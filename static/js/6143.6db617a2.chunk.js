"use strict";(self.webpackChunkamit_kumar_rathi=self.webpackChunkamit_kumar_rathi||[]).push([[6143],{76143:function(e,t,r){r.d(t,{q:function(){return et}});var n=r(29439),i=r(1413),a=r(37762),s=r(74165),u=r(15861),o=r(43144),l=r(15671),c=r(63780),h=r(10064),f=r(46784),d=r(84652),p=r(92026),v=r(18759),y=r(66978),m=r(68860),g=r(45925),_=r(41414),x=r(65156),k=r(376),b=r(77981),T=r(91340),E=r(92975),I=r(83406),S=r(93433),F=r(16054),R=r(54054),Z=function(){function e(t,r){(0,l.Z)(this,e),this._cache=new F.z(t),this._invalidCache=new F.z(r)}return(0,o.Z)(e,[{key:"get",value:function(e,t){var r="".concat(t.uid,":").concat(e),n=this._cache.get(r);if(n)return n;if(null!=this._invalidCache.get(r))return null;try{var i=R.WhereClause.create(e,t);return this._cache.put(r,i),i}catch(N){return this._invalidCache.put(r,N),null}}},{key:"getError",value:function(e,t){var r,n="".concat(t.uid,":").concat(e);return null!==(r=this._invalidCache.get(n))&&void 0!==r?r:null}}]),e}(),w=r(85249),A=new Z(50,500),C="unsupported-query",N=" as ",O=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),D=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),P=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID"].concat((0,S.Z)(O),(0,S.Z)(D)));function L(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=Q(t,e);if(!n){var i=A.getError(t,e);throw new h.Z(C,"invalid SQL expression",{expression:t,error:i})}var a=r.expressionName||"expression";if(r.validateStandardized&&!n.isStandardized)throw new h.Z(C,"".concat(a," is not standard"),{expression:t});if(r.validateAggregate&&!n.isAggregate)throw new h.Z(C,"".concat(a," does not contain a valid aggregate function"),{expression:t});return n.fieldNames}function Q(e,t){return e?A.get(e,t):null}function G(e){return/\((.*?)\)/.test(e)?e:e.split(N)[0]}function V(e,t,r){var n,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=new Map;if(function(e,t,r,n,s){var u,o=(0,a.Z)(s);try{for(o.s();!(u=o.n()).done;){var l=u.value;if("*"!==l)if(t.get(l))M(e,t,r,n,l);else try{var c,h=L(t,G(l),{validateStandardized:!0}),f=(0,a.Z)(h);try{for(f.s();!(c=f.n()).done;){M(e,t,r,n,c.value)}}catch(d){f.e(d)}finally{f.f()}}catch(i){e.set(l,{type:"expression-error",expression:l,error:i})}}}catch(d){o.e(d)}finally{o.f()}}(s,e,t,null!==(n=i.allowedFieldTypes)&&void 0!==n?n:P,r),s.size){var u,o=null!==(u=i.expressionName)&&void 0!==u?u:"expression";throw new h.Z(C,"".concat(o," contains invalid or missing fields"),{errors:Array.from(s.values()),query:i.query})}}function M(e,t,r,n,i){if("*"!==i){var a=t.get(i);a?r.has(a.name)?!1===(null===n||void 0===n?void 0:n.has(a.type))&&e.set(i,{type:"invalid-type",fieldName:a.name,fieldType:w.v.fromJSON(a.type),allowedFieldTypes:Array.from(n,(function(e){return w.v.fromJSON(e)}))}):e.set(i,{type:"missing-field",fieldName:a.name}):e.set(i,{type:"invalid-field",fieldName:i})}}var U=r(3306),q=r(19995),z=r(60480),B=r(4954),H=r(94446),j=r(58971),Y=r(37270),W=r(95281),X=r(71486),J=r(819),K=function(){function e(t,r,n){var i;(0,l.Z)(this,e),this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=null!==(i=t.returnDistinctValues)&&void 0!==i&&i,this.fieldsIndex=n,this.featureAdapter=r;var s=t.outFields;if(s&&!s.includes("*")){this.outFields=s;var u,o=0,c=(0,a.Z)(s);try{for(c.s();!(u=c.n()).done;){var h=u.value,f=G(h),d=this.fieldsIndex.get(f),p=d?null:Q(f,n),v=d?d.name:h.split(N)[1]||"FIELD_EXP_"+o++;this._fieldDataCache.set(h,{alias:v,clause:p})}}catch(y){c.e(y)}finally{c.f()}}}return(0,o.Z)(e,[{key:"countDistinctValues",value:function(e){var t=this;return this.returnDistinctValues?(e.forEach((function(e){return t.getAttributes(e)})),this._returnDistinctMap.size):e.length}},{key:"getAttributes",value:function(e){var t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}},{key:"getFieldValue",value:function(e,t,r){var n,i,a=r?r.name:t,s=null;return this._fieldDataCache.has(a)?s=null===(n=this._fieldDataCache.get(a))||void 0===n?void 0:n.clause:r||(s=Q(t,this.fieldsIndex),this._fieldDataCache.set(a,{alias:a,clause:s})),r?this.featureAdapter.getAttribute(e,a):null===(i=s)||void 0===i?void 0:i.calculateValue(e,this.featureAdapter)}},{key:"getDataValues",value:function(e,t){var r=this,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=t.normalizationType,a=t.normalizationTotal,s=this.fieldsIndex.get(t.field),u=(0,Y.UQ)(s)||(0,Y.ig)(s),o=(0,Y.sX)(s);return e.map((function(e){var s=t.field&&r.getFieldValue(e,t.field,r.fieldsIndex.get(t.field));if(t.field2?(s="".concat((0,X.wk)(s)).concat(t.fieldDelimiter).concat((0,X.wk)(r.getFieldValue(e,t.field2,r.fieldsIndex.get(t.field2)))),t.field3&&(s="".concat(s).concat(t.fieldDelimiter).concat((0,X.wk)(r.getFieldValue(e,t.field3,r.fieldsIndex.get(t.field3)))))):"string"==typeof s&&n&&(u?s=s?new Date(s).getTime():null:o&&(s=s?(0,W.yO)(s):null)),i&&Number.isFinite(s)){var l="field"===i&&t.normalizationField?r.getFieldValue(e,t.normalizationField,r.fieldsIndex.get(t.normalizationField)):null;s=(0,X.fk)(s,i,l,a)}return s}))}},{key:"getExpressionValues",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,a,u){var o,l,c,h,f,d,p=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,J.LC)();case 2:if(o=e.sent,l=o.arcadeUtils,c=l.hasGeometryOperations(r),e.t0=c,!e.t0){e.next=9;break}return e.next=9,l.enableGeometryOperations();case 9:return h=l.createFunction(r),f=l.getViewInfo(n),d={fields:this.fieldsIndex.fields},e.abrupt("return",t.map((function(e){var t={attributes:p.featureAdapter.getAttributes(e),layer:d,geometry:c?(0,i.Z)((0,i.Z)({},(0,U.Op)(a.geometryType,a.hasZ,a.hasM,p.featureAdapter.getGeometry(e))),{},{spatialReference:null===n||void 0===n?void 0:n.spatialReference}):null},r=l.createExecContext(t,f,u);return l.executeFunction(h,r)})));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"validateItem",value:function(e,t){var r,n;return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:Q(t,this.fieldsIndex)}),null!==(r=null===(n=this._fieldDataCache.get(t))||void 0===n||null===(n=n.clause)||void 0===n?void 0:n.testFeature(e,this.featureAdapter))&&void 0!==r&&r}},{key:"validateItems",value:function(e,t){var r,n;return this._fieldDataCache.has(t)||this._fieldDataCache.set(t,{alias:t,clause:Q(t,this.fieldsIndex)}),null!==(r=null===(n=this._fieldDataCache.get(t))||void 0===n||null===(n=n.clause)||void 0===n?void 0:n.testSet(e,this.featureAdapter))&&void 0!==r&&r}},{key:"_processAttributesForOutFields",value:function(e){var t=this.outFields;if(null===t||void 0===t||!t.length)return this.featureAdapter.getAttributes(e);var r,n={},i=(0,a.Z)(t);try{for(i.s();!(r=i.n()).done;){var s=r.value,u=this._fieldDataCache.get(s),o=u.alias,l=u.clause;n[o]=l?l.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,o)}}catch(c){i.e(c)}finally{i.f()}return n}},{key:"_processAttributesForDistinctValues",value:function(e){if(null==e||!this.returnDistinctValues)return e;var t=this.outFields,r=[];if(t){var n,i=(0,a.Z)(t);try{for(i.s();!(n=i.n()).done;){var s=n.value,u=this._fieldDataCache.get(s).alias;r.push(e[u])}}catch(h){i.e(h)}finally{i.f()}}else for(var o in e)r.push(e[o]);var l="".concat((t||["*"]).join(","),"=").concat(r.join(",")),c=this._returnDistinctMap.get(l)||0;return this._returnDistinctMap.set(l,++c),c>1?null:e}}]),e}();function $(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}}function ee(e,t,r,n,i){return{objectId:e,target:t,distance:r,type:"edge",start:n,end:i,draped:arguments.length>5&&void 0!==arguments[5]&&arguments[5]}}var te=function(){function e(t,r,n){(0,l.Z)(this,e),this.items=t,this.query=r,this.geometryType=n.geometryType,this.hasM=n.hasM,this.hasZ=n.hasZ,this.fieldsIndex=n.fieldsIndex,this.objectIdField=n.objectIdField,this.spatialReference=n.spatialReference,this.featureAdapter=n.featureAdapter}return(0,o.Z)(e,[{key:"size",get:function(){return this.items.length}},{key:"createQueryResponseForCount",value:function(){var e=new K(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);var t=this.query,r=t.groupByFieldsForStatistics,n=t.having,i=t.outStatistics;if(!(null===r||void 0===r?void 0:r.length))return 1;var s,u=new Map,o=new Map,l=new Set,c=(0,a.Z)(i);try{for(c.s();!(s=c.n()).done;){var h=s.value,f="exceedslimit"!==h.statisticType?h.onStatisticField:void 0;if(!o.has(f)){var d,p=[],v=(0,a.Z)(r);try{for(v.s();!(d=v.n()).done;){var y=d.value,m=this._getAttributeValues(e,y,u);p.push(m)}}catch(E){v.e(E)}finally{v.f()}o.set(f,this._calculateUniqueValues(p,e.returnDistinctValues))}var g=o.get(f);for(var _ in g){var x=g[_],k=x.data,b=x.items,T=k.join(",");n&&!e.validateItems(b,n)||l.add(T)}}}catch(E){c.e(E)}finally{c.f()}return l.size}},{key:"createQueryResponse",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.query.outStatistics){e.next=11;break}if(!this.query.outStatistics.some((function(e){return"exceedslimit"===e.statisticType}))){e.next=5;break}e.t0=this._createExceedsLimitQueryResponse(this.query),e.next=8;break;case 5:return e.next=7,this._createStatisticsQueryResponse(this.query);case 7:e.t0=e.sent;case 8:t=e.t0,e.next=12;break;case 11:t=this._createFeatureQueryResponse(this.query);case 12:return this.query.returnQueryGeometry&&(r=this.query.geometry,(0,E.JY)(this.query.outSR)&&!(0,E.fS)(r.spatialReference,this.query.outSR)?t.queryGeometry=(0,U.S2)((0,i.Z)({spatialReference:this.query.outSR},(0,q.iV)(r,r.spatialReference,this.query.outSR))):t.queryGeometry=(0,U.S2)((0,i.Z)({spatialReference:this.query.outSR},r))),e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createSnappingResponse",value:function(e,t){var r,n=this.featureAdapter,i=ne(this.hasZ,this.hasM),s=e.point,u=e.mode,o="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,c={candidates:[]},h="esriGeometryPolygon"===this.geometryType,f=this._getPointCreator(u,this.spatialReference,t),d=new ie(null,0),p=new ie(null,0),v={x:0,y:0,z:0},y=(0,a.Z)(this.items);try{for(y.s();!(r=y.n()).done;){var m=r.value,g=n.getGeometry(m);if(null!=g){var _=g.coords,x=g.lengths;if(d.coords=_,p.coords=_,e.returnEdge)for(var k=0,b=0;b<x.length;b++)for(var T=x[b],E=0;E<T;E++,k+=i){var I=d;if(I.coordsIndex=k,E!==T-1){var S=p;S.coordsIndex=k+i;var F=v;re(v,s,I,S);var R=(s.x-F.x)/o,Z=(s.y-F.y)/l,w=R*R+Z*Z;w<=1&&c.candidates.push(ee(n.getObjectId(m),f(F),Math.sqrt(w),f(I),f(S)))}}if("none"!==e.vertexMode){var A=h?_.length-i:_.length;if("all"===e.vertexMode)for(var C=0;C<A;C+=i){var N=d;N.coordsIndex=C;var O=(s.x-N.x)/o,D=(s.y-N.y)/l,P=O*O+D*D;P<=1&&c.candidates.push($(n.getObjectId(m),f(N),Math.sqrt(P)))}else if("ends"===e.vertexMode){var L=[0];h||L.push(_.length-i);for(var Q=0,G=L;Q<G.length;Q++){var V=G[Q],M=d;M.coordsIndex=V;var U=(s.x-M.x)/o,q=(s.y-M.y)/l,z=U*U+q*q;z<=1&&c.candidates.push($(n.getObjectId(m),f(M),Math.sqrt(z)))}}}}}}catch(B){y.e(B)}finally{y.f()}return c.candidates.sort((function(e,t){return e.distance-t.distance})),c}},{key:"_getPointCreator",value:function(e,t,r){var n=null==r||(0,E.fS)(t,r)?function(e){return e}:function(e){return(0,q.iV)(e,t,r)},i=this.hasZ;return"3d"===e?i?function(e){var t=e.x,r=e.y,i=e.z;return n({x:t,y:r,z:i})}:function(e){var t=e.x,r=e.y;return n({x:t,y:r,z:0})}:function(e){var t=e.x,r=e.y;return n({x:t,y:r})}}},{key:"createSummaryStatisticsResponse",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,h,f,d,p,v,y,m;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,i=t.normalizationField,a=t.normalizationType,u=t.normalizationTotal,o=t.minValue,l=t.maxValue,c=t.scale,h=t.timeZone,f=this.fieldsIndex.get(r),d=(0,Y.y2)(f)||(0,Y.UQ)(f)||(0,Y.ig)(f),e.next=13,this._getDataValues({field:r,valueExpression:n,normalizationField:i,normalizationType:a,normalizationTotal:u,scale:c,timeZone:h});case 13:return p=e.sent,v=(0,X.S5)({normalizationType:a,normalizationField:i,minValue:o,maxValue:l}),y={value:.5,fieldType:null===f||void 0===f?void 0:f.type},m=(0,Y.qN)(f)?(0,X.H0)({values:p,supportsNullCount:v,percentileParams:y}):(0,X.i5)({values:p,minValue:o,maxValue:l,useSampleStdDev:!a,supportsNullCount:v,percentileParams:y}),e.abrupt("return",(0,X.F_)(m,d));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createUniqueValuesResponse",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,i=t.domains,a=t.returnAllCodedValues,u=t.scale,o=t.timeZone,e.next=8,this._getDataValues({field:r,field2:t.field2,field3:t.field3,fieldDelimiter:t.fieldDelimiter,valueExpression:n,scale:u,timeZone:o},!1);case 8:return l=e.sent,c=(0,X.eT)(l),e.abrupt("return",(0,X.Qm)(c,i,a,t.fieldDelimiter));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createClassBreaksResponse",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,h,f,d,p,v,y;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,i=t.normalizationField,a=t.normalizationType,u=t.normalizationTotal,o=t.classificationMethod,l=t.standardDeviationInterval,c=t.minValue,h=t.maxValue,f=t.numClasses,d=t.scale,p=t.timeZone,e.next=14,this._getDataValues({field:r,valueExpression:n,normalizationField:i,normalizationType:a,normalizationTotal:u,scale:d,timeZone:p});case 14:return v=e.sent,y=(0,X.G2)(v,{field:r,normalizationField:i,normalizationType:a,normalizationTotal:u,classificationMethod:o,standardDeviationInterval:l,minValue:c,maxValue:h,numClasses:f}),e.abrupt("return",(0,X.DL)(y,o));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createHistogramResponse",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o,l,c,h,f,d,p,v;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.field,n=t.valueExpression,i=t.normalizationField,a=t.normalizationType,u=t.normalizationTotal,o=t.classificationMethod,l=t.standardDeviationInterval,c=t.minValue,h=t.maxValue,f=t.numBins,d=t.scale,p=t.timeZone,e.next=14,this._getDataValues({field:r,valueExpression:n,normalizationField:i,normalizationType:a,normalizationTotal:u,scale:d,timeZone:p});case 14:return v=e.sent,e.abrupt("return",(0,X.oF)(v,{field:r,normalizationField:i,normalizationType:a,normalizationTotal:u,classificationMethod:o,standardDeviationInterval:l,minValue:c,maxValue:h,numBins:f}));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sortFeatures",value:function(e,t,r){var n=this;if(e.length>1&&null!==t&&void 0!==t&&t.length){var i,s=(0,a.Z)(t.reverse());try{var u=function(){var t=i.value.split(" "),a=t[0],s=n.fieldsIndex.get(a),u=!!t[1]&&"desc"===t[1].toLowerCase(),o=(0,X.Lq)(null===s||void 0===s?void 0:s.type,u);e.sort((function(e,t){var n=r(e,a,s),i=r(t,a,s);return o(n,i)}))};for(s.s();!(i=s.n()).done;)u()}catch(o){s.e(o)}finally{s.f()}}}},{key:"_createFeatureQueryResponse",value:function(e){var t=this,r=this.items,n=this.geometryType,i=this.hasM,a=this.hasZ,s=this.objectIdField,u=this.spatialReference,o=e.outFields,l=e.outSR,c=e.quantizationParameters,h=e.resultRecordCount,f=e.resultOffset,d=e.returnZ,p=e.returnM,v=null!=h&&r.length>(f||0)+h,y=o&&(o.includes("*")?(0,S.Z)(this.fieldsIndex.fields):o.map((function(e){return t.fieldsIndex.get(e)})));return{exceededTransferLimit:v,features:this._createFeatures(e,r),fields:y,geometryType:n,hasM:i&&p,hasZ:a&&d,objectIdFieldName:s,spatialReference:(0,U.S2)(l||u),transform:c&&(0,j.vY)(c)||null}}},{key:"_createFeatures",value:function(e,t){var r=new K(e,this.featureAdapter,this.fieldsIndex),n=this.hasM,i=this.hasZ,s=e.orderByFields,u=e.quantizationParameters,o=e.returnGeometry,l=e.returnCentroid,c=e.maxAllowableOffset,h=e.resultOffset,f=e.resultRecordCount,d=e.returnZ,p=void 0!==d&&d,v=e.returnM,y=i&&p,m=n&&(void 0!==v&&v),g=[],_=0,x=(0,S.Z)(t);if(this._sortFeatures(x,s,(function(e,t,n){return r.getFieldValue(e,t,n)})),this.geometryType&&(o||l)){var k,b=null!==(k=(0,j.vY)(u))&&void 0!==k?k:void 0;if(o&&!l){var T,E=(0,a.Z)(x);try{for(E.s();!(T=E.n()).done;){var I=T.value;g[_++]={attributes:r.getAttributes(I),geometry:(0,U.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(I),c,b,y,m)}}}catch(G){E.e(G)}finally{E.f()}}else if(!o&&l){var F,R=(0,a.Z)(x);try{for(R.s();!(F=R.n()).done;){var Z=F.value;g[_++]={attributes:r.getAttributes(Z),centroid:(0,U.EG)(this,this.featureAdapter.getCentroid(Z,this),b)}}}catch(G){R.e(G)}finally{R.f()}}else{var w,A=(0,a.Z)(x);try{for(A.s();!(w=A.n()).done;){var C=w.value;g[_++]={attributes:r.getAttributes(C),centroid:(0,U.EG)(this,this.featureAdapter.getCentroid(C,this),b),geometry:(0,U.Op)(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(C),c,b,y,m)}}}catch(G){A.e(G)}finally{A.f()}}}else{var N,O=(0,a.Z)(x);try{for(O.s();!(N=O.n()).done;){var D=N.value,P=r.getAttributes(D);P&&(g[_++]={attributes:P})}}catch(G){O.e(G)}finally{O.f()}}var L=h||0;if(null!=f){var Q=L+f;g=g.slice(L,Math.min(g.length,Q))}return g}},{key:"_createExceedsLimitQueryResponse",value:function(e){var t,r,n=!1,i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,u=Number.POSITIVE_INFINITY,o=(0,a.Z)(null!==(t=e.outStatistics)&&void 0!==t?t:[]);try{for(o.s();!(r=o.n()).done;){var l=r.value;if("exceedslimit"===l.statisticType){i=null!=l.maxPointCount?l.maxPointCount:Number.POSITIVE_INFINITY,s=null!=l.maxRecordCount?l.maxRecordCount:Number.POSITIVE_INFINITY,u=null!=l.maxVertexCount?l.maxVertexCount:Number.POSITIVE_INFINITY;break}}}catch(f){o.e(f)}finally{o.f()}if("esriGeometryPoint"===this.geometryType)n=this.items.length>i;else if(this.items.length>s)n=!0;else{var c=ne(this.hasZ,this.hasM),h=this.featureAdapter;n=this.items.reduce((function(e,t){var r=h.getGeometry(t);return e+(null!=r&&r.coords.length||0)}),0)/c>u}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(n)}}]}}},{key:"_createStatisticsQueryResponse",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,u,o,l,c,h,f,d,p,v,y,m,g,_,x,k,b,T,E,I,S,F,R,Z,w,A,C,N,O,D,P,L,Q,G,V,M,U,q,z,B,H,j=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r={attributes:{}},n=[],i=new Map,u=new Map,o=new Map,l=new Map,c=new K(t,this.featureAdapter,this.fieldsIndex),h=t.outStatistics,f=t.groupByFieldsForStatistics,d=t.having,p=t.orderByFields,v=t.resultRecordCount,y=null===f||void 0===f?void 0:f.length,g=(m=!!y)?f[0]:null,_=m&&!this.fieldsIndex.get(g),x=(0,a.Z)(null!==h&&void 0!==h?h:[]),e.prev=2,x.s();case 4:if((k=x.n()).done){e.next=38;break}if(T=k.value,E=T.outStatisticFieldName,I=T.statisticType,S=T,F="exceedslimit"!==I?T.onStatisticField:void 0,R="percentile_disc"===I||"percentile_cont"===I,Z="EnvelopeAggregate"===I||"CentroidAggregate"===I||"ConvexHullAggregate"===I,w=m&&1===y&&(F===g||_)&&"count"===I,!m){e.next=22;break}if(!o.has(F)){A=[],C=(0,a.Z)(f);try{for(C.s();!(N=C.n()).done;)O=N.value,D=this._getAttributeValues(c,O,i),A.push(D)}catch(W){C.e(W)}finally{C.f()}o.set(F,this._calculateUniqueValues(A,!Z&&c.returnDistinctValues))}if(P=o.get(F)){e.next=12;break}return e.abrupt("continue",36);case 12:L=Object.keys(P),Q=(0,s.Z)().mark((function e(){var t,r,n,a,u,o,h,p,v,y,m,g,_,x,k;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=V[G],r=P[t],n=r.count,a=r.data,u=r.items,o=r.itemPositions,h=a.join(","),d&&!c.validateItems(u,d)){e.next=19;break}if(p=l.get(h)||{attributes:{}},!Z){e.next=14;break}return p.aggregateGeometries||(p.aggregateGeometries={}),e.next=8,j._getAggregateGeometry(S,u);case 8:v=e.sent,y=v.aggregateGeometries,m=v.outStatisticFieldName,p.aggregateGeometries[m]=y,e.next=17;break;case 14:g=null,w?g=n:(_=j._getAttributeValues(c,F,i),x=o.map((function(e){return _[e]})),g=R&&"statisticParameters"in S?j._getPercentileValue(S,x):j._getStatisticValue(S,x,null,c.returnDistinctValues)),p.attributes[E]=g;case 17:k=0,f.forEach((function(e,t){return p.attributes[j.fieldsIndex.get(e)?e:"EXPR_"+ ++k]=a[t]})),l.set(h,p);case 19:case"end":return e.stop()}}),e)})),G=0,V=L;case 15:if(!(G<V.length)){e.next=20;break}return e.delegateYield(Q(),"t0",17);case 17:G++,e.next=15;break;case 20:e.next=34;break;case 22:if(!Z){e.next=32;break}return r.aggregateGeometries||(r.aggregateGeometries={}),e.next=26,this._getAggregateGeometry(S,this.items);case 26:M=e.sent,U=M.aggregateGeometries,q=M.outStatisticFieldName,r.aggregateGeometries[q]=U,e.next=34;break;case 32:z=this._getAttributeValues(c,F,i),r.attributes[E]=R&&"statisticParameters"in S?this._getPercentileValue(S,z):this._getStatisticValue(S,z,u,c.returnDistinctValues);case 34:B="min"!==I&&"max"!==I||!(0,Y.qN)(this.fieldsIndex.get(F))&&!this._isAnyDateField(F)?null:null===(b=this.fieldsIndex.get(F))||void 0===b?void 0:b.type,n.push({name:E,alias:E,type:B||"esriFieldTypeDouble"});case 36:e.next=4;break;case 38:e.next=43;break;case 40:e.prev=40,e.t1=e.catch(2),x.e(e.t1);case 43:return e.prev=43,x.f(),e.finish(43);case 46:return H=m?Array.from(l.values()):[r],e.abrupt("return",(this._sortFeatures(H,p,(function(e,t){return e.attributes[t]})),v&&(H.length=Math.min(v,H.length)),{fields:n,features:H}));case 48:case"end":return e.stop()}}),e,this,[[2,40,43,46]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_isAnyDateField",value:function(e){var t=this.fieldsIndex.get(e);return(0,Y.y2)(t)||(0,Y.UQ)(t)||(0,Y.ig)(t)||(0,Y.sX)(t)}},{key:"_getAggregateGeometry",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,n){var a,u,o,l,c,h,f,d,p,v,y,m,g,_,x;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([r.e(9058),r.e(3645)]).then(r.bind(r,50309));case 2:return a=e.sent,u=a.convexHull,o=a.union,l=t.statisticType,c=t.outStatisticFieldName,h=this.featureAdapter,f=this.spatialReference,d=this.geometryType,p=this.hasZ,v=this.hasM,y=n.map((function(e){return(0,U.Op)(d,p,v,h.getGeometry(e))})),m=u(f,y,!0)[0],g={aggregateGeometries:null,outStatisticFieldName:null},"EnvelopeAggregate"===l?(_=m?(0,H._w)(m):(0,H.aO)(o(f,y)),g.aggregateGeometries=(0,i.Z)((0,i.Z)({},_),{},{spatialReference:f}),g.outStatisticFieldName=c||"extent"):"CentroidAggregate"===l?(x=m?(0,B.tO)(m):(0,B.$G)((0,H.aO)(o(f,y))),g.aggregateGeometries={x:x[0],y:x[1],spatialReference:f},g.outStatisticFieldName=c||"centroid"):"ConvexHullAggregate"===l&&(g.aggregateGeometries=m,g.outStatisticFieldName=c||"convexHull"),e.abrupt("return",g);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getStatisticValue",value:function(e,t,r,n){var i,a=e.onStatisticField,s=e.statisticType;return i=null!==r&&void 0!==r&&r.has(a)?r.get(a):(0,Y.qN)(this.fieldsIndex.get(a))||this._isAnyDateField(a)?(0,X.H0)({values:t,returnDistinct:n}):(0,X.i5)({values:n?(0,S.Z)(new Set(t)):t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(a,i),i["var"===s?"variance":s]}},{key:"_getPercentileValue",value:function(e,t){var r=e.onStatisticField,n=e.statisticParameters,i=e.statisticType,a=n.value,s=n.orderBy,u=this.fieldsIndex.get(r);return(0,X.XL)(t,{value:a,orderBy:s,fieldType:null===u||void 0===u?void 0:u.type,isDiscrete:"percentile_disc"===i})}},{key:"_getAttributeValues",value:function(e,t,r){if(r.has(t))return r.get(t);var n=this.fieldsIndex.get(t),i=this.items.map((function(r){return e.getFieldValue(r,t,n)}));return r.set(t,i),i}},{key:"_calculateUniqueValues",value:function(e,t){for(var r={},n=this.items,i=n.length,s=0;s<i;s++){var u,o=n[s],l=[],c=(0,a.Z)(e);try{for(c.s();!(u=c.n()).done;){var h=u.value;l.push(h[s])}}catch(d){c.e(d)}finally{c.f()}var f=l.join(",");null==r[f]?r[f]={count:1,data:l,items:[o],itemPositions:[s]}:(t||r[f].count++,r[f].items.push(o),r[f].itemPositions.push(s))}return r}},{key:"_getDataValues",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i,a,u,o=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=!(o.length>1&&void 0!==o[1])||o[1],n=new K(this.query,this.featureAdapter,this.fieldsIndex),i=t.valueExpression,a=t.scale,u=t.timeZone,e.abrupt("return",i?n.getExpressionValues(this.items,i,{viewingMode:"map",scale:a,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},u):n.getDataValues(this.items,(0,d.d9)(t),r));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function re(e,t,r,n){var i=n.x-r.x,a=n.y-r.y,s=i*i+a*a,u=(t.x-r.x)*i+(t.y-r.y)*a,o=Math.min(1,Math.max(0,u/s));e.x=r.x+i*o,e.y=r.y+a*o}function ne(e,t){return e?t?4:3:t?3:2}var ie=function(){function e(t,r){(0,l.Z)(this,e),this.coords=t,this.coordsIndex=r}return(0,o.Z)(e,[{key:"x",get:function(){return this.coords[this.coordsIndex]}},{key:"y",get:function(){return this.coords[this.coordsIndex+1]}},{key:"z",get:function(){return this.coords[this.coordsIndex+2]}}]),e}(),ae=r(20994),se=r(77095),ue="unsupported-query";function oe(e,t){return le.apply(this,arguments)}function le(){return le=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=r.fieldsIndex,a=r.geometryType,u=r.spatialReference,o=r.availableFields,!((null!==(n=t.distance)&&void 0!==n?n:0)<0||null!=t.geometryPrecision||t.multipatchOption&&"xyFootprint"!==t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=3;break}throw new h.Z(ue,"Unsupported query options",{query:t});case 3:return e.abrupt("return",(ce(i,o,t),fe(i,o,t),Promise.all([(0,se.P0)(t,a,u),(0,q._W)(u,t.outSR)]).then((function(){return t}))));case 4:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}function ce(e,t,r){var n=r.outFields,i=r.orderByFields,a=r.returnDistinctValues,s=r.outStatistics,u=s?s.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})).filter(Boolean):[];if(i&&i.length>0){var o=" asc",l=" desc",c=i.map((function(e){var t=e.toLowerCase();return t.includes(o)?t.split(o)[0]:t.includes(l)?t.split(l)[0]:e})).filter((function(e){return!u.includes(e)}));V(e,t,c,{expressionName:"orderByFields",query:r})}if(n&&n.length>0)V(e,t,n,{expressionName:"outFields",query:r});else if(a)throw new h.Z(ue,"outFields should be specified for returnDistinctValues",{query:r});!function(e,t,r,n){if(!r)return!0;var i="where clause";V(e,t,L(e,r,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:n})}(e,t,r.where,r)}var he=new Set([].concat((0,S.Z)(O),(0,S.Z)(D)));function fe(e,t,r){var n,i=r.outStatistics,s=r.groupByFieldsForStatistics,u=r.having,o=null===s||void 0===s?void 0:s.length,l=null===i||void 0===i?void 0:i.length;if(u){if(!o||!l)throw new h.Z(ue,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:r});!function(e,t,r,n,i){if(!r)return!0;var a="having clause",s=L(e,r,{validateAggregate:!0,expressionName:a});V(e,t,s,{expressionName:a,query:i});var u=Q(r,e),o=null===u||void 0===u?void 0:u.getExpressions().every((function(t){var r,i=t.aggregateType,a=t.field,s=null===(r=e.get(a))||void 0===r?void 0:r.name;return n.some((function(t){var r,n=t.onStatisticField,a=t.statisticType;return(null===(r=e.get(n))||void 0===r?void 0:r.name)===s&&a.toLowerCase().trim()===i}))}));if(!o)throw new h.Z(C,"expressions in having clause should also exist in outStatistics",{having:r})}(e,t,u,i,r)}if(l){if(null==(n=i)||!n.every((function(e){return"exceedslimit"!==e.statisticType})))return;var c=i.map((function(e){return e.onStatisticField})).filter(Boolean);V(e,t,c,{expressionName:"onStatisticFields",query:r}),o&&V(e,t,s,{expressionName:"groupByFieldsForStatistics",query:r});var f,d=(0,a.Z)(i);try{for(d.s();!(f=d.n()).done;){var p=f.value,v=p.onStatisticField,y=p.statisticType;if("percentile_disc"!==y&&"percentile_cont"!==y||!("statisticParameters"in p))e.get(v)&&"count"!==y&&"min"!==y&&"max"!==y&&V(e,t,[v],{expressionName:"outStatistics with '".concat(y,"' statistic type"),allowedFieldTypes:he,query:r});else if(!p.statisticParameters)throw new h.Z(ue,"statisticParameters should be set for percentile type",{definition:p,query:r})}}catch(m){d.e(m)}finally{d.f()}}}function de(e,t,r){return pe.apply(this,arguments)}function pe(){return pe=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,a,u,o,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.fieldsIndex,u=n.geometryType,o=n.spatialReference,l=n.availableFields,!((null!==(i=t.distance)&&void 0!==i?i:0)<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=3;break}throw new h.Z(ue,"Unsupported query options",{query:t});case 3:return e.abrupt("return",(ce(a,l,t),Promise.all([ve(a,l,r,t),(0,se.P0)(t,u,o),(0,q._W)(o,t.outSR)]).then((function(){return t}))));case 4:case"end":return e.stop()}}),e)}))),pe.apply(this,arguments)}function ve(e,t,r,n){return ye.apply(this,arguments)}function ye(){return ye=(0,u.Z)((0,s.Z)().mark((function e(t,r,n,i){var a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!n.valueExpression){e.next=7;break}return e.next=4,(0,J.LC)();case 4:u=e.sent,o=u.arcadeUtils,a=o.extractFieldNames(n.valueExpression);case 7:if(n.field&&a.push(n.field),n.field2&&a.push(n.field2),n.field3&&a.push(n.field3),n.normalizationField&&a.push(n.normalizationField),a.length||n.valueExpression){e.next=9;break}throw new h.Z(ue,"field or valueExpression is required",{params:n});case 9:V(t,r,a,{expressionName:"statistics",query:i});case 10:case"end":return e.stop()}}),e)}))),ye.apply(this,arguments)}var me=r(20311),ge=r(52410),_e=r(100),xe=(r(93169),r(32718)),ke=r(90941),be=r(27546),Te=r(94172),Ee=r(76432),Ie=r(38499),Se=function(){function e(){(0,l.Z)(this,e),this._tasks=new Array,this._running=(0,Ee.t)(!1)}return(0,o.Z)(e,[{key:"length",get:function(){return this._tasks.length}},{key:"running",get:function(){return this._running.value}},{key:"destroy",value:function(){this.cancelAll()}},{key:"runTask",value:function(e){for(;!e.done&&this._process(e);)e.madeProgress()}},{key:"push",value:function(e,t,r){var n=this;return this._running.value=!0,new Promise((function(i,a){return n._tasks.push(new Fe(i,a,e,t,r))}))}},{key:"unshift",value:function(e,t,r){var n=this;return this._running.value=!0,new Promise((function(i,a){return n._tasks.unshift(new Fe(i,a,e,t,r))}))}},{key:"_process",value:function(e){if(0===this._tasks.length)return!1;var t=this._tasks.shift();try{var r=(0,y.Hc)(t.signal);if(r&&!t.abortCallback)t.reject((0,y.zE)());else{var n,i=r?null===(n=t.abortCallback)||void 0===n?void 0:n.call(t,(0,y.zE)()):t.callback(e);(0,y.y8)(i)?i.then(t.resolve,t.reject):t.resolve(i)}}catch(Fe){t.reject(Fe)}return this._running.value=this._tasks.length>0,!0}},{key:"cancelAll",value:function(){var e,t=(0,y.zE)(),r=(0,a.Z)(this._tasks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.abortCallback){var i=n.abortCallback(t);n.resolve(i)}else n.reject(t)}}catch(s){r.e(s)}finally{r.f()}this._tasks.length=0,this._running.value=!1}}]),e}(),Fe=(0,o.Z)((function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;(0,l.Z)(this,e),this.resolve=t,this.reject=r,this.callback=n,this.signal=i,this.abortCallback=a})),Re=r(60136),Ze=r(29388),we=r(27366),Ae=r(7138),Ce=r(49861),Ne=(r(25243),r(69912)),Oe=function(e){(0,Re.Z)(r,e);var t=(0,Ze.Z)(r);function r(){var e;return(0,l.Z)(this,r),(e=t.apply(this,arguments)).SCHEDULER_LOG_SLOW_TASKS=!1,e.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1,e}return(0,o.Z)(r)}(Ae.Z);(0,we._)([(0,Ce.Cb)()],Oe.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),(0,we._)([(0,Ce.Cb)()],Oe.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0);var De,Pe,Le,Qe=new(Oe=(0,we._)([(0,Ne.j)("esri.views.support.DebugFlags")],Oe)),Ge=r(75248);(Le=De||(De={}))[Le.YIELD=1]="YIELD",function(e){e.RESOURCE_CONTROLLER_IMMEDIATE="immediate",e.RESOURCE_CONTROLLER="schedule",e.SLIDE="slide",e.STREAM_DATA_LOADER="stream loader",e.ELEVATION_QUERY="elevation query",e.TERRAIN_SURFACE="terrain",e.SURFACE_GEOMETRY_UPDATES="surface geometry updates",e.LOD_RENDERER="LoD renderer",e.GRAPHICS_CORE="Graphics3D",e.I3S_CONTROLLER="I3S",e.POINT_CLOUD_LAYER="point cloud",e.FEATURE_TILE_FETCHER="feature fetcher",e.OVERLAY="overlay",e.STAGE="stage",e.GRAPHICS_DECONFLICTOR="graphics deconflictor",e.FILTER_VISIBILITY="Graphics3D filter visibility",e.SCALE_VISIBILITY="Graphics3D scale visibility",e.FRUSTUM_VISIBILITY="Graphics3D frustum visibility",e.POINT_OF_INTEREST_FREQUENT="POI frequent",e.POINT_OF_INTEREST_INFREQUENT="POI infrequent",e.LABELER="labeler",e.FEATURE_QUERY_ENGINE="feature query",e.FEATURE_TILE_TREE="feature tile tree",e.FEATURE_TILE_TREE_ACTIVE="fast feature tile tree",e.ELEVATION_ALIGNMENT="elevation alignment",e.TEXT_TEXTURE_ATLAS="text texture atlas",e.TEXTURE_UNLOAD="texture unload",e.LINE_OF_SIGHT_TOOL="line of sight tool",e.LINE_OF_SIGHT_TOOL_INTERACTIVE="interactive line of sight tool",e.ELEVATION_PROFILE="elevation profile",e.SNAPPING="snapping",e.SHADOW_ACCUMULATOR="shadow accumulator",e.CLOUDS_GENERATOR="clouds generator",e[e.NONE=0]="NONE",e[e.TEST_PRIO=1]="TEST_PRIO"}(Pe||(Pe={}));var Ve=new Map([[Pe.RESOURCE_CONTROLLER_IMMEDIATE,0],[Pe.RESOURCE_CONTROLLER,4],[Pe.SLIDE,0],[Pe.STREAM_DATA_LOADER,0],[Pe.ELEVATION_QUERY,0],[Pe.TERRAIN_SURFACE,1],[Pe.SURFACE_GEOMETRY_UPDATES,1],[Pe.LOD_RENDERER,2],[Pe.GRAPHICS_CORE,2],[Pe.I3S_CONTROLLER,2],[Pe.POINT_CLOUD_LAYER,2],[Pe.FEATURE_TILE_FETCHER,2],[Pe.OVERLAY,4],[Pe.STAGE,4],[Pe.GRAPHICS_DECONFLICTOR,4],[Pe.FILTER_VISIBILITY,4],[Pe.SCALE_VISIBILITY,4],[Pe.FRUSTUM_VISIBILITY,4],[Pe.CLOUDS_GENERATOR,4],[Pe.POINT_OF_INTEREST_FREQUENT,6],[Pe.POINT_OF_INTEREST_INFREQUENT,30],[Pe.LABELER,8],[Pe.FEATURE_QUERY_ENGINE,8],[Pe.FEATURE_TILE_TREE,16],[Pe.FEATURE_TILE_TREE_ACTIVE,0],[Pe.ELEVATION_ALIGNMENT,12],[Pe.TEXT_TEXTURE_ATLAS,12],[Pe.TEXTURE_UNLOAD,12],[Pe.LINE_OF_SIGHT_TOOL,16],[Pe.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[Pe.SNAPPING,0],[Pe.SHADOW_ACCUMULATOR,30]]);function Me(e){return Ve.has(e)?Ve.get(e):"number"==typeof e?e:1}var Ue,qe,ze=(0,Ie.HA)(6.5),Be=(0,Ie.HA)(1),He=(0,Ie.HA)(30),je=(0,Ie.HA)(1e3/30),Ye=(0,Ie.HA)(100);!function(e){var t=function(){function e(){var t=this;(0,l.Z)(this,e),this._updating=(0,Ee.t)(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new ke.Z("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new n,this._state=Ge.n.INTERACTING,this._tasks=new be.Z,this._runQueue=new be.Z,this._load=0,this._idleStateCallbacks=new be.Z,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=(0,Te.YP)((function(){return Qe.SCHEDULER_LOG_SLOW_TASKS}),(function(e){return t._debug=e}),Te.nn);for(var r=0,i=Object.keys(Pe);r<i.length;r++){var a=i[r];this.performanceInfo.tasks.set(Pe[a],new ke.Z(Pe[a]))}var s=this;this._test={FRAME_SAFETY_BUDGET:ze,INTERACTING_BUDGET:je,IDLE_BUDGET:Ye,get availableBudget(){return s._budget.budget},usedBudget:0,getBudget:function(){return s._budget},setBudget:function(e){return s._budget=e},updateTask:function(e){return t._updateTask(e)},getState:function(e){return t._getState(e)},getRuntime:function(e){return t._getRuntime(e)},frameTaskTimes:this._frameTaskTimes,resetRuntimes:function(){return t._resetRuntimes()},getRunning:function(){return t._getRunning()}}}return(0,o.Z)(e,[{key:"updating",get:function(){return this._updating.value}},{key:"_updatingChanged",value:function(){this._updating.value=this._tasks.some((function(e){return e.needsUpdate}))}},{key:"destroy",value:function(){this._tasks.toArray().forEach((function(e){return e.remove()})),this._tasks.clear(),(0,p.hw)(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}},{key:"taskRunningChanged",value:function(e){var t=this;this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask((function(){t._microTaskQueued&&(t._microTaskQueued=!1,t._budget.remaining>0&&t._schedule()&&t.frame())})))}},{key:"registerTask",value:function(e,t){var n=Me(e),i=new r(this,e,t,n);return this._tasks.push(i),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new ke.Z(e)),i}},{key:"registerIdleStateCallbacks",value:function(e,t){var r=this,n={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(n),this.state===Ge.n.IDLE&&this._idleUpdatesStartFired&&n.idleBegin();var i=this;return{remove:function(){return r._removeIdleStateCallbacks(n)},set idleBegin(e){i._idleUpdatesStartFired&&(n.idleEnd(),i._state===Ge.n.IDLE&&e()),n.idleBegin=e},set idleEnd(e){n.idleEnd=e}}}},{key:"load",get:function(){return this._load}},{key:"state",get:function(){return this._state},set:function(e){this._state!==e&&(this._state=e,this.state!==Ge.n.IDLE&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forAll((function(e){return e.idleEnd()}))))}},{key:"updateBudget",value:function(e){this._test.usedBudget=0,++this._frameNumber;var t=ze,r=e.frameDuration,n=Be;switch(this.state){case Ge.n.IDLE:t=(0,Ie.HA)(0),r=(0,Ie.HA)(Math.max(Ye,e.frameDuration)),n=He;break;case Ge.n.INTERACTING:r=(0,Ie.HA)(Math.max(je,e.frameDuration));case Ge.n.ANIMATING:}return r=(0,Ie.HA)(r-e.elapsedFrameTime-t),this.state!==Ge.n.IDLE&&r<Be&&!this._forceTask?(this._forceTask=!0,!1):(r=(0,Ie.HA)(Math.max(r,n)),this._budget.reset(r,this.state),this._updateLoad(),this._schedule())}},{key:"frame",value:function(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case Ge.n.IDLE:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forAll((function(e){return e.idleBegin()}))),this._runIdle();break;case Ge.n.INTERACTING:this._runInteracting();break;default:this._runAnimating()}this._test.usedBudget=this._budget.elapsed}},{key:"stopFrame",value:function(){this._budget.reset((0,Ie.HA)(0),this._state),this._budget.madeProgress()}},{key:"_removeIdleStateCallbacks",value:function(e){this._idleUpdatesStartFired&&e.idleEnd(),this._idleStateCallbacks.removeUnordered(e)}},{key:"removeTask",value:function(e){this._tasks.removeUnordered(e),this._runQueue.removeUnordered(e),this._updatingChanged()}},{key:"_updateTask",value:function(e){this._tasks.forAll((function(t){t.name===e&&t.setPriority(e)}))}},{key:"_getState",value:function(e){if(this._runQueue.some((function(t){return t.name===e})))return qe.SCHEDULED;var t=qe.IDLE;return this._tasks.forAll((function(r){r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t=qe.READY:t!==qe.READY&&(t=qe.WAITING))})),t}},{key:"_getRuntime",value:function(e){var t=0;return this._tasks.forAll((function(r){r.name===e&&(t+=r.runtime)})),t}},{key:"_resetRuntimes",value:function(){this._tasks.forAll((function(e){return e.runtime=0}))}},{key:"_getRunning",value:function(){var e=new Map;if(this._tasks.forAll((function(t){t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)})),0===e.size)return null;var t="";return e.forEach((function(e,r){t+=e>1?" ".concat(e,"x ").concat(r):" ".concat(r)})),t}},{key:"_runIdle",value:function(){this._run()}},{key:"_runInteracting",value:function(){this._run()}},{key:"_runAnimating",value:function(){this._run()}},{key:"_updateLoad",value:function(){var e=this._tasks.reduce((function(e,t){return t.needsUpdate?++e:e}),0);this._load=.9*this._load+e*(1-.9)}},{key:"_schedule",value:function(){var e,t=this,r=function(){var e=!1,r=0;if(t._tasks.forAll((function(n){n.needsUpdate&&0!==n.schedulePriority&&0!==n.basePriority&&n.blockFrame!==t._frameNumber&&(e=!0,r=Math.max(r,n.basePriority),1===n.schedulePriority?(n.schedulePriority=0,t._runQueue.push(n)):--n.schedulePriority)})),!e)return{v:(t._updatingChanged(),!1)}};for(this._runQueue.filterInPlace((function(e){return!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)})),this._tasks.forAll((function(e){0===e.basePriority&&e.needsUpdate&&!t._runQueue.includes(e)&&e.blockFrame!==t._frameNumber&&t._runQueue.unshift(e)}));0===this._runQueue.length;)if(e=r())return e.v;return this._updatingChanged(),!0}},{key:"_run",value:function(){var e=this._budget.now();this._startFrameTaskTimes();do{for(;this._runQueue.length>0;){var t=this._budget.now(),r=this._runQueue.pop();this._budget.resetProgress();try{r.task.runTask(this._budget)===De.YIELD&&(r.blockFrame=this._frameNumber)}catch(C){xe.Z.getLogger("esri.views.support.Scheduler").error('Exception in task "'.concat(r.name,'"'),C),r.blockFrame=this._frameNumber}!this._budget.hasProgressed&&r.blockFrame!==this._frameNumber&&r.needsUpdate&&(r.name,Pe.I3S_CONTROLLER,r.blockFrame=this._frameNumber),r.schedulePriority=r.basePriority;var n=this._budget.now()-t;if(r.runtime+=n,this._frameTaskTimes.set(r.priority,this._frameTaskTimes.get(r.priority)+n),this._debug&&n>2*this._budget.budget&&console.log("Task",r.name,"used",n,"of max",this._budget.budget,"ms"),this._budget.remaining<=0)return this._updatingChanged(),void this._recordFrameTaskTimes(this._budget.now()-e)}}while(this._schedule());this._updatingChanged(),this._recordFrameTaskTimes(this._budget.now()-e)}},{key:"_startFrameTaskTimes",value:function(){for(var e=0,t=Object.keys(Pe);e<t.length;e++){var r=t[e];this._frameTaskTimes.set(Pe[r],0)}}},{key:"_recordFrameTaskTimes",value:function(e){var t=this;this._frameTaskTimes.forEach((function(e,r){return t.performanceInfo.tasks.get(r).record(e)})),this.performanceInfo.total.record(e)}},{key:"test",get:function(){return this._test}}]),e}();e.Scheduler=t;var r=function(){function e(t,r,n,i){var a=this;(0,l.Z)(this,e),this._scheduler=t,this.name=r,this._basePriority=i,this.blockFrame=0,this.runtime=0,this._queue=new Se,this._handles=new _e.Z,this.schedulePriority=this._basePriority,this._task=(0,Ee.t)(null!=n?n:this._queue),this._handles.add((0,Te.gx)((function(){return a.task.running}),(function(e){return t.taskRunningChanged(e)})))}return(0,o.Z)(e,[{key:"task",get:function(){return this._task.value}},{key:"updating",get:function(){return this._queue.running}},{key:"remove",value:function(){this.processQueue(We),this._scheduler.removeTask(this),this.schedule=Je.schedule,this.reschedule=Je.reschedule,this._handles.destroy()}},{key:"basePriority",get:function(){return this._basePriority}},{key:"setPriority",value:function(e){this.name=e;var t=Me(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}},{key:"priority",get:function(){return this.name},set:function(e){this.setPriority(e)}},{key:"needsUpdate",get:function(){return this.updating||this.task.running}},{key:"schedule",value:function(e,t,r){return this._queue.push(e,t,r)}},{key:"reschedule",value:function(e,t,r){return this._queue.unshift(e,t,r)}},{key:"processQueue",value:function(e){this._queue.runTask(e)}}]),e}(),n=function(){function e(){(0,l.Z)(this,e),this._begin="undefined"!=typeof performance?performance.now():0,this._budget=0,this._state=Ge.n.IDLE,this._done=!1,this._progressed=!1,this._enabled=!0}return(0,o.Z)(e,[{key:"run",value:function(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}},{key:"done",get:function(){return this._done}},{key:"budget",get:function(){return this._budget}},{key:"madeProgress",value:function(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}},{key:"state",get:function(){return this._state}},{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"reset",value:function(e,t){this._begin=this.now(),this._budget=e,this._state=t,this.resetProgress()}},{key:"remaining",get:function(){return Math.max(this._budget-this.elapsed,0)}},{key:"now",value:function(){return performance.now()}},{key:"elapsed",get:function(){return performance.now()-this._begin}},{key:"resetProgress",value:function(){this._progressed=!1,this._done=!1}},{key:"hasProgressed",get:function(){return this._progressed}}]),e}();e.Budget=n}(Ue||(Ue={})),function(e){e.SCHEDULED="s",e.READY="r",e.WAITING="w",e.IDLE="i"}(qe||(qe={}));var We=function(){var e=new Ue.Budget;return e.enabled=!1,e}(),Xe=function(){function e(){(0,l.Z)(this,e)}return(0,o.Z)(e,[{key:"remove",value:function(){}},{key:"processQueue",value:function(){}},{key:"schedule",value:function(e,t,r){try{if((0,y.Hc)(t)){var n=(0,y.zE)();return r?Promise.resolve(r(n)):Promise.reject(n)}return(0,y.gx)(e(We))}catch(Z){return Promise.reject(Z)}}},{key:"reschedule",value:function(e,t,r){return this.schedule(e,t,r)}}]),e}(),Je=new Xe,Ke=new v.WJ(2e6),$e=0,et=function(){function e(t){var r=this;(0,l.Z)(this,e),this._geometryQueryCache=null,this._changeHandle=null,this.capabilities={query:z.g},this.geometryType=t.geometryType,this.hasM=!!t.hasM,this.hasZ=!!t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new v.Xq($e+++"$$",Ke)),this.fieldsIndex=(0,f.AK)(t.fieldsIndex)?t.fieldsIndex:ge.Z.fromJSON(t.fieldsIndex),this.availableFields=null==t.availableFields?new Set(this.fieldsIndex.fields.map((function(e){return e.name}))):new Set(t.availableFields.map((function(e){var t;return null===(t=r.fieldsIndex.get(e))||void 0===t?void 0:t.name})).filter((function(e){return null!=e}))),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return(0,o.Z)(e,[{key:"destroy",value:function(){this._frameTask=(0,p.hw)(this._frameTask),this.clearCache(),(0,p.SC)(this._geometryQueryCache),this._changeHandle=(0,p.hw)(this._changeHandle)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"clearCache",value:function(){var e;null!==(e=this._geometryQueryCache)&&void 0!==e&&e.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}},{key:"executeQuery",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{},r);case 3:return e.abrupt("return",e.sent.createQueryResponse());case 6:if(e.prev=6,e.t0=e.catch(0),e.t0===ae.Ti){e.next=10;break}throw e.t0;case 10:return e.abrupt("return",new te([],t,this).createQueryResponse());case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.prev=2,e.next=5,this._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},r);case 5:return e.abrupt("return",e.sent.createQueryResponseForCount());case 8:if(e.prev=8,e.t0=e.catch(2),e.t0===ae.Ti){e.next=12;break}throw e.t0;case 12:return e.abrupt("return",0);case 13:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outSR,e.prev=1,e.next=4,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 4:if(i=e.sent,a=i.size){e.next=8;break}return e.abrupt("return",{count:0,extent:null});case 8:return e.t0=a,e.next=11,this._getBounds(i.items,i.spatialReference,n||this.spatialReference);case 11:return e.t1=e.sent,e.abrupt("return",{count:e.t0,extent:e.t1});case 15:if(e.prev=15,e.t2=e.catch(1),e.t2!==ae.Ti){e.next=19;break}return e.abrupt("return",{count:0,extent:null});case 19:throw e.t2;case 20:case"end":return e.stop()}}),e,this,[[1,15]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 3:return n=e.sent,i=n.items,u=new Set,e.next=8,this._reschedule((function(){var e,t=(0,a.Z)(i);try{for(t.s();!(e=t.n()).done;){var r=e.value;u.add(n.featureAdapter.getObjectId(r))}}catch(s){t.e(s)}finally{t.f()}}),r);case 8:return e.abrupt("return",u);case 11:if(e.prev=11,e.t0=e.catch(0),e.t0!==ae.Ti){e.next=15;break}return e.abrupt("return",new Set);case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,a,u,o,l,c,h,f,p,v,y,m,g,_,x,k,I=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.point,a=t.distance,u=t.returnEdge,o=t.vertexMode,u||"none"!==o){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return l=(0,d.d9)(t.query),e.next=6,this._schedule((function(){return(0,ae.j6)(l,I.definitionExpression,I.spatialReference)}),r);case 6:return l=e.sent,e.next=9,this._reschedule((function(){return oe(l,{availableFields:I.availableFields,fieldsIndex:I.fieldsIndex,geometryType:I.geometryType,spatialReference:I.spatialReference})}),r);case 9:if(l=e.sent,c=!(0,E.fS)(n.spatialReference,this.spatialReference),e.t0=c,!e.t0){e.next=15;break}return e.next=15,(0,q._W)(n.spatialReference,this.spatialReference);case 15:if(h="number"==typeof a?a:a.x,f="number"==typeof a?a:a.y,p={xmin:n.x-h,xmax:n.x+h,ymin:n.y-f,ymax:n.y+f,spatialReference:n.spatialReference},v=c?(0,q.iV)(p,this.spatialReference):p){e.next=18;break}return e.abrupt("return",{candidates:[]});case 18:return e.next=20,(0,T.aX)((0,b.im)(n),null,{signal:r});case 20:return y=e.sent[0],e.next=23,(0,T.aX)((0,b.im)(v),null,{signal:r});case 23:if(m=e.sent[0],null!=y&&null!=m){e.next=26;break}return e.abrupt("return",{candidates:[]});case 26:return e.t1=te,e.next=29,this._reschedule((function(){return I._searchFeatures(I._getQueryBBoxes(m.toJSON()))}),r);case 29:return e.t2=e.sent,e.t3=l,e.t4=this,g=new e.t1(e.t2,e.t3,e.t4),e.next=35,this._reschedule((function(){return I._executeObjectIdsQuery(g)}),r);case 35:return e.next=37,this._reschedule((function(){return I._executeTimeQuery(g)}),r);case 37:return e.next=39,this._reschedule((function(){return I._executeAttributesQuery(g)}),r);case 39:return e.next=41,this._reschedule((function(){return I._executeGeometryQueryForSnapping(g,r)}),r);case 41:return _=y.toJSON(),x=c?(0,q.iV)(_,this.spatialReference):_,k=c?Math.max(v.xmax-v.xmin,v.ymax-v.ymin)/2:a,e.abrupt("return",g.createSnappingResponse((0,i.Z)((0,i.Z)({},t),{},{point:x,distance:k}),n.spatialReference));case 43:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=this.timeInfo)&&void 0!==n&&n.trackIdField){e.next=2;break}throw new h.Z("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 2:return e.prev=2,e.next=5,this._executeQuery(t,{},r);case 5:return i=e.sent,e.next=8,this._reschedule((function(){return a._filterLatest(i)}),r);case 8:return e.abrupt("return",i.createQueryResponse());case 11:if(e.prev=11,e.t0=e.catch(2),e.t0===ae.Ti){e.next=15;break}throw e.t0;case 15:return e.abrupt("return",new te([],t,this).createQueryResponse());case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,a,u,o=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=o.length>2?o[2]:void 0,i=(r=o.length>1?o[1]:void 0).field,a=r.normalizationField,u=r.valueExpression,e.next=6,this._executeQueryForStatistics(t,{field:i,normalizationField:a,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForUniqueValues",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,a,u,o,l=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:{},n=l.length>2?l[2]:void 0,i=(r=l.length>1?l[1]:void 0).field,a=r.field2,u=r.field3,o=r.valueExpression,e.next=6,this._executeQueryForStatistics(t,{field:i,field2:a,field3:u,valueExpression:o},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForClassBreaks",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,a,u,o=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=o.length>2?o[2]:void 0,i=(r=o.length>1?o[1]:void 0).field,a=r.normalizationField,u=r.valueExpression,e.next=6,this._executeQueryForStatistics(t,{field:i,normalizationField:a,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForHistogram",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i,a,u,o=arguments;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=o.length>2?o[2]:void 0,i=(r=o.length>1?o[1]:void 0).field,a=r.normalizationField,u=r.valueExpression,e.next=6,this._executeQueryForStatistics(t,{field:i,normalizationField:a,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchRecomputedExtents",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,i,a,u;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._timeExtentPromise||(this._timeExtentPromise=(0,me.R)(this.timeInfo,this.featureStore)),e.next=3,Promise.all([this._getFullExtent(),this._timeExtentPromise]);case 3:return r=e.sent,i=(0,n.Z)(r,2),a=i[0],u=i[1],e.abrupt("return",((0,y.k_)(t),{fullExtent:a,timeExtent:u}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getBounds",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,a,u,o,l,c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,_.t8)((0,_.Ue)(),_.G_),e.next=3,this.featureStore.forEachBounds(t,(function(e){return(0,_.TC)(i,e)}));case 3:return a={xmin:i[0],ymin:i[1],xmax:i[3],ymax:i[4],spatialReference:(0,U.S2)(this.spatialReference)},this.hasZ&&isFinite(i[2])&&isFinite(i[5])&&(a.zmin=i[2],a.zmax=i[5]),(u=(0,q.iV)(a,r,n)).spatialReference=(0,U.S2)(n),u.xmax-u.xmin==0&&(o=(0,m.c9)(u.spatialReference),u.xmin-=o,u.xmax+=o),u.ymax-u.ymin==0&&(l=(0,m.c9)(u.spatialReference),u.ymin-=l,u.ymax+=l),this.hasZ&&null!=u.zmin&&null!=u.zmax&&u.zmax-u.zmin==0&&(c=(0,m.c9)(u.spatialReference),u.zmin-=c,u.zmax+=c),e.abrupt("return",u);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_getFullExtent",value:function(){var e=this;return this._fullExtentPromise||(this._fullExtentPromise="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then((function(t){return e._getBounds(t,e.spatialReference,e.spatialReference)}))),this._fullExtentPromise}},{key:"_schedule",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!=this._frameTask?this._frameTask.schedule(t,r):t(We));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!=this._frameTask?this._frameTask.reschedule(t,r):t(We));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAllFeaturesQueryEngineResult",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=te,e.next=3,this._getAllFeatures();case 3:return e.t1=e.sent,e.t2=t,e.t3=this,e.abrupt("return",new e.t0(e.t1,e.t2,e.t3));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getAllFeatures",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(){var t,r,n,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this._allFeaturesPromise&&(t=[],this._allFeaturesPromise=(0,u.Z)((0,s.Z)().mark((function e(){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.featureStore.forEach((function(e){return t.push(e)}));case 2:case"end":return e.stop()}}),e)})))().then((function(){return t}))),r=this._allFeaturesPromise,e.next=4,r;case 4:return n=e.sent,e.abrupt("return",r===this._allFeaturesPromise?n.slice():this._getAllFeatures());case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_executeQuery",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var a,u,o=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,d.d9)(t),e.next=3,this._schedule((function(){return(0,ae.Up)(t,o.definitionExpression,o.spatialReference)}),n);case 3:return t=e.sent,e.next=6,this._reschedule((function(){return oe(t,{availableFields:o.availableFields,fieldsIndex:o.fieldsIndex,geometryType:o.geometryType,spatialReference:o.spatialReference})}),n);case 6:return t=e.sent,t=(0,i.Z)((0,i.Z)({},t),r),e.next=10,this._reschedule((function(){return o._executeSceneFilterQuery(t,n)}),n);case 10:return a=e.sent,e.next=13,this._reschedule((function(){return o._executeGeometryQuery(t,a,n)}),n);case 13:return u=e.sent,e.next=16,this._reschedule((function(){return o._executeAggregateIdsQuery(u)}),n);case 16:return e.next=18,this._reschedule((function(){return o._executeObjectIdsQuery(u)}),n);case 18:return e.next=20,this._reschedule((function(){return o._executeTimeQuery(u)}),n);case 20:return e.next=22,this._reschedule((function(){return o._executeAttributesQuery(u)}),n);case 22:return e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeSceneFilterQuery",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,o,l,c,h,f,d,p,v,y,m,g,_,x,k,b,T,I=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t.sceneFilter){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.outSR,i=t.returnGeometry,o=t.returnCentroid,l=this.featureStore.featureSpatialReference,c=t.sceneFilter.geometry,h=null==l||(0,E.fS)(l,c.spatialReference)?c:(0,q.iV)(c,l)){e.next=5;break}return e.abrupt("return",null);case 5:return f=i||o,d=(0,E.JY)(n)&&!(0,E.fS)(this.spatialReference,n)&&f?function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",I._project(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():function(e){return e},p=this.featureAdapter,e.next=10,this._reschedule((function(){return I._searchFeatures(I._getQueryBBoxes(h))}),r);case 10:if(v=e.sent,"disjoint"!==t.sceneFilter.spatialRelationship){e.next=24;break}if(v.length){e.next=14;break}return e.abrupt("return",null);case 14:y=new Set,m=(0,a.Z)(v);try{for(m.s();!(g=m.n()).done;)_=g.value,y.add(p.getObjectId(_))}catch(S){m.e(S)}finally{m.f()}return e.next=19,this._reschedule((function(){return I._getAllFeatures()}),r);case 19:return x=e.sent,e.next=22,this._reschedule((0,u.Z)((0,s.Z)().mark((function e(){var n,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,se.cW)("esriSpatialRelDisjoint",h,I.geometryType,I.hasZ,I.hasM);case 2:return n=e.sent,i=function(e){return!y.has(p.getObjectId(e))||n(p.getGeometry(e))},e.next=6,I._runSpatialFilter(x,i,r);case 6:return a=e.sent,e.abrupt("return",new te(a,t,I));case 8:case"end":return e.stop()}}),e)}))),r);case 22:return k=e.sent,e.abrupt("return",d(k));case 24:if(v.length){e.next=26;break}return e.abrupt("return",new te([],t,this));case 26:if(!this._canExecuteSinglePass(h,t)){e.next=28;break}return e.abrupt("return",d(new te(v,t,this)));case 28:return e.next=30,(0,se.cW)("esriSpatialRelContains",h,this.geometryType,this.hasZ,this.hasM);case 30:return b=e.sent,e.next=33,this._runSpatialFilter(v,(function(e){return b(p.getGeometry(e))}),r);case 33:return T=e.sent,e.abrupt("return",d(new te(T,t,this)));case 35:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_executeGeometryQuery",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,o,l,h,f,d,p,v,y,m,g,_,x,k,b,T,I,S,F,R,Z,w,A,C,N,O=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r||0!==r.items.length){e.next=2;break}return e.abrupt("return",r);case 2:if(t=null!=r?r.query:t,o=(i=t).geometry,l=i.outSR,h=i.spatialRel,f=i.returnGeometry,d=i.returnCentroid,p=this.featureStore.featureSpatialReference,v=!o||null==p||(0,E.fS)(p,o.spatialReference)?o:(0,q.iV)(o,p),y=f||d,m=(0,E.JY)(l)&&!(0,E.fS)(this.spatialReference,l),g=this._geometryQueryCache&&null==r?m&&y?JSON.stringify({originalFilterGeometry:o,spatialRelationship:h,outSpatialReference:l}):JSON.stringify({originalFilterGeometry:o,spatialRelationship:h}):null,null==(_=g?this._geometryQueryCache.get(g):null)){e.next=6;break}return e.abrupt("return",new te(_,t,this));case 6:if(x=function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=m&&y,!e.t0){e.next=4;break}return e.next=4,O._project(t,l);case 4:return g&&O._geometryQueryCache.put(g,t.items,t.items.length+1),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),v){e.next=18;break}if(e.t0=x,null==r){e.next=13;break}e.t1=r,e.next=16;break;case 13:return e.next=15,this._getAllFeaturesQueryEngineResult(t);case 15:e.t1=e.sent;case 16:return e.t2=e.t1,e.abrupt("return",(0,e.t0)(e.t2));case 18:return k=this.featureAdapter,e.next=21,this._reschedule((function(){return O._searchFeatures(O._getQueryBBoxes(o))}),n);case 21:if(b=e.sent,"esriSpatialRelDisjoint"!==h){e.next=49;break}if(b.length){e.next=34;break}if(e.t3=x,null==r){e.next=29;break}e.t4=r,e.next=32;break;case 29:return e.next=31,this._getAllFeaturesQueryEngineResult(t);case 31:e.t4=e.sent;case 32:return e.t5=e.t4,e.abrupt("return",(0,e.t3)(e.t5));case 34:T=new Set,I=(0,a.Z)(b);try{for(I.s();!(S=I.n()).done;)F=S.value,T.add(k.getObjectId(F))}catch(D){I.e(D)}finally{I.f()}if(null==r){e.next=41;break}e.t6=r.items,e.next=44;break;case 41:return e.next=43,this._reschedule((function(){return O._getAllFeatures()}),n);case 43:e.t6=e.sent;case 44:return R=e.t6,e.next=47,this._reschedule((0,u.Z)((0,s.Z)().mark((function e(){var r,i,a;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,se.cW)(h,v,O.geometryType,O.hasZ,O.hasM);case 2:return r=e.sent,i=function(e){return!T.has(k.getObjectId(e))||r(k.getGeometry(e))},e.next=6,O._runSpatialFilter(R,i,n);case 6:return a=e.sent,e.abrupt("return",new te(a,t,O));case 8:case"end":return e.stop()}}),e)}))),n);case 47:return Z=e.sent,e.abrupt("return",x(Z));case 49:if(null!=r&&(w=new c.SO,b=b.filter((function(e){return(0,c.cq)(r.items,e,r.items.length,w)>=0}))),b.length){e.next=53;break}return A=new te([],t,this),e.abrupt("return",(g&&this._geometryQueryCache.put(g,A.items,1),A));case 53:if(!this._canExecuteSinglePass(v,t)){e.next=55;break}return e.abrupt("return",x(new te(b,t,this)));case 55:return e.next=57,(0,se.cW)(h,v,this.geometryType,this.hasZ,this.hasM);case 57:return C=e.sent,e.next=60,this._runSpatialFilter(b,(function(e){return C(k.getGeometry(e))}),n);case 60:return N=e.sent,e.abrupt("return",x(new te(N,t,this)));case 62:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeGeometryQueryForSnapping",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.query,a=i.spatialRel,null!==t&&void 0!==t&&null!==(n=t.items)&&void 0!==n&&n.length&&i.geometry&&a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,(0,se.cW)(a,i.geometry,this.geometryType,this.hasZ,this.hasM);case 5:return u=e.sent,e.next=8,this._runSpatialFilter(t.items,(function(e){return u(e.geometry)}),r);case 8:o=e.sent,t.items=o;case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_executeAggregateIdsQuery",value:function(e){var t;if(0!==e.items.length&&null!==(t=e.query.aggregateIds)&&void 0!==t&&t.length&&null!=this.aggregateAdapter){var r,n=new Set,i=(0,a.Z)(e.query.aggregateIds);try{for(i.s();!(r=i.n()).done;){var s=r.value;this.aggregateAdapter.getFeatureObjectIds(s).forEach((function(e){return n.add(e)}))}}catch(o){i.e(o)}finally{i.f()}var u=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return n.has(u(e))}))}}},{key:"_executeObjectIdsQuery",value:function(e){var t;if(0!==e.items.length&&null!==(t=e.query.objectIds)&&void 0!==t&&t.length){var r=new Set(e.query.objectIds),n=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return r.has(n(e))}))}}},{key:"_executeTimeQuery",value:function(e){if(0!==e.items.length){var t=(0,me.y)(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}}},{key:"_executeAttributesQuery",value:function(e){var t=this;if(0!==e.items.length){var r=Q(e.query.where,this.fieldsIndex);if(r){if(!r.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((function(e){return r.testFeature(e,t.featureAdapter)}))}}}},{key:"_runSpatialFilter",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,a,o,l=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(null!=this._frameTask){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,a=new Array,o=function(){var e=(0,u.Z)((0,s.Z)().mark((function e(u){var c;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=9;break}if(c=t[i++],r(c)&&(a.push(c),u.madeProgress()),e.t0=u.done,!e.t0){e.next=7;break}return e.next=7,l._reschedule((function(e){return o(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return o(e)}),n).then((function(){return a})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_filterLatest",value:function(e){var t,r=this.timeInfo,n=r.trackIdField,i=r.startTimeField,s=r.endTimeField||i,u=new Map,o=this.featureAdapter.getAttribute,l=(0,a.Z)(e.items);try{for(l.s();!(t=l.n()).done;){var c=t.value,h=o(c,n),f=o(c,s),d=u.get(h);(!d||f>o(d,s))&&u.set(h,c)}}catch(p){l.e(p)}finally{l.f()}e.items=Array.from(u.values())}},{key:"_canExecuteSinglePass",value:function(e,t){var r=t.spatialRel;return(0,se.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}},{key:"_project",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r){var n,i,a,u,o=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!(0,E.fS)(this.spatialReference,r)){e.next=2;break}return e.abrupt("return",t);case 2:return n=this.featureAdapter,e.prev=3,e.next=6,this._getFullExtent();case 6:a=e.sent,i=(0,g.getTransformation)(this.spatialReference,r,a),e.next=12;break;case 10:e.prev=10,e.t0=e.catch(3);case 12:return e.next=14,(0,q.oj)(t.items.map((function(e){return(0,U.Op)(o.geometryType,o.hasZ,o.hasM,n.getGeometry(e))})),this.spatialReference,r,i);case 14:return u=e.sent,e.abrupt("return",(t.items=u.map((function(e,r){return n.cloneWithGeometry(t.items[r],(0,I.GH)(e,o.hasZ,o.hasM))})),t));case 16:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getQueryBBoxes",value:function(e){if((0,se.hN)(e)){if((0,b.YX)(e))return[(0,x.al)(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if((0,b.oU)(e))return e.rings.map((function(e){return(0,x.al)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[(0,k.$P)((0,x.Ue)(),e)]}},{key:"_searchFeatures",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t){var r,n,i=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Set,e.next=3,Promise.all(t.map((function(e){return i.featureStore.forEachInBounds(e,(function(e){return r.add(e)}))})));case 3:return n=Array.from(r.values()),e.abrupt("return",(r.clear(),n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_executeQueryForStatistics",value:function(){var e=(0,u.Z)((0,s.Z)().mark((function e(t,r,n){var i,a,u=this;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,d.d9)(t),e.prev=1,e.next=4,this._schedule((function(){return(0,ae.Up)(t,u.definitionExpression,u.spatialReference)}),n);case 4:return t=e.sent,e.next=7,this._reschedule((function(){return de(t,r,{availableFields:u.availableFields,fieldsIndex:u.fieldsIndex,geometryType:u.geometryType,spatialReference:u.spatialReference})}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return u._executeSceneFilterQuery(t,n)}),n);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return u._executeGeometryQuery(t,i,n)}),n);case 13:return a=e.sent,e.next=16,this._reschedule((function(){return u._executeAggregateIdsQuery(a)}),n);case 16:return e.next=18,this._reschedule((function(){return u._executeObjectIdsQuery(a)}),n);case 18:return e.next=20,this._reschedule((function(){return u._executeTimeQuery(a)}),n);case 20:return e.next=22,this._reschedule((function(){return u._executeAttributesQuery(a)}),n);case 22:return e.abrupt("return",a);case 25:if(e.prev=25,e.t0=e.catch(1),e.t0===ae.Ti){e.next=29;break}throw e.t0;case 29:return e.abrupt("return",new te([],t,this));case 30:case"end":return e.stop()}}),e,this,[[1,25]])})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}()},60480:function(e,t,r){r.d(t,{g:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},75248:function(e,t,r){var n;r.d(t,{n:function(){return n}}),function(e){e[e.ANIMATING=0]="ANIMATING",e[e.INTERACTING=1]="INTERACTING",e[e.IDLE=2]="IDLE"}(n||(n={}))}}]);
//# sourceMappingURL=6143.6db617a2.chunk.js.map