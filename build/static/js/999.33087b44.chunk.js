"use strict";(self.webpackChunkamit_kumar_rathi=self.webpackChunkamit_kumar_rathi||[]).push([[999],{84683:function(e,t,n){n.d(t,{bU:function(){return d},fC:function(){return h},tp:function(){return y},v7:function(){return c}});var r=new Float64Array(2),a=new Float64Array(2),i="0123456789bcdefghjkmnpqrstuvwxyz";function o(e){return i[e]}function s(e){return(e[0]+e[1])/2}function u(e,t,n){return e[0]=t,e[1]=n,e}function l(e,t){var n=s(e),r=t,a=!t;e[0]=a*e[0]+r*n,e[1]=a*n+r*e[1]}function p(e,t){var n=t>s(e);return l(e,n),n}function d(e,t){for(var n=-90,r=90,a=-180,i=180,o=0;o<t;o++){for(var s=Math.ceil((o+1)/2),u=Math.floor((o+1)/2),l=1-o%2,p=30-(3*s+2*u),d=30-(2*s+3*u),c=3*l+2*(1-l),y=2*l+3*(1-l),h=3*l+7*(1-l)<<d,f=(7*l+3*(1-l)<<p&e.geohashX)>>p,m=(h&e.geohashY)>>d,v=c-1;v>=0;v--){var g=(a+i)/2,b=f&1<<v?1:0;a=(1-b)*a+b*g,i=(1-b)*g+b*i}for(var w=y-1;w>=0;w--){var _=(n+r)/2,k=m&1<<w?1:0;n=(1-k)*n+k*_,r=(1-k)*_+k*r}}return[a,n,i,r]}function c(e,t,n,r){r%2&&(r+=1);for(var a=0,i=0,o=-90,s=90,u=-180,l=180,p=0;p<r/2;p++){for(var d=0;d<5;d++){var c=(u+l)/2,y=n>c?1:0;a|=y<<29-(d+5*p),u=(1-y)*u+y*c,l=(1-y)*c+y*l}for(var h=0;h<5;h++){var f=(o+s)/2,m=t>f?1:0;i|=m<<29-(h+5*p),o=(1-m)*o+m*f,s=(1-m)*f+m*s}}e.geohashX=a,e.geohashY=i}function y(e,t,n,r,a){a%2&&(a+=1);for(var i=0,o=0,s=-90,u=90,l=-180,p=180,d=0;d<a/2;d++){for(var c=0;c<5;c++){var y=(l+p)/2,h=r>y?1:0;i|=h<<29-(c+5*d),l=(1-h)*l+h*y,p=(1-h)*y+h*p}for(var f=0;f<5;f++){var m=(s+u)/2,v=n>m?1:0;o|=v<<29-(f+5*d),s=(1-v)*s+v*m,u=(1-v)*m+v*u}}e[2*t]=i,e[2*t+1]=o}function h(e,t,n){for(var i="",s=u(r,-90,90),l=u(a,-180,180),d=0;d<n;d++){var c=0;d%2?(c|=p(s,e)<<4,c|=p(l,t)<<3,c|=p(s,e)<<2,c|=p(l,t)<<1,c|=p(s,e)<<0):(c|=p(l,t)<<4,c|=p(s,e)<<3,c|=p(l,t)<<2,c|=p(s,e)<<1,c|=p(l,t)<<0),i+=o(c)}return i}},46326:function(e,t,n){n.r(t),n.d(t,{default:function(){return Un}});var r=n(37762),a=n(74165),i=n(15861),o=n(15671),s=n(43144),u=n(82963),l=n(60136),p=n(29388),d=n(27366),c=(n(59486),n(40281)),y=n(10064),h=n(32718),f=n(66978),m=n(49861),v=(n(25243),n(63780),n(93169)),g=n(69912),b=n(84683),w=n(30651),_=n(83406),k=n(80457),x=n(29439),C=n(7138),Z=n(77427),T=n(76672),E=n(80885),M=n(45925),I=n(92975),L=n(3182),D=n(77981),G=function(){function e(){(0,o.Z)(this,e),this._featureLookup=new Map}return(0,s.Z)(e,[{key:"deleteFromStore",value:function(e){var t=this;e.forEach((function(e){t._featureLookup.delete(e)}))}},{key:"readFromStoreByList",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.readFromStoreById(e);r&&n.push(r)})),n}},{key:"readFromStoreById",value:function(e){var t;return null!==(t=this._featureLookup.get(e))&&void 0!==t?t:null}},{key:"writeToStore",value:function(e,t,n){var r=this,a=[];return e.forEach((function(e){if(null!==e&&void 0!==e&&e.id){e.properties||(e.properties=[]);var i,o=null;if(n&&e.properties[n]&&(o=(0,_.GH)(e.properties[n])),"originId"in e&&"destinationId"in e&&(e.properties.ESRI__ORIGIN_ID=e.originId,e.properties.ESRI__DESTINATION_ID=e.destinationId),e.properties[t]=e.id,e.id&&r._featureLookup.has(e.id)&&r._featureLookup.get(e.id).attributes){var s=r._featureLookup.get(e.id),u=JSON.parse(JSON.stringify(Object.assign(s.attributes,e.properties)));n&&e.properties[n]&&(u[n]=(0,D.im)(e.properties[n])),i=new L.u_(o?JSON.parse(JSON.stringify(o)):null!==s&&void 0!==s&&s.geometry?JSON.parse(JSON.stringify(s.geometry)):null,u,null,e.properties[t])}else i=new L.u_(o?JSON.parse(JSON.stringify(o)):null,e.properties,null,e.properties[t]);r._featureLookup.set(e.id,i),a.push(i)}})),a}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}},{key:"resetInstance",value:function(){e.instance&&(e.instance=null)}}]),e}(),R=n(1413),S=n(19545),N=n(76200),j=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).resultRows=[],r}return(0,s.Z)(n)}(C.Z);(0,d._)([(0,m.Cb)()],j.prototype,"resultRows",void 0);var F=j=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQueryResult")],j),O=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).resultRowsStream=new ReadableStream,r}return(0,s.Z)(n)}(C.Z);(0,d._)([(0,m.Cb)()],O.prototype,"resultRowsStream",void 0);var P=O=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQueryResult")],O),A=n(46784),z=n(78952),Q=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).name=null,r.unique=null,r.ascending=null,r.description=null,r.fieldNames=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],Q.prototype,"name",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"unique",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],Q.prototype,"ascending",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],Q.prototype,"description",void 0),(0,d._)([(0,m.Cb)({type:[String],json:{write:!0}})],Q.prototype,"fieldNames",void 0);var U=Q=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.FieldIndex")],Q),q=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).name=null,r.alias=null,r.fieldType=null,r.geometryType=null,r.hasM=null,r.hasZ=null,r.nullable=null,r.editable=null,r.required=null,r.defaultVisibility=null,r.systemMaintained=null,r.role=null,r.defaultValue=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],q.prototype,"name",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],q.prototype,"alias",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],q.prototype,"fieldType",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],q.prototype,"geometryType",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"hasM",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"hasZ",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"nullable",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"editable",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"required",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"defaultVisibility",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],q.prototype,"systemMaintained",void 0),(0,d._)([(0,m.Cb)()],q.prototype,"role",void 0),(0,d._)([(0,m.Cb)({type:Object,json:{type:String,write:{writer:function(e,t){t.defaultValue=null!=e?e.toString():null}}}})],q.prototype,"defaultValue",void 0);var Y=q=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphProperty")],q),H=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).name=null,r.alias=null,r.role=null,r.strict=null,r.properties=null,r.fieldIndexes=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],H.prototype,"name",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],H.prototype,"alias",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],H.prototype,"role",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],H.prototype,"strict",void 0),(0,d._)([(0,m.Cb)({type:[Y],json:{write:!0}})],H.prototype,"properties",void 0),(0,d._)([(0,m.Cb)({type:[U],json:{write:!0}})],H.prototype,"fieldIndexes",void 0);var B=H=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphObjectType")],H),J=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,o.Z)(this,n),t.call(this,e)}return(0,s.Z)(n)}(B),V=J=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.EntityType")],J),W=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).endPoints=[],r}return(0,s.Z)(n)}(B);(0,d._)([(0,m.Cb)()],W.prototype,"endPoints",void 0);var K=W=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.RelationshipType")],W),$=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).timestamp=null,r.spatialReference=null,r.strict=null,r.objectIdField=null,r.globalIdField=null,r.arcgisManaged=null,r.identifierInfo=null,r.searchIndexes=null,r.entityTypes=null,r.relationshipTypes=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:Date,json:{type:Number,write:{writer:function(e,t){t.timestamp=null===e||void 0===e?void 0:e.getTime()}}}})],$.prototype,"timestamp",void 0),(0,d._)([(0,m.Cb)({type:z.Z,json:{write:!0}})],$.prototype,"spatialReference",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],$.prototype,"strict",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],$.prototype,"objectIdField",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],$.prototype,"globalIdField",void 0),(0,d._)([(0,m.Cb)()],$.prototype,"arcgisManaged",void 0),(0,d._)([(0,m.Cb)()],$.prototype,"identifierInfo",void 0),(0,d._)([(0,m.Cb)()],$.prototype,"searchIndexes",void 0),(0,d._)([(0,m.Cb)({type:[V],json:{write:!0}})],$.prototype,"entityTypes",void 0),(0,d._)([(0,m.Cb)({type:[K],json:{write:!0}})],$.prototype,"relationshipTypes",void 0);var X=$=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.DataModel")],$),ee=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).capabilities=[],r.supportsSearch=!1,r.supportedQueryFormats=[],r.allowGeometryUpdates=!1,r.searchMaxRecordCount=null,r.serviceCapabilities=null,r.maxRecordCount=null,r.description="",r.copyrightText="",r.units="",r.spatialReference=null,r.currentVersion=null,r.dateFieldsTimeReference=null,r.serviceItemId="",r.supportsDocuments=!1,r.dataEditingNotSupported=!1,r.schemaEditingNotSupported=!1,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:[String],json:{write:!0}})],ee.prototype,"capabilities",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"supportsSearch",void 0),(0,d._)([(0,m.Cb)({type:[String],json:{write:!0}})],ee.prototype,"supportedQueryFormats",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"allowGeometryUpdates",void 0),(0,d._)([(0,m.Cb)({type:Number,json:{write:!0}})],ee.prototype,"searchMaxRecordCount",void 0),(0,d._)([(0,m.Cb)({type:Object,json:{write:!0}})],ee.prototype,"serviceCapabilities",void 0),(0,d._)([(0,m.Cb)({type:Number,json:{write:!0}})],ee.prototype,"maxRecordCount",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],ee.prototype,"description",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],ee.prototype,"copyrightText",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],ee.prototype,"units",void 0),(0,d._)([(0,m.Cb)({type:Object,json:{write:!0}})],ee.prototype,"spatialReference",void 0),(0,d._)([(0,m.Cb)({type:Number,json:{write:!0}})],ee.prototype,"currentVersion",void 0),(0,d._)([(0,m.Cb)({type:Object,json:{write:!0}})],ee.prototype,"dateFieldsTimeReference",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],ee.prototype,"serviceItemId",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"supportsDocuments",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"dataEditingNotSupported",void 0),(0,d._)([(0,m.Cb)({type:Boolean,json:{write:!0}})],ee.prototype,"schemaEditingNotSupported",void 0);var te=ee=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.ServiceDefinition")],ee),ne=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).dataModel=null,r.serviceDefinition=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],ne.prototype,"url",void 0),(0,d._)([(0,m.Cb)({type:X,json:{write:!0}})],ne.prototype,"dataModel",void 0),(0,d._)([(0,m.Cb)({type:te,json:{write:!0}})],ne.prototype,"serviceDefinition",void 0);var re,ae=ne=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.KnowledgeGraph")],ne),ie=n(65905),oe="esri/rest/knowledgeGraph/wasmInterface/",se=null;function ue(){return le.apply(this,arguments)}function le(){return le=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=null!==(t=se)&&void 0!==t?t:re)){e.next=3;break}return e.abrupt("return",n);case 3:return r=(0,v.Z)("wasm-simd"),e.abrupt("return",re=pe(r));case 5:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}function pe(e){return de.apply(this,arguments)}function de(){return de=(0,i.Z)((0,a.Z)().mark((function e(t){var r,i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,n.e(2717).then(n.bind(n,2717)).then((function(e){return e.a}));case 3:return r=e.sent,i=r.default,e.abrupt("return",i({locateFile:function(e){return(0,ie.V)(oe+e)}}));case 6:return e.next=8,n.e(3415).then(n.bind(n,43415)).then((function(e){return e.a}));case 8:return o=e.sent,s=o.default,e.abrupt("return",s({locateFile:function(e){return(0,ie.V)(oe+e)}}));case 11:case"end":return e.stop()}}),e)}))),de.apply(this,arguments)}var ce=n(77577),ye=n(585),he=n(29909),fe=n(32238);function me(e,t){var n=new t.ArrayValue;return n.deleteLater(),e.forEach((function(e){n.add_value(_e(e,t))})),n}function ve(e,t){var n=new t.ObjectValue;n.deleteLater();for(var r=0,a=Object.entries(e);r<a.length;r++){var i=(0,x.Z)(a[r],2),o=i[0],s=i[1];n.set_key_value(o,_e(s,t))}return n}function ge(e,t){if(e instanceof ce.Z)return function(e,t){var n=new t.GeometryValue;n.deleteLater(),n.geometry_type=n.geometry_type=t.esriGeometryType.esriGeometryMultipoint,n.has_z=e.hasZ,n.has_m=e.hasM;var r=[],a=[];a[0]=e.points.length;var i=0;return e.points.forEach((function(e){e.forEach((function(e){r[i]=e,i++}))})),n.coords=new Float64Array(r),n.lengths=new Uint32Array(a),n}(e,t);if(e instanceof ye.Z)return function(e,t){var n=new t.GeometryValue;n.deleteLater(),n.geometry_type=t.esriGeometryType.esriGeometryPoint,n.has_z=e.hasZ,n.has_m=e.hasM;var r=[],a=[];a[0]=1,r[0]=e.x,r[1]=e.y;var i=2;return e.hasZ&&(r[i]=e.z,i++),e.hasM&&(r[i]=e.m,i++),n.coords=new Float64Array(r),n.lengths=new Uint32Array(a),n}(e,t);if(e instanceof he.Z||e instanceof E.Z)return function(e,t){var n=new t.GeometryValue;n.deleteLater(),n.has_z=e.hasZ,n.has_m=e.hasM;var r=[],a=[],i=[];e instanceof he.Z?(n.geometry_type=t.esriGeometryType.esriGeometryPolyline,i=e.paths):e instanceof E.Z&&(n.geometry_type=t.esriGeometryType.esriGeometryPolygon,i=e.rings);var o=0,s=0;return i.forEach((function(e){var t=0;e.forEach((function(e){t++,e.forEach((function(e){r[s]=e,s++}))})),a[o]=t,o++})),n.coords=new Float64Array(r),n.lengths=new Uint32Array(a),n}(e,t);throw new y.Z("knowledge-graph:unsupported-geometry","Only Point, Multipoint, Polyline, and Polygon geometry are supported by ArcGIS Knowledge",{geometry:e})}function be(e,t){t.input_quantization_parameters={xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function we(e,t,n){if(!e.extent)throw new y.Z("knowledge-graph:illegal-output-quantization","The Output quantization provided to the encoder had an illegal value as part of its extent",e.extent);if(!e.quantizeMode)throw new y.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal mode setting",e.quantizeMode);if(!e.tolerance)throw new y.Z("knowledge-graph:illegal-output-quantization","The Output quantization contained an illegal tolerance setting",e.quantizeMode);t.output_quantization_parameters={extent:{xmax:e.extent.xmax,ymax:e.extent.ymax,xmin:e.extent.xmin,ymin:e.extent.ymin},quantize_mode:n.esriQuantizeMode[e.quantizeMode],tolerance:e.tolerance}}function _e(e,t){if(null==e)return"";if("object"!=typeof e)return e;if(e instanceof Date)return e;if(e instanceof fe.Z)return ge(e,t);if(Array.isArray(e)){var n=new t.ArrayValue;return n.deleteLater(),e.forEach((function(e){n.add_value(_e(e,t))})),n}return ve(e,t)}var ke=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).properties=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({json:{write:!0}})],ke.prototype,"properties",void 0);var xe=ke=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphObject")],ke),Ce=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).typeName=null,r.id=null,r}return(0,s.Z)(n)}(xe);(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],Ce.prototype,"typeName",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],Ce.prototype,"id",void 0);var Ze=Ce=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphNamedObject")],Ce),Te=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).layoutGeometry=null,r}return(0,s.Z)(n)}(Ze);(0,d._)([(0,m.Cb)({type:ye.Z,json:{write:!0}})],Te.prototype,"layoutGeometry",void 0);var Ee=Te=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.Entity")],Te),Me=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).originId=null,r.destinationId=null,r.layoutGeometry=null,r}return(0,s.Z)(n)}(Ze);(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],Me.prototype,"originId",void 0),(0,d._)([(0,m.Cb)({type:String,json:{write:!0}})],Me.prototype,"destinationId",void 0),(0,d._)([(0,m.Cb)({type:he.Z,json:{write:!0}})],Me.prototype,"layoutGeometry",void 0);var Ie=Me=(0,d._)([(0,g.j)("esri.rest.Relationship.Relationship")],Me);function Le(e,t){if(!e.typeName)throw new y.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits");if(e instanceof Ee){var n=new t.EntityValue;n.deleteLater(),n.type_name=e.typeName;for(var r=0,a=Object.entries(e.properties);r<a.length;r++){var i=(0,x.Z)(a[r],2),o=i[0],s=i[1];n.set_key_value(o,Ge(s,t))}return e.id&&n.set_id(e.id),n}if(e instanceof Ie){var u=new t.RelationshipValue;u.deleteLater(),u.type_name=e.typeName;for(var l=0,p=Object.entries(e.properties);l<p.length;l++){var d=(0,x.Z)(p[l],2),c=d[0],h=d[1];u.set_key_value(c,Ge(h,t))}return e.id&&u.set_id(e.id),e.originId&&e.destinationId&&u.set_related_entity_ids(e.originId,e.destinationId),u}throw new y.Z("knowledge-graph:applyEdits-encoding-failure","Could not determine the type of a named graph object passed to the encoder")}function De(e){return{xy_resolution:e.xyResolution,x_false_origin:e.xFalseOrigin,y_false_origin:e.yFalseOrigin,z_resolution:e.zResolution,z_false_origin:e.zFalseOrigin,m_resolution:e.mResolution,m_false_origin:e.mFalseOrigin}}function Ge(e,t){return null==e?"":"object"!=typeof e||e instanceof Date?e:e instanceof fe.Z?ge(e,t):""}var Re=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).name=null,r.supportedCategory=null,r.analyzers=[],r.searchProperties=new Map,r}return(0,s.Z)(n)}(C.Z);(0,d._)([(0,m.Cb)()],Re.prototype,"name",void 0),(0,d._)([(0,m.Cb)()],Re.prototype,"supportedCategory",void 0),(0,d._)([(0,m.Cb)()],Re.prototype,"analyzers",void 0),(0,d._)([(0,m.Cb)()],Re.prototype,"searchProperties",void 0);var Se,Ne,je,Fe,Oe,Pe,Ae,ze=Re=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.SearchIndex")],Re);function Qe(e){var t,n,r,a;return e.deleteLater(),new X({timestamp:e.timestamp,spatialReference:new z.Z(e.spatial_reference),strict:e.strict,objectIdField:e.objectid_property,globalIdField:e.globalid_property,arcgisManaged:e.arcgis_managed,identifierInfo:{identifierMappingInfo:{identifierInfoType:Ae[null===(t=e.identifier_info)||void 0===t||null===(t=t.identifier_mapping_info)||void 0===t||null===(t=t.identifier_info_type)||void 0===t?void 0:t.value],databaseNativeIdentifier:null===(n=e.identifier_info)||void 0===n||null===(n=n.identifier_mapping_info)||void 0===n?void 0:n.database_native_identifier,uniformPropertyIdentifier:{identifierPropertyName:null===(r=e.identifier_info)||void 0===r||null===(r=r.identifier_mapping_info)||void 0===r||null===(r=r.uniform_property_identifier)||void 0===r?void 0:r.identifier_property_name}},identifierGenerationInfo:{uuidMethodHint:Fe[null===(a=e.identifier_info)||void 0===a||null===(a=a.identifier_generation_info)||void 0===a||null===(a=a.uuid_method_hint)||void 0===a?void 0:a.value]}},searchIndexes:Xe(e.search_indexes),entityTypes:Je(e.entity_types),relationshipTypes:$e(e.relationship_types)})}function Ue(e){return e.deleteLater(),new V(Ye(e))}function qe(e){return e.deleteLater(),new U({name:e.name,unique:e.unique,ascending:e.ascending,description:e.description,fieldNames:Ve(e.fields)})}function Ye(e){return{name:e.name,alias:e.alias,role:Se[e.role.value]?Se[e.role.value]:null,strict:e.strict,properties:We(e.properties),fieldIndexes:Ke(e.field_indexes)}}function He(e){return e.deleteLater(),new Y({alias:e.alias,name:e.name,fieldType:Ne[e.field_type.value]?Ne[e.field_type.value]:null,geometryType:je[e.geometry_type.value]?je[e.geometry_type.value]:null,hasM:e.has_m,hasZ:e.has_z,nullable:e.nullable,editable:e.editable,required:e.required,defaultVisibility:e.default_visibility,systemMaintained:e.system_maintained,role:Pe[e.role.value],defaultValue:e.default_value})}function Be(e){e.deleteLater();for(var t=Ye(e),n=[],r=0;r<e.end_points.size();r++){var a=e.end_points.get(r);n.push({originEntityType:a.origin_entity_type,destinationEntityType:a.dest_entity_type})}return new K(Object.assign({endPoints:n},t))}function Je(e){for(var t=[],n=0;n<e.size();n++)t.push(Ue(e.get(n)));return t}function Ve(e){for(var t=[],n=0;n<e.size();n++)t.push(e.get(n));return t}function We(e){for(var t=[],n=0;n<e.size();n++)t.push(He(e.get(n)));return t}function Ke(e){for(var t=[],n=0;n<e.size();n++)t.push(qe(e.get(n)));return t}function $e(e){for(var t=[],n=0;n<e.size();n++)t.push(Be(e.get(n)));return t}function Xe(e){for(var t=[],n=0;n<e.size();n++){var r=new ze,a=e.get(0);r.name=a.name,r.supportedCategory=Oe[a.supported_category.value];for(var i=a.analyzers.size(),o=0;o<i;o++)r.analyzers.push({name:a.analyzers.get(o).name});for(var s=0;s<a.search_properties.keys().size();s++){for(var u=a.search_properties.keys().get(s),l=a.search_properties.get(u),p=[],d=0;d<l.property_names.size();d++)p.push(l.property_names.get(d));r.searchProperties.set(u,{propertyNames:p})}t.push(r)}return t}!function(e){e[e.Regular=0]="Regular",e[e.Provenance=1]="Provenance",e[e.Document=2]="Document"}(Se||(Se={})),function(e){e[e.esriFieldTypeSmallInteger=0]="esriFieldTypeSmallInteger",e[e.esriFieldTypeInteger=1]="esriFieldTypeInteger",e[e.esriFieldTypeSingle=2]="esriFieldTypeSingle",e[e.esriFieldTypeDouble=3]="esriFieldTypeDouble",e[e.esriFieldTypeString=4]="esriFieldTypeString",e[e.esriFieldTypeDate=5]="esriFieldTypeDate",e[e.esriFieldTypeOID=6]="esriFieldTypeOID",e[e.esriFieldTypeGeometry=7]="esriFieldTypeGeometry",e[e.esriFieldTypeBlob=8]="esriFieldTypeBlob",e[e.esriFieldTypeRaster=9]="esriFieldTypeRaster",e[e.esriFieldTypeGUID=10]="esriFieldTypeGUID",e[e.esriFieldTypeGlobalID=11]="esriFieldTypeGlobalID",e[e.esriFieldTypeXML=12]="esriFieldTypeXML",e[e.esriFieldTypeBigInteger=13]="esriFieldTypeBigInteger",e[e.esriFieldTypeDateOnly=14]="esriFieldTypeDateOnly",e[e.esriFieldTypeTimeOnly=15]="esriFieldTypeTimeOnly",e[e.esriFieldTypeTimestampOffset=16]="esriFieldTypeTimestampOffset"}(Ne||(Ne={})),function(e){e[e.esriGeometryNull=0]="esriGeometryNull",e[e.esriGeometryPoint=1]="esriGeometryPoint",e[e.esriGeometryMultipoint=2]="esriGeometryMultipoint",e[e.esriGeometryPolyline=3]="esriGeometryPolyline",e[e.esriGeometryPolygon=4]="esriGeometryPolygon",e[e.esriGeometryEnvelope=5]="esriGeometryEnvelope",e[e.esriGeometryAny=6]="esriGeometryAny",e[e.esriGeometryMultiPatch=7]="esriGeometryMultiPatch"}(je||(je={})),function(e){e[e.esriMethodHintUNSPECIFIED=0]="esriMethodHintUNSPECIFIED",e[e.esriUUIDESRI=1]="esriUUIDESRI",e[e.esriUUIDRFC4122=2]="esriUUIDRFC4122"}(Fe||(Fe={})),function(e){e[e.esriTypeUNSPECIFIED=0]="esriTypeUNSPECIFIED",e[e.esriTypeEntity=1]="esriTypeEntity",e[e.esriTypeRelationship=2]="esriTypeRelationship",e[e.esriTypeBoth=4]="esriTypeBoth"}(Oe||(Oe={})),function(e){e[e.esriGraphPropertyUNSPECIFIED=0]="esriGraphPropertyUNSPECIFIED",e[e.esriGraphPropertyRegular=1]="esriGraphPropertyRegular",e[e.esriGraphPropertyDocumentName=2]="esriGraphPropertyDocumentName",e[e.esriGraphPropertyDocumentTitle=3]="esriGraphPropertyDocumentTitle",e[e.esriGraphPropertyDocumentUrl=4]="esriGraphPropertyDocumentUrl",e[e.esriGraphPropertyDocumentText=5]="esriGraphPropertyDocumentText",e[e.esriGraphPropertyDocumentKeywords=6]="esriGraphPropertyDocumentKeywords",e[e.esriGraphPropertyDocumentContentType=7]="esriGraphPropertyDocumentContentType",e[e.esriGraphPropertyDocumentMetadata=8]="esriGraphPropertyDocumentMetadata",e[e.esriGraphPropertyDocumentFileExtension=9]="esriGraphPropertyDocumentFileExtension"}(Pe||(Pe={})),function(e){e[e.esriIdentifierInfoTypeUNSPECIFIED=0]="esriIdentifierInfoTypeUNSPECIFIED",e[e.esriIdentifierInfoTypeDatabaseNative=1]="esriIdentifierInfoTypeDatabaseNative",e[e.esriIdentifierInfoTypeUniformProperty=2]="esriIdentifierInfoTypeUniformProperty"}(Ae||(Ae={}));var et=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){return(0,o.Z)(this,n),t.call(this,e)}return(0,s.Z)(n)}(xe),tt=et=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.ObjectValue")],et),nt=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).path=null,r}return(0,s.Z)(n)}(A.wq);(0,d._)([(0,m.Cb)({type:[xe],json:{write:!0}})],nt.prototype,"path",void 0);var rt,at,it,ot=nt=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.Path")],nt);function st(e){var t={},n=ut(e,t),r=e.lengths,a=e.coords,i="";if(e.geometry_type.value===rt.ESRI_GEOMETRY_POLYGON)i="rings";else{if(e.geometry_type.value!==rt.ESRI_GEOMETRY_POLYLINE)throw new y.Z("KnowledgeGraph:illegal-geometry-type","Illegal Geometry type for multipath conversion");i="paths"}t[i]=[];var o=0;return r.forEach((function(e){for(var r=[],s=0;s<e;s++){for(var u=[],l=0;l<n;l++)u[l]=a[o],o++;r.push(u)}t[i].push(r)})),t}function ut(e,t){var n=2;return e.has_z?(t.hasZ=e.has_z,n++):t.hasZ=!1,e.has_m?(t.hasM=e.has_m,n++):t.hasM=!1,n}!function(e){e[e.ESRI_GEOMETRY_NULL=0]="ESRI_GEOMETRY_NULL",e[e.ESRI_GEOMETRY_POINT=1]="ESRI_GEOMETRY_POINT",e[e.ESRI_GEOMETRY_MULTIPOINT=2]="ESRI_GEOMETRY_MULTIPOINT",e[e.ESRI_GEOMETRY_POLYLINE=3]="ESRI_GEOMETRY_POLYLINE",e[e.ESRI_GEOMETRY_POLYGON=4]="ESRI_GEOMETRY_POLYGON",e[e.ESRI_GEOMETRY_ENVELOPE=5]="ESRI_GEOMETRY_ENVELOPE",e[e.ESRI_GEOMETRY_ANY=6]="ESRI_GEOMETRY_ANY",e[e.ESRI_GEOMETRY_MULTI_PATCH=7]="ESRI_GEOMETRY_MULTI_PATCH"}(rt||(rt={})),function(e){e[e.OBJECT=0]="OBJECT",e[e.ENTITY=1]="ENTITY",e[e.RELATIONSHIP=2]="RELATIONSHIP",e[e.PATH=3]="PATH",e[e.ARRAY=4]="ARRAY"}(at||(at={})),function(e){e[e.view=0]="view",e[e.edit=1]="edit"}(it||(it={}));var lt=h.Z.getLogger("esri.rest.knowledgeGraph.WasmToQueryResponseObjConstructors"),pt={decodedWasmObjToQueryResponseObj:function(e,t){if(null==e)return null;if("object"!=typeof e)return e;if("getDate"in e)return e;if("geometry_type"in e)switch(e.geometry_type.value){case null:return null;case rt.ESRI_GEOMETRY_POINT:return function(e){var t={},n=2;ut(e,t);var r=e.coords;return t.x=r[0],t.y=r[1],e.has_z&&(t.z=r[n],n++),e.has_m&&(t.m=r[n]),new ye.Z(t)}(e);case rt.ESRI_GEOMETRY_MULTIPOINT:return function(e){var t={},n=ut(e,t),r=e.lengths,a=e.coords,i=r[0];t.points=[];for(var o=0,s=0;s<i;s++){for(var u=[],l=0;l<n;l++)u[l]=a[o],o++;t.points.push(u)}return new ce.Z(t)}(e);case rt.ESRI_GEOMETRY_POLYLINE:return function(e){return new he.Z(st(e))}(e);case rt.ESRI_GEOMETRY_POLYGON:return function(e){return new E.Z(st(e))}(e);case rt.ESRI_GEOMETRY_ENVELOPE:case rt.ESRI_GEOMETRY_MULTI_PATCH:return lt.warnOnce("Envelope and Multipatch are not supported on knowledge entities, but one of those geometry types was detected. Result interpreted as null"),null;case rt.ESRI_GEOMETRY_NULL:case rt.ESRI_GEOMETRY_ANY:default:return lt.warnOnce("Unknown or blank geometry type returned - Result interpreted as null"),null}else{if(!("object_value_type"in e))return lt.warnOnce("A decoded value came back of a type that is not supported. Result interpreted as null"),null;switch(e.object_value_type.value){case at.OBJECT:return function(e,t){return new tt(yt(e,t))}(e,t);case at.ENTITY:return ct(e,t);case at.RELATIONSHIP:return ht(e,t);case at.PATH:return function(e,t){for(var n=e.entity_count(),r=e.relationship_count(),a=[],i=0;i<n;i++)a.push(ct(e.get_entity_at(i),t)),i<r&&a.push(ht(e.get_relationship_at(i),t));return new ot({path:a})}(e,t);case at.ARRAY:return function(e,t){for(var n=[],r=e.count(),a=0;a<r;a++){var i=e.get_value_at(a);n.push(dt(i,t))}return n}(e,t);default:return lt.warnOnce("Unknown graph object type detected!  Result interpreted as null"),null}}}};function dt(e,t){return pt.decodedWasmObjToQueryResponseObj(e,t)}function ct(e,t){var n=e.type_name,r=yt(e,t),a=e.get_id();return new Ee(Object.assign({typeName:n,id:a},r))}function yt(e,t){for(var n={},r=e.key_count(),a=0;a<r;a++)n[e.get_key_at(a)]=dt(e.get_value_at(a),t);return{properties:n}}function ht(e,t){var n=e.type_name,r=yt(e,t);return new Ie(Object.assign({typeName:n,id:e.get_id(),originId:e.get_origin_entity_id(),destinationId:e.get_destination_entity_id()},r))}var ft=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).hasError=null,r.error=null,r.editResults=[],r}return(0,s.Z)(n)}(C.Z);(0,d._)([(0,m.Cb)()],ft.prototype,"hasError",void 0),(0,d._)([(0,m.Cb)()],ft.prototype,"error",void 0),(0,d._)([(0,m.Cb)()],ft.prototype,"editResults",void 0);var mt=ft=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphApplyEdits")],ft);function vt(e){var t=new mt;t.hasError=e.has_error(),t.hasError&&(t.error={errorCode:e.error.error_code,errorMessage:e.error.error_message});for(var n=e.get_edit_results_count(),r=0;r<n;r++){for(var a=e.get_edit_results_at(r),i=e.get_edit_results_type_name_at(r),o=[],s=[],u=[],l=a.get_add_results_count(),p=a.get_update_results_count(),d=a.get_delete_results_count(),c=0;c<l;c++){var y=a.get_add_result_at(c);o.push({id:y.id,error:{errorCode:y.error.error_code,errorMessage:y.error.error_message}})}for(var h=0;h<p;h++){var f=a.get_update_result_at(h);s.push({id:f.id,error:{errorCode:f.error.error_code,errorMessage:f.error.error_message}})}for(var m=0;m<d;m++){var v=a.get_delete_result_at(m);u.push({id:v.id,error:{errorCode:v.error.error_code,errorMessage:v.error.error_message}})}t.editResults.push({typeName:i,adds:o,updates:s,deletes:u})}return t}var gt={fetchKnowledgeGraph:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new ae({url:t}),(r=[]).push(kt(n)),r.push(Ct(n)),e.next=5,Promise.all(r);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refreshDataModel:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yt(t);case 2:t.dataModel=e.sent;case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),refreshServiceDefinition:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,N.Z)(t.url,{query:{f:"json"}});case 2:return i=e.sent.data,e.abrupt("return",(i.capabilities=null===i||void 0===i||null===(n=i.capabilities)||void 0===n?void 0:n.split(","),i.supportedQueryFormats=null===i||void 0===i||null===(r=i.supportedQueryFormats)||void 0===r?void 0:r.split(","),t.serviceDefinition=new te(i),t.serviceDefinition));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),executeQueryStreaming:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(t.url,"/graph/query"),e.next=3,Mt(t);case 3:return e.next=5,Ot(i,r);case 5:return o=e.sent,e.next=8,St(n,t);case 8:return o.data.body=e.sent,e.next=11,Tt(o.data.url,o.data);case 11:if(s=e.sent,!t.dataModel){e.next=19;break}return e.t0=P,e.next=16,Ut(s,t.dataModel);case 16:return e.t1=e.sent,e.t2={resultRowsStream:e.t1},e.abrupt("return",new e.t0(e.t2));case 19:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeApplyEdits:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(i=t.serviceDefinition)||void 0===i||!i.dataEditingNotSupported){e.next=2;break}throw new y.Z("knowledge-graph:data-editing-not-supported","The Knowledge Graph Service definition indicated that data editing is not supported");case 2:return o="".concat(t.url,"/graph/applyEdits"),e.next=5,Mt(t);case 5:return e.next=7,Ot(o,r);case 7:return s=e.sent,e.next=10,Gt(n,t);case 10:return s.data.body=e.sent,e.t0=At,e.next=14,Tt(s.data.url,s.data);case 14:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeQuery:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u,l,p;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o="".concat(t.url,"/graph/query"),e.next=3,(0,N.Z)(o,{responseType:"array-buffer",query:(0,R.Z)({f:"pbf",openCypherQuery:n.openCypherQuery},null===r||void 0===r?void 0:r.query),signal:null===r||void 0===r?void 0:r.signal,timeout:null===r||void 0===r?void 0:r.timeout});case 3:if(s=e.sent,u=null===(i=s.getHeader)||void 0===i?void 0:i.call(s,"content-type"),l=s.data,null===u||void 0===u||!u.includes("application/x-protobuf")){e.next=14;break}return e.next=9,ue();case 9:if(e.t0=e.sent.GraphQueryDecoder,(p=new e.t0).deleteLater(),!t.dataModel){e.next=13;break}return e.abrupt("return",new F({resultRows:Qt(p,l,t.dataModel)}));case 13:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 14:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:u,data:s.data});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeSearch:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.typeCategoryFilter,s="".concat(t.url,"/graph/search"),e.next=4,(0,N.Z)(s,{responseType:"array-buffer",query:(0,R.Z)({f:"pbf",searchQuery:'"'.concat(n.searchQuery,'"'),typeCategoryFilter:o},null===r||void 0===r?void 0:r.query),signal:null===r||void 0===r?void 0:r.signal,timeout:null===r||void 0===r?void 0:r.timeout});case 4:if(u=e.sent,l=null===(i=u.getHeader)||void 0===i?void 0:i.call(u,"content-type"),p=u.data,null===l||void 0===l||!l.includes("application/x-protobuf")){e.next=15;break}return e.next=10,ue();case 10:if(e.t0=e.sent.GraphQueryDecoder,(d=new e.t0).deleteLater(),!t.dataModel){e.next=14;break}return e.abrupt("return",new F({resultRows:Qt(d,p,t.dataModel)}));case 14:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 15:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:l,data:u.data});case 16:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),executeSearchStreaming:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i="".concat(t.url,"/graph/search"),e.next=3,Mt(t);case 3:return e.next=5,Ot(i,r);case 5:return o=e.sent,e.next=8,jt(n);case 8:return o.data.body=e.sent,e.next=11,Tt(o.data.url,o.data);case 11:if(s=e.sent,!t.dataModel){e.next=19;break}return e.t0=P,e.next=16,Ut(s,t.dataModel);case 16:return e.t1=e.sent,e.t2={resultRowsStream:e.t1},e.abrupt("return",new e.t0(e.t2));case 19:throw new y.Z("knowledge-graph:undefined-data-model","The KnowledgeGraph supplied did not have a data model");case 20:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),_fetchWrapper:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()};function bt(e,t,n){return wt.apply(this,arguments)}function wt(){return wt=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.executeQueryStreaming(t,n,r));case 1:case"end":return e.stop()}}),e)}))),wt.apply(this,arguments)}function _t(){return _t=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.fetchKnowledgeGraph(t));case 1:case"end":return e.stop()}}),e)}))),_t.apply(this,arguments)}function kt(e){return xt.apply(this,arguments)}function xt(){return xt=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.refreshDataModel(t));case 1:case"end":return e.stop()}}),e)}))),xt.apply(this,arguments)}function Ct(e){return Zt.apply(this,arguments)}function Zt(){return Zt=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt.refreshServiceDefinition(t));case 1:case"end":return e.stop()}}),e)}))),Zt.apply(this,arguments)}function Tt(e,t){return Et.apply(this,arguments)}function Et(){return Et=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",gt._fetchWrapper(t,n));case 1:case"end":return e.stop()}}),e)}))),Et.apply(this,arguments)}function Mt(e){return It.apply(this,arguments)}function It(){return It=(0,i.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===S.id||void 0===S.id?void 0:S.id.findCredential(t.url),e.t0=n,e.t0){e.next=10;break}if(!t.dataModel){e.next=8;break}return e.next=6,Yt(t);case 6:e.next=10;break;case 8:return e.next=10,kt(t);case 10:case"end":return e.stop()}}),e)}))),It.apply(this,arguments)}function Lt(e,t,n){if(0!==e.error_code)throw new y.Z(t,n,{errorCode:e.error_code,errorMessage:e.error_message})}function Dt(e,t,n,r){null==t?n.set_param_key_value(e,""):"object"!=typeof t||t instanceof Date?n.set_param_key_value(e,t):t instanceof fe.Z?n.set_param_key_value(e,ge(t,r)):t instanceof Array?n.set_param_key_value(e,me(t,r)):n.set_param_key_value(e,ve(t,r))}function Gt(e,t){return Rt.apply(this,arguments)}function Rt(){return Rt=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u,l,p,d,c,h,f,m,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n.dataModel,e.t0){e.next=4;break}return e.next=4,kt(n);case 4:if(n.dataModel){e.next=6;break}throw new y.Z("knowledge-graph:data-model-undefined","Encoding could not proceed because a data model was not provided and it could not be determined from the service");case 6:return e.next=8,ue();case 8:s=e.sent,u=!(null===(r=t.options)||void 0===r||!r.cascadeDelete),(l=new s.GraphApplyEditsEncoder(s.SpatialReferenceUtil.WGS84(),null!==(i=t.options)&&void 0!==i&&i.inputQuantizationParameters?De(null===(o=t.options)||void 0===o?void 0:o.inputQuantizationParameters):s.InputQuantizationUtil.WGS84_lossless())).deleteLater(),l.cascade_delete=u,e.prev=12,null!==(p=t.entityAdds)&&void 0!==p&&p.forEach((function(e){Lt(l.add_entity(Le(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(d=t.relationshipAdds)&&void 0!==d&&d.forEach((function(e){if(!e.originId||!e.destinationId)throw new y.Z("knowledge-graph:relationship-origin-destination-missing","When adding a new relationship, you must provide both an origin and destination id on the appropriate class property");Lt(l.add_relationship(Le(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(c=t.entityUpdates)&&void 0!==c&&c.forEach((function(e){if(!e.id)throw new y.Z("knowledge-graph:entity-id-missing","When updating an entity or relationship, you must specify the id on the class level property");Lt(l.update_entity(Le(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - an entity failed to be added to the encoder")})),null!==(h=t.relationshipUpdates)&&void 0!==h&&h.forEach((function(e){if(!e.id)throw new y.Z("knowledge-graph:relationship-id-missing","When updating an entity or relationship, you must specify the id on the class level property");Lt(l.update_relationship(Le(e,s)),"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits - a relationship failed to be added to the encoder")})),null!==(f=t.entityDeletes)&&void 0!==f&&f.forEach((function(e){var t;if(!e.typeName)throw new y.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");var n=l.make_delete_helper(e.typeName,!0);n.deleteLater(),null===(t=e.ids)||void 0===t||t.forEach((function(e){n.delete_by_id(e)}))})),null!==(m=t.relationshipDeletes)&&void 0!==m&&m.forEach((function(e){var t;if(!e.typeName)throw new y.Z("knowledge-graph:no-type-name","You must indicate the entity/relationship named object type to apply edits - delete");var n=l.make_delete_helper(e.typeName,!1);null===(t=e.ids)||void 0===t||t.forEach((function(e){n.delete_by_id(e)}))})),l.encode(),e.next=19;break;case 16:throw e.prev=16,e.t1=e.catch(12),new y.Z("knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed",{error:e.t1});case 19:return v=l.get_encoding_result(),e.abrupt("return",(Lt(v.error,"knowledge-graph:applyEdits-encoding-failed","Attempting to encode the applyEdits failed"),v.get_byte_buffer()));case 21:case"end":return e.stop()}}),e,null,[[12,16]])}))),Rt.apply(this,arguments)}function St(e,t){return Nt.apply(this,arguments)}function Nt(){return Nt=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u,l,p,d,c;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue();case 2:if(r=e.sent,(i=new r.GraphQueryRequestEncoder).deleteLater(),i.output_spatial_reference=r.SpatialReferenceUtil.WGS84(),i.open_cypher_query=t.openCypherQuery,t.bindParameters)for(o=0,s=Object.entries(t.bindParameters);o<s.length;o++)u=(0,x.Z)(s[o],2),l=u[0],p=u[1],Dt(l,p,i,r);if(!t.bindGeometryQuantizationParameters){e.next=9;break}be(t.bindGeometryQuantizationParameters,i),e.next=16;break;case 9:if(e.t0=n.dataModel,e.t0){e.next=13;break}return e.next=13,kt(n);case 13:if(4326===(null===(d=n.dataModel)||void 0===d||null===(d=d.spatialReference)||void 0===d?void 0:d.wkid)){e.next=15;break}throw new y.Z("knowledge-graph:SR-quantization-mismatch","If the DataModel indicates a coordinate system other than WGS84, inputQuantizationParameters must be provided to the query encoder");case 15:i.input_quantization_parameters=r.InputQuantizationUtil.WGS84_lossless();case 16:t.outputQuantizationParameters&&we(t.outputQuantizationParameters,i,r),e.prev=17,i.encode(),e.next=24;break;case 21:throw e.prev=21,e.t1=e.catch(17),new y.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{error:e.t1});case 24:if(0===(c=i.get_encoding_result()).error.error_code){e.next=27;break}throw new y.Z("knowledge-graph:query-encoding-failed","Attempting to encode the query failed",{errorCode:c.error.error_code,errorMessage:c.error.error_message});case 27:return e.abrupt("return",c.get_byte_buffer());case 28:case"end":return e.stop()}}),e,null,[[17,21]])}))),Nt.apply(this,arguments)}function jt(e){return Ft.apply(this,arguments)}function Ft(){return Ft=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ue();case 2:if(r=e.sent,(i=new r.GraphSearchRequestEncoder).deleteLater(),i.search_query=t.searchQuery,i.type_category_filter=r.esriNamedTypeCategory[t.typeCategoryFilter],!0===t.returnSearchContext&&(i.return_search_context=t.returnSearchContext),null!=t.start&&t.start>0&&(i.start_index=t.start),null!=t.num&&(i.max_num_results=t.num),!(null!=t.idsFilter&&Array.isArray(t.idsFilter)&&t.idsFilter.length>0)){e.next=12;break}e.prev=5,i.set_ids_filter(me(t.idsFilter,r)),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(5),new y.Z("knowledge-graph:ids-format-error","Attempting to set ids filter failed.  This is usually caused by an incorrectly formatted UUID string",{error:e.t0});case 12:null===(n=t.namedTypesFilter)||void 0===n||n.forEach((function(e){i.add_named_type_filter(e)})),e.prev=13,i.encode(),e.next=20;break;case 17:throw e.prev=17,e.t1=e.catch(13),new y.Z("knowledge-graph:search-encoding-failed","Attempting to encode the search failed",{error:e.t1});case 20:if(0===(o=i.get_encoding_result()).error.error_code){e.next=23;break}throw new y.Z("knowledge-graph:search-encoding-failed","Attempting to get encoding result from the query failed",{errorCode:o.error.error_code,errorMessage:o.error.error_message});case 23:return e.abrupt("return",o.get_byte_buffer());case 24:case"end":return e.stop()}}),e,null,[[5,9],[13,17]])}))),Ft.apply(this,arguments)}function Ot(e,t){return Pt.apply(this,arguments)}function Pt(){return Pt=(0,i.Z)((0,a.Z)().mark((function e(t,n){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,N.Z)(t,{responseType:"native-request-init",method:"post",query:(0,R.Z)({f:"pbf"},null===n||void 0===n?void 0:n.query),body:"x",headers:{"Content-Type":"application/octet-stream"},signal:null===n||void 0===n?void 0:n.signal,timeout:null===n||void 0===n?void 0:n.timeout}));case 1:case"end":return e.stop()}}),e)}))),Pt.apply(this,arguments)}function At(e){return zt.apply(this,arguments)}function zt(){return zt=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r,i;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=t.headers.get("content-type"))||void 0===n||!n.includes("application/x-protobuf")){e.next=10;break}return e.next=4,t.arrayBuffer();case 4:return r=e.sent,e.next=7,ue();case 7:return e.t0=e.sent.GraphApplyEditsDecoder,i=new e.t0,e.abrupt("return",(i.deleteLater(),i.decode(new Uint8Array(r)),vt(i)));case 10:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:n,data:t.text()});case 11:case"end":return e.stop()}}),e)}))),zt.apply(this,arguments)}function Qt(e,t,n){e.push_buffer(new Uint8Array(t));for(var r=[],a=0;e.next_row();){a||(a=e.get_header_keys().size());for(var i=new Array(a),o=0;o<a;o++){var s=e.get_value(o);i[o]=dt(s,n)}r.push(i)}if(e.has_error())throw new y.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:e.error.error_code,errorMessage:e.error.error_message});return r}function Ut(e,t){return qt.apply(this,arguments)}function qt(){return qt=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.headers.get("content-type"),t.headers.get("content-length")&&h.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphService").warnOnce("Found `Content-Length` header when expecting a streaming HTTP response! Please investigate whether all intermediate HTTP proxies and/or load balancers are configured such that they don't forcefully buffer the entire response before returning it to the client. A valid HTTP streaming response should use Chunked Transfer Encoding and not have a Content Length defined."),null===r||void 0===r||!r.includes("application/x-protobuf")){e.next=8;break}return s=null===(o=t.body)||void 0===o?void 0:o.getReader(),e.next=5,ue();case 5:return e.t0=e.sent.GraphQueryDecoder,u=new e.t0,e.abrupt("return",(u.deleteLater(),new ReadableStream({start:function(e){return(0,i.Z)((0,a.Z)().mark((function t(){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=function(){return null===s||void 0===s?void 0:s.read().then((function(t){var a,i=t.done,o=t.value;if(!i){var l=Qt(u,o,n);return l.length>0&&e.enqueue(l),r()}if(u.has_error()&&(a=new y.Z("knowledge-graph:stream-decoding-error","One or more result rows were not successfully decoded",{errorCode:u.error.error_code,errorMessage:u.error.error_message})),s.releaseLock(),a)throw e.error(a),a;e.close()}))},t.prev=1,t.abrupt("return",r());case 5:t.prev=5,t.t0=t.catch(1),null!==s&&void 0!==s&&s.releaseLock(),e.error(new y.Z("knowledge-graph:stream-decoding-error","The server returned a valid response, but there was an error decoding the response stream",{error:t.t0})),e.close();case 8:case"end":return t.stop()}}),t,null,[[1,5]])})))()}})));case 8:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:r,data:t.text()});case 9:case"end":return e.stop()}}),e)}))),qt.apply(this,arguments)}function Yt(e){return Ht.apply(this,arguments)}function Ht(){return Ht=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(t.url,"/dataModel/queryDataModel"),e.next=3,(0,N.Z)(r,{responseType:"array-buffer",query:{f:"pbf"}});case 3:if(i=e.sent,o=null===(n=i.getHeader)||void 0===n?void 0:n.call(i,"content-type"),s=i.data,null===o||void 0===o||!o.includes("application/x-protobuf")){e.next=13;break}return e.next=9,ue();case 9:if(u=e.sent.decode_data_model_from_protocol_buffer(new Uint8Array(s))){e.next=12;break}throw new y.Z("knowledge-graph:data-model-decode-failure","The server responded to the data model query, but the response failed to be decoded.  This typically occurs when the Knowledge JS API (4.26 or later) is used with an unsupported backend (11.0 or earlier)");case 12:return e.abrupt("return",Qe(u));case 13:throw new y.Z("knowledge-graph:unexpected-server-response","server returned an unexpected response",{responseType:o,data:i.data});case 14:case"end":return e.stop()}}),e)}))),Ht.apply(this,arguments)}var Bt=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).openCypherQuery="",r}return(0,s.Z)(n)}(C.Z);(0,d._)([(0,m.Cb)()],Bt.prototype,"openCypherQuery",void 0);var Jt=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;return(0,o.Z)(this,n),(r=t.call(this,e)).bindParameters=null,r.bindGeometryQuantizationParameters=null,r.outputQuantizationParameters=null,r}return(0,s.Z)(n)}(Bt=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQuery")],Bt));(0,d._)([(0,m.Cb)()],Jt.prototype,"bindParameters",void 0),(0,d._)([(0,m.Cb)()],Jt.prototype,"bindGeometryQuantizationParameters",void 0),(0,d._)([(0,m.Cb)()],Jt.prototype,"outputQuantizationParameters",void 0);var Vt=Jt=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.GraphQueryStreaming")],Jt);function Wt(e){if(!e.spatialReference.isWGS84)throw new y.Z("knowledge-graph:layer-support-utils","The extentToInBoundsRings function only supports WGS84 spatial references.");return e.xmax>180&&e.xmin<180?[[[e.xmin,e.ymin],[e.xmin,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[-180,e.ymin]]]:e.xmax>180&&e.xmin>180?[[[e.xmin-360,e.ymin],[e.xmin-360,e.ymax],[e.xmax-360,e.ymax],[e.xmax-360,e.ymin],[e.xmin-360,e.ymin]]]:e.xmax>-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[180,e.ymax],[180,e.ymin],[e.xmin+360,e.ymin]],[[-180,e.ymin],[-180,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[-180,e.ymin]]]:e.xmax<-180&&e.xmin<-180?[[[e.xmin+360,e.ymin],[e.xmin+360,e.ymax],[e.xmax+360,e.ymax],[e.xmax+360,e.ymin],[e.xmin+360,e.ymin]]]:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}function Kt(e,t){return $t.apply(this,arguments)}function $t(){return $t=(0,i.Z)((0,a.Z)().mark((function e(t,n){var o,s,u,l,p,d,c,y,h,f,m,v,g,b,w,_,k;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=[],u=new Map,l=[],null!==(o=n.dataModel)&&void 0!==o&&o.relationshipTypes){p=(0,r.Z)(n.dataModel.relationshipTypes);try{for(p.s();!(d=p.n()).done;)(c=d.value).name&&u.set(c.name,[])}catch(C){p.e(C)}finally{p.f()}}y=(0,r.Z)(t);try{for(y.s();!(h=y.n()).done;)m=h.value,u.has(m.typeName)&&(null===(f=u.get(m.typeName))||void 0===f||f.push(m.id))}catch(C){y.e(C)}finally{y.f()}v=(0,r.Z)(u),e.prev=5,v.s();case 7:if((g=v.n()).done){e.next=15;break}if(b=(0,x.Z)(g.value,2),w=b[0],!((_=b[1]).length<1)){e.next=11;break}return e.abrupt("continue",13);case 11:k=new Vt({openCypherQuery:"MATCH (n)-[r:".concat(w,"]->(m) WHERE id(r) in $ids RETURN id(n), labels(n)[0], id(m), labels(m)[0]"),bindParameters:{ids:_}}),l.push(bt(n,k).then(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,i,o,u,l,p,d;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.resultRowsStream.getReader();case 1:return e.next=3,n.read();case 3:if(i=e.sent,o=i.done,u=i.value,!o){e.next=8;break}return e.abrupt("break",12);case 8:l=(0,r.Z)(u);try{for(l.s();!(p=l.n()).done;)d=p.value,s.push({id:d[0],typeName:d[1]}),s.push({id:d[2],typeName:d[3]})}catch(C){l.e(C)}finally{l.f()}case 10:e.next=1;break;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 13:e.next=7;break;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),v.e(e.t0);case 20:return e.prev=20,v.f(),e.finish(20);case 23:return e.next=25,Promise.all(l);case 25:return e.abrupt("return",s);case 26:case"end":return e.stop()}}),e,null,[[5,17,20,23]])}))),$t.apply(this,arguments)}var Xt=n(86638),en=n(53866),tn="ESRI__ID",nn="ESRI__ORIGIN_ID",rn="ESRI__DESTINATION_ID",an="ESRI__LAYOUT_GEOMETRY",on=12,sn=h.Z.getLogger("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager"),un=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a,i,s;(0,o.Z)(this,n),(s=t.call(this,e)).inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},s.entityTypeNames=new Set,s.relationshipTypeNames=new Set,s.geographicLookup=new Map,s.sublayerCaches=new Map,s.nodeConnectionsLookup=new Map,s.memberIdTypeLookup=new Map,s._processingCacheUpdatesLookup=new Map;var u=new Map;return null!==(r=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==r&&r.forEach((function(t){var n,r;t.name&&(u.set(t.name,"entity"),s._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers)||s.entityTypeNames.add(t.name),null===(r=t.properties)||void 0===r||r.forEach((function(e){var n;e.geometryType&&"esriGeometryNull"!==e.geometryType&&s.geographicLookup.set(t.name,{name:null!==(n=e.name)&&void 0!==n?n:"",geometryType:e.geometryType})})))})),null!==(a=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==a&&a.forEach((function(t){var n,r;t.name&&(u.set(t.name,"relationship"),s._processingCacheUpdatesLookup.set(t.name,[]),e.inclusionModeDefinition&&!(null!==(n=e.inclusionModeDefinition)&&void 0!==n&&n.generateAllSublayers)||s.relationshipTypeNames.add(t.name),null===(r=t.properties)||void 0===r||r.forEach((function(e){var n;e.geometryType&&"esriGeometryNull"!==e.geometryType&&s.geographicLookup.set(t.name,{name:null!==(n=e.name)&&void 0!==n?n:"",geometryType:e.geometryType})})))})),null===(i=e.inclusionModeDefinition)||void 0===i||i.namedTypeDefinitions.forEach((function(t,n){var r;if("entity"===u.get(n))s.entityTypeNames.add(n);else{var a;if("relationship"!==u.get(n))return sn.warn("A named type, ".concat(n,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(a=e.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.delete(n));s.relationshipTypeNames.add(n)}var i=new Map;null!==(r=t.members)&&void 0!==r&&r.forEach((function(e){s.memberIdTypeLookup.set(e.id,n);var t=s.getById(e.id);t&&i.set(e.id,t)})),s.sublayerCaches.set(n,i)})),s}return(0,s.Z)(n,[{key:"addToLayer",value:function(e){var t=this;e.forEach((function(e){var n=e.typeName,r=e.id;if(!t.inclusionModeDefinition)throw new y.Z("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(t.inclusionModeDefinition.namedTypeDefinitions.has(n)){if(t.inclusionModeDefinition.namedTypeDefinitions.has(n)){var a=t.inclusionModeDefinition.namedTypeDefinitions.get(n);a.members||(a.members=new Map),a.members.set(r,{id:r}),t.memberIdTypeLookup.set(r,n)}}else{var i=new Map;i.set(r,{id:r}),t.inclusionModeDefinition.namedTypeDefinitions.set(n,{useAllData:!1,members:i}),t.memberIdTypeLookup.set(r,n)}}))}},{key:"getById",value:function(e){return G.getInstance().readFromStoreById(e)}},{key:"getData",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u,l,p,d,c,y,h,f,m,v;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.objectType.name&&null!==(i=this.inclusionModeDefinition)&&void 0!==i&&i.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0)||this.inclusionModeDefinition.namedTypeDefinitions.has(n.objectType.name)){e.next=2;break}return e.abrupt("return",[]);case 2:if(o=t||new Xt.Z({where:"1=1",outFields:["*"]}),"link-chart"!==n.parentCompositeLayer.type){e.next=12;break}if(p=n.parentCompositeLayer,d=this._processingCacheUpdatesLookup.get(null!==(s=n.objectType.name)&&void 0!==s?s:""),c=o.outFields,y=o.geometry,h="",f="",y&&y.extent&&(h=(0,b.fC)(y.extent.ymin,y.extent.xmin,on),f=(0,b.fC)(y.extent.ymax,y.extent.xmax,on)),e.t0=c&&1===c.length&&c[0]===tn&&"1=1"===o.where,e.t0){e.next=10;break}return e.next=10,Promise.all(null!==d&&void 0!==d?d:[]);case 10:return m=this.sublayerCaches.has(null!==(u=n.objectType.name)&&void 0!==u?u:"")?Array.from(null===(l=this.sublayerCaches.get(n.objectType.name))||void 0===l?void 0:l.values()):[],v=[],e.abrupt("return",(m.forEach((function(e){if(e.geometry=p.linkChartDiagramLookup.get(e.attributes[n.objectIdField]),e.attributes[an]=e.geometry,h&&f){var t=p.linkChartGeohashLookup.get(e.attributes[n.objectIdField]);t?t>=h&&t<=f&&v.push(e):v.push(e)}else v.push(e)})),v));case 12:return e.abrupt("return",this.retrieveDataFromService(o,n,r));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getConnectedRecordIds",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r,o,s=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],r=[],o=new Map,t.forEach((function(e){if(s.memberIdTypeLookup.has(e)){var t,n=s.memberIdTypeLookup.get(e);if(!s.entityTypeNames.has(n))return;o.has(n)?null===(t=o.get(n))||void 0===t||t.push(e):o.set(n,[e])}})),o.forEach((function(e,t){var o="MATCH (n:".concat(t,")-[r]-(m) WHERE id(n) IN $ids RETURN id(r), type(r), id(m), labels(m)[0]"),u=new Promise((function(t){(0,i.Z)((0,a.Z)().mark((function t(){var r,i,u,l,p,d;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,bt(s.knowledgeGraph,new Vt({openCypherQuery:o,bindParameters:{ids:e}}));case 2:r=t.sent.resultRowsStream.getReader(),t.prev=3;case 4:return t.next=6,r.read();case 6:if(i=t.sent,u=i.done,l=i.value,!u){t.next=11;break}return t.abrupt("break",14);case 11:for(p=0;p<l.length;p++)d=l[p],n.push({id:d[0],typeName:d[1]}),n.push({id:d[2],typeName:d[3]});case 12:t.next=4;break;case 14:t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(3),"AbortError"===t.t0.name){t.next=20;break}throw t.t0;case 20:sn.info("Request aborted as expected");case 21:case"end":return t.stop()}}),t,null,[[3,16]])})))().then((function(){t()}))}));r.push(u)})),e.next=5,Promise.all(r);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshCacheContent",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,o){var s,u,l,p,d,c,h,f,m,v,g,b,w,_=this,k=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=!(k.length>3&&void 0!==k[3])||k[3],h=G.getInstance(),f=[],m=new Map,v=new Map,null!==(s=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((function(e){e.name&&v.set(e.name,e)})),null!==(u=this.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){e.name&&v.set(e.name,e)})),t||this.inclusionModeDefinition?t?t.forEach((function(e){if(_.memberIdTypeLookup.has(e)){var t,n=_.memberIdTypeLookup.get(e);m.has(n)?null===(t=m.get(n))||void 0===t||t.push(e):m.set(n,[e])}})):null===(l=this.inclusionModeDefinition)||void 0===l||null===(l=l.namedTypeDefinitions)||void 0===l||l.forEach((function(e,t){e.useAllData?m.set(t,null):e.members&&e.members.forEach((function(e){var n;m.has(t)&&null!==m.get(t)?null===(n=m.get(t))||void 0===n||n.push(e.id):m.set(t,[e.id])}))})):(null!==(p=this.knowledgeGraph.dataModel.entityTypes)&&void 0!==p&&p.forEach((function(e){e.name&&m.set(e.name,null)})),null===(d=this.knowledgeGraph.dataModel.entityTypes)||void 0===d||d.forEach((function(e){e.name&&m.set(e.name,null)}))),g=(0,r.Z)(m),e.prev=4,w=(0,a.Z)().mark((function e(){var t,r,s,u,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(0,x.Z)(b.value,2),s=r[0],u=r[1],l=new Promise((function(e){var t=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,r,i,l,p,d,f,m,g,b;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new Set,i=[],p="",d=!1,n||null!==(t=v.get(s))&&void 0!==t&&null!==(t=t.properties)&&void 0!==t&&t.forEach((function(e){e.name&&r.add(e.name)})),o&&_.geographicLookup.has(s)&&(m=null===(f=_.geographicLookup.get(s))||void 0===f?void 0:f.name)&&r.add(m),!_.entityTypeNames.has(s)){e.next=7;break}p="MATCH (n:".concat(s,") ").concat(u?"WHERE id(n) IN $ids ":"","return ID(n)"),r.forEach((function(e){p+=", n.".concat(e),i.push(e)})),e.next=10;break;case 7:if(_.relationshipTypeNames.has(s)){e.next=9;break}throw new y.Z("knowledge-graph:layer-data-manager","The graph type of ".concat(s," could not be determined. Was this type set in the KG data model and inclusion definition?"));case 9:d=!0,p="MATCH ()-[n:".concat(s,"]->() ").concat(u?"WHERE id(n) IN $ids ":"","return ID(n), id(startNode(n)), id(endNode(n))"),r.forEach((function(e){p+=", n.".concat(e),i.push(e)}));case 10:return l=new Vt(u?{openCypherQuery:p,bindParameters:{ids:u}}:{openCypherQuery:p}),e.next=13,bt(_.knowledgeGraph,l);case 13:g=e.sent.resultRowsStream.getReader(),b=(0,a.Z)().mark((function e(){var t,n,r,o,u,l,p,y,f,m,v,b,w,k,x;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.read();case 2:if(u=e.sent,l=u.done,p=u.value,!l){e.next=7;break}return e.abrupt("return",1);case 7:for(y=[],f=0;f<p.length;f++){for(m=p[f],b=0,(w={properties:{}}).id=m[v=0],v++,b++,d&&(w.originId=m[v],v++,b++,w.destinationId=m[v],v++,b++,(0,Z.s1)(_.nodeConnectionsLookup,w.originId,(function(){return new Set})).add(w.id),(0,Z.s1)(_.nodeConnectionsLookup,w.destinationId,(function(){return new Set})).add(w.id));v<m.length;v++)w.properties[i[v-b]]=m[v];y.push(w)}k=h.writeToStore(y,tn,null===(t=_.geographicLookup.get(s))||void 0===t?void 0:t.name),_.sublayerCaches.has(s)||_.sublayerCaches.set(s,new Map),c&&!(null!==(n=_.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.has(s))&&null!==(r=_.inclusionModeDefinition)&&void 0!==r&&r.namedTypeDefinitions.set(s,{useAllData:!1,members:new Map}),c&&(null===(o=_.inclusionModeDefinition)||void 0===o||!o.namedTypeDefinitions.get(s).members)&&(_.inclusionModeDefinition.namedTypeDefinitions.get(s).members=new Map),x=_.sublayerCaches.get(s),k.forEach((function(e){var t,n;null!==x&&void 0!==x&&x.set(e.attributes[tn],e),c&&(null===(t=_.inclusionModeDefinition)||void 0===t||!t.namedTypeDefinitions.get(s).members.has(e.attributes[tn]))&&(null!==(n=_.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.get(s).members.set(e.attributes[tn],{id:e.attributes[tn]}),_.memberIdTypeLookup.set(e.attributes[tn],s))}));case 13:case"end":return e.stop()}}),e)}));case 15:return e.delegateYield(b(),"t0",16);case 16:if(!e.t0){e.next=18;break}return e.abrupt("break",20);case 18:e.next=15;break;case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t().then((function(){e(null)}))})),f.push(l),null===(t=_._processingCacheUpdatesLookup.get(s))||void 0===t||t.push(l);case 3:case"end":return e.stop()}}),e)})),g.s();case 7:if((b=g.n()).done){e.next=11;break}return e.delegateYield(w(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),g.e(e.t1);case 16:return e.prev=16,g.f(),e.finish(16);case 19:return e.next=21,Promise.all(f);case 21:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"removeFromLayer",value:function(e){var t,n=this,a=new Set,i=new Set(e.map((function(e){return e.id}))),o=(0,r.Z)(e);try{var s=function(){var e,r=t.value;a.add(r.typeName),n.memberIdTypeLookup.delete(r.id),null===(e=n.inclusionModeDefinition)||void 0===e||e.namedTypeDefinitions.forEach((function(e){var t;(null===(t=e.members)||void 0===t?void 0:t.has(r.id))&&e.members.delete(r.id)}))};for(o.s();!(t=o.n()).done;)s()}catch(u){o.e(u)}finally{o.f()}a.forEach((function(e){var t;null===(t=n.sublayerCaches.get(e))||void 0===t||t.forEach((function(t,r){var a;i.has(r)&&(null===(a=n.sublayerCaches.get(e))||void 0===a||a.delete(r))}))}))}},{key:"retrieveDataFromService",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n,r){var i,o,s,u,l,p,d,c,h,f,m,v,g,b,w,_,k,x,C,Z,L,D,R,S,N,j,F,O,P,A,z,Q,U,q,Y,H,B,J,V,W,K,$,X,ee,te,ne,re,ae,ie,oe;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=G.getInstance(),l=new Set,p=[],c="",h=[],f="relationship"===n.graphType,m=null===(i=this.inclusionModeDefinition)||void 0===i||null===(i=i.namedTypeDefinitions)||void 0===i||null===(i=i.get(n.objectType.name))||void 0===i?void 0:i.useAllData,v=n.parentCompositeLayer.sublayerIdsCache.get(n.objectType.name),g=!m&&v?Array.from(v).sort():null,null===(o=this.inclusionModeDefinition)||void 0===o||null===(o=o.namedTypeDefinitions)||void 0===o||null===(o=o.get(n.objectType.name))||void 0===o||!o.useAllData){e.next=8;break}(null===(s=this.inclusionModeDefinition)||void 0===s||null===(s=s.namedTypeDefinitions)||void 0===s||null===(s=s.get(n.objectType.name))||void 0===s?void 0:s.useAllData)&&null!=t.objectIds&&(g=t.objectIds),e.next=20;break;case 8:if(!(null!=t.objectIds&&g&&g.length>0)){e.next=13;break}b=t.objectIds,t.objectIds=g.filter((function(e){return b.includes(e)})),e.next=20;break;case 13:if(null==t.objectIds){e.next=17;break}g=t.objectIds,e.next=20;break;case 17:if(null===(w=this.inclusionModeDefinition)||void 0===w||!w.namedTypeDefinitions.has(n.objectType.name)||null!==(_=this.inclusionModeDefinition.namedTypeDefinitions.get(n.objectType.name))&&void 0!==_&&_.members&&!((null===(k=this.inclusionModeDefinition.namedTypeDefinitions.get(n.objectType.name))||void 0===k||null===(k=k.members)||void 0===k?void 0:k.size)<1)){e.next=19;break}return e.abrupt("return",(t.objectIds=[],[]));case 19:t.objectIds=g;case 20:if(null!=t.outFields&&((x=t.outFields).includes("*")?n.fields.forEach((function(e){l.add(e.name)})):x.forEach((function(e){e!==tn&&e!==n.geometryFieldName&&l.add(e)}))),null==t.geometry){e.next=46;break}if(D=t.geometry,S=n.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,N=null===S||void 0===S?void 0:S.spatialReference,j=null===S||void 0===S||null===(C=S.serviceCapabilities)||void 0===C?void 0:C.geometryCapabilities,F=null===j||void 0===j?void 0:j.geometryMaxBoundingRectangleSizeX,O=null===j||void 0===j?void 0:j.geometryMaxBoundingRectangleSizeY,null===D||void 0===D||null===(Z=D.extent)||void 0===Z||!Z.spatialReference||null!==(L=D.spatialReference)&&void 0!==L&&L.isWGS84){e.next=31;break}return e.next=28,(0,M.initializeProjection)(D.extent.spatialReference,I.Zn);case 28:R=(0,M.project)(D.extent,I.Zn),e.next=32;break;case 31:R=D.extent;case 32:if(!(F&&O&&N)){e.next=38;break}if(4326!==N.wkid&&(P=new en.Z({spatialReference:N,xmax:F,ymax:O}),A=(0,M.project)(P,I.Zn),F=A.xmax,O=A.ymax),!(R.xmax-R.xmin>F)){e.next=36;break}throw new y.Z("knowledge-graph:layer-data-manager","Extent x bounds should be within ".concat(F,"\xb0 latitude, limit exceeded"));case 36:if(!(R.ymax-R.ymin>O)){e.next=38;break}throw new y.Z("knowledge-graph:layer-data-manager","Extent y bounds should be within ".concat(O,"\xb0 longitude, limit exceeded"));case 38:if(null==t.where||"1=1"===t.where){e.next=43;break}return e.next=41,(0,T.E)(t.where.toUpperCase(),n.fieldsIndex);case 41:z=e.sent,n.fields.forEach((function(e){z.fieldNames.includes(e.name)&&l.add(e.name)}));case 43:c=f?"Match ()-[n:".concat(n.objectType.name,"]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(n.geometryFieldName,") return ID(n), id(startNode(r)), id(endNode(r))"):"Match (n:".concat(n.objectType.name,") WHERE esri.graph.ST_Intersects($param_filter_geom, n.").concat(n.geometryFieldName,") return ID(n)"),n.geometryFieldName&&l.add(n.geometryFieldName),l.forEach((function(e){c+=", n.".concat(e),p.push(e)})),d=new Vt({openCypherQuery:c,bindParameters:{param_filter_geom:new E.Z({rings:Wt(R)})}}),e.next=60;break;case 46:if(Q="",null==t.where||"1=1"===t.where){e.next=56;break}return e.next=50,(0,T.E)(t.where,n.fieldsIndex);case 50:U=e.sent,n.fields.forEach((function(e){U.fieldNames.includes(e.name)&&l.add(e.name)})),q=new Set(["column-reference","string","number","binary-expression"]),Y=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),H=!1,B=function e(t){if("column-reference"===t.type)return"n.".concat(t.column);if("string"===t.type)return"'".concat(t.value,"'");if("number"===t.type)return"".concat(t.value);if("binary-expression"===t.type&&q.has(t.left.type)&&q.has(t.right.type)&&Y.has(t.operator))return"".concat(e(t.left)," ").concat(t.operator," ").concat(e(t.right));if("binary-expression"===t.type&&"LIKE"===t.operator){var n="";if("function"===t.left.type&&"column-reference"===t.left.args.value[0].type)n+="lower(n.".concat(t.left.args.value[0].column,")");else{if("column-reference"!==t.left.type)return H=!0,"";n+="lower(n.".concat(t.left.column,")")}if(n+=" CONTAINS (","string"!==t.right.type)return H=!0,"";var r=t.right.value;return"%"===r.charAt(0)&&(r=r.slice(1)),"%"===r.charAt(r.length-1)&&(r=r.slice(0,-1)),n+="'".concat(r.toLowerCase(),"')")}return H=!0,""},Q=B(U.parseTree),H&&(Q="");case 56:J="",J=f?"Match ()-[n:".concat(n.objectType.name,"]->()"):"Match (n:".concat(n.objectType.name,")"),V=!1,g&&(V=!0,J+=" WHERE ID(n) IN $ids"),Q&&(J+=V?" AND":" WHERE",J+=" ".concat(Q)),J+=" return ID(n)",f&&(J+=", id(startNode(n)), id(endNode(n))"),t.returnGeometry&&n.geometryFieldName&&l.add(n.geometryFieldName),l.forEach((function(e){J+=", n.".concat(e),p.push(e)})),d=new Vt(g?{openCypherQuery:J,bindParameters:{ids:g}}:{openCypherQuery:J});case 60:return e.next=62,bt(n.parentCompositeLayer.dataManager.knowledgeGraph,d,r);case 62:W=e.sent.resultRowsStream.getReader();case 63:return e.next=65,W.read();case 65:if($=e.sent,X=$.done,ee=$.value,!X){e.next=70;break}return e.abrupt("break",75);case 70:for(te=[],ne=0;ne<ee.length;ne++){for(re=ee[ne],ie=0,(oe={properties:{}}).id=re[ae=0],ae++,ie++,f&&(oe.originId=re[ae],ae++,ie++,oe.destinationId=re[ae],ae++,ie++);ae<re.length;ae++)oe.properties[p[ae-ie]]=re[ae];te.push(oe)}h=h.concat(u.writeToStore(te,tn,null===(K=n.parentCompositeLayer.dataManager.geographicLookup.get(n.objectType.name))||void 0===K?void 0:K.name));case 73:e.next=63;break;case 75:return e.abrupt("return",h);case 76:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(C.Z);(0,d._)([(0,m.Cb)()],un.prototype,"knowledgeGraph",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"inclusionModeDefinition",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"entityTypeNames",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"relationshipTypeNames",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"geographicLookup",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"sublayerCaches",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"nodeConnectionsLookup",void 0),(0,d._)([(0,m.Cb)()],un.prototype,"memberIdTypeLookup",void 0),un=(0,d._)([(0,g.j)("esri.rest.knowledgeGraph.knowledgeGraphLayer.KnowledgeGraphLayerDataManager")],un);var ln=n(93433),pn=n(44055),dn=(n(94931),n(78451),n(98689),n(57823),n(32066),n(49018),n(34999),n(28189),n(9014)),cn=n(40464),yn=(n(70431),n(33960)),hn=n(76143),fn=n(63543),mn=(0,n(25610).v)(),vn=n(6693),gn=n(64390),bn=n(71684),wn=n(56811),_n=n(83040),kn=n(37270),xn=n(49818),Cn=n(81085),Zn=n(82485),Tn=n(27823),En=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r,a,i,s,l;if((0,o.Z)(this,n),(l=t.call(this,e)).capabilities=(0,fn.MS)(!1,!1),l.definitionExpression="",l.displayField="",l.elevationInfo=null,l.geometryType=null,l.geometryFieldName=null,l.graphType=null,l.hasM=!1,l.hasZ=!1,l.labelsVisible=null,l.labelingInfo=null,l.objectIdField=tn,l.objectType=null,l.parentCompositeLayer=null,l.popupTemplate=null,l.source={openPorts:function(){return l.load().then((function(){var e=new MessageChannel;return new Zn.Z(e.port1,{channel:e,client:{queryFeatures:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Xt.Z.fromJSON(e);return l.queryFeaturesJSON(n,t)}}}),[e.port2]}))}},l.type="knowledge-graph-sublayer","link-chart"===e.parentCompositeLayer.type)"relationship"===e.graphType?l.geometryType="polyline":l.geometryType="point",l.geometryFieldName=an;else if(null!==(r=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))&&void 0!==r&&r.geometryType&&"esriGeometryNull"!==(null===(a=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name))||void 0===a?void 0:a.geometryType)){var p,d,c,y,h=e.parentCompositeLayer.dataManager.geographicLookup.get(e.objectType.name);l.geometryFieldName=null!==(p=null===h||void 0===h?void 0:h.name)&&void 0!==p?p:null,l.geometryType=null!==h&&void 0!==h&&h.geometryType?Tn.M.fromJSON(h.geometryType):null;var f=null===h||void 0===h?void 0:h.name,m=f?null===(d=e.objectType.properties)||void 0===d?void 0:d[f]:null;m?(l.hasM=null!==(c=m.hasM)&&void 0!==c&&c,l.hasZ=null!==(y=m.hasZ)&&void 0!==y&&y):(l.hasM=!1,l.hasZ=!1)}else l.geometryType=null;return null!==(i=e.objectType.properties)&&void 0!==i&&i.forEach((function(e){var t=e.fieldType;"esriFieldTypeOID"===t&&(t="esriFieldTypeInteger"),l.fields.push(_n.Z.fromJSON({name:e.name,type:t,alias:e.alias,defaultValue:null,editable:e.editable,nullable:e.nullable}))})),l.fields.push(_n.Z.fromJSON({name:l.objectIdField,type:"esriFieldTypeString",alias:l.objectIdField,editable:!1})),l._set("fields",(0,ln.Z)(l.fields)),null!==(s=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel)&&void 0!==s&&s.spatialReference&&(l.spatialReference=e.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference),"link-chart"===e.parentCompositeLayer.type?"relationship"===e.graphType?l.renderer=(0,dn.i)((0,fn.bU)(Tn.M.toJSON("polyline")).renderer):l.renderer=(0,dn.i)((0,fn.bU)(Tn.M.toJSON("point")).renderer):l.renderer=(0,dn.i)((0,fn.bU)(Tn.M.toJSON(l.geometryType)).renderer),(0,u.Z)(l)}return(0,s.Z)(n,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(e){(0,kn.YN)(e,this.fieldsIndex),this._set("renderer",e)}},{key:"createPopupTemplate",value:function(e){return(0,Cn.eZ)(this,e)}},{key:"createQuery",value:function(){return new Xt.Z({where:"1=1",outFields:["*"]})}},{key:"getField",value:function(e){for(var t=0;t<this.fields.length;t++)if(this.fields[t].name===e)return this.fields[t];throw new Error("Field not found")}},{key:"getFieldDomain",value:function(e,t){return null}},{key:"queryFeatures",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return r=e.sent,i=r.resolvedQuery,o=r.queryEngine,e.t0=xn.Z,e.next=8,o.executeQuery(i.toJSON(),null===n||void 0===n?void 0:n.signal);case 8:return e.t1=e.sent,s=e.t0.fromJSON.call(e.t0,e.t1),e.abrupt("return",(s.features.forEach((function(e){e.sourceLayer=u})),s));case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"queryFeaturesJSON",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return r=e.sent,i=r.resolvedQuery,o=r.queryEngine,e.next=7,o.executeQuery(i.toJSON(),null===n||void 0===n?void 0:n.signal);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"queryFeatureCount",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._setupQueryObjects(t);case 2:return r=e.sent,i=r.resolvedQuery,o=r.queryEngine,e.abrupt("return",o.executeQueryForCount(i.toJSON(),null===n||void 0===n?void 0:n.signal));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"queryExtent",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,r,i,o,s,u,l,p,d,c,y,h=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=h.length>0&&void 0!==h[0]?h[0]:{},s=h.length>1?h[1]:void 0,u=(0,R.Z)((0,R.Z)({},o),{},{returnGeometry:!0}),e.next=5,this._setupQueryObjects(u);case 5:return l=e.sent,p=l.resolvedQuery,d=l.queryEngine,e.next=10,d.executeQueryForExtent(p.toJSON(),null===s||void 0===s?void 0:s.signal);case 10:return c=e.sent,e.abrupt("return",(y=null!=(null===(t=c.extent)||void 0===t?void 0:t.xmin)&&null!=(null===(n=c.extent)||void 0===n?void 0:n.xmax)&&null!=(null===(r=c.extent)||void 0===r?void 0:r.ymin)&&null!=(null===(i=c.extent)||void 0===i?void 0:i.ymax)?new en.Z(c.extent):new en.Z,{count:c.count,extent:y}));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"queryObjectIds",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Xt.Z.from(t),"link-chart"!==this.parentCompositeLayer.type||!this._cachedQueryEngine){e.next=5;break}i=this._cachedQueryEngine,e.next=9;break;case 5:return e.next=7,this.parentCompositeLayer.dataManager.getData(r,this,n);case 7:o=e.sent,i=this.loadQueryEngine(o);case 9:return e.abrupt("return",i.executeQueryForIds(r.toJSON(),null===n||void 0===n?void 0:n.signal));case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadQueryEngine",value:function(e){var t=new yn.Z({geometryType:Tn.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),n=new hn.q({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:Tn.M.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:t});return n.featureStore.addMany(e),n}},{key:"refreshCachedQueryEngine",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.parentCompositeLayer.dataManager.getData(new Xt.Z({where:"1=1",outFields:[tn]}),this);case 2:t=e.sent,this._cachedQueryEngine=this.loadQueryEngine(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_setupQueryObjects",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o,s,u;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Xt.Z.from(t),o=i.geometry,e.t0=o&&!(null!==(r=o.spatialReference)&&void 0!==r&&r.isWGS84),!e.t0){e.next=6;break}return e.next=5,(0,M.initializeProjection)(o.spatialReference,I.Zn);case 5:i.geometry=(0,M.project)(o instanceof E.Z||o instanceof he.Z?o:o.extent,I.Zn);case 6:if("link-chart"!==this.parentCompositeLayer.type||!this._cachedQueryEngine){e.next=10;break}s=this._cachedQueryEngine,e.next=14;break;case 10:return e.next=12,this.parentCompositeLayer.dataManager.getData(i,this,n);case 12:u=e.sent,s=this.loadQueryEngine(u);case 14:return e.abrupt("return",{resolvedQuery:i,queryEngine:s});case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}((0,gn.M)(function(e){var t=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,o.Z)(this,n),(e=t.apply(this,arguments)).fields=[],e.fieldsIndex=null,e}return(0,s.Z)(n)}(e);return(0,d._)([(0,m.Cb)(mn.fields)],t.prototype,"fields",void 0),(0,d._)([(0,m.Cb)(mn.fieldsIndex)],t.prototype,"fieldsIndex",void 0),t=(0,d._)([(0,g.j)("esri.layers.knowledgeGraphLayer.KnowledgeGraphSublayerBase")],t),t}((0,vn.h)((0,wn.M)((0,bn.Q)(w.Z))))));(0,d._)([(0,m.Cb)()],En.prototype,"capabilities",void 0),(0,d._)([(0,m.Cb)({readOnly:!0})],En.prototype,"defaultPopupTemplate",null),(0,d._)([(0,m.Cb)()],En.prototype,"definitionExpression",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"displayField",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"elevationInfo",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"geometryType",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"geometryFieldName",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"graphType",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"hasM",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"hasZ",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"labelsVisible",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"labelingInfo",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"objectIdField",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"objectType",void 0),(0,d._)([(0,m.Cb)()],En.prototype,"parentCompositeLayer",void 0),(0,d._)([(0,m.Cb)({type:pn.Z,json:{name:"popupInfo",write:!0}})],En.prototype,"popupTemplate",void 0),(0,d._)([(0,m.Cb)({types:cn.A,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],En.prototype,"renderer",null),(0,d._)([(0,m.Cb)()],En.prototype,"source",void 0),(0,d._)([(0,m.Cb)({json:{read:!1}})],En.prototype,"type",void 0);var Mn,In,Ln=En=(0,d._)([(0,g.j)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],En),Dn=null;function Gn(){return Mn||(Mn=n.e(662).then(n.bind(n,39672)).then((function(e){return e.l})).then((function(e){return(0,e.default)({locateFile:function(e){return(0,ie.V)("esri/libs/linkchartlayout/".concat(e))}})})).then((function(e){!function(e){Dn=e}(e)})),Mn)}function Rn(e,t,n,r,a,i){var o=n.length,s=a.length,u=Float64Array.BYTES_PER_ELEMENT,l=Uint32Array.BYTES_PER_ELEMENT,p=Uint8Array.BYTES_PER_ELEMENT,d=15+o*(p+2*u)+s*(2*l),c=Dn._malloc(d);try{var y=c+16-c%16,h=y+o*u,f=h+o*u,m=f+s*l,v=m+s*l,g=function(){return[Dn.HEAPF64.subarray(y>>3,(y>>3)+o),Dn.HEAPF64.subarray(h>>3,(h>>3)+o),Dn.HEAPU32.subarray(f>>2,(f>>2)+s),Dn.HEAPU32.subarray(m>>2,(m>>2)+s),Dn.HEAPU8.subarray(v,v+o)]},b=g(),w=(0,x.Z)(b,5),_=w[0],k=w[1],C=w[2],Z=w[3],T=w[4];_.set(n),k.set(r),C.set(a),Z.set(i),T.set(t);var E=e(o,v,y,h,s,f,m),M=g(),I=(0,x.Z)(M,5),L=I[0],D=I[1],G=I[2],R=I[3],S=I[4];return n.set(L),r.set(D),a.set(G),i.set(R),t.set(S),E}finally{Dn._free(c)}}!function(e){e[e.None=0]="None",e[e.IsMovable=1]="IsMovable",e[e.IsGeographic=2]="IsGeographic",e[e.IsRoot=4]="IsRoot"}(In||(In={}));var Sn,Nn,jn,Fn,On,Pn,An,zn;!function(e){e.getMinIdealEdgeLength=function(){return Dn.getMinIdealEdgeLength()},e.apply=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Rn((function(e,t,n,r,a,u,l){return Dn.applyForceDirectedLayout(e,t,n,r,a,u,l,i,o,s)}),e,t,n,r,a)}}(Sn||(Sn={})),function(e){e.apply=function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:-1;return Rn((function(e,t,n,r,a,u,l){return Dn.applyCommunityLayout(e,t,n,r,a,u,l,i,o,s)}),e,t,n,r,a)}}(Nn||(Nn={})),function(e){e.apply=function(e,t,n,r,a){return Rn(Dn.applySimpleLayout,e,t,n,r,a)}}(jn||(jn={})),function(e){e.apply=function(e,t,n,r,a){return Rn(Dn.applyHierarchicalLayout,e,t,n,r,a)}}(Fn||(Fn={})),function(e){e.apply=function(e,t,n,r,a){return Rn(Dn.applyRadialTreeLayout,e,t,n,r,a)}}(On||(On={})),function(e){e.apply=function(e,t,n,r,a){return Rn(Dn.applySmartTreeLayout,e,t,n,r,a)}}(Pn||(Pn={})),function(e){e[e.Undirected=0]="Undirected",e[e.Directed=1]="Directed",e[e.Reversed=2]="Reversed"}(An||(An={})),function(e){e[e.ByCC_Raw=0]="ByCC_Raw",e[e.ByCC_NormalizeGlobally=1]="ByCC_NormalizeGlobally",e[e.ByCC_NormalizeByCC=2]="ByCC_NormalizeByCC"}(zn||(zn={}));var Qn=function(e){(0,l.Z)(n,e);var t=(0,p.Z)(n);function n(e){var r;if((0,o.Z)(this,n),(r=t.call(this,e)).dataPreloadedInLocalCache=!1,r.defaultLinkChartConfig=null,r._currentLinkChartConfig={layoutMode:"RADIAL_TREE",xScaleFactor:1,yScaleFactor:1},r._graphTypeLookup=new Map,r.knowledgeGraph=null,r.layers=new c.Z,r.linkChartDiagramLookup=new Map,r.linkChartExtent=new en.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),r.linkChartGeohashLookup=new Map,r.memberEntityTypes=null,r.memberRelationshipTypes=null,r.sublayerIdsCache=new Map,r.tables=new c.Z,r.type="link-chart",r._originalInclusionList=e.inclusionModeDefinition,e.dataPreloadedInLocalCache&&!e.inclusionModeDefinition)throw new y.Z("knowledge-graph:linkchart-layer-constructor","If creating a link chart composite layer and configured that data is already loaded in the cache, you must specify an inclusion list so the Composite Layer knows what records belong to it");return(0,u.Z)(r)}return(0,s.Z)(n,[{key:"normalizeCtorArgs",value:function(e){return{url:e.url,title:e.title,dataPreloadedInLocalCache:e.dataPreloadedInLocalCache,defaultLinkChartConfig:e.defaultLinkChartConfig}}},{key:"_initializeLayerProperties",value:function(e){var t,n,r,a,i,o,s,u,l,p,d=this;if(!this.title&&this.url){var c=this.url.split("/");this.title=c[c.length-2]}var f=new Set,m=[],v=[];if(e.inclusionModeDefinition&&(!e.inclusionModeDefinition.namedTypeDefinitions||e.inclusionModeDefinition.namedTypeDefinitions.size<1))throw new y.Z("knowledge-graph:composite-layer-constructor","If an explicit inclusion definition is defined, at least one namedTypeDefinition must also be defined");null!==(t=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==t&&t.forEach((function(e){e.name&&d._graphTypeLookup.set(e.name,e)})),null!==(n=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==n&&n.forEach((function(e){e.name&&d._graphTypeLookup.set(e.name,e)})),null!==(r=e.inclusionModeDefinition)&&void 0!==r&&r.generateAllSublayers?(m=null!==(a=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==a?a:[],v=null!==(i=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==i?i:[]):null!==(o=e.inclusionModeDefinition)&&void 0!==o&&o.namedTypeDefinitions&&(null===(s=e.inclusionModeDefinition)||void 0===s?void 0:s.namedTypeDefinitions.size)>0?null===(u=e.inclusionModeDefinition)||void 0===u||u.namedTypeDefinitions.forEach((function(t,n){var r,a;if(!d._graphTypeLookup.get(n))return h.Z.getLogger(d).warn("A named type, ".concat(n,", was in the inclusion list that wasn't in the data model and will be removed")),void(null===(r=e.inclusionModeDefinition)||void 0===r||r.namedTypeDefinitions.delete(n));d._graphTypeLookup.get(n)instanceof K||"strictOrigin"in d._graphTypeLookup.get(n)?f.has(n)||(f.add(n),v.push(d._graphTypeLookup.get(n))):d._graphTypeLookup.get(n)instanceof V||"properties"in d._graphTypeLookup.get(n)?f.has(n)||(f.add(n),m.push(d._graphTypeLookup.get(n))):(h.Z.getLogger(d).warn("A named type, ".concat(n,", was in the inclusion list that wasn't properly modeled and will be removed")),null===(a=e.inclusionModeDefinition)||void 0===a||a.namedTypeDefinitions.delete(n))})):(m=null!==(l=e.knowledgeGraph.dataModel.entityTypes)&&void 0!==l?l:[],v=null!==(p=e.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==p?p:[]);var g=new un({knowledgeGraph:e.knowledgeGraph,inclusionModeDefinition:e.inclusionModeDefinition});this.knowledgeGraph=e.knowledgeGraph,this.memberEntityTypes=m,this.memberRelationshipTypes=v,this.dataManager=g}},{key:"load",value:function(e){var t=this;return this.addResolvingPromise(new Promise((function(n){(function(e){return _t.apply(this,arguments)})(t.url).then((function(r){var o,s,u,l;if(t._initializeLayerProperties({knowledgeGraph:r,inclusionModeDefinition:t._originalInclusionList}),null!==(o=t.dataManager.inclusionModeDefinition)&&void 0!==o&&null!==(o=o.namedTypeDefinitions)&&void 0!==o&&o.size||(t.dataManager.inclusionModeDefinition={generateAllSublayers:!1,namedTypeDefinitions:new Map},null!==(s=t.dataManager.knowledgeGraph.dataModel.entityTypes)&&void 0!==s&&s.forEach((function(e){var n;e.name&&(null===(n=t.dataManager.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.set(e.name,{useAllData:!0}))})),null!==(u=t.dataManager.knowledgeGraph.dataModel.relationshipTypes)&&void 0!==u&&u.forEach((function(e){var n;e.name&&(null===(n=t.dataManager.inclusionModeDefinition)||void 0===n||n.namedTypeDefinitions.set(e.name,{useAllData:!0}))}))),t.dataPreloadedInLocalCache)t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1),null===(l=t.dataManager.inclusionModeDefinition)||void 0===l||l.namedTypeDefinitions.forEach((function(e){var n;e.useAllData=!1,null!==(n=e.members)&&void 0!==n&&n.forEach((function(e){var n;n=e.linkChartLocation instanceof k.Z?e.linkChartLocation:e.linkChartLocation?(0,_.GH)(e.linkChartLocation):null,t.linkChartDiagramLookup.set(e.id,n),n&&2===n.coords.length&&0===n.lengths.length?t.linkChartGeohashLookup.set(e.id,(0,b.fC)(n.coords[1],n.coords[0],on)):t.linkChartGeohashLookup.set(e.id,"")})),t.addResolvingPromise(t._initializeDiagram().then((0,i.Z)((0,a.Z)().mark((function e(){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.layers.forEach(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.tables.forEach(function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.refreshCachedQueryEngine();case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))))}));else{var p,d="GEOGRAPHIC"===(null===(p=t.defaultLinkChartConfig)||void 0===p?void 0:p.layoutMode);t.addResolvingPromise(t.dataManager.refreshCacheContent(void 0,!1,d,!0).then((0,i.Z)((0,a.Z)().mark((function n(){var r,i;return(0,a.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(0,f.k_)(e),r=[],i=[],t.loadLayerAssumingLocalCache(),t.dataManager.inclusionModeDefinition&&(t.dataManager.inclusionModeDefinition.generateAllSublayers=!1,t.dataManager.inclusionModeDefinition.namedTypeDefinitions.forEach((function(e){e.useAllData=!1}))),n.next=6,t._initializeDiagram();case 6:return t.layers.forEach((function(e){i.push(e.refreshCachedQueryEngine()),r.push(new Promise((function(t){e.on("layerview-create",(function(){t(null)}))})))})),t.tables.forEach((function(e){i.push(e.refreshCachedQueryEngine())})),n.next=10,Promise.all(i);case 10:case"end":return n.stop()}}),n)})))))}n(null)}))}))),Promise.resolve(this)}},{key:"addRecords",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t,n){var r,i,o=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.t0=(null===n||void 0===n?void 0:n.cascadeAddRelationshipEndNodes)&&this.dataManager.knowledgeGraph.dataModel,!e.t0){e.next=6;break}return e.next=5,Kt(t,this.dataManager.knowledgeGraph);case 5:r=e.sent;case 6:return i=t.concat(r).filter((function(e){var t;return!(null!==(t=o.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))})),e.next=9,this._handleNewRecords(i);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeRecords",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,i,o,s,u,l,p,d,c,y,h,f,m,v,g,b,w,_,k,x,C,Z,T,E,M,I,L,D=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(n=D.length>1&&void 0!==D[1]?D[1]:{cascadeRemoveRelationships:!0,recalculateLayout:!1}).cascadeRemoveRelationships,o=void 0===i||i,s=n.recalculateLayout,u=void 0!==s&&s,l=[],p=(0,r.Z)(t);try{for(p.s();!(d=p.n()).done;)h=d.value,!1===(null===(c=this.dataManager.inclusionModeDefinition)||void 0===c||null===(c=c.namedTypeDefinitions)||void 0===c||null===(c=c.get(h.typeName))||void 0===c?void 0:c.useAllData)&&(null===(y=this.dataManager.inclusionModeDefinition)||void 0===y||null===(y=y.namedTypeDefinitions)||void 0===y||null===(y=y.get(h.typeName))||void 0===y||null===(y=y.members)||void 0===y?void 0:y.has(h.id))&&l.push(h)}catch(a){p.e(a)}finally{p.f()}if(o){f=new Set,m=[],v=(0,r.Z)(l);try{for(v.s();!(g=v.n()).done;)if(b=g.value,this.dataManager.nodeConnectionsLookup.has(b.id)){w=(0,r.Z)(this.dataManager.nodeConnectionsLookup.get(b.id));try{for(w.s();!(_=w.n()).done;)k=_.value,f.add(k)}catch(a){w.e(a)}finally{w.f()}}}catch(a){v.e(a)}finally{v.f()}x=(0,r.Z)(f);try{for(x.s();!(C=x.n()).done;)Z=C.value,this.dataManager.memberIdTypeLookup.has(Z)&&m.push({id:Z,typeName:this.dataManager.memberIdTypeLookup.get(Z)})}catch(a){x.e(a)}finally{x.f()}l=l.concat(m)}this.dataManager.removeFromLayer(l),T=(0,r.Z)(l);try{for(T.s();!(E=T.n()).done;)I=E.value,null!==(M=this.sublayerIdsCache.get(I.typeName))&&void 0!==M&&M.delete(I.id),this.linkChartDiagramLookup.delete(I.id)}catch(a){T.e(a)}finally{T.f()}if(e.t0=u,!e.t0){e.next=12;break}return e.next=12,this.calculateLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});case 12:return L=[],this.layers.forEach((function(e){L.push(e.refreshCachedQueryEngine())})),e.next=16,Promise.all(L);case 16:return this._refreshNamedTypes(),e.abrupt("return",l);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"expand",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,r,i=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.getConnectedRecordIds(t);case 2:return n=e.sent,r=n.filter((function(e){var t;return!(null!==(t=i.sublayerIdsCache.get(e.typeName))&&void 0!==t&&t.has(e.id))})),e.next=6,this._handleNewRecords(n);case 6:return e.abrupt("return",{records:r});case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadLayerAssumingLocalCache",value:function(){var e,t,n=this;this.memberRelationshipTypes.forEach((function(e){var t=new Ln({objectType:e,parentCompositeLayer:n,graphType:"relationship",title:e.name});t.geometryType?n.layers.push(t):n.tables.push(t),n.dataManager.sublayerCaches.has(e.name)||n.dataManager.sublayerCaches.set(e.name,new Map)})),this.memberEntityTypes.forEach((function(e){var t=new Ln({objectType:e,parentCompositeLayer:n,graphType:"entity",title:e.name});t.geometryType?n.layers.push(t):n.tables.push(t),n.dataManager.sublayerCaches.has(e.name)||n.dataManager.sublayerCaches.set(e.name,new Map)})),(null===(e=this.dataManager.inclusionModeDefinition)||void 0===e?void 0:e.namedTypeDefinitions)&&(null===(t=this.dataManager.inclusionModeDefinition)||void 0===t||t.namedTypeDefinitions.forEach((function(e,t){var r,a=function(e,t,n){return e.has(t)||e.set(t,n()),e.get(t)}(n.sublayerIdsCache,t,(function(){return new Set}));null===(r=e.members)||void 0===r||r.forEach((function(e){if(a.add(e.id),e.linkChartLocation)if(e.linkChartLocation instanceof k.Z)n.linkChartDiagramLookup.set(e.id,e.linkChartLocation),2===e.linkChartLocation.coords.length&&0===e.linkChartLocation.lengths.length?n.linkChartGeohashLookup.set(e.id,(0,b.fC)(e.linkChartLocation.coords[1],e.linkChartLocation.coords[0],on)):n.linkChartGeohashLookup.set(e.id,"");else{var t=(0,_.GH)(e.linkChartLocation);n.linkChartDiagramLookup.set(e.id,e.linkChartLocation?t:null),"x"in e.linkChartLocation&&"y"in e.linkChartLocation?n.linkChartGeohashLookup.set(e.id,(0,b.fC)(e.linkChartLocation.x,e.linkChartLocation.y,on)):n.linkChartGeohashLookup.set(e.id,"")}}))})))}},{key:"calculateLinkChartLayout",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,r,i,o,s,u,l,p,d,c,f,m,v,g,w,k,x,C,Z,T,E,M,I,L,D,G,R=this,S=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=S.length>0&&void 0!==S[0]?S[0]:"RADIAL_TREE",i=S.length>1?S[1]:void 0,o=[],s=[],this.dataManager.sublayerCaches.forEach((function(e,t){R.dataManager.entityTypeNames.has(t)?e.forEach((function(e){o.push({typeName:t,feature:e})})):R.dataManager.relationshipTypeNames.has(t)&&e.forEach((function(e){s.push({typeName:t,feature:e})}))})),this.linkChartDiagramLookup=new Map,u=new Map,l=new Map,p=new Map,d=new Map,c=new Uint8Array(o.length),f=new Float64Array(o.length),m=new Float64Array(o.length),v=new Uint32Array(s.length),g=new Uint32Array(s.length),w=[],"FORCE_DIRECTED",k=null!==(t=null===i||void 0===i?void 0:i.xScaleFactor)&&void 0!==t?t:1,x=null!==(n=null===i||void 0===i?void 0:i.yScaleFactor)&&void 0!==n?n:1,C=new en.Z({xmin:-1e-7,ymin:-1e-7,xmax:1e-7,ymax:1e-7}),"FORCE_DIRECTED",T=0,E=0,e.t0="GEOGRAPHIC"===r?"FORCE_DIRECTED":r,e.next="FORCE_DIRECTED"===e.t0?9:"COMMUNITY"===e.t0?11:"HIERARCHICAL"===e.t0?13:"RADIAL_TREE"===e.t0?15:"SMART_TREE"===e.t0?17:19;break;case 9:return Z=Sn.apply,e.abrupt("break",20);case 11:return Z=Nn.apply,e.abrupt("break",20);case 13:return Z=Fn.apply,e.abrupt("break",20);case 15:return Z=On.apply,e.abrupt("break",20);case 17:return Z=Pn.apply,e.abrupt("break",20);case 19:Z=jn.apply;case 20:return o.forEach((function(e){var t,n,a,o,s,u,l=e.typeName,p=e.feature;if(null!==i&&void 0!==i&&null!==(t=i.lockedNodeLocations)&&void 0!==t&&t.has(p.attributes[tn])){"GEOGRAPHIC"===r&&R.dataManager.geographicLookup.has(l)?c[T]=In.IsGeographic:c[T]=In.None;var y=i.lockedNodeLocations.get(p.attributes[tn]);f[T]=y.x,m[T]=y.y}else if("GEOGRAPHIC"===r&&R.dataManager.geographicLookup.has(l)){var h;c[T]=In.IsGeographic;var v=null,g=p.attributes[R.dataManager.geographicLookup.get(l).name];switch(null===(h=R.dataManager.geographicLookup.get(l))||void 0===h?void 0:h.geometryType){case"esriGeometryPoint":f[T]=null===g||void 0===g?void 0:g.x,m[T]=null===g||void 0===g?void 0:g.y;break;case"esriGeometryPolygon":null!=(null===(n=v=null===g||void 0===g?void 0:g.centroid)||void 0===n?void 0:n.x)&&null!=(null===(a=v)||void 0===a?void 0:a.y)?(f[T]=v.x,m[T]=v.y):c[T]=In.IsMovable;break;case"esriGeometryPolyline":case"esriGeometryMultipoint":null!=(null===(s=v=null===g||void 0===g||null===(o=g.extent)||void 0===o?void 0:o.center)||void 0===s?void 0:s.x)&&null!=(null===(u=v)||void 0===u?void 0:u.y)?(f[T]=v.x,m[T]=v.y):c[T]=In.IsMovable;break;default:c[T]=In.IsMovable}(null==f[T]||null==m[T]||Number.isNaN(f[T])||Number.isNaN(m[T]))&&(c[T]=In.IsMovable,f[T]=0,m[T]=0)}else c[T]=In.IsMovable,f[T]=0,m[T]=0;d.set(p.attributes[tn],T),w[T]={feature:p,typeName:l},T++})),M=!1,s.forEach((function(e){var t=d.get(e.feature.attributes[nn]),n=d.get(e.feature.attributes[rn]);void 0!==t&&void 0!==n?(v[E]=t,g[E]=n,E++):(M=!0,R.linkChartDiagramLookup.set(e.feature.attributes[nn],null),R.linkChartGeohashLookup.set(e.feature.attributes[nn],null))})),M&&h.Z.getLogger(this).warn("A relationship is a member of this layer that has either origin or destination entity nodes that are not members. The diagram geometry will be set to null"),e.next=26,Gn();case 26:if(Z(c,f,m,v,g)){e.next=28;break}throw new y.Z("knowledge-graph:layout-failed","Attempting to arrange the records in the specified layout failed");case 28:for(I=0;I<w.length;I++)c[I]===In.IsMovable&&(f[I]=f[I]*k,m[I]=m[I]*x),m[I]>84.9999&&(m[I]=84.9999),m[I]<-84.9999&&(m[I]=-84.9999),f[I]>179.9999&&(f[I]=179.9999),f[I]<-179.9999&&(f[I]=-179.9999),w[I].feature.attributes[an]=new ye.Z(f[I],m[I]),u.has(w[I].typeName)?null===(L=u.get(w[I].typeName))||void 0===L||L.set(w[I].feature.attributes[tn],w[I].feature):((D=new Map).set(w[I].feature.attributes[tn],w[I].feature),u.set(w[I].typeName,D)),p.set(w[I].feature.attributes[tn],w[I].feature),G=(0,_.GH)(w[I].feature.attributes[an]),this.linkChartDiagramLookup.set(w[I].feature.attributes[tn],w[I].feature.attributes[an]?G:null),this.linkChartGeohashLookup.set(w[I].feature.attributes[tn],(0,b.fC)(w[I].feature.attributes[an].y,w[I].feature.attributes[an].x,on)),w[I].feature.attributes[an].x<C.xmin&&(C.xmin=w[I].feature.attributes[an].x),w[I].feature.attributes[an].x>C.xmax&&(C.xmax=w[I].feature.attributes[an].x),w[I].feature.attributes[an].y<C.ymin&&(C.ymin=w[I].feature.attributes[an].y),w[I].feature.attributes[an].y>C.ymax&&(C.ymax=w[I].feature.attributes[an].y);return e.abrupt("return",(this.linkChartExtent.xmin=C.xmin,this.linkChartExtent.xmax=C.xmax,this.linkChartExtent.ymin=C.ymin,this.linkChartExtent.ymax=C.ymax,s.forEach((function(e){var t,n,r=null===(t=w[d.get(e.feature.attributes[nn])])||void 0===t?void 0:t.feature.attributes[an],a=null===(n=w[d.get(e.feature.attributes[rn])])||void 0===n?void 0:n.feature.attributes[an];if(r&&a){var i=new he.Z({paths:[[r.x,r.y],[a.x,a.y]]});if(e.feature.attributes[an]=i,l.has(e.typeName)){var o=l.get(e.typeName);null===o||void 0===o||o.set(e.feature.attributes[tn],e.feature)}else{var s=new Map;s.set(e.feature.attributes[tn],e.feature),l.set(e.typeName,s)}p.set(e.feature.attributes[tn],e.feature);var u=(0,_.GH)(e.feature.attributes[an]);R.linkChartDiagramLookup.set(e.feature.attributes[tn],e.feature.attributes[an]?u:null),R.linkChartGeohashLookup.set(e.feature.attributes[tn],"")}})),this._currentLinkChartConfig={layoutMode:r,xScaleFactor:k,yScaleFactor:x},{nodes:u,links:l,idMap:p}));case 30:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"applyNewLinkChartLayout",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n,r,i=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"RADIAL_TREE",n=i.length>1?i[1]:void 0,r=[],e.next=5,this.calculateLinkChartLayout(t,n);case 5:return this.layers.forEach((function(e){r.push(e.refreshCachedQueryEngine())})),e.next=8,Promise.all(r);case 8:this._refreshNamedTypes();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCurrentNodeLocations",value:function(){var e,t=new Map;return null!==(e=this.dataManager.inclusionModeDefinition)&&void 0!==e&&null!==(e=e.namedTypeDefinitions)&&void 0!==e&&e.forEach((function(e){var n;null===e||void 0===e||null===(n=e.members)||void 0===n||n.forEach((function(e){var n,r=e.linkChartLocation,a=e.id;r&&(n="x"in r?{x:r.x,y:r.y}:{x:r.coords[0],y:r.coords[1]},t.set(a,new ye.Z({x:n.x,y:n.y})))}))})),t}},{key:"synchronizeInclusionListWithCache",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n;null!==(n=t.dataManager.inclusionModeDefinition)&&void 0!==n&&n.namedTypeDefinitions.forEach((function(e,n){if(e.useAllData=!1,e.members&&e.members.size>0){if(!t.dataManager.sublayerCaches.get(n))return;var r=new Set(Array.from(t.dataManager.sublayerCaches.get(n).keys()));Array.from(e.members.keys()).filter((function(e){return!r.has(e)})).forEach((function(t){var n;null===(n=e.members)||void 0===n||n.delete(t)}))}})),e()})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshLinkChartCache",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.dataManager.refreshCacheContent(t);case 2:return n=[],this.layers.forEach((function(e){n.push(e.refreshCachedQueryEngine())})),e.next=6,Promise.all(n);case 6:this._refreshNamedTypes();case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleNewRecords",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(t){var n,i,o,s,u,l,p,d,c,y;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],this.dataManager.addToLayer(t),i=(0,r.Z)(t);try{for(i.s();!(o=i.n()).done;)s=o.value,this.sublayerIdsCache.has(s.typeName)||(this.sublayerIdsCache.set(s.typeName,new Set),n.push(s.typeName)),this.sublayerIdsCache.get(s.typeName).add(s.id)}catch(a){i.e(a)}finally{i.f()}for(u=0,l=n;u<l.length;u++)p=l[u],this._graphTypeLookup.has(p)&&(d=this._graphTypeLookup.get(p),y=new Ln({objectType:d,parentCompositeLayer:this,graphType:c="endPoints"in d?"relationship":"entity",title:p}),"entity"===c?this.dataManager.entityTypeNames.add(p):this.dataManager.relationshipTypeNames.add(p),y.geometryType?this.layers.push(y):this.tables.push(y),this.dataManager.sublayerCaches.set(p,new Map));return e.next=7,this.dataManager.refreshCacheContent(t.map((function(e){return e.id})));case 7:return e.next=9,this.applyNewLinkChartLayout(this._currentLinkChartConfig.layoutMode,{xScaleFactor:this._currentLinkChartConfig.xScaleFactor,yScaleFactor:this._currentLinkChartConfig.xScaleFactor});case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_initializeDiagram",value:function(){var e=(0,i.Z)((0,a.Z)().mark((function e(){var t,n=this;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defaultLinkChartConfig){e.next=9;break}if(!this.defaultLinkChartConfig.doNotRecalculateLayout){e.next=5;break}null!==(t=this.dataManager.inclusionModeDefinition)&&void 0!==t&&null!==(t=t.namedTypeDefinitions)&&void 0!==t&&t.forEach((function(e){var t;null===e||void 0===e||null===(t=e.members)||void 0===t||t.forEach((function(e){var t,r=e.linkChartLocation,a=e.id;if(r){t="x"in r?{x:r.x,y:r.y}:{x:r.coords[0],y:r.coords[1]};var i=(0,_.GH)(t);n.linkChartDiagramLookup.set(a,i),n.linkChartGeohashLookup.set(a,(0,b.fC)(t.x,t.y,on)),n.linkChartExtent.xmin>t.x&&(n.linkChartExtent.xmin=t.x),n.linkChartExtent.xmax<t.x&&(n.linkChartExtent.xmax=t.x),n.linkChartExtent.ymin>t.y&&(n.linkChartExtent.ymin=t.y),n.linkChartExtent.ymax<t.y&&(n.linkChartExtent.ymax=t.y)}}))})),this.memberRelationshipTypes.forEach((function(e){var t;e.name&&(null===(t=n.dataManager.sublayerCaches.get(e.name))||void 0===t||t.forEach((function(e){var t=n.linkChartDiagramLookup.get(e.attributes[nn]),r=n.linkChartDiagramLookup.get(e.attributes[rn]);if(t&&r){var a=(0,_.GH)(new he.Z({paths:[[t.coords[0],t.coords[1]],[r.coords[0],r.coords[1]]]}));n.linkChartDiagramLookup.set(e.attributes[tn],a)}else n.linkChartDiagramLookup.set(e.attributes[tn],null);n.linkChartGeohashLookup.set(e.attributes[tn],"")})))})),e.next=7;break;case 5:return e.next=7,this.calculateLinkChartLayout(this.defaultLinkChartConfig.layoutMode,{xScaleFactor:this.defaultLinkChartConfig.xScaleFactor,yScaleFactor:this.defaultLinkChartConfig.yScaleFactor,lockedNodeLocations:this.getCurrentNodeLocations()});case 7:e.next=11;break;case 9:return e.next=11,this.calculateLinkChartLayout("RADIAL_TREE",{lockedNodeLocations:this.getCurrentNodeLocations()});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_refreshNamedTypes",value:function(){var e,t=(0,r.Z)(this.layers);try{for(t.s();!(e=t.n()).done;){e.value.emit("refresh",{dataChanged:!0})}}catch(i){t.e(i)}finally{t.f()}var n,a=(0,r.Z)(this.tables);try{for(a.s();!(n=a.n()).done;){n.value.emit("refresh",{dataChanged:!0})}}catch(i){a.e(i)}finally{a.f()}}}]),n}((0,vn.h)((0,wn.M)(w.Z)));(0,d._)([(0,m.Cb)()],Qn.prototype,"dataPreloadedInLocalCache",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"defaultLinkChartConfig",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"dataManager",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"knowledgeGraph",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"layers",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"linkChartDiagramLookup",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"linkChartExtent",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"linkChartGeohashLookup",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"memberEntityTypes",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"memberRelationshipTypes",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"sublayerIdsCache",void 0),(0,d._)([(0,m.Cb)()],Qn.prototype,"tables",void 0),(0,d._)([(0,m.Cb)({json:{read:!1}})],Qn.prototype,"type",void 0);var Un=Qn=(0,d._)([(0,g.j)("esri.layers.LinkChartLayer")],Qn)},63543:function(e,t,n){n.d(t,{Dm:function(){return c},Hq:function(){return y},MS:function(){return h},bU:function(){return l}});var r=n(4942),a=n(1413),i=n(93169),o=n(84652),s=n(60480),u=n(76115);function l(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?u.I4:"esriGeometryPolyline"===e?u.ET:u.lF}}}var p=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/,d=1;function c(e,t){if((0,i.Z)("esri-csp-restrictions"))return function(){return(0,a.Z)((0,r.Z)({},t,null),e)};try{var n="this.".concat(t," = null;");for(var o in e)n+="this".concat(p.test(o)?".".concat(o):'["'.concat(o,'"]')," = ").concat(JSON.stringify(e[o]),";");var s=new Function("\n      return class AttributesClass$".concat(d++," {\n        constructor() {\n          ").concat(n,";\n        }\n      }\n    "))();return function(){return new s}}catch(u){return function(){return(0,a.Z)((0,r.Z)({},t,null),e)}}}function y(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,o.d9)(e)}}]}function h(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}}}]);
//# sourceMappingURL=999.33087b44.chunk.js.map