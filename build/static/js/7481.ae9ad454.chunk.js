"use strict";(self.webpackChunkamit_kumar_rathi=self.webpackChunkamit_kumar_rathi||[]).push([[7481],{37481:function(e,t,i){i.r(t),i.d(t,{default:function(){return I}});var r=i(74165),n=i(15861),s=i(37762),a=i(15671),u=i(43144),o=i(10064),l=i(32718),h=i(65156),c=i(376),d=i(20994),f=i(77095),v=i(20311),y=i(86638),p=i(36876),_=i(76672),m=l.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),w={getAttribute:function(e,t){return e.readAttribute(t)}};function b(e,t){return k.apply(this,arguments)}function k(){return k=(0,n.Z)((0,r.Z)().mark((function e(t,i){var n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,_.E)(t,i);case 3:return(n=e.sent).isStandardized||(s=new o.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",n),m.error(s)),e.abrupt("return",(function(e){var t=e.readArcadeFeature();return n.testFeature(t,w)}));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",(m.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",t),function(e){return!0}));case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),k.apply(this,arguments)}var I=function(){function e(t){(0,a.Z)(this,e),this._geometryBounds=(0,h.Ue)(),this._idToVisibility=new Map,this._serviceInfo=t}return(0,u.Z)(e,[{key:"hash",get:function(){return this._hash}},{key:"check",value:function(e){return this._applyFilter(e)}},{key:"clear",value:function(){var e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}},{key:"invalidate",value:function(){var e=this;this._idToVisibility.forEach((function(t,i){e._idToVisibility.set(i,0)}))}},{key:"setKnownIds",value:function(e){var t,i=(0,s.Z)(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._idToVisibility.set(r,1)}}catch(n){i.e(n)}finally{i.f()}}},{key:"setTrue",value:function(e){var t=this,i=[],r=[],n=new Set(e);return this._idToVisibility.forEach((function(e,s){var a=!!(1&t._idToVisibility.get(s)),u=n.has(s);!a&&u?i.push(s):a&&!u&&r.push(s),t._idToVisibility.set(s,u?3:0)})),{show:i,hide:r}}},{key:"createQuery",value:function(){var e=this.geometry,t=this.spatialRel,i=this.where,r=this.timeExtent,n=this.objectIds;return y.Z.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:n})}},{key:"update",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t,i){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._hash=JSON.stringify(t),e.next=3,(0,d.j6)(t,null,i);case 3:return n=e.sent,e.next=6,Promise.all([this._setGeometryFilter(n),this._setIdFilter(n),this._setAttributeFilter(n),this._setTimeFilter(n)]);case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_setAttributeFilter",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t&&t.where){e.next=2;break}return e.abrupt("return",(this._clause=null,void(this.where=null)));case 2:return e.next=4,b(t.where,this._serviceInfo.fieldsIndex);case 4:this._clause=e.sent,this.where=t.where;case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setIdFilter",value:function(e){this._idsToShow=(null===e||void 0===e?void 0:e.objectIds)&&new Set(e.objectIds),this._idsToHide=(null===e||void 0===e?void 0:e.hiddenIds)&&new Set(e.hiddenIds),this.objectIds=null===e||void 0===e?void 0:e.objectIds}},{key:"_setGeometryFilter",value:function(){var e=(0,n.Z)((0,r.Z)().mark((function e(t){var i,n,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==t&&void 0!==t&&t.geometry){e.next=2;break}return e.abrupt("return",(this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null)));case 2:return i=t.geometry,n=t.spatialRel||"esriSpatialRelIntersects",e.next=6,(0,f.cW)(n,i,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);case 6:s=e.sent,(0,c.$P)(this._geometryBounds,i),this._spatialQueryOperator=s,this.geometry=i,this.spatialRel=n;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_setTimeFilter",value:function(e){if(this.timeExtent=this._timeOperator=null,null!==e&&void 0!==e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,v.y)(this._serviceInfo.timeInfo,e.timeExtent,p.k);else{var t=new o.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);l.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(t)}}},{key:"_applyFilter",value:function(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}},{key:"_filterByExpression",value:function(e){return!this.where||this._clause(e)}},{key:"_filterById",value:function(e){var t,i;return(!(null!==(t=this._idsToHide)&&void 0!==t&&t.size)||!this._idsToHide.has(e.getObjectId()))&&(!(null!==(i=this._idsToShow)&&void 0!==i&&i.size)||this._idsToShow.has(e.getObjectId()))}},{key:"_filterByGeometry",value:function(e){if(!this.geometry)return!0;var t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}},{key:"_filterByTime",value:function(e){return null==this._timeOperator||this._timeOperator(e)}},{key:"_resetAllHiddenIds",value:function(){var e=this,t=[];return this._idToVisibility.forEach((function(i,r){1&i||(e._idToVisibility.set(r,1),t.push(r))})),t}}]),e}()}}]);
//# sourceMappingURL=7481.ae9ad454.chunk.js.map