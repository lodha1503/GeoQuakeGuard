"use strict";(self.webpackChunkamit_kumar_rathi=self.webpackChunkamit_kumar_rathi||[]).push([[3803],{43244:function(t,e,i){i.d(e,{Z:function(){return o}});var n=i(37762),a=i(15671),r=i(43144),o=function(){function t(e){(0,a.Z)(this,t),this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}return(0,r.Z)(t,[{key:"entries",get:function(){return this._buffer}},{key:"enqueue",value:function(t){if(this.size===this.maxSize){var e=this._buffer[this._start];return this._buffer[this._start]=t,this._start=(this._start+1)%this.maxSize,e}return this._buffer[(this._start+this.size++)%this.maxSize]=t,null}},{key:"dequeue",value:function(){if(0===this.size)return null;var t=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,t}},{key:"peek",value:function(){return 0===this.size?null:this._buffer[this._start]}},{key:"find",value:function(t){if(0===this.size)return null;var e,i=(0,n.Z)(this._buffer);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(null!=a&&t(a))return a}}catch(r){i.e(r)}finally{i.f()}return null}},{key:"clear",value:function(t){for(var e=this.dequeue();null!=e;)t&&t(e),e=this.dequeue()}}]),t}()},78084:function(t,e,i){i.d(e,{Z:function(){return d}});var n,a,r=i(15671),o=i(43144),s=i(93169),u=i(13005);(a=n||(n={}))[a.varint=0]="varint",a[a.fixed64=1]="fixed64",a[a.delimited=2]="delimited",a[a.fixed32=5]="fixed32",a[a.unknown=99]="unknown";var l=4294967296,h=new TextDecoder("utf-8"),c=(0,s.Z)("safari")||(0,s.Z)("ios")?6:(0,s.Z)("ff")?12:32,d=function(){function t(e,i){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e?e.byteLength:0;(0,r.Z)(this,t),this._tag=0,this._dataType=n.unknown,this._init(e,i,a,o)}return(0,o.Z)(t,[{key:"_init",value:function(t,e,i,n){this._data=t,this._dataView=e,this._pos=i,this._end=n}},{key:"asUnsafe",value:function(){return this}},{key:"clone",value:function(){return new t(this._data,this._dataView,this._pos,this._end)}},{key:"pos",value:function(){return this._pos}},{key:"move",value:function(t){this._pos=t}},{key:"nextTag",value:function(t){for(;;){if(this._pos===this._end)return!1;var e=this._decodeVarint();if(this._tag=e>>3,this._dataType=7&e,!t||t===this._tag)break;this.skip()}return!0}},{key:"next",value:function(){if(this._pos===this._end)return!1;var t=this._decodeVarint();return this._tag=t>>3,this._dataType=7&t,!0}},{key:"empty",value:function(){return this._pos>=this._end}},{key:"tag",value:function(){return this._tag}},{key:"getInt32",value:function(){return this._decodeVarint()}},{key:"getInt64",value:function(){return this._decodeVarint()}},{key:"getUInt32",value:function(){var t=4294967295;return t=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?t:(t=(t|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?t:(t=(t|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?t:void 0))))}},{key:"getUInt64",value:function(){return this._decodeVarint()}},{key:"getSInt32",value:function(){var t=this.getUInt32();if(void 0!==t)return t>>>1^-(1&t)|0}},{key:"getSInt64",value:function(){return this._decodeSVarint()}},{key:"getBool",value:function(){var t=0!==this._data[this._pos];return this._skip(1),t}},{key:"getEnum",value:function(){return this._decodeVarint()}},{key:"getFixed64",value:function(){var t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getUint32(e+4,!0)*l;return this._skip(8),i}},{key:"getSFixed64",value:function(){var t=this._dataView,e=this._pos,i=t.getUint32(e,!0)+t.getInt32(e+4,!0)*l;return this._skip(8),i}},{key:"getDouble",value:function(){var t=this._dataView.getFloat64(this._pos,!0);return this._skip(8),t}},{key:"getFixed32",value:function(){var t=this._dataView.getUint32(this._pos,!0);return this._skip(4),t}},{key:"getSFixed32",value:function(){var t=this._dataView.getInt32(this._pos,!0);return this._skip(4),t}},{key:"getFloat",value:function(){var t=this._dataView.getFloat32(this._pos,!0);return this._skip(4),t}},{key:"getString",value:function(){var t=this._getLength(),e=this._pos,i=this._toString(this._data,e,e+t);return this._skip(t),i}},{key:"getBytes",value:function(){var t=this._getLength(),e=this._pos,i=this._toBytes(this._data,e,e+t);return this._skip(t),i}},{key:"getLength",value:function(){return this._getLengthUnsafe()}},{key:"processMessageWithArgs",value:function(t,e,i,n){var a=this.getMessage(),r=t(a,e,i,n);return a.release(),r}},{key:"processMessage",value:function(t){var e=this.getMessage(),i=t(e);return e.release(),i}},{key:"getMessage",value:function(){var e=this._getLength(),i=t.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+e),this._skip(e),i}},{key:"release",value:function(){t.pool.release(this)}},{key:"dataType",value:function(){return this._dataType}},{key:"skip",value:function(){switch(this._dataType){case n.varint:this._decodeVarint();break;case n.fixed64:this._skip(8);break;case n.delimited:this._skip(this._getLength());break;case n.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}},{key:"skipLen",value:function(t){this._skip(t)}},{key:"_skip",value:function(t){if(this._pos+t>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=t}},{key:"_decodeVarint",value:function(){var t=this._data,e=this._pos,i=0,n=0;if(this._end-e>=10)do{if(i|=127&(n=t[e++]),0==(128&n))break;if(i|=(127&(n=t[e++]))<<7,0==(128&n))break;if(i|=(127&(n=t[e++]))<<14,0==(128&n))break;if(i|=(127&(n=t[e++]))<<21,0==(128&n))break;if(i+=268435456*(127&(n=t[e++])),0==(128&n))break;if(i+=34359738368*(127&(n=t[e++])),0==(128&n))break;if(i+=4398046511104*(127&(n=t[e++])),0==(128&n))break;if(i+=562949953421312*(127&(n=t[e++])),0==(128&n))break;if(i+=72057594037927940*(127&(n=t[e++])),0==(128&n))break;if(i+=0x8000000000000000*(127&(n=t[e++])),0==(128&n))break;throw new Error("Varint too long!")}while(0);else{for(var a=1;e!==this._end&&0!=(128&(n=t[e]));)++e,i+=(127&n)*a,a*=128;if(e===this._end)throw new Error("Varint overrun!");++e,i+=n*a}return this._pos=e,i}},{key:"_decodeSVarint",value:function(){var t,e=this._data,i=0,n=0,a=1&e[this._pos];if(i|=127&(n=e[this._pos++]),0==(128&n))return a?-(i+1)/2:i/2;if(i|=(127&(n=e[this._pos++]))<<7,0==(128&n))return a?-(i+1)/2:i/2;if(i|=(127&(n=e[this._pos++]))<<14,0==(128&n))return a?-(i+1)/2:i/2;if(i|=(127&(n=e[this._pos++]))<<21,0==(128&n))return a?-(i+1)/2:i/2;if(i+=268435456*(127&(n=e[this._pos++])),0==(128&n))return a?-(i+1)/2:i/2;if(i+=34359738368*(127&(n=e[this._pos++])),0==(128&n))return a?-(i+1)/2:i/2;if(i+=4398046511104*(127&(n=e[this._pos++])),0==(128&n))return a?-(i+1)/2:i/2;if(t=BigInt(i),n=e[this._pos++],t+=0x2000000000000n*BigInt(127&n),0==(128&n))return Number(a?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x100000000000000n*BigInt(127&n),0==(128&n))return Number(a?-(t+1n)/2n:t/2n);if(n=e[this._pos++],t+=0x8000000000000000n*BigInt(127&n),0==(128&n))return Number(a?-(t+1n)/2n:t/2n);throw new Error("Varint too long!")}},{key:"_getLength",value:function(){if(this._dataType!==n.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}},{key:"_getLengthUnsafe",value:function(){return this.getUInt32()}},{key:"_toString",value:function(t,e,i){if((i=Math.min(this._end,i))-e>c){var n=t.subarray(e,i);return h.decode(n)}for(var a="",r="",o=e;o<i;++o){var s=t[o];128&s?r+="%"+s.toString(16):(a+=decodeURIComponent(r)+String.fromCharCode(s),r="")}return r.length&&(a+=decodeURIComponent(r)),a}},{key:"_toBytes",value:function(t,e,i){return i=Math.min(this._end,i),new Uint8Array(t.buffer,e,i-e)}}]),t}();d.pool=new u.Z(d,void 0,(function(t){t._data=null,t._dataView=null}))},14916:function(t,e,i){function n(t,e,i,n){var a=null,r=1e3;"number"==typeof e?(r=e,n=i):(a=null!==e&&void 0!==e?e:null,r=i);var o,s=0,u=function(){s=0,t.apply(n,o)},l=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];a&&a.apply(n,e),o=e,r?s||(s=setTimeout(u,r)):u()};return l.remove=function(){s&&(clearTimeout(s),s=0)},l.forceUpdate=function(){s&&(clearTimeout(s),u())},l.hasPendingUpdates=function(){return!!s},l}i.d(e,{P:function(){return n}})},91958:function(t,e,i){i.d(e,{$7:function(){return m},$e:function(){return s},E0:function(){return d},N5:function(){return f},lW:function(){return u}});var n=i(74165),a=i(15861),r=(i(93169),i(10064)),o=i(35995);function s(t){var e=d(t);return null!=e?e.toDataURL():""}function u(t){return l.apply(this,arguments)}function l(){return l=(0,a.Z)((0,n.Z)().mark((function t(e){var i,a,o;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(i=d(e))){t.next=3;break}throw new r.Z("imageToArrayBuffer","Unsupported image type");case 3:return t.next=5,h(e);case 5:return a=t.sent,t.next=8,new Promise((function(t){return i.toBlob(t,a)}));case 8:if(o=t.sent){t.next=11;break}throw new r.Z("imageToArrayBuffer","Failed to encode image");case 11:return t.next=13,o.arrayBuffer();case 13:return t.t0=t.sent,t.t1=a,t.abrupt("return",{data:t.t0,type:t.t1});case 16:case"end":return t.stop()}}),t)}))),l.apply(this,arguments)}function h(t){return c.apply(this,arguments)}function c(){return c=(0,a.Z)((0,n.Z)().mark((function t(e){var i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e instanceof HTMLImageElement){t.next=2;break}return t.abrupt("return","image/png");case 2:if(i=e.src,!(0,o.HK)(i)){t.next=6;break}return a=(0,o.sJ)(i),t.abrupt("return","image/jpeg"===(null===a||void 0===a?void 0:a.mediaType)?a.mediaType:"image/png");case 6:return t.abrupt("return",/\.png$/i.test(i)?"image/png":/\.(jpg|jpeg)$/i.test(i)?"image/jpeg":"image/png");case 7:case"end":return t.stop()}}),t)}))),c.apply(this,arguments)}function d(t){if(t instanceof HTMLCanvasElement)return t;if(t instanceof HTMLVideoElement)return null;var e=document.createElement("canvas");e.width=t.width,e.height=t.height;var i=e.getContext("2d");return t instanceof HTMLImageElement?i.drawImage(t,0,0,t.width,t.height):t instanceof ImageData&&i.putImageData(t,0,0),e}function f(t){for(var e=[],i=new Uint8Array(t),n=0;n<i.length;n++)e.push(String.fromCharCode(i[n]));return"data:application/octet-stream;base64,"+btoa(e.join(""))}function m(t){if(t.byteLength<8)return!1;var e=new Uint8Array(t);return 137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]}},16285:function(t,e,i){i.d(e,{Z:function(){return f}});var n=i(37762),a=i(29439),r=i(15671),o=i(43144),s=i(16889),u=i(78915),l=i(26554),h=i(691),c=i(6388),d=i(31027),f=function(){function t(e){(0,r.Z)(this,t),this._resourceManager=e,this._lazyRasterizationCanvas=null}return(0,o.Z)(t,[{key:"dispose",value:function(){this._lazyRasterizationCanvas=null}},{key:"_rasterizationCanvas",get:function(){return null==this._lazyRasterizationCanvas&&(this._lazyRasterizationCanvas=document.createElement("canvas"),this._lazyRasterizationCanvas.getContext("2d",{willReadFrequently:!0})),this._lazyRasterizationCanvas}},{key:"rasterizeJSONResource",value:function(t,e,i){if("simple-fill"===t.type||"esriSFS"===t.type){var n=(0,l.Y)(this._rasterizationCanvas,t.style,e),r=(0,a.Z)(n,3),o=r[0];return{size:[r[1],r[2]],image:new Uint32Array(o.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:(0,s.fp)(Math.ceil(e))}}if("simple-line"===t.type||"esriSLS"===t.type||"line"===t.type&&t.dashTemplate){var d,f;if("simple-line"===t.type||"esriSLS"===t.type)switch(d=(0,u.U1)(t.style,t.cap),t.cap){case"butt":f="Butt";break;case"square":f="Square";break;default:f="Round"}else d=t.dashTemplate,f=t.cim.capStyle;var m=(0,l.m)(d,f),v=(0,a.Z)(m,3),_=v[0];return{size:[v[1],v[2]],image:new Uint32Array(_.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}var p,g=null,y=null,w=1;if("simple-marker"===t.type||"esriSMS"===t.type||"line-marker"===t.type?(p=u.B$.fromSimpleMarker(t),y=(0,c.Fp)(p)):t.cim&&"CIMHatchFill"===t.cim.type?(p=u.B$.fromCIMHatchFill(t.cim,e),g=new h.Z(p.frame.xmin,-p.frame.ymax,p.frame.xmax-p.frame.xmin,p.frame.ymax-p.frame.ymin),w=e):t.cim.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===t.cim.markerPlacement.type?(p=u.B$.fromCIMInsidePolygon(t.cim),g=new h.Z(p.frame.xmin,-p.frame.ymax,p.frame.xmax-p.frame.xmin,p.frame.ymax-p.frame.ymin)):(p=t.cim,t.avoidSDFRasterization||(y=(0,c.Fp)(p))),y&&!i){var b=(0,c.RL)(y),x=(0,a.Z)(b,3),k=x[0],M=x[1],C=x[2];return k?{size:[M,C],image:new Uint32Array(k.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:w}:null}var Z=u.B$.rasterize(this._rasterizationCanvas,p,g,this._resourceManager,!i),T=(0,a.Z)(Z,5),S=T[0],I=T[1],z=T[2],D=T[3],R=T[4];return S?{size:[I,z],image:new Uint32Array(S.buffer),sdf:!1,simplePattern:!1,anchorX:D,anchorY:R}:null}},{key:"rasterizeImageResource",value:function(t,e,i,r){this._rasterizationCanvas.width=t,this._rasterizationCanvas.height=e;var o=this._rasterizationCanvas.getContext("2d");i instanceof ImageData?o.putImageData(i,0,0):(i.setAttribute("width","".concat(t,"px")),i.setAttribute("height","".concat(e,"px")),o.drawImage(i,0,0,t,e));var s,u=o.getImageData(0,0,t,e),l=new Uint8Array(u.data);if(r){var h,c=(0,n.Z)(r);try{for(c.s();!(h=c.n()).done;){var f=h.value;if(f&&f.oldColor&&4===f.oldColor.length&&f.newColor&&4===f.newColor.length){var m=(0,a.Z)(f.oldColor,4),v=m[0],_=m[1],p=m[2],g=m[3],y=(0,a.Z)(f.newColor,4),w=y[0],b=y[1],x=y[2],k=y[3];if(v===w&&_===b&&p===x&&g===k)continue;for(var M=0;M<l.length;M+=4)v===l[M]&&_===l[M+1]&&p===l[M+2]&&g===l[M+3]&&(l[M]=w,l[M+1]=b,l[M+2]=x,l[M+3]=k)}}}catch(R){c.e(R)}finally{c.f()}}for(var C=0;C<l.length;C+=4)s=l[C+3]/255,l[C]=l[C]*s,l[C+1]=l[C+1]*s,l[C+2]=l[C+2]*s;var Z=l,T=t,S=e,I=512;if(T>=I||S>=I){var z=T/S;z>1?(T=I,S=Math.round(I/z)):(S=I,T=Math.round(I*z)),Z=new Uint8Array(4*T*S);var D=new Uint8ClampedArray(Z.buffer);(0,d.TT)(l,t,e,D,T,S,!1)}return{size:[T,S],image:new Uint32Array(Z.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}]),t}()},26554:function(t,e,i){i.d(e,{Y:function(){return u},m:function(){return l}});var n=i(37762),a=i(93433),r=i(46228),o=i(16889),s=function(t){return"vertical"===t||"horizontal"===t||"cross"===t||"esriSFSCross"===t||"esriSFSVertical"===t||"esriSFSHorizontal"===t};function u(t,e,i){var n=(0,o.fp)(Math.ceil(i)),a=s(e)?8*n:16*n,r=2*n;t.width=a,t.height=a;var u=t.getContext("2d");u.strokeStyle="#FFFFFF",u.lineWidth=n,u.beginPath(),"vertical"!==e&&"cross"!==e&&"esriSFSCross"!==e&&"esriSFSVertical"!==e||(u.moveTo(a/2,-r),u.lineTo(a/2,a+r)),"horizontal"!==e&&"cross"!==e&&"esriSFSCross"!==e&&"esriSFSHorizontal"!==e||(u.moveTo(-r,a/2),u.lineTo(a+r,a/2)),"forward-diagonal"!==e&&"diagonal-cross"!==e&&"esriSFSDiagonalCross"!==e&&"esriSFSForwardDiagonal"!==e||(u.moveTo(-r,-r),u.lineTo(a+r,a+r),u.moveTo(a-r,-r),u.lineTo(a+r,r),u.moveTo(-r,a-r),u.lineTo(r,a+r)),"backward-diagonal"!==e&&"diagonal-cross"!==e&&"esriSFSBackwardDiagonal"!==e&&"esriSFSDiagonalCross"!==e||(u.moveTo(a+r,-r),u.lineTo(-r,a+r),u.moveTo(r,-r),u.lineTo(-r,r),u.moveTo(a+r,a-r),u.lineTo(a-r,a+r)),u.stroke();for(var l,h=u.getImageData(0,0,t.width,t.height),c=new Uint8Array(h.data),d=0;d<c.length;d+=4)l=c[d+3]/255,c[d]=c[d]*l,c[d+1]=c[d+1]*l,c[d+2]=c[d+2]*l;return[c,t.width,t.height]}function l(t,e){var i="Butt"===e,o="Square"===e,s=!i&&!o;t.length%2==1&&(t=[].concat((0,a.Z)(t),(0,a.Z)(t)));var u,l=15.5,h=0,c=(0,n.Z)(t);try{for(c.s();!(u=c.n()).done;){h+=u.value}}catch(I){c.e(I)}finally{c.f()}var d,f=Math.round(h*l),m=new Float32Array(31*f),v=7.75,_=0,p=0,g=.5,y=!0,w=(0,n.Z)(t);try{for(w.s();!(d=w.n()).done;){var b=d.value;for(_=p,p+=b*l;g<=p;){for(var x=.5;x<31;){var k=(x-.5)*f+g-.5,M=s?(x-l)*(x-l):Math.abs(x-l);m[k]=y?i?Math.max(Math.max(_+v-g,M),Math.max(g-p+v,M)):M:s?Math.min((g-_)*(g-_)+M,(g-p)*(g-p)+M):o?Math.min(Math.max(g-_,M),Math.max(p-g,M)):Math.min(Math.max(g-_+v,M),Math.max(p+v-g,M)),x++}g++}y=!y}}catch(I){w.e(I)}finally{w.f()}for(var C=m.length,Z=new Uint8Array(4*C),T=0;T<C;++T){var S=(s?Math.sqrt(m[T]):m[T])/l;(0,r.I)(S,Z,4*T)}return[Z,f,31]}},70812:function(t,e,i){i.d(e,{Q:function(){return M}});var n=i(15671),a=i(43144),r=i(97326),o=i(60136),s=i(29388),u=i(27366),l=i(7138),h=(i(10064),i(93169)),c=(i(32718),i(14916)),d=i(49861),f=(i(25243),i(63780),i(69912)),m=i(37762),v=i(29439),_=i(93433),p=i(94109),g=i(16889),y=i(44333),w=function(){function t(e,i,a){(0,n.Z)(this,t),this._debugMap=new Map,this._width=e*a,this._height=i*a,this._pixelRatio=a;var r=Math.ceil(this._width/1),o=Math.ceil(this._height/1);this._cols=r,this._rows=o,this._cells=y.p.create(r*o)}return(0,a.Z)(t,[{key:"insertMetrics",value:function(t){var e=this._hasCollision(t);return 0===e&&this._markMetrics(t),e}},{key:"getCellId",value:function(t,e){return t+e*this._cols}},{key:"has",value:function(t){return this._cells.has(t)}},{key:"hasRange",value:function(t,e){return this._cells.hasRange(t,e)}},{key:"set",value:function(t){this._cells.set(t)}},{key:"setRange",value:function(t,e){this._cells.setRange(t,e)}},{key:"_collide",value:function(t,e,i,n){var a=t-i/2,r=e-n/2,o=a+i,s=r+n;if(o<0||s<0||a>this._width||r>this._height)return 1;for(var u=(0,g.uZ)(Math.floor(a/1),0,this._cols),l=(0,g.uZ)(Math.floor(r/1),0,this._rows),h=(0,g.uZ)(Math.ceil(o/1),0,this._cols),c=(0,g.uZ)(Math.ceil(s/1),0,this._rows),d=l;d<=c;d++)for(var f=u;f<=h;f++){var m=this.getCellId(f,d);if(this.has(m))return 2}return 0}},{key:"_mark",value:function(t,e,i,n,a){for(var r=t-i/2,o=e-n/2,s=r+i,u=o+n,l=(0,g.uZ)(Math.floor(r/1),0,this._cols),h=(0,g.uZ)(Math.floor(o/1),0,this._rows),c=(0,g.uZ)(Math.ceil(s/1),0,this._cols),d=(0,g.uZ)(Math.ceil(u/1),0,this._rows),f=h;f<=d;f++)for(var m=l;m<=c;m++){var v=this.getCellId(m,f);this._debugMap.set(v,a),this.set(v)}return!1}},{key:"_hasCollision",value:function(t){var e=t.id,i=0,n=0;t.save();do{var a=t.boundsCount;i+=a;for(var r=0;r<a;r++){var o=t.boundsComputedAnchorX(r),s=t.boundsComputedAnchorY(r),u=(t.boundsWidth(r)+2)*this._pixelRatio,l=(t.boundsHeight(r)+2)*this._pixelRatio;switch(this._collide(o,s,u,l)){case 2:return 2;case 1:n++}}}while(t.peekId()===e&&t.next());return t.restore(),i===n?1:0}},{key:"_markMetrics",value:function(t){var e=t.id;t.save();do{for(var i=t.boundsCount,n=0;n<i;n++){var a=t.boundsComputedAnchorX(n),r=t.boundsComputedAnchorY(n),o=(t.boundsWidth(n)+2)*this._pixelRatio,s=(t.boundsHeight(n)+2)*this._pixelRatio;this._mark(a,r,o,s,t.id)}}while(t.peekId()===e&&t.next());t.restore()}}]),t}(),b=255;function x(t,e){var i=[];t.forEachTile((function(t){return i.push(t)})),i.sort((function(t,e){return t.instanceId-e.instanceId})),i.forEach((function(t){null!=t.labelMetrics&&t.isReady&&e(t,t.labelMetrics.getCursor())}))}var k=function(){function t(){(0,n.Z)(this,t)}return(0,a.Z)(t,[{key:"run",value:function(t,e,i){for(var n=[],a=t.length-1;a>=0;a--){var r=t[a];r.labelingCollisionInfos&&n.push.apply(n,(0,_.Z)(r.labelingCollisionInfos))}this._transformMetrics(n),this._runCollision(n,e,i)}},{key:"_runCollision",value:function(t,e,i){var n,a=this,r=(0,v.Z)(e.state.size,2),o=r[0],s=r[1],u=new w(o,s,e.pixelRatio),l=(0,m.Z)(t);try{var h=function(){var t=n.value,e=t.tileRenderer,r=t.deconflictionEnabled,o=t.visible,s=e.featuresView.attributeView;r?o?(a._prepare(e),a._collideVisible(u,e,i),a._collideInvisible(u,e)):x(e,(function(t,e){for(;e.nextId();)s.setLabelMinZoom(e.id,b)})):x(e,(function(t,e){for(;e.nextId();)s.setLabelMinZoom(e.id,0),o&&u.insertMetrics(e)}))};for(l.s();!(n=l.n()).done;)h()}catch(c){l.e(c)}finally{l.f()}}},{key:"_isFiltered",value:function(t,e,i){var n=e.getFilterFlags(t),a=!i.hasFilter||!!(n&p.g3),r=null==i.featureEffect||i.featureEffect.excludedLabelsVisible||!!(n&p.kU);return!(a&&r)}},{key:"_prepare",value:function(t){var e=this,i=t.featuresView.attributeView,n=new Set;x(t,(function(a,r){for(;r.nextId();)n.has(r.id)||(n.add(r.id),e._isFiltered(r.id,i,t.layerView)?i.setLabelMinZoom(r.id,254):0!==i.getLabelMinZoom(r.id)?i.setLabelMinZoom(r.id,b):i.setLabelMinZoom(r.id,0))}))}},{key:"_collideVisible",value:function(t,e,i){var n=e.featuresView.attributeView,a=new Set;x(e,(function(e,r){for(;r.nextId();)if(!a.has(r.id))if(e.key.level===i){if(0===n.getLabelMinZoom(r.id))switch(t.insertMetrics(r)){case 1:break;case 2:n.setLabelMinZoom(r.id,254),a.add(r.id);break;case 0:n.setLabelMinZoom(r.id,0),a.add(r.id)}}else n.setLabelMinZoom(r.id,254)}))}},{key:"_collideInvisible",value:function(t,e){var i=e.featuresView.attributeView,n=new Set;x(e,(function(e,a){for(;a.nextId();)if(!n.has(a.id)&&i.getLabelMinZoom(a.id)===b)switch(t.insertMetrics(a)){case 1:break;case 2:i.setLabelMinZoom(a.id,b),n.add(a.id);break;case 0:i.setLabelMinZoom(a.id,0),n.add(a.id)}}))}},{key:"_transformMetrics",value:function(t){var e,i=(0,m.Z)(t);try{var n=function(){var t=e.value,i=t.tileRenderer,n=t.geometryType,a=t.vvEvaluators;x(i,(function(t,e){var r=i.featuresView.attributeView,o=t.transforms.labelMat2d;o[4]=Math.round(o[4]),o[5]=Math.round(o[5]);for(var s="polyline"===n;e.next();){var u=e.boundsCount,l=e.anchorX,h=e.anchorY,c=e.size,d=a[0];if(null!=d){var f=d(r.getVVSize(e.id));c=isNaN(f)||null==f||f===1/0?c:f}for(var m=e.directionX*(c/2),v=e.directionY*(c/2),_=0;_<u;_++){var p=l,g=e.anchorY;if(s){var y=p+e.boundsX(_)+m,w=g+e.boundsY(_)+v;y=o[0]*y+o[2]*w+o[4],w=o[1]*y+o[3]*w+o[5],e.setBoundsComputedAnchorX(_,Math.floor(y)),e.setBoundsComputedAnchorY(_,Math.floor(w))}else{p=o[0]*l+o[2]*h+o[4],g=o[1]*l+o[3]*h+o[5];var b=p+e.boundsX(_)+m,x=g+e.boundsY(_)+v;e.setBoundsComputedAnchorX(_,b),e.setBoundsComputedAnchorY(_,x)}}}}))};for(i.s();!(e=i.n()).done;)n()}catch(a){i.e(a)}finally{i.f()}}}]),t}(),M=function(t){(0,o.Z)(i,t);var e=(0,s.Z)(i);function i(t){var a;return(0,n.Z)(this,i),(a=e.call(this,t)).collisionEngine=new k,a.lastUpdateId=-1,a.updateRequested=!1,a.view=null,a._applyVisibilityPass=(0,c.P)((function(t){var e=a.view;if(e)try{var i=e.featuresTilingScheme.getClosestInfoForScale(t.state.scale).level;a.collisionEngine.run(e.allLayerViews.items,t,i)}catch(n){}}),32,(0,r.Z)(a)),a.addHandles(a._applyVisibilityPass),a}return(0,a.Z)(i,[{key:"updating",get:function(){return(0,h.Z)("esri-2d-log-updating")&&console.log("Updating LabelManager ".concat(this.updateRequested,":\n-> updateRequested: ").concat(this.updateRequested)),this.updateRequested}},{key:"update",value:function(t){this._applyVisibilityPass(t)}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"requestUpdate",value:function(){var t;this.updateRequested||(this.updateRequested=!0,null===(t=this.view)||void 0===t||t.requestUpdate())}},{key:"processUpdate",value:function(t){this.updateRequested&&(this.updateRequested=!1,this.update(t))}}]),i}(l.Z);(0,u._)([(0,d.Cb)()],M.prototype,"updateRequested",void 0),(0,u._)([(0,d.Cb)()],M.prototype,"updating",null),(0,u._)([(0,d.Cb)()],M.prototype,"view",void 0),M=(0,u._)([(0,f.j)("esri.views.2d.LabelManager")],M)},10106:function(t,e,i){var n,a,r;i.d(e,{Fr:function(){return r},_K:function(){return a},al:function(){return n}}),function(t){t[t.FILL=1]="FILL",t[t.LINE=2]="LINE",t[t.SYMBOL=3]="SYMBOL",t[t.CIRCLE=4]="CIRCLE"}(n||(n={})),function(t){t[t.BACKGROUND=0]="BACKGROUND",t[t.FILL=1]="FILL",t[t.OUTLINE=2]="OUTLINE",t[t.LINE=3]="LINE",t[t.ICON=4]="ICON",t[t.CIRCLE=5]="CIRCLE",t[t.TEXT=6]="TEXT",t[t.TILEINFO=7]="TILEINFO"}(a||(a={})),function(t){t[t.PAINTER_CHANGED=0]="PAINTER_CHANGED",t[t.LAYOUT_CHANGED=1]="LAYOUT_CHANGED",t[t.LAYER_CHANGED=2]="LAYER_CHANGED",t[t.LAYER_REMOVED=3]="LAYER_REMOVED",t[t.SPRITES_CHANGED=4]="SPRITES_CHANGED"}(r||(r={}))},34052:function(t,e,i){i.d(e,{w:function(){return r}});var n={background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n#ifdef ID\nif (gl_FragColor.a < 1.0 / 255.0) {\ndiscard;\n}\ngl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\n#ifdef ID\nv_id = u_id / 255.0;\n#endif\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}};var a=new(i(56648).B)((function(t){var e=n;return t.split("/").forEach((function(t){e&&(e=e[t])})),e}));function r(t){return a.resolveIncludes(t)}},39484:function(t,e,i){i.d(e,{Q:function(){return d},g:function(){return h}});var n=i(37762),a=i(15671),r=i(43144),o=i(93169),s=i(92026),u=i(70734),l=(0,o.Z)("esri-2d-log-allocations"),h=function(){function t(e,i){(0,a.Z)(this,t),this._array=e,this._pool=i}return(0,r.Z)(t,[{key:"array",get:function(){return this._array}},{key:"length",get:function(){return this._array.length}},{key:"expand",value:function(t){var e=this._pool.acquire(t);e.set(this._array),this._pool.release(this._array),this._array=e}},{key:"destroy",value:function(){this._pool.release(this._array)}},{key:"set",value:function(t,e){this._array.set(t._array,e)}},{key:"slice",value:function(){var e=this._pool.acquire(this._array.byteLength);return e.set(this._array),new t(e,this._pool)}}],[{key:"create",value:function(e,i){return new t(i.acquire(e),i)}}]),t}(),c=function(){function t(){(0,a.Z)(this,t),this._data=new ArrayBuffer(t.BYTE_LENGTH),this._freeList=new u.m({start:0,end:this._data.byteLength})}return(0,r.Z)(t,[{key:"buffer",get:function(){return this._data}},{key:"allocate",value:function(t){var e=this._freeList.firstFit(t);return null==e?null:new Uint32Array(this._data,e,t/Uint32Array.BYTES_PER_ELEMENT)}},{key:"free",value:function(t){this._freeList.free(t.byteOffset,t.byteLength)}}],[{key:"BYTE_LENGTH",get:function(){return 64e6}}]),t}(),d=function(){function t(){(0,a.Z)(this,t),this._bytesAllocated=0,this._pages=[],this._pagesByBuffer=new Map,this._addPage()}return(0,r.Z)(t,[{key:"destroy",value:function(){this._pages=[],this._pagesByBuffer=null}},{key:"_bytesTotal",get:function(){return this._pages.length*c.BYTE_LENGTH}},{key:"acquire",value:function(t){if(this._bytesAllocated+=t,l&&console.log("Allocating ".concat(t,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")")),t>c.BYTE_LENGTH)return new Uint32Array(t/Uint32Array.BYTES_PER_ELEMENT);var e,i=(0,n.Z)(this._pages);try{for(i.s();!(e=i.n()).done;){var a=e.value.allocate(t);if(null!=a)return a}}catch(o){i.e(o)}finally{i.f()}var r=this._addPage().allocate(t);return(0,s.O3)(r,"Expected to allocate page"),r}},{key:"release",value:function(t){this._bytesAllocated-=t.byteLength,l&&console.log("Freeing ".concat(t.byteLength,", (").concat(this._bytesAllocated," / ").concat(this._bytesTotal,")"));var e=this._pagesByBuffer.get(t.buffer);e&&e.free(t)}},{key:"_addPage",value:function(){var t=new c;return this._pages.push(t),this._pagesByBuffer.set(t.buffer,t),t}}]),t}()},13163:function(t,e,i){i.d(e,{Q:function(){return c}});var n=i(37762),a=i(15671),r=i(43144),o=i(43244),s=i(91505),u=i(93169),l=i(40235),h=(0,u.Z)("esri-2d-profiler"),c=function(){function t(e,i){var n=this;if((0,a.Z)(this,t),this._events=new s.Z,this._entries=new Map,this._timings=new o.Z(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,h){this._ext=(0,l.mO)(e.gl,{}),this._debugOutput=i;var r,u=e.gl;if(this.enableCommandLogging)for(r in u)if("function"==typeof u[r]){var c=u[r],d=r.includes("draw");u[r]=function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return n._events.emit("command",{container:n._currentContainer,pass:n._currentPass,brush:n._currentBrush,method:r,args:e,isDrawCommand:d}),n._currentSummary&&(n._currentSummary.commands++,d&&n._currentSummary.drawCommands++),c.apply(u,e)}}}}return(0,r.Z)(t,[{key:"enableCommandLogging",get:function(){return!("object"==typeof h&&h.disableCommands)}},{key:"recordContainerStart",value:function(t){h&&(this._currentContainer=t)}},{key:"recordContainerEnd",value:function(){h&&(this._currentContainer=null)}},{key:"recordPassStart",value:function(t){h&&(this._currentPass=t,this._initSummary())}},{key:"recordPassEnd",value:function(){h&&(this._currentPass=null,this._emitSummary())}},{key:"recordBrushStart",value:function(t){h&&(this._currentBrush=t)}},{key:"recordBrushEnd",value:function(){h&&(this._currentBrush=null)}},{key:"recordStart",value:function(t){if(h&&null!=this._ext){if(this._entries.has(t)){var e=this._entries.get(t),i=this._ext.resultAvailable(e.query),a=this._ext.disjoint();if(i&&!a){var r=this._ext.getResult(e.query)/1e6,o=0;if(null!=this._timings.enqueue(r)){var s,u=this._timings.entries,l=u.length,c=0,d=(0,n.Z)(u);try{for(d.s();!(s=d.n()).done;){c+=s.value}}catch(g){d.e(g)}finally{d.f()}o=c/l}var f=r.toFixed(2),m=o?o.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed("Frame report for ".concat(t,", ").concat(f," ms (").concat(m," last 10 avg)\n").concat(e.commandsLen," Commands (").concat(e.drawCommands," draw)")),console.log("RenderPass breakdown: "),console.table(e.summaries),console.log("Commands: ",e.commands),console.groupEnd()):console.log("Frame report for ".concat(t,", ").concat(f," ms (").concat(m," last 10 avg)")),this._debugOutput.innerHTML="".concat(f," (").concat(m,")")}var v,_=(0,n.Z)(e.handles);try{for(_.s();!(v=_.n()).done;){v.value.remove()}}catch(g){_.e(g)}finally{_.f()}this._ext.deleteQuery(e.query),this._entries.delete(t)}var p={name:t,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(p.handles.push(this._events.on("command",(function(t){p.commandsLen++,p.commands.push(t),t.isDrawCommand&&p.drawCommands++}))),p.handles.push(this._events.on("summary",(function(t){p.summaries.push(t)})))),this._ext.beginTimeElapsed(p.query),this._entries.set(t,p)}}},{key:"recordEnd",value:function(t){h&&null!=this._ext&&this._entries.has(t)&&this._ext.endTimeElapsed()}},{key:"_initSummary",value:function(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}},{key:"_emitSummary",value:function(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}}]),t}()},99267:function(t,e,i){i.d(e,{Z:function(){return ot}});var n=i(1413),a=i(74165),r=i(15861),o=i(15671),s=i(43144),u=i(42265),l=i(76200),h=i(75746),c=i(10064),d=i(82272),f=i(93169),m=i(32718),v=i(16889),_=i(66978),p=i(17842),g=i(35995),y=i(88396),w=i(15245),b=i(16285),x=i(94109),k=i(80613),M=i(37762),C=i(12233),Z=function(){function t(e,i){(0,o.Z)(this,t),this._width=0,this._height=0,this._free=[],this._width=e,this._height=i,this._free.push(new C.Z(0,0,e,i))}return(0,s.Z)(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(t,e){if(t>this._width||e>this._height)return new C.Z;for(var i=null,n=-1,a=0;a<this._free.length;++a){var r=this._free[a];t<=r.width&&e<=r.height&&(null===i||r.y<=i.y&&r.x<=i.x)&&(i=r,n=a)}return null===i?new C.Z:(this._free.splice(n,1),i.width<i.height?(i.width>t&&this._free.push(new C.Z(i.x+t,i.y,i.width-t,e)),i.height>e&&this._free.push(new C.Z(i.x,i.y+e,i.width,i.height-e))):(i.width>t&&this._free.push(new C.Z(i.x+t,i.y,i.width-t,i.height)),i.height>e&&this._free.push(new C.Z(i.x,i.y+e,t,i.height-e))),new C.Z(i.x,i.y,t,e))}},{key:"release",value:function(t){for(var e=0;e<this._free.length;++e){var i=this._free[e];if(i.y===t.y&&i.height===t.height&&i.x+i.width===t.x)i.width+=t.width;else if(i.x===t.x&&i.width===t.width&&i.y+i.height===t.y)i.height+=t.height;else if(t.y===i.y&&t.height===i.height&&t.x+t.width===i.x)i.x=t.x,i.width+=t.width;else{if(t.x!==i.x||t.width!==i.width||t.y+t.height!==i.y)continue;i.y=t.y,i.height+=t.height}this._free.splice(e,1),this.release(t)}this._free.push(t)}}]),t}(),T=i(8548),S=i(57808),I=i(52311),z=function(t){return Math.floor(t/256)};function D(t){var e,i=new Set,n=(0,M.Z)(t);try{for(n.s();!(e=n.n()).done;){var a=e.value;i.add(z(a))}}catch(r){n.e(r)}finally{n.f()}return i}function R(t,e,i){return t.has(e)||t.set(e,i().then((function(){t.delete(e)})).catch((function(i){t.delete(e),(0,_.H9)(i)}))),t.get(e)}var F=function(){function t(e,i,n){(0,o.Z)(this,t),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=e,this.height=i,this._glyphSource=n,this._binPack=new Z(e-4,i-4),this._glyphData.push(new Uint8Array(e*i)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}return(0,s.Z)(t,[{key:"dispose",value:function(){this._binPack=null;var t,e=(0,M.Z)(this._textures);try{for(e.s();!(t=e.n()).done;){var i=t.value;i&&i.dispose()}}catch(n){e.e(n)}finally{e.f()}this._textures.length=0,this._glyphData.length=0}},{key:"_initDecorationGlyphs",value:function(){for(var t=[117,149,181,207,207,181,149,117],e=[],i=[],n=0;n<t.length;n++)for(var a=t[n],r=0;r<11;r++){var o=n>=3&&n<5&&r>=3&&r<8?255:0;e.push(a),i.push(o)}var s={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(e)},u={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(i)};this._recordGlyph(s),this._recordGlyph(u)}},{key:"getGlyphItems",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this._getGlyphCache(e),t.next=3,this._fetchRanges(e,i,n);case 3:return t.abrupt("return",i.map((function(t){return o._getMosaicItem(r,e,t)})));case 4:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"bind",value:function(t,e,i,n){var a=this._getTexture(t,i);a.setSamplingMode(e),this._dirties[i]&&(a.setData(this._glyphData[i]),this._dirties[i]=!1),t.bindTexture(a,n)}},{key:"preloadASCIIGlyphCache",value:function(t){var e=this,i=this._preloadCache[t];if(null!=i)return i;var n=this._glyphSource.preloadASCIIRange(t).then((function(){for(var i=e._getGlyphCache(t),n=0;n<256;n++)e._getMosaicItem(i,t,n)}));return this._preloadCache[t]=n,n}},{key:"_getGlyphCache",value:function(t){return this._glyphCache[t]||(this._glyphCache[t]={}),this._glyphCache[t]}},{key:"_getTexture",value:function(t,e){if(!this._textures[e]){var i=new I.X;i.pixelFormat=T.VI.ALPHA,i.wrapMode=T.e8.CLAMP_TO_EDGE,i.width=this.width,i.height=this.height,this._textures[e]=new S.x(t,i,new Uint8Array(this.width*this.height))}return this._textures[e]}},{key:"_invalidate",value:function(){this._dirties[this._currentPage]=!0}},{key:"_fetchRanges",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o,s=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=D(i),o=[],r.forEach((function(t){o.push(s._fetchRange(e,t,n))})),t.next=4,Promise.all(o);case 4:case"end":return t.stop()}}),t)})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_fetchRange",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(i>256)){t.next=2;break}return t.abrupt("return");case 2:return r=e+i,t.abrupt("return",R(this._rangePromises,r,(function(){return o._glyphSource.getRange(e,i,n)})));case 4:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_getMosaicItem",value:function(t,e,i){if(!t[i]){var n=this._glyphSource.getGlyph(e,i);if(null===n||void 0===n||!n.metrics)return function(t){return{rect:new C.Z(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:t,sdf:!0}}(i);var a=this._recordGlyph(n),r=this._currentPage,o=n.metrics;t[i]={rect:a,page:r,metrics:o,code:i,sdf:!0},this._invalidate()}return t[i]}},{key:"_recordGlyph",value:function(t){var e,i=t.metrics;if(0===i.width)e=new C.Z(0,0,0,0);else{var n=i.width+6,a=i.height+6;(e=this._binPack.allocate(n,a)).isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new Z(this.width-4,this.height-4),e=this._binPack.allocate(n,a));var r,o,s=this._glyphData[this._currentPage],u=t.bitmap;if(u)for(var l=0;l<a;l++){r=n*l,o=this.width*(e.y+l)+e.x;for(var h=0;h<n;h++)s[o+h]=u[r+h]}(0,f.Z)("esri-glyph-debug")&&this._showDebugPage(s)}return e}},{key:"_showDebugPage",value:function(t){var e=document.createElement("canvas"),i=e.getContext("2d"),n=new ImageData(this.width,this.height),a=n.data;e.width=this.width,e.height=this.height,e.style.border="1px solid black";for(var r=0;r<t.length;++r)a[4*r]=t[r],a[4*r+1]=0,a[4*r+2]=0,a[4*r+3]=255;i.putImageData(n,0,0),document.body.appendChild(e)}}]),t}(),A=i(78084),P=function(){function t(e){for((0,o.Z)(this,t),this._metrics=[],this._bitmaps=[];e.next();)if(1===e.tag()){for(var i=e.getMessage();i.next();)if(3===i.tag()){for(var n=i.getMessage(),a=void 0,r=void 0,s=void 0,u=void 0,l=void 0,h=void 0,c=void 0;n.next();)switch(n.tag()){case 1:a=n.getUInt32();break;case 2:r=n.getBytes();break;case 3:s=n.getUInt32();break;case 4:u=n.getUInt32();break;case 5:l=n.getSInt32();break;case 6:h=n.getSInt32();break;case 7:c=n.getUInt32();break;default:n.skip()}n.release(),a&&(this._metrics[a]={width:s,height:u,left:l,top:h,advance:c},this._bitmaps[a]=r)}else i.skip();i.release()}else e.skip()}return(0,s.Z)(t,[{key:"getMetrics",value:function(t){return this._metrics[t]}},{key:"getBitmap",value:function(t){return this._bitmaps[t]}}]),t}(),E=function(){function t(){(0,o.Z)(this,t),this._ranges=[]}return(0,s.Z)(t,[{key:"getRange",value:function(t){return this._ranges[t]}},{key:"addRange",value:function(t,e){this._ranges[t]=e}}]),t}(),L=function(){function t(e){(0,o.Z)(this,t),this._glyphInfo={},this._baseURL=e}return(0,s.Z)(t,[{key:"getRange",value:function(t,e,i){var a=this._getFontStack(t);if(a.getRange(e))return Promise.resolve();var r=256*e,o=r+255,s=this._baseURL.replace("{fontstack}",t).replace("{range}",r+"-"+o);return(0,l.Z)(s,(0,n.Z)({responseType:"array-buffer"},i)).then((function(t){a.addRange(e,new P(new A.Z(new Uint8Array(t.data),new DataView(t.data))))}))}},{key:"preloadASCIIRange",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e){var i,n,r,o,s,u,h;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this._getFontStack(e),n=0,r=255,o=this._baseURL.replace("{fontstack}",e).replace("{range}",n+"-"+r),t.next=6,(0,l.Z)(o,{responseType:"array-buffer"});case 6:for(s=t.sent,u=new P(new A.Z(new Uint8Array(s.data),new DataView(s.data))),h=n;h<=r;h++)i.getRange(h)||i.addRange(h,u);case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getGlyph",value:function(t,e){var i=this._getFontStack(t);if(i){var n=Math.floor(e/256),a=i.getRange(n);return a?{metrics:a.getMetrics(e),bitmap:a.getBitmap(e)}:void 0}}},{key:"_getFontStack",value:function(t){var e=this._glyphInfo[t];return e||(e=this._glyphInfo[t]=new E),e}}]),t}(),V=i(46228),B=1e20,U=function(){function t(e){(0,o.Z)(this,t),this._svg=null,this.size=e;var i=document.createElement("canvas");i.width=i.height=e,this._context=i.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(e*e),this._gridInner=new Float64Array(e*e),this._f=new Float64Array(e),this._d=new Float64Array(e),this._z=new Float64Array(e+1),this._v=new Int16Array(e)}return(0,s.Z)(t,[{key:"dispose",value:function(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg&&(document.body.removeChild(this._svg),this._svg=null)}},{key:"draw",value:function(t,e,i){var n=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:31;this._initSVG();var r=this.createSVGString(t,e);return new Promise((function(t,e){var o=new Image;o.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(r),o.onload=function(){o.onload=null,n._context.clearRect(0,0,n.size,n.size),n._context.drawImage(o,0,0,n.size,n.size);for(var e=n._context.getImageData(0,0,n.size,n.size),i=new Uint8Array(n.size*n.size*4),r=0;r<n.size*n.size;r++){var s=e.data[4*r+3]/255;n._gridOuter[r]=1===s?0:0===s?B:Math.pow(Math.max(0,.5-s),2),n._gridInner[r]=1===s?B:0===s?0:Math.pow(Math.max(0,s-.5),2)}n._edt(n._gridOuter,n.size,n.size),n._edt(n._gridInner,n.size,n.size);for(var u=0;u<n.size*n.size;u++){var l=n._gridOuter[u]-n._gridInner[u];(0,V.I)(.5-l/(2*a),i,4*u)}t(i)};var s=null===i||void 0===i?void 0:i.signal;s&&(0,_.fu)(s,(function(){return e((0,_.zE)())}))}))}},{key:"_initSVG",value:function(){if(!this._svg){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("style","position: absolute;"),t.setAttribute("width","0"),t.setAttribute("height","0"),t.setAttribute("aria-hidden","true"),t.setAttribute("role","presentation"),document.body.appendChild(t),this._svg=t}return this._svg}},{key:"createSVGString",value:function(t,e){var i=this._initSVG(),n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",t),i.appendChild(n);var a,r,o,s=n.getBBox(),u=s.width/s.height,l=this.size/2;if(u>1){a=l/s.width;var h=l*(1/u);r=this.size/4,o=l-h/2}else a=l/s.height,r=l-l*u/2,o=this.size/4;var c=-s.x*a+r,d=-s.y*a+o;n.setAttribute("style","transform: matrix(".concat(a,", 0, 0, ").concat(a,", ").concat(c,", ").concat(d,")")),n.setAttribute("stroke-width",""+.5/a);var f='<svg style="fill:'.concat(e?"red":"none","; stroke:").concat(e?"none":"red",'" height="').concat(this.size,'" width="').concat(this.size,'" xmlns="http://www.w3.org/2000/svg">').concat(i.innerHTML,"</svg>");return i.removeChild(n),f}},{key:"_edt",value:function(t,e,i){for(var n=this._f,a=this._d,r=this._v,o=this._z,s=0;s<e;s++){for(var u=0;u<i;u++)n[u]=t[u*e+s];this._edt1d(n,a,r,o,i);for(var l=0;l<i;l++)t[l*e+s]=a[l]}for(var h=0;h<i;h++){for(var c=0;c<e;c++)n[c]=t[h*e+c];this._edt1d(n,a,r,o,e);for(var d=0;d<e;d++)t[h*e+d]=Math.sqrt(a[d])}}},{key:"_edt1d",value:function(t,e,i,n,a){i[0]=0,n[0]=-B,n[1]=+B;for(var r=1,o=0;r<a;r++){for(var s=(t[r]+r*r-(t[i[o]]+i[o]*i[o]))/(2*r-2*i[o]);s<=n[o];)o--,s=(t[r]+r*r-(t[i[o]]+i[o]*i[o]))/(2*r-2*i[o]);i[++o]=r,n[o]=s,n[o+1]=+B}for(var u=0,l=0;u<a;u++){for(;n[l+1]<u;)l++;e[u]=(u-i[l])*(u-i[l])+t[i[l]]}}}]),t}(),N=i(29439),O=i(13200);function H(t){return t&&"static"===t.type}var G=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,o.Z)(this,t),this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,(e<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=i,n>0&&(this._maxItemSize=n),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new Z(this._pageWidth,this._pageHeight);var a=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(a*r)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}return(0,s.Z)(t,[{key:"getWidth",value:function(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[0]}},{key:"getHeight",value:function(t){return t>=this._mosaicPages.length?-1:this._mosaicPages[t].size[1]}},{key:"getPageTexture",value:function(t){return t<this._mosaicPages.length?this._mosaicPages[t].texture:null}},{key:"has",value:function(t){return this._mosaicRects.has(t)}},{key:"itemCount",get:function(){return this._mosaicRects.size}},{key:"getSpriteItem",value:function(t){return this._mosaicRects.get(t)}},{key:"addSpriteItem",value:function(t,e,i,n,a,r){var o,s,u,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(this._mosaicRects.has(t))return this._mosaicRects.get(t);if(H(i)){var h=this._allocateImage(e[0],e[1]),c=(0,N.Z)(h,3);o=c[0],s=c[1],u=c[2]}else{o=new C.Z(0,0,e[0],e[1]),s=this._mosaicPages.length;this._mosaicPages.push({mosaicsData:i,size:[e[0]+2*x.s4,e[1]+2*x.s4],dirty:!0,texture:void 0})}if(o.width<=0||o.height<=0)return null;var d={rect:o,width:e[0],height:e[1],sdf:a,simplePattern:r,pixelRatio:l,page:s};return this._mosaicRects.set(t,d),H(i)&&((0,f.Z)("esri-mosaic-debug")&&this._showDebugSprite(e,i.data),this._copy({rect:o,spriteSize:e,spriteData:i.data,page:s,pageSize:u,repeat:n,sdf:a})),d}},{key:"hasItemsToProcess",value:function(){return 0!==this._spriteCopyQueue.length}},{key:"processNextItem",value:function(){var t=this._spriteCopyQueue.pop();t&&this._copy(t)}},{key:"getSpriteItems",value:function(t){var e,i={},n=(0,M.Z)(t);try{for(n.s();!(e=n.n()).done;){var a=e.value;i[a]=this.getSpriteItem(a)}}catch(r){n.e(r)}finally{n.f()}return i}},{key:"getMosaicItemPosition",value:function(t){var e=this.getSpriteItem(t),i=null===e||void 0===e?void 0:e.rect;if(!i)return null;i.width=e.width,i.height=e.height;var n=e.width,a=e.height,r=x.s4,o=this._mosaicPages[e.page].size;return{size:[e.width,e.height],tl:[(i.x+r)/o[0],(i.y+r)/o[1]],br:[(i.x+r+n)/o[0],(i.y+r+a)/o[1]],page:e.page}}},{key:"bind",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this._mosaicPages[i],r=a.mosaicsData,o=a.texture;o||(o=function(t,e){var i=new I.X;return i.width=e[0],i.height=e[1],i.wrapMode=T.e8.CLAMP_TO_EDGE,new S.x(t,i,null)}(t,a.size),a.texture=o),o.setSamplingMode(e),H(r)?(t.bindTexture(o,n),a.dirty&&(o.setData(new Uint8Array(r.data.buffer)),o.generateMipmap(),(0,f.Z)("esri-mosaic-debug")&&this._showDebugPage(i))):(r.data.bindFrame(t,o,n),o.generateMipmap()),a.dirty=!1}},{key:"dispose",value:function(){this._binPack=null;var t,e=(0,M.Z)(this._mosaicPages);try{for(e.s();!(t=e.n()).done;){var i=t.value,n=i.texture;n&&n.dispose();var a=i.mosaicsData;H(a)||a.data.destroy()}}catch(r){e.e(r)}finally{e.f()}this._mosaicPages=null,this._mosaicRects.clear()}},{key:"_copy",value:function(e){if(!(e.page>=this._mosaicPages.length)){var i=this._mosaicPages[e.page],n=i.mosaicsData;if(!H(i.mosaicsData))throw new c.Z("mapview-invalid-resource","unsuitable data type!");var a=e.spriteData,r=n.data;r&&a||console.error("Source or target images are uninitialized!"),t._copyBits(a,e.spriteSize[0],0,0,r,e.pageSize[0],e.rect.x+x.s4,e.rect.y+x.s4,e.spriteSize[0],e.spriteSize[1],e.repeat),i.dirty=!0}}},{key:"_allocateImage",value:function(t,e){t+=2*x.s4,e+=2*x.s4;var i=Math.max(t,e);if(this._maxItemSize&&this._maxItemSize<i){var n=Math.pow(2,Math.ceil((0,O.k3)(t))),a=Math.pow(2,Math.ceil((0,O.k3)(e))),r=new C.Z(0,0,t,e);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(n*a)},size:[n,a],dirty:!0,texture:void 0}),[r,this._mosaicPages.length-1,[n,a]]}var o=this._binPack.allocate(t,e);if(o.width<=0){var s=this._mosaicPages[this._currentPage];return!s.dirty&&H(s.mosaicsData)&&(s.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new Z(this._pageWidth,this._pageHeight),this._allocateImage(t,e)}return[o,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_showDebugSprite",value:function(t,e){var i=(0,N.Z)(t,2),n=i[0],a=i[1],r=document.createElement("canvas");r.width=n,r.height=a,r.setAttribute("style","position: absolute; top: ".concat(4+204*q++,"px; right: 208px; width: 200px; height: 200px; border: 1px solid black;"));var o=r.getContext("2d"),s=new ImageData(n,a);s.data.set(new Uint8Array(e.buffer)),o.putImageData(s,0,0),document.body.appendChild(r)}},{key:"_showDebugPage",value:function(t){var e,i=this._mosaicPages[t],n=(0,N.Z)(i.size,2),a=n[0],r=n[1],o=i.mosaicsData;if(H(o)){var s="mosaicDebugPage".concat(t),u=null!==(e=document.getElementById(s))&&void 0!==e?e:document.createElement("canvas");u.id=s,u.width=a,u.height=r,u.setAttribute("style","position: absolute; top: ".concat(4+204*t,"px; right: 4px; width: 200px; height: 200px; border: 1px solid black;"));var l=u.getContext("2d"),h=new ImageData(a,r);h.data.set(new Uint8Array(o.data.buffer)),l.putImageData(h,0,0),document.body.appendChild(u)}else console.error("Could not show sprite mosaic debug for non-static resource")}}],[{key:"_copyBits",value:function(t,e,i,n,a,r,o,s,u,l,h){var c=n*e+i,d=s*r+o;if(h){d-=r;for(var f=-1;f<=l;c=((++f+l)%l+n)*e+i,d+=r)for(var m=-1;m<=u;m++)a[d+m]=t[c+(m+u)%u]}else for(var v=0;v<l;v++){for(var _=0;_<u;_++)a[d+_]=t[c+_];c+=e,d+=r}}}]),t}(),q=0;var W=i(84319),Y=i(25999),X=function(){function t(e,i,n,a){var r=this;(0,o.Z)(this,t),this._animation=e,this._frameData=null;this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=(0,Y.hY)(this._animation,n,a,(function(t){r._frameData=t,i.requestRender()}))}return(0,s.Z)(t,[{key:"destroy",value:function(){this._playHandle.remove()}},{key:"bindFrame",value:function(t,e,i){t.bindTexture(e,i);var n=this._frameData;if(null!=n){var a="width"in n?n.width:n.codedWidth,r="height"in n?n.height:n.codedHeight;e.updateData(0,x.s4,x.s4,a,r,n),this._frameData=null}}}]),t}(),j=i(55940);function Q(t){switch(t.type){case"esriSMS":return"".concat(t.style,".").concat(t.path);case"esriSLS":return"".concat(t.style,".").concat(t.cap);case"esriSFS":return"".concat(t.style);case"esriPFS":case"esriPMS":return t.imageData?"".concat(t.imageData).concat(t.width).concat(t.height):"".concat(t.url).concat(t.width).concat(t.height);default:return"mosaicHash"in t?t.mosaicHash:JSON.stringify(t)}}var $=i(57785),J=(0,w.c)(),K="arial-unicode-ms-regular",tt=m.Z.getLogger("esri.views.2d.engine.webgl.TextureManager");function et(t){var e=Math.round((0,p.F2)(t)*window.devicePixelRatio);return e*(e>=128?2:4)}function it(t,e){return Math.min(t,et(e))}function nt(t,e){if(!t||!e)return{width:0,height:0};var i=t/e;if(i>1){var n=et(t);return{width:n,height:n/i}}var a=et(e);return{width:a*i,height:a}}var at=function(t,e,i){return tt.error(new c.Z(t,e,i))},rt=function(){function t(e,i,n){(0,o.Z)(this,t),this.mosaicType=e,this.page=i,this.sdf=n}return(0,s.Z)(t,null,[{key:"fromMosaic",value:function(e,i){return new t(e,i.page,i.sdf)}}]),t}(),ot=function(){function t(e,i,n){(0,o.Z)(this,t),this._requestRender=e,this.resourceManager=i,this._allowNonPowerOfTwo=n,this._invalidFontsMap=new Map,this._sdfConverter=new U(x.qu),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new $.e({concurrency:10,process:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i){return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(0,_.k_)(i),t.prev=1,t.next=4,(0,l.Z)(e,{responseType:"image",signal:i});case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(1),(0,_.D_)(t.t0)){t.next=11;break}throw new c.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(e),t.t0);case 11:throw t.t0;case 12:case"end":return t.stop()}}),t,null,[[1,7]])})));return function(e,i){return t.apply(this,arguments)}}()}),this._spriteMosaic=new G(2048,2048,500),this._glyphSource=new L("".concat(u.Z.fontsUrl,"/{fontstack}/{range}.pbf")),this._glyphMosaic=new F(1024,1024,this._glyphSource),this._rasterizer=new b.Z(i)}return(0,s.Z)(t,[{key:"dispose",value:function(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null}},{key:"sprites",get:function(){return this._spriteMosaic}},{key:"glyphs",get:function(){return this._glyphMosaic}},{key:"rasterizeItem",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n,r){var o,s,u=this;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e){t.next=2;break}return t.abrupt("return",(at("mapview-null-resource","Unable to rasterize null resource"),null));case 2:t.t0=e.type,t.next="text"===t.t0||"esriTS"===t.t0?5:9;break;case 5:return t.next=7,this._rasterizeText(e,n,r);case 7:return o=t.sent,t.abrupt("return",(o.forEach((function(t){return u._setTextureBinding(k.Un.GLYPH,t)})),{glyphMosaicItems:o}));case 9:if(!(0,W.Ll)(e)){t.next=11;break}return t.abrupt("return",(at("mapview-invalid-type","MapView does not support symbol type: ".concat(e.type),e),null));case 11:return t.next=13,this._rasterizeSpriteSymbol(e,i,r);case 13:return s=t.sent,t.abrupt("return",((0,j.ok)(s)&&s&&this._setTextureBinding(k.Un.SPRITE,s),{spriteMosaicItem:s}));case 15:case"end":return t.stop()}}),t,this)})));return function(e,i,n,a){return t.apply(this,arguments)}}()},{key:"bindTextures",value:function(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(0!==i.textureBinding){var a=this._bindingInfos[i.textureBinding-1],r=a.page,o=n?T.cw.LINEAR_MIPMAP_LINEAR:T.cw.LINEAR;switch(a.mosaicType){case k.Un.SPRITE:var s=this.sprites.getWidth(r),u=this.sprites.getHeight(r),l=(0,y.s)(J,s,u);return this._spriteMosaic.bind(t,o,r,x.Kt),e.setUniform1i("u_texture",x.Kt),void e.setUniform2fv("u_mosaicSize",l);case k.Un.GLYPH:var h=this.glyphs.width,c=this.glyphs.height,d=(0,y.s)(J,h,c);return this._glyphMosaic.bind(t,o,r,x.wJ),e.setUniform1i("u_texture",x.wJ),void e.setUniform2fv("u_mosaicSize",d);default:tt.error("mapview-texture-manager","Cannot handle unknown type ".concat(a.mosaicType))}}}},{key:"_hashMosaic",value:function(t,e){return 1|t<<1|(e.sdf?1:0)<<2|e.page<<3}},{key:"_setTextureBinding",value:function(t,e){var i=this._hashMosaic(t,e);if(!this._hashToBindingIndex.has(i)){var n=rt.fromMosaic(t,e),a=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,a),this._bindingInfos.push(n)}e.textureBinding=this._hashToBindingIndex.get(i)}},{key:"_rasterizeText",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o,s,u,l,c,m;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("cim"in e?(r=(s=e).fontName,o=s.text):(u=e,r=(0,d.Yc)(u.font),o=u.text),l=this._invalidFontsMap.has(r),c=i||(0,W.Jq)((0,h.E)(o)[0]),t.prev=2,m=l?K:r,t.t0=(0,f.Z)("esri-2d-stabilize-glyphs"),!t.t0){t.next=8;break}return t.next=8,this._glyphMosaic.preloadASCIIGlyphCache(m);case 8:return t.next=10,this._glyphMosaic.getGlyphItems(m,c,n);case 10:return t.abrupt("return",t.sent);case 13:return t.prev=13,t.t1=t.catch(2),t.abrupt("return",(at("mapview-invalid-resource","Couldn't find font ".concat(r,". Falling back to Arial Unicode MS Regular")),this._invalidFontsMap.set(r,!0),this._glyphMosaic.getGlyphItems(K,c,n)));case 16:case"end":return t.stop()}}),t,this,[[2,13]])})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_rasterizeSpriteSymbol",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o,s,u,l,h,d,f;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,W.Gg)(e)){t.next=2;break}return t.abrupt("return");case 2:if(r=Q(e),!this._spriteMosaic.has(r)){t.next=5;break}return t.abrupt("return",this._spriteMosaic.getSpriteItem(r));case 5:if(!((0,W.sG)(e)||(0,W.HX)(e)&&!(0,W.yP)(e))){t.next=7;break}return t.abrupt("return",this._handleAsyncResource(r,e,n));case 7:if(o=x.FM,!(s=this._rasterizer.rasterizeJSONResource(e,o))){t.next=11;break}return u=s.size,l=s.image,h=s.sdf,d=s.simplePattern,f=s.rasterizationScale,t.abrupt("return",this._addItemToMosaic(r,u,{type:"static",data:l},(0,W.js)(e),h,d,f));case 11:return t.abrupt("return",new c.Z("TextureManager","unrecognized or null rasterized image"));case 12:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_handleAsyncResource",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._ongoingRasterizations.has(e)){t.next=2;break}return t.abrupt("return",this._ongoingRasterizations.get(e));case 2:return r=(0,W.sG)(i)?this._handleSVG(i,e,n):this._handleImage(i,e,n),this._ongoingRasterizations.set(e,r),t.prev=3,t.next=6,r;case 6:this._ongoingRasterizations.delete(e),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(3),this._ongoingRasterizations.delete(e);case 12:return t.abrupt("return",r);case 13:case"end":return t.stop()}}),t,this,[[3,9]])})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_handleSVG",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o,s;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=[x.qu,x.qu],o=!("cim"in e)||e.cim.asFill,t.next=4,this._sdfConverter.draw(e.path,o,n);case 4:return s=t.sent,t.abrupt("return",this._addItemToMosaic(i,r,{type:"static",data:new Uint32Array(s.buffer)},!1,!0,!0));case 6:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_handleGIFOrPNG",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,n){var r,o,s,u,l,h,d,f,m,_,p,g;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=(0,W.Gr)(e),t.next=3,this.resourceManager.fetchResource(r,n);case 3:if(null!=(o=this.resourceManager.getResource(r))){t.next=6;break}return t.abrupt("return",new c.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(r,".")));case 6:if(s=o.width,u=o.height,!(o instanceof HTMLImageElement)){t.next=11;break}return"esriPMS"===e.type&&(s=Math.round(it(o.width,(0,W.Ub)(e))),u=Math.round(o.height*(s/o.width))),l="cim"in e?e.cim.colorSubstitutions:void 0,h=this._rasterizer.rasterizeImageResource(s,u,o,l),d=h.size,f=h.sdf,m=h.image,t.abrupt("return",this._addItemToMosaic(i,d,{type:"static",data:m},(0,W.js)(e),f,!1));case 11:return this._allowNonPowerOfTwo||(s=(0,v.fp)(o.width+2*x.s4)-2*x.s4,u=(0,v.fp)(o.height+2*x.s4)-2*x.s4),s===o.width&&u===o.height||(o=(0,Y.SI)(o,s,u)),_=e.animatedSymbolProperties||{},p=e.objectId,g=new X(o,this._requestRender,_,p),t.abrupt("return",this._addItemToMosaic(i,[g.width,g.height],{type:"animated",data:g},(0,W.js)(e),!1,!1));case 14:case"end":return t.stop()}}),t,this)})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_handleImage",value:function(){var t=(0,r.Z)((0,a.Z)().mark((function t(e,i,r){var o,s,u,l,h,d,f,m,v,p,y,w,b,x,k,M,C,Z,T,S;return(0,a.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(0,W.DQ)(e)&&!(0,W.iw)(e)){t.next=2;break}return t.abrupt("return",this._handleGIFOrPNG(e,i,r));case 2:if(o=(0,W.Gr)(e),t.prev=3,!(null!=(u=this.resourceManager.getResource(o))&&u instanceof HTMLImageElement)){t.next=9;break}s=u,t.next=14;break;case 9:return t.next=11,this._imageRequestQueue.push(o,(0,n.Z)({},r));case 11:l=t.sent,h=l.data,s=h;case 14:if((0,g.zd)(o)&&("width"in e&&"height"in e?(d=nt(e.width,e.height),f=d.width,m=d.height,s.width=f,s.height=m):"cim"in e&&(p=e.cim,y=nt(null!==(v=p.width)&&void 0!==v?v:p.scaleX*p.size,p.size),w=y.width,b=y.height,s.width=w,s.height=b)),s.width&&s.height){t.next=17;break}return t.abrupt("return",null);case 17:return x=s.width,k=s.height,"esriPMS"===e.type&&(x=Math.round(it(s.width,(0,W.Ub)(e))),k=Math.round(s.height*(x/s.width))),M="cim"in e?e.cim.colorSubstitutions:void 0,C=this._rasterizer.rasterizeImageResource(x,k,s,M),Z=C.size,T=C.sdf,S=C.image,t.abrupt("return",this._addItemToMosaic(i,Z,{type:"static",data:S},(0,W.js)(e),T,!1));case 23:if(t.prev=23,t.t0=t.catch(3),(0,_.D_)(t.t0)){t.next=27;break}return t.abrupt("return",new c.Z("mapview-invalid-resource","Could not fetch requested resource at ".concat(o,". ").concat(t.t0.message)));case 27:case"end":return t.stop()}}),t,this,[[3,23]])})));return function(e,i,n){return t.apply(this,arguments)}}()},{key:"_addItemToMosaic",value:function(t,e,i,n,a,r,o){return this._spriteMosaic.addSpriteItem(t,e,i,n,a,r,o)}}]),t}()},25999:function(t,e,i){i.d(e,{SI:function(){return _},hY:function(){return v}});var n=i(15671),a=i(43144),r=i(42537),o=i(38499),s=i(91958),u=i(48202),l=i(93592);function h(t,e){var i=t.width,n=t.height,a=t.getFrame,r=t.frameDurations.slice(),s=r.pop();return r.push((0,o.HA)(s+e)),{frameCount:t.frameCount,duration:t.duration+e,frameDurations:r,getFrame:a,width:i,height:n}}var c,d,f=function(){function t(e,i,a,r){(0,n.Z)(this,t),this._animation=e,this._repeatType=a,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];for(var o=0;i>o;)o+=this.timeToFrame,this.nextFrame();var s=this._animation.getFrame(this._currentFrame);this._onFrameData(s)}return(0,a.Z)(t,[{key:"nextFrame",value:function(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case u.of.None:this._currentFrame-=this._direction;break;case u.of.Loop:this._currentFrame=0;break;case u.of.Oscillate:this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case u.of.None:this._currentFrame-=this._direction;break;case u.of.Loop:this._currentFrame=this._animation.frameDurations.length-1;break;case u.of.Oscillate:this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];var t=this._animation.getFrame(this._currentFrame);this._onFrameData(t)}}]),t}();function m(t,e,i,n){var a,r=e.repeatType;if(null==r&&(r=u.of.Loop),!0===e.reverseAnimation&&(t=function(t){var e=t.width,i=t.height,n=t.frameDurations.reverse();return{frameCount:t.frameCount,duration:t.duration,frameDurations:n,getFrame:function(e){var i=t.frameDurations.length-1-e;return t.getFrame(i)},width:e,height:i}}(t)),null!=e.duration&&(t=function(t,e){var i=t.width,n=t.height,a=t.getFrame,r=e/t.duration,s=t.frameDurations.map((function(t){return(0,o.HA)(t*r)}));return{frameCount:t.frameCount,duration:t.duration,frameDurations:s,getFrame:a,width:i,height:n}}(t,(0,o.HA)(1e3*e.duration))),null!=e.repeatDelay){var s=1e3*e.repeatDelay;r===u.of.Loop?t=h(t,(0,o.HA)(s)):r===u.of.Oscillate&&(t=function(t,e){var i=t.width,n=t.height,a=t.getFrame,r=t.frameDurations.slice(),s=r.shift();return r.unshift((0,o.HA)(s+e)),{frameCount:t.frameCount,duration:t.duration+e,frameDurations:r,getFrame:a,width:i,height:n}}(h(t,(0,o.HA)(s/2)),(0,o.HA)(s/2)))}if(null!=e.startTimeOffset)a=(0,o.HA)(1e3*e.startTimeOffset);else if(null!=e.randomizeStartTime){var c=(0,l.$)(i),d=null!=e.randomizeStartSeed?e.randomizeStartSeed:82749913,m=(0,l.f)(c,d);a=(0,o.HA)(m*function(t){return(0,o.HA)(t.frameDurations.reduce((function(t,e){return t+e}),0))}(t))}else a=(0,o.HA)(0);return new f(t,a,r,n)}function v(t,e,i,n){var a,o=null==e.playAnimation||e.playAnimation,s=m(t,e,i,n),u=s.timeToFrame;return function t(){a=o?setTimeout((function(){s.nextFrame(),u=s.timeToFrame,t()}),u):void 0}(),(0,r.kB)((function(){return o&&clearTimeout(a)}))}function _(t,e,i){var n=function(){var t,e;return null!==(t=c)&&void 0!==t||(c=document.createElement("canvas")),null!==(e=d)&&void 0!==e||(d=c.getContext("2d")),{canvas:c,ctx:d}}(),a=n.canvas,r=n.ctx;a.width=e,a.height=i;for(var o=[],u=t.frameDurations.length,l=0;l<u;l++){var h=t.getFrame(l);r.clearRect(0,0,e,i),h instanceof ImageData?r.drawImage((0,s.E0)(h),0,0,e,i):r.drawImage(h,0,0,e,i),o.push(r.getImageData(0,0,e,i))}return{width:e,height:i,frameDurations:t.frameDurations,getFrame:function(t){return o[t]},frameCount:t.frameCount,duration:t.duration}}},23174:function(t,e,i){i.d(e,{k:function(){return p}});var n=i(15671),a=i(43144),r=i(10064),o=i(32718),s=i(92026),u=i(80613),l=i(25866),h=i(54711),c=function(t){return"#define ".concat(function(t){return t.replace("-","_").toUpperCase()}(t),"\n")};function d(t){return{attributes:new Map([["a_pos",0],["a_tex",1]]),shaders:{vertexShader:c(t)+(0,h.w)("blend/blend.vert"),fragmentShader:c(t)+(0,h.w)("blend/blend.frag")}}}var f=i(8548),m=i(57808),v=i(52311),_=o.Z.getLogger("esri.views.2d.engine.webgl.effects.blendEffects.BlendEffect"),p=function(){function t(){(0,n.Z)(this,t),this._size=[0,0]}return(0,a.Z)(t,[{key:"dispose",value:function(t){this._backBufferTexture=(0,s.M2)(this._backBufferTexture),this._quad=(0,s.M2)(this._quad)}},{key:"draw",value:function(t,e,i,n,a){var o=t.context,s=t.drawPhase;if(this._setupShader(o),n&&"normal"!==n&&s!==u.jx.LABEL)this._drawBlended(t,e,i,n,a);else{var l=d("normal"),h=o.programCache.acquire(l.shaders.vertexShader,l.shaders.fragmentShader,l.attributes);if(h){o.useProgram(h),e.setSamplingMode(i),o.bindTexture(e,0),h.setUniform1i("u_layerTexture",0),h.setUniform1f("u_opacity",a),o.setBlendingEnabled(!0),o.setBlendFunction(f.zi.ONE,f.zi.ONE_MINUS_SRC_ALPHA);var c=this._quad;c.draw(),c.unbind(),h.dispose()}else _.error(new r.Z("mapview-BlendEffect",'Error creating shader program for blend mode "normal"'))}}},{key:"_drawBlended",value:function(t,e,i,n,a){var o,s,u=t.context,l=t.state,h=t.pixelRatio,c=t.inFadeTransition,m=l.size,v=u.getBoundFramebufferObject();null!=v?(o=v.width,s=v.height):(o=Math.round(h*m[0]),s=Math.round(h*m[1])),this._createOrResizeTexture(t,o,s);var p=this._backBufferTexture;v.copyToTexture(0,0,o,s,0,0,p),u.setStencilTestEnabled(!1),u.setStencilWriteMask(0),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setDepthWriteEnabled(!1);var g=d(n),y=u.programCache.acquire(g.shaders.vertexShader,g.shaders.fragmentShader,g.attributes);if(y){u.useProgram(y),p.setSamplingMode(i),u.bindTexture(p,0),y.setUniform1i("u_backbufferTexture",0),e.setSamplingMode(i),u.bindTexture(e,1),y.setUniform1i("u_layerTexture",1),y.setUniform1f("u_opacity",a),y.setUniform1f("u_inFadeOpacity",c?1:0),u.setBlendFunction(f.zi.ONE,f.zi.ZERO);var w=this._quad;w.draw(),w.unbind(),y.dispose(),u.setBlendFunction(f.zi.ONE,f.zi.ONE_MINUS_SRC_ALPHA)}else _.error(new r.Z("mapview-BlendEffect","Error creating shader program for blend mode ".concat(n)))}},{key:"_setupShader",value:function(t){this._quad||(this._quad=new l.Z(t,[-1,-1,1,-1,-1,1,1,1]))}},{key:"_createOrResizeTexture",value:function(t,e,i){var n=t.context;if(null===this._backBufferTexture||e!==this._size[0]||i!==this._size[1]){if(this._backBufferTexture)this._backBufferTexture.resize(e,i);else{var a=new v.X;a.internalFormat=f.VI.RGBA,a.wrapMode=f.e8.CLAMP_TO_EDGE,a.width=e,a.height=i,this._backBufferTexture=new m.x(n,a)}this._size[0]=e,this._size[1]=i}}}]),t}()},53456:function(t,e,i){i.d(e,{Q:function(){return a}});var n=i(54711),a={shaders:{vertexShader:(0,n.w)("bitBlit/bitBlit.vert"),fragmentShader:(0,n.w)("bitBlit/bitBlit.frag")},attributes:new Map([["a_pos",0],["a_tex",1]])}},93985:function(t,e,i){i.d(e,{C:function(){return a},y:function(){return r}});var n=i(54711),a={shaders:{vertexShader:(0,n.w)("highlight/textured.vert"),fragmentShader:(0,n.w)("highlight/highlight.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])},r={shaders:{vertexShader:(0,n.w)("highlight/textured.vert"),fragmentShader:(0,n.w)("highlight/blur.frag")},attributes:new Map([["a_position",0],["a_texcoord",1]])}},69610:function(t,e,i){i.d(e,{F:function(){return o},c:function(){return r}});var n=i(54711),a=i(96721),r={shaders:{vertexShader:(0,n.w)("magnifier/magnifier.vert"),fragmentShader:(0,n.w)("magnifier/magnifier.frag")},attributes:new Map([["a_pos",0]])};function o(t){return(0,a.H)(t,r)}},92841:function(t,e,i){i.d(e,{H:function(){return a}});var n=i(54711),a={shaders:{vertexShader:(0,n.w)("stencil/stencil.vert"),fragmentShader:(0,n.w)("stencil/stencil.frag")},attributes:new Map([["a_pos",0]])}},91908:function(t,e,i){i.d(e,{Z:function(){return tt}});var n=i(74165),a=i(15861),r=i(15671),o=i(43144),s=i(60136),u=i(29388),l=i(27366),h=i(13894),c=i(7138),d=i(92026),f=i(49861),m=(i(25243),i(63780),i(93169),i(69912)),v=i(585),_=i(86226),p=i(97326),g=i(17842),y=i(76741),w="esri-zoom-box",b={container:"".concat(w,"__container"),overlay:"".concat(w,"__overlay"),background:"".concat(w,"__overlay-background"),box:"".concat(w,"__outline")},x="Shift",k="Ctrl",M=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t){var n;return(0,r.Z)(this,i),(n=e.call(this,t))._container=null,n._overlay=null,n._backgroundShape=null,n._boxShape=null,n._box={x:0,y:0,width:0,height:0},n._rafId=null,n._redraw=n._redraw.bind((0,p.Z)(n)),n}return(0,o.Z)(i,[{key:"destroy",value:function(){this.view=null}},{key:"view",set:function(t){var e=this;this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",[x],(function(t){return e._handleDrag(t,1)}),y.f.INTERNAL),t.on("drag",[x,k],(function(t){return e._handleDrag(t,-1)}),y.f.INTERNAL)])}},{key:"_start",value:function(){this._createContainer(),this._createOverlay(),this.navigation.begin()}},{key:"_update",value:function(t,e,i,n){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=n,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}},{key:"_end",value:function(t,e,i,n,a){var r=this.view,o=r.toMap((0,g.vW)(t+.5*i,e+.5*n)),s=Math.max(i/r.width,n/r.height);-1===a&&(s=1/s),this._destroyOverlay(),this.navigation.end(),r.goTo({center:o,scale:r.scale*s})}},{key:"_updateBox",value:function(t,e,i,n){var a=this._boxShape;a.setAttributeNS(null,"x",""+t),a.setAttributeNS(null,"y",""+e),a.setAttributeNS(null,"width",""+i),a.setAttributeNS(null,"height",""+n),a.setAttributeNS(null,"class",b.box)}},{key:"_updateBackground",value:function(t,e,i,n){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,n,this.view.width,this.view.height))}},{key:"_createContainer",value:function(){var t=document.createElement("div");t.className=b.container,this.view.root.appendChild(t),this._container=t}},{key:"_createOverlay",value:function(){var t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",b.background);var n=document.createElementNS("http://www.w3.org/2000/svg","rect"),a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),a.setAttributeNS(null,"class",b.overlay),a.appendChild(i),a.appendChild(n),this._container.appendChild(a),this._backgroundShape=i,this._boxShape=n,this._overlay=a}},{key:"_destroyOverlay",value:function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}},{key:"_toSVGPath",value:function(t,e,i,n,a,r){var o=t+i,s=e+n;return"M 0 0 L "+a+" 0 L "+a+" "+r+" L 0 "+r+" ZM "+t+" "+e+" L "+t+" "+s+" L "+o+" "+s+" L "+o+" "+e+" Z"}},{key:"_handleDrag",value:function(t,e){var i,n,a,r,o=t.x,s=t.y,u=t.origin.x,l=t.origin.y;switch(o>u?(i=u,a=o-u):(i=o,a=u-o),s>l?(n=l,r=s-l):(n=s,r=l-s),t.action){case"start":this._start();break;case"update":this._update(i,n,a,r);break;case"end":this._end(i,n,a,r,e)}t.stopPropagation()}},{key:"_redraw",value:function(){if(this._rafId&&(this._rafId=null,this._overlay)){var t=this._box,e=t.x,i=t.y,n=t.width,a=t.height;this._updateBox(e,i,n,a),this._updateBackground(e,i,n,a),this._rafId=requestAnimationFrame(this._redraw)}}}]),i}(c.Z);(0,l._)([(0,f.Cb)()],M.prototype,"navigation",void 0),(0,l._)([(0,f.Cb)()],M.prototype,"view",null);var C=M=(0,l._)([(0,m.j)("esri.views.2d.navigation.ZoomBox")],M),Z=(i(59486),i(94172)),T=i(11186),S=i(71353),I=i(88301),z=i(61120),D=function(){function t(e){(0,r.Z)(this,t),this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}return(0,o.Z)(t,[{key:"update",value:function(t){if(this.hasLastValue()){var e=this.computeDelta(t);this._updateDelta(e)}this.lastValue=t}},{key:"reset",value:function(){this.lastValue=void 0,this.filteredDelta=void 0}},{key:"hasLastValue",value:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",value:function(){return void 0!==this.filteredDelta}},{key:"computeDelta",value:function(t){return void 0===this.lastValue?NaN:t-this.lastValue}},{key:"_updateDelta",value:function(t){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*t:this.filteredDelta=t}}]),t}(),R=function(){function t(e,i,n){(0,r.Z)(this,t),this._initialVelocity=e,this._stopVelocity=i,this._friction=n,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}return(0,o.Z)(t,[{key:"duration",get:function(){return this._duration}},{key:"isFinished",value:function(t){return t>this.duration}},{key:"friction",get:function(){return this._friction}},{key:"value",value:function(t){return this.valueFromInitialVelocity(this._initialVelocity,t)}},{key:"valueDelta",value:function(t,e){var i=this.value(t);return this.value(t+e)-i}},{key:"valueFromInitialVelocity",value:function(t,e){e=Math.min(e,this.duration);var i=1-this.friction;return t*(Math.pow(i,e)-1)/Math.log(i)}}]),t}(),F=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t,n,a,o,s){var u;return(0,r.Z)(this,i),(u=e.call(this,t,n,a))._sceneVelocity=o,u.direction=s,u}return(0,o.Z)(i,[{key:"value",value:function(t){return(0,I.Z)((0,z.Z)(i.prototype),"valueFromInitialVelocity",this).call(this,this._sceneVelocity,t)}}]),i}(R),A=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:300,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.84;(0,r.Z)(this,t),this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=n,this.enabled=!0,this._time=new D(.6),this._screen=[new D(.4),new D(.4)],this._scene=[new D(.6),new D(.6),new D(.6)],this._tmpDirection=(0,S.c)()}return(0,o.Z)(t,[{key:"add",value:function(t,e,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(t[0]),this._screen[1].update(t[1]),this._scene[0].update(e[0]),this._scene[1].update(e[1]),this._scene[2].update(e[2]),this._time.update(i)}}},{key:"reset",value:function(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var t=this._screen[0].filteredDelta,e=this._screen[1].filteredDelta,i=null==t||null==e?0:Math.sqrt(t*t+e*e),n=this._time.filteredDelta,a=null==n||null==i?0:i/n;return Math.abs(a)<this._minimumInitialVelocity?null:this.createMomentum(a,this._stopVelocity,this._friction)}},{key:"createMomentum",value:function(t,e,i){var n,a,r;(0,T.s)(this._tmpDirection,null!==(n=this._scene[0].filteredDelta)&&void 0!==n?n:0,null!==(a=this._scene[1].filteredDelta)&&void 0!==a?a:0,null!==(r=this._scene[2].filteredDelta)&&void 0!==r?r:0);var o=(0,T.l)(this._tmpDirection);o>0&&(0,T.i)(this._tmpDirection,this._tmpDirection,1/o);var s=this._time.filteredDelta;return new F(t,e,i,null==s?0:o/s,this._tmpDirection)}}]),t}(),P=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t){var n;return(0,r.Z)(this,i),(n=e.call(this,t)).animationTime=0,n.momentumEstimator=new A(500,6,.92),n.momentum=null,n.tmpMomentum=(0,S.c)(),n.momentumFinished=!1,n.viewpoint=new h.Z({targetGeometry:new v.Z,scale:0,rotation:0}),n._previousDrag=null,(0,Z.gx)((function(){return n.momentumFinished}),(function(){return n.navigation.stop()})),n}return(0,o.Z)(i,[{key:"begin",value:function(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}},{key:"update",value:function(t,e){this.addToEstimator(e);var i=e.center.x,n=e.center.y,a=this._previousDrag;i=a?a.center.x-i:-i,n=a?n-a.center.y:n,t.viewpoint=(0,_.Rx)(this.viewpoint,t.viewpoint,[i||0,n||0]),this._previousDrag=e}},{key:"end",value:function(t,e){this.addToEstimator(e);var i=t.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}},{key:"addToEstimator",value:function(t){var e=t.center.x,i=t.center.y,n=(0,g.s1)(-e,i),a=(0,S.f)(-e,i,0);this.momentumEstimator.add(n,a,.001*t.timestamp)}},{key:"onAnimationUpdate",value:function(t){var e,i=this;null===(e=this.navigation.animationManager)||void 0===e||e.animateContinous(t.viewpoint,(function(e,n){var a=i.momentum,r=i.animationTime,o=i.tmpMomentum,s=.001*n;if(!(i.momentumFinished=!a||a.isFinished(r))){var u=a.valueDelta(r,s);(0,T.i)(o,a.direction,u),(0,_.Rx)(e,e,o),t.constraints.constrainByGeometry(e)}i.animationTime+=s}))}},{key:"stopMomentumNavigation",value:function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}}]),i}(c.Z);(0,l._)([(0,f.Cb)()],P.prototype,"momentumFinished",void 0),(0,l._)([(0,f.Cb)()],P.prototype,"viewpoint",void 0),(0,l._)([(0,f.Cb)()],P.prototype,"navigation",void 0);var E=P=(0,l._)([(0,m.j)("esri.views.2d.navigation.actions.Pan")],P),L=i(88396),V=i(6394),B=i(16889),U=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;(0,r.Z)(this,t),this._minimumInitialVelocity=e,this._stopVelocity=i,this._friction=n,this._maxVelocity=a,this.enabled=!0,this.value=new D(.8),this.time=new D(.3)}return(0,o.Z)(t,[{key:"add",value:function(t,e){if(this.enabled&&null!=e){if(this.time.hasLastValue()){if(this.time.computeDelta(e)<.01)return;if(this.value.hasFilteredDelta()){var i=this.value.computeDelta(t);this.value.filteredDelta*i<0&&this.value.reset()}}this.time.update(e),this.value.update(t)}}},{key:"reset",value:function(){this.value.reset(),this.time.reset()}},{key:"evaluateMomentum",value:function(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;var t=this.value.filteredDelta/this.time.filteredDelta;return t=(0,B.uZ)(t,-this._maxVelocity,this._maxVelocity),Math.abs(t)<this._minimumInitialVelocity?null:this.createMomentum(t,this._stopVelocity,this._friction)}},{key:"createMomentum",value:function(t,e,i){return new R(t,e,i)}}]),t}(),N=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return(0,r.Z)(this,i),e.call(this,t,n,a,o)}return(0,o.Z)(i,[{key:"add",value:function(t,e){var n=this.value.lastValue;if(null!=n){for(var a=t-n;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;t=n+a}(0,I.Z)((0,z.Z)(i.prototype),"add",this).call(this,t,e)}}]),i}(U),O=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t,n,a){return(0,r.Z)(this,i),e.call(this,t,n,a)}return(0,o.Z)(i,[{key:"value",value:function(t){var e=(0,I.Z)((0,z.Z)(i.prototype),"value",this).call(this,t);return Math.exp(e)}},{key:"valueDelta",value:function(t,e){var n=(0,I.Z)((0,z.Z)(i.prototype),"value",this).call(this,t),a=(0,I.Z)((0,z.Z)(i.prototype),"value",this).call(this,t+e)-n;return Math.exp(a)}}]),i}(R),H=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2.5,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.95,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:12;return(0,r.Z)(this,i),e.call(this,t,n,a,o)}return(0,o.Z)(i,[{key:"add",value:function(t,e){(0,I.Z)((0,z.Z)(i.prototype),"add",this).call(this,Math.log(t),e)}},{key:"createMomentum",value:function(t,e,i){return new O(t,e,i)}}]),i}(U),G=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t){var n;return(0,r.Z)(this,i),(n=e.call(this,t))._animationTime=0,n._momentumFinished=!1,n._previousAngle=0,n._previousRadius=0,n._previousCenter=null,n._rotationMomentumEstimator=new N(.6,.15,.95),n._rotationDirection=1,n._startAngle=0,n._startRadius=0,n._updateTimestamp=null,n._zoomDirection=1,n._zoomMomentumEstimator=new H,n._zoomOnly=null,n.zoomMomentum=null,n.rotateMomentum=null,n.viewpoint=new h.Z({targetGeometry:new v.Z,scale:0,rotation:0}),n.addHandles((0,Z.gx)((function(){return n._momentumFinished}),(function(){return n.navigation.stop()}))),n}return(0,o.Z)(i,[{key:"begin",value:function(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)}},{key:"update",value:function(t,e){null===this._updateTimestamp&&(this._updateTimestamp=e.timestamp);var i=e.angle,n=e.radius,a=e.center,r=Math.abs(180*(i-this._startAngle)/Math.PI),o=Math.abs(n-this._startRadius),s=this._startRadius/n;if(this._previousRadius&&this._previousCenter){var u=n/this._previousRadius,l=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=l>=0?1:-1,this._zoomDirection=u>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-r>0),null===this._zoomOnly||this._zoomOnly?l=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):l=0,this.addToZoomEstimator(e,s),this.navigation.setViewpoint([a.x,a.y],1/u,l,[this._previousCenter.x-a.x,a.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=n,this._previousCenter=a}},{key:"end",value:function(t){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t),this.navigation.end()}},{key:"addToRotateEstimator",value:function(t,e){this._rotationMomentumEstimator.add(t,.001*e)}},{key:"addToZoomEstimator",value:function(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)}},{key:"canZoomIn",value:function(t){var e=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||e>i}},{key:"canZoomOut",value:function(t){var e=t.scale,i=t.constraints.effectiveMinScale;return 0===i||e<i}},{key:"onAnimationUpdate",value:function(t){var e,i=this;null===(e=this.navigation.animationManager)||void 0===e||e.animateContinous(t.viewpoint,(function(e,n){var a=!i.canZoomIn(t)&&i._zoomDirection>1||!i.canZoomOut(t)&&i._zoomDirection<1,r=!i.rotateMomentum||i.rotateMomentum.isFinished(i._animationTime),o=a||!i.zoomMomentum||i.zoomMomentum.isFinished(i._animationTime),s=.001*n;if(i._momentumFinished=r&&o,!i._momentumFinished){var u=i.rotateMomentum?Math.abs(i.rotateMomentum.valueDelta(i._animationTime,s))*i._rotationDirection*180/Math.PI:0,l=i.zoomMomentum?Math.abs(i.zoomMomentum.valueDelta(i._animationTime,s)):1,h=(0,V.a)(),c=(0,V.a)();if(i._previousCenter){(0,L.s)(h,i._previousCenter.x,i._previousCenter.y),(0,_.Dq)(c,t.size,t.padding),(0,L.i)(h,h,c);var d=t.constraints,f=t.scale,m=f*l;l<1&&!d.canZoomInTo(m)?(l=f/d.effectiveMaxScale,i.zoomMomentum=null,i.rotateMomentum=null):l>1&&!d.canZoomOutTo(m)&&(l=f/d.effectiveMinScale,i.zoomMomentum=null,i.rotateMomentum=null),(0,_.UZ)(e,t.viewpoint,l,u,h,t.size),t.constraints.constrainByGeometry(e)}}i._animationTime+=s}))}},{key:"stopMomentumNavigation",value:function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}}]),i}(c.Z);(0,l._)([(0,f.Cb)()],G.prototype,"_momentumFinished",void 0),(0,l._)([(0,f.Cb)()],G.prototype,"viewpoint",void 0),(0,l._)([(0,f.Cb)()],G.prototype,"navigation",void 0);var q=G=(0,l._)([(0,m.j)("esri.views.2d.navigation.actions.Pinch")],G),W=(0,V.a)(),Y=(0,V.a)(),X=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t){var n;return(0,r.Z)(this,i),(n=e.call(this,t))._previousCenter=(0,V.a)(),n.viewpoint=new h.Z({targetGeometry:new v.Z,scale:0,rotation:0}),n}return(0,o.Z)(i,[{key:"begin",value:function(t,e){this.navigation.begin(),(0,L.s)(this._previousCenter,e.center.x,e.center.y)}},{key:"update",value:function(t,e){var i=t.state,n=i.size,a=i.padding;(0,L.s)(W,e.center.x,e.center.y),(0,_.ni)(Y,n,a),t.viewpoint=(0,_.$H)(this.viewpoint,t.state.paddedViewState.viewpoint,(0,_.dI)(Y,this._previousCenter,W)),(0,L.j)(this._previousCenter,W)}},{key:"end",value:function(){this.navigation.end()}}]),i}(c.Z);(0,l._)([(0,f.Cb)()],X.prototype,"viewpoint",void 0),(0,l._)([(0,f.Cb)()],X.prototype,"navigation",void 0);var j=X=(0,l._)([(0,m.j)("esri.views.2d.actions.Rotate")],X),Q=10,$=new h.Z({targetGeometry:new v.Z}),J=[0,0],K=function(t){(0,s.Z)(i,t);var e=(0,u.Z)(i);function i(t){var n;return(0,r.Z)(this,i),(n=e.call(this,t))._endTimer=null,n._lastEventTimestamp=null,n.animationManager=null,n.interacting=!1,n}return(0,o.Z)(i,[{key:"initialize",value:function(){this.pan=new E({navigation:this}),this.rotate=new j({navigation:this}),this.pinch=new q({navigation:this}),this.zoomBox=new C({view:this.view,navigation:this})}},{key:"destroy",value:function(){this.pan=(0,d.SC)(this.pan),this.rotate=(0,d.SC)(this.rotate),this.pinch=(0,d.SC)(this.pinch),this.zoomBox=(0,d.SC)(this.zoomBox),this.animationManager=null}},{key:"begin",value:function(){this._set("interacting",!0)}},{key:"end",value:function(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}},{key:"zoom",value:function(){var t=(0,a.Z)((0,n.Z)().mark((function t(e){var i,a=arguments;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=a.length>1&&void 0!==a[1]?a[1]:this._getDefaultAnchor(),this.stop(),this.begin(),!this.view.constraints.snapToZoom||!this.view.constraints.effectiveLODs){t.next=3;break}return t.abrupt("return",e<1?this.zoomIn(i):this.zoomOut(i));case 3:this.setViewpoint(i,e,0,[0,0]);case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"zoomIn",value:function(){var t=(0,a.Z)((0,n.Z)().mark((function t(e){var i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.view,a=i.constraints.snapToNextScale(i.scale),t.abrupt("return",this._zoomToScale(a,e));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"zoomOut",value:function(){var t=(0,a.Z)((0,n.Z)().mark((function t(e){var i,a;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.view,a=i.constraints.snapToPreviousScale(i.scale),t.abrupt("return",this._zoomToScale(a,e));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setViewpoint",value:function(t,e,i,n){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,n),this.end()}},{key:"setViewpointImmediate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._getDefaultAnchor();this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,n,t,e,i)}},{key:"continousRotateClockwise",value:function(){var t,e=this.view.viewpoint;null===(t=this.animationManager)||void 0===t||t.animateContinous(e,(function(t){(0,_.$H)(t,t,-1)}))}},{key:"continousRotateCounterclockwise",value:function(){var t,e=this.view.viewpoint;null===(t=this.animationManager)||void 0===t||t.animateContinous(e,(function(t){(0,_.$H)(t,t,1)}))}},{key:"resetRotation",value:function(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}},{key:"continousPanLeft",value:function(){this._continuousPan([-10,0])}},{key:"continousPanRight",value:function(){this._continuousPan([Q,0])}},{key:"continousPanUp",value:function(){this._continuousPan([0,Q])}},{key:"continousPanDown",value:function(){this._continuousPan([0,-10])}},{key:"continuousPanVector",value:function(t){var e=t.x,i=t.y;this._continuousPan([e*Q,i*Q])}},{key:"stop",value:function(){var t;this.pan.stopMomentumNavigation(),null!==(t=this.animationManager)&&void 0!==t&&t.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}},{key:"_continuousPan",value:function(t){var e,i=this,n=this.view.viewpoint;null===(e=this.animationManager)||void 0===e||e.animateContinous(n,(function(e){(0,_.Rx)(e,e,t),i.view.constraints.constrainByGeometry(e)}))}},{key:"_startTimer",value:function(t){var e=this;return null!==this._endTimer||(this._endTimer=setTimeout((function(){var t;e._endTimer=null;var i=performance.now()-(null!==(t=e._lastEventTimestamp)&&void 0!==t?t:0);i<250?e._endTimer=e._startTimer(i):e._set("interacting",!1)}),t)),this._endTimer}},{key:"_getDefaultAnchor",value:function(){var t=this.view,e=t.size,i=t.padding,n=i.left,a=i.right,r=i.top,o=i.bottom;return J[0]=.5*(e[0]-a+n),J[1]=.5*(e[1]-o+r),J}},{key:"_zoomToScale",value:function(){var t=(0,a.Z)((0,n.Z)().mark((function t(e){var i,a,r,o,s,u,l,h,c,d=arguments;return(0,n.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=d.length>1&&void 0!==d[1]?d[1]:this._getDefaultAnchor(),a=this.view,r=a.constraints,o=a.scale,s=a.viewpoint,u=a.size,l=a.padding,h=r.canZoomInTo(e),c=r.canZoomOutTo(e),e<o&&!h||e>o&&!c){t.next=4;break}return t.abrupt("return",((0,_.gG)($,s,e/o,0,i,u,l),r.constrainByGeometry($),a.goTo($,{animate:!0,pickClosestTarget:!1})));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"_scaleRotateTranslateViewpoint",value:function(t,e,i,n,a){var r=this.view,o=r.size,s=r.padding,u=r.constraints,l=r.scale,h=r.viewpoint,c=l*i,d=u.canZoomInTo(c),f=u.canZoomOutTo(c);return(i<1&&!d||i>1&&!f)&&(i=1),(0,_.Rx)(h,h,a),(0,_.gG)(t,h,i,n,e,o,s),u.constrainByGeometry(t)}}]),i}(c.Z);(0,l._)([(0,f.Cb)()],K.prototype,"animationManager",void 0),(0,l._)([(0,f.Cb)({type:Boolean,readOnly:!0})],K.prototype,"interacting",void 0),(0,l._)([(0,f.Cb)()],K.prototype,"pan",void 0),(0,l._)([(0,f.Cb)()],K.prototype,"pinch",void 0),(0,l._)([(0,f.Cb)()],K.prototype,"rotate",void 0),(0,l._)([(0,f.Cb)()],K.prototype,"view",void 0),(0,l._)([(0,f.Cb)()],K.prototype,"zoomBox",void 0);var tt=K=(0,l._)([(0,m.j)("esri.views.2d.navigation.MapViewNavigation")],K)}}]);
//# sourceMappingURL=3803.3058306c.chunk.js.map