"use strict";(self.webpackChunkamit_kumar_rathi=self.webpackChunkamit_kumar_rathi||[]).push([[5436],{46228:function(e,t,i){i.d(t,{I:function(){return n},v:function(){return s}});var r=i(16889);function n(e,t){for(var i,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=(0,r.uZ)(e,0,o),l=0;l<4;l++)t[n+l]=Math.floor(256*((i=s*a[l])-Math.floor(i)))}function s(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=0,r=0;r<4;r++)i+=e[t+r]*l[r];return i}var a=[1,256,65536,16777216],l=[1/256,1/65536,1/16777216,1/4294967296],o=s(new Uint8ClampedArray([255,255,255,255]))},78084:function(e,t,i){i.d(t,{Z:function(){return y}});var r,n,s=i(15671),a=i(43144),l=i(93169),o=i(13005);(n=r||(r={}))[n.varint=0]="varint",n[n.fixed64=1]="fixed64",n[n.delimited=2]="delimited",n[n.fixed32=5]="fixed32",n[n.unknown=99]="unknown";var h=4294967296,u=new TextDecoder("utf-8"),c=(0,l.Z)("safari")||(0,l.Z)("ios")?6:(0,l.Z)("ff")?12:32,y=function(){function e(t,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t?t.byteLength:0;(0,s.Z)(this,e),this._tag=0,this._dataType=r.unknown,this._init(t,i,n,a)}return(0,a.Z)(e,[{key:"_init",value:function(e,t,i,r){this._data=e,this._dataView=t,this._pos=i,this._end=r}},{key:"asUnsafe",value:function(){return this}},{key:"clone",value:function(){return new e(this._data,this._dataView,this._pos,this._end)}},{key:"pos",value:function(){return this._pos}},{key:"move",value:function(e){this._pos=e}},{key:"nextTag",value:function(e){for(;;){if(this._pos===this._end)return!1;var t=this._decodeVarint();if(this._tag=t>>3,this._dataType=7&t,!e||e===this._tag)break;this.skip()}return!0}},{key:"next",value:function(){if(this._pos===this._end)return!1;var e=this._decodeVarint();return this._tag=e>>3,this._dataType=7&e,!0}},{key:"empty",value:function(){return this._pos>=this._end}},{key:"tag",value:function(){return this._tag}},{key:"getInt32",value:function(){return this._decodeVarint()}},{key:"getInt64",value:function(){return this._decodeVarint()}},{key:"getUInt32",value:function(){var e=4294967295;return e=(127&this._data[this._pos])>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<7)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<14)>>>0,this._data[this._pos++]<128?e:(e=(e|(127&this._data[this._pos])<<21)>>>0,this._data[this._pos++]<128?e:(e=(e|(15&this._data[this._pos])<<28)>>>0,this._data[this._pos++]<128?e:void 0))))}},{key:"getUInt64",value:function(){return this._decodeVarint()}},{key:"getSInt32",value:function(){var e=this.getUInt32();if(void 0!==e)return e>>>1^-(1&e)|0}},{key:"getSInt64",value:function(){return this._decodeSVarint()}},{key:"getBool",value:function(){var e=0!==this._data[this._pos];return this._skip(1),e}},{key:"getEnum",value:function(){return this._decodeVarint()}},{key:"getFixed64",value:function(){var e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getUint32(t+4,!0)*h;return this._skip(8),i}},{key:"getSFixed64",value:function(){var e=this._dataView,t=this._pos,i=e.getUint32(t,!0)+e.getInt32(t+4,!0)*h;return this._skip(8),i}},{key:"getDouble",value:function(){var e=this._dataView.getFloat64(this._pos,!0);return this._skip(8),e}},{key:"getFixed32",value:function(){var e=this._dataView.getUint32(this._pos,!0);return this._skip(4),e}},{key:"getSFixed32",value:function(){var e=this._dataView.getInt32(this._pos,!0);return this._skip(4),e}},{key:"getFloat",value:function(){var e=this._dataView.getFloat32(this._pos,!0);return this._skip(4),e}},{key:"getString",value:function(){var e=this._getLength(),t=this._pos,i=this._toString(this._data,t,t+e);return this._skip(e),i}},{key:"getBytes",value:function(){var e=this._getLength(),t=this._pos,i=this._toBytes(this._data,t,t+e);return this._skip(e),i}},{key:"getLength",value:function(){return this._getLengthUnsafe()}},{key:"processMessageWithArgs",value:function(e,t,i,r){var n=this.getMessage(),s=e(n,t,i,r);return n.release(),s}},{key:"processMessage",value:function(e){var t=this.getMessage(),i=e(t);return t.release(),i}},{key:"getMessage",value:function(){var t=this._getLength(),i=e.pool.acquire();return i._init(this._data,this._dataView,this._pos,this._pos+t),this._skip(t),i}},{key:"release",value:function(){e.pool.release(this)}},{key:"dataType",value:function(){return this._dataType}},{key:"skip",value:function(){switch(this._dataType){case r.varint:this._decodeVarint();break;case r.fixed64:this._skip(8);break;case r.delimited:this._skip(this._getLength());break;case r.fixed32:this._skip(4);break;default:throw new Error("Invalid data type!")}}},{key:"skipLen",value:function(e){this._skip(e)}},{key:"_skip",value:function(e){if(this._pos+e>this._end)throw new Error("Attempt to skip past the end of buffer!");this._pos+=e}},{key:"_decodeVarint",value:function(){var e=this._data,t=this._pos,i=0,r=0;if(this._end-t>=10)do{if(i|=127&(r=e[t++]),0==(128&r))break;if(i|=(127&(r=e[t++]))<<7,0==(128&r))break;if(i|=(127&(r=e[t++]))<<14,0==(128&r))break;if(i|=(127&(r=e[t++]))<<21,0==(128&r))break;if(i+=268435456*(127&(r=e[t++])),0==(128&r))break;if(i+=34359738368*(127&(r=e[t++])),0==(128&r))break;if(i+=4398046511104*(127&(r=e[t++])),0==(128&r))break;if(i+=562949953421312*(127&(r=e[t++])),0==(128&r))break;if(i+=72057594037927940*(127&(r=e[t++])),0==(128&r))break;if(i+=0x8000000000000000*(127&(r=e[t++])),0==(128&r))break;throw new Error("Varint too long!")}while(0);else{for(var n=1;t!==this._end&&0!=(128&(r=e[t]));)++t,i+=(127&r)*n,n*=128;if(t===this._end)throw new Error("Varint overrun!");++t,i+=r*n}return this._pos=t,i}},{key:"_decodeSVarint",value:function(){var e,t=this._data,i=0,r=0,n=1&t[this._pos];if(i|=127&(r=t[this._pos++]),0==(128&r))return n?-(i+1)/2:i/2;if(i|=(127&(r=t[this._pos++]))<<7,0==(128&r))return n?-(i+1)/2:i/2;if(i|=(127&(r=t[this._pos++]))<<14,0==(128&r))return n?-(i+1)/2:i/2;if(i|=(127&(r=t[this._pos++]))<<21,0==(128&r))return n?-(i+1)/2:i/2;if(i+=268435456*(127&(r=t[this._pos++])),0==(128&r))return n?-(i+1)/2:i/2;if(i+=34359738368*(127&(r=t[this._pos++])),0==(128&r))return n?-(i+1)/2:i/2;if(i+=4398046511104*(127&(r=t[this._pos++])),0==(128&r))return n?-(i+1)/2:i/2;if(e=BigInt(i),r=t[this._pos++],e+=0x2000000000000n*BigInt(127&r),0==(128&r))return Number(n?-(e+1n)/2n:e/2n);if(r=t[this._pos++],e+=0x100000000000000n*BigInt(127&r),0==(128&r))return Number(n?-(e+1n)/2n:e/2n);if(r=t[this._pos++],e+=0x8000000000000000n*BigInt(127&r),0==(128&r))return Number(n?-(e+1n)/2n:e/2n);throw new Error("Varint too long!")}},{key:"_getLength",value:function(){if(this._dataType!==r.delimited)throw new Error("Not a delimited data type!");return this._decodeVarint()}},{key:"_getLengthUnsafe",value:function(){return this.getUInt32()}},{key:"_toString",value:function(e,t,i){if((i=Math.min(this._end,i))-t>c){var r=e.subarray(t,i);return u.decode(r)}for(var n="",s="",a=t;a<i;++a){var l=e[a];128&l?s+="%"+l.toString(16):(n+=decodeURIComponent(s)+String.fromCharCode(l),s="")}return s.length&&(n+=decodeURIComponent(s)),n}},{key:"_toBytes",value:function(e,t,i){return i=Math.min(this._end,i),new Uint8Array(e.buffer,t,i-t)}}]),e}();y.pool=new o.Z(y,void 0,(function(e){e._data=null,e._dataView=null}))},40316:function(e,t,i){i.d(t,{E9:function(){return l},I6:function(){return u},Vl:function(){return r},bN:function(){return h}});var r,n,s=i(15671),a=i(43144);!function(e){e[e.Unknown=0]="Unknown",e[e.Point=1]="Point",e[e.LineString=2]="LineString",e[e.Polygon=3]="Polygon"}(r||(r={}));var l=function(){function e(t,i){(0,s.Z)(this,e),this.x=t,this.y=i}return(0,a.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}},{key:"equals",value:function(e,t){return e===this.x&&t===this.y}},{key:"isEqual",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"setCoords",value:function(e,t){this.x=e,this.y=t}},{key:"normalize",value:function(){var e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);this.x/=i,this.y/=i}},{key:"rightPerpendicular",value:function(){var e=this.x;this.x=this.y,this.y=-e}},{key:"move",value:function(e,t){this.x+=e,this.y+=t}},{key:"assign",value:function(e){this.x=e.x,this.y=e.y}},{key:"assignAdd",value:function(e,t){this.x=e.x+t.x,this.y=e.y+t.y}},{key:"assignSub",value:function(e,t){this.x=e.x-t.x,this.y=e.y-t.y}},{key:"rotate",value:function(e,t){var i=this.x,r=this.y;this.x=i*e-r*t,this.y=i*t+r*e}},{key:"scale",value:function(e){this.x*=e,this.y*=e}},{key:"length",value:function(){var e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}}],[{key:"distance",value:function(e,t){var i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}},{key:"add",value:function(t,i){return new e(t.x+i.x,t.y+i.y)}},{key:"sub",value:function(t,i){return new e(t.x-i.x,t.y-i.y)}}]),e}(),o=(0,a.Z)((function e(t,i,r){(0,s.Z)(this,e),this.ratio=t,this.x=i,this.y=r})),h=function(){function e(t,i,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;(0,s.Z)(this,e),this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=n,this._pixelMargin=a,this._tileSize=512*n,this._dz=t,this._yPos=i,this._xPos=r}return(0,a.Z)(e,[{key:"setPixelMargin",value:function(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}},{key:"setExtent",value:function(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);var t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;var i=e>>this._dz;t>i&&(t=i),this._margin=t,this._xmin=i*this._xPos-t,this._ymin=i*this._yPos-t,this._xmax=this._xmin+i+2*t,this._ymax=this._ymin+i+2*t}},{key:"reset",value:function(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}},{key:"moveTo",value:function(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new l(e,t),this._firstPt=new l(e,t),this._dist=0}},{key:"lineTo",value:function(e,t){var i,r,n,s,a,h,u,c,y=this._isIn(e,t),f=new l(e,t),d=l.distance(this._prevPt,f);if(y)this._prevIsIn?this._lineTo(e,t,!0):(i=this._prevPt,r=f,n=this._intersect(r,i),this._start=this._dist+d*(1-this._r),this._lineTo(n.x,n.y,!0),this._lineTo(r.x,r.y,!0));else if(this._prevIsIn)r=this._prevPt,i=f,n=this._intersect(r,i),this._lineTo(n.x,n.y,!0),this._lineTo(i.x,i.y,!1);else{var _=this._prevPt,v=f;if(_.x<=this._xmin&&v.x<=this._xmin||_.x>=this._xmax&&v.x>=this._xmax||_.y<=this._ymin&&v.y<=this._ymin||_.y>=this._ymax&&v.y>=this._ymax)this._lineTo(v.x,v.y,!1);else{var p=[];if((_.x<this._xmin&&v.x>this._xmin||_.x>this._xmin&&v.x<this._xmin)&&(s=(this._xmin-_.x)/(v.x-_.x),(c=_.y+s*(v.y-_.y))<=this._ymin?h=!1:c>=this._ymax?h=!0:p.push(new o(s,this._xmin,c))),(_.x<this._xmax&&v.x>this._xmax||_.x>this._xmax&&v.x<this._xmax)&&(s=(this._xmax-_.x)/(v.x-_.x),(c=_.y+s*(v.y-_.y))<=this._ymin?h=!1:c>=this._ymax?h=!0:p.push(new o(s,this._xmax,c))),(_.y<this._ymin&&v.y>this._ymin||_.y>this._ymin&&v.y<this._ymin)&&(s=(this._ymin-_.y)/(v.y-_.y),(u=_.x+s*(v.x-_.x))<=this._xmin?a=!1:u>=this._xmax?a=!0:p.push(new o(s,u,this._ymin))),(_.y<this._ymax&&v.y>this._ymax||_.y>this._ymax&&v.y<this._ymax)&&(s=(this._ymax-_.y)/(v.y-_.y),(u=_.x+s*(v.x-_.x))<=this._xmin?a=!1:u>=this._xmax?a=!0:p.push(new o(s,u,this._ymax))),0===p.length)a?h?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):h?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(p.length>1&&p[0].ratio>p[1].ratio)this._start=this._dist+d*p[1].ratio,this._lineTo(p[1].x,p[1].y,!0),this._lineTo(p[0].x,p[0].y,!0);else{this._start=this._dist+d*p[0].ratio;for(var g=0;g<p.length;g++)this._lineTo(p[g].x,p[g].y,!0)}this._lineTo(v.x,v.y,!1)}}this._dist+=d,this._prevIsIn=y,this._prevPt=f}},{key:"close",value:function(){if(this._line.length>2){var e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);for(var i=this._line,r=i.length;r>=4&&(i[0].x===i[1].x&&i[0].x===i[r-2].x||i[0].y===i[1].y&&i[0].y===i[r-2].y);)i.pop(),i[0].x=i[r-2].x,i[0].y=i[r-2].y,--r}}},{key:"result",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._pushLine(),0===this._lines.length?null:(this._type===r.Polygon&&e&&c.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}},{key:"resultWithStarts",value:function(){if(this._type!==r.LineString)throw new Error("Only valid for lines");this._pushLine();var e=this._lines,t=e.length;if(0===t)return null;for(var i=[],n=0;n<t;n++)i.push({line:e[n],start:this._starts[n]||0});return i}},{key:"_isIn",value:function(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}},{key:"_intersect",value:function(e,t){var i,r,n;if(t.x>=this._xmin&&t.x<=this._xmax)n=((r=t.y<=this._ymin?this._ymin:this._ymax)-e.y)/(t.y-e.y),i=e.x+n*(t.x-e.x);else if(t.y>=this._ymin&&t.y<=this._ymax)n=((i=t.x<=this._xmin?this._xmin:this._xmax)-e.x)/(t.x-e.x),r=e.y+n*(t.y-e.y);else{r=t.y<=this._ymin?this._ymin:this._ymax;var s=((i=t.x<=this._xmin?this._xmin:this._xmax)-e.x)/(t.x-e.x),a=(r-e.y)/(t.y-e.y);s<a?(n=s,r=e.y+s*(t.y-e.y)):(n=a,i=e.x+a*(t.x-e.x))}return this._r=n,new l(i,r)}},{key:"_pushLine",value:function(){this._line&&(this._type===r.Point?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===r.LineString?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):this._type===r.Polygon&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}},{key:"_moveTo",value:function(e,t,i){this._type!==r.Polygon?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new l(e,t))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.push(new l(e,t)),this._isH=!1,this._isV=!1)}},{key:"_lineTo",value:function(e,t,i){var n,s;if(this._type!==r.Polygon)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1]).equals(e,t))return;this._line.push(new l(e,t))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),t<this._ymin&&(t=this._ymin),t>this._ymax&&(t=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),t=Math.round((t-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){var a=(n=this._line[this._line.length-1]).x===e,o=n.y===t;if(a&&o)return;this._isH&&a||this._isV&&o?(n.x=e,n.y=t,(s=this._line[this._line.length-2]).x===e&&s.y===t?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===t)):(this._isH=s.x===e,this._isV=s.y===t)):(this._line.push(new l(e,t)),this._isH=a,this._isV=o)}else this._line.push(new l(e,t))}}]),e}(),u=function(){function e(){(0,s.Z)(this,e)}return(0,a.Z)(e,[{key:"setExtent",value:function(e){this._ratio=4096===e?1:4096/e}},{key:"validateTessellation",get:function(){return this._ratio<1}},{key:"reset",value:function(e){this._lines=[],this._line=null}},{key:"moveTo",value:function(e,t){this._line&&this._lines.push(this._line),this._line=[];var i=this._ratio;this._line.push(new l(e*i,t*i))}},{key:"lineTo",value:function(e,t){var i=this._ratio;this._line.push(new l(e*i,t*i))}},{key:"close",value:function(){var e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}},{key:"result",value:function(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}}]),e}();!function(e){e[e.sideLeft=0]="sideLeft",e[e.sideRight=1]="sideRight",e[e.sideTop=2]="sideTop",e[e.sideBottom=3]="sideBottom"}(n||(n={}));var c=function(){function e(){(0,s.Z)(this,e)}return(0,a.Z)(e,null,[{key:"simplify",value:function(t,i,r){if(r){for(var s=-i,a=t+i,l=-i,o=t+i,h=[],u=[],c=r.length,y=0;y<c;++y){var f=r[y];if(f&&!(f.length<2))for(var d=void 0,_=f[0],v=f.length,p=1;p<v;++p)d=f[p],_.x===d.x&&(_.x<=s&&(_.y>d.y?(h.push(y),h.push(p),h.push(n.sideLeft),h.push(-1)):(u.push(y),u.push(p),u.push(n.sideLeft),u.push(-1))),_.x>=a&&(_.y<d.y?(h.push(y),h.push(p),h.push(n.sideRight),h.push(-1)):(u.push(y),u.push(p),u.push(n.sideRight),u.push(-1)))),_.y===d.y&&(_.y<=l&&(_.x<d.x?(h.push(y),h.push(p),h.push(n.sideTop),h.push(-1)):(u.push(y),u.push(p),u.push(n.sideTop),u.push(-1))),_.y>=o&&(_.x>d.x?(h.push(y),h.push(p),h.push(n.sideBottom),h.push(-1)):(u.push(y),u.push(p),u.push(n.sideBottom),u.push(-1)))),_=d}if(0!==h.length&&0!==u.length){e.fillParent(r,u,h),e.fillParent(r,h,u);var g=[];e.calcDeltas(g,u,h),e.calcDeltas(g,h,u),e.addDeltas(g,r)}}}},{key:"fillParent",value:function(e,t,i){for(var r=i.length,s=t.length,a=0;a<s;a+=4){for(var l=t[a],o=t[a+1],h=t[a+2],u=e[l][o-1],c=e[l][o],f=8092,d=-1,_=0;_<r;_+=4)if(i[_+2]===h){var v=i[_],p=i[_+1],g=e[v][p-1],m=e[v][p];switch(h){case n.sideLeft:case n.sideRight:if(y(u.y,g.y,m.y)&&y(c.y,g.y,m.y)){var x=Math.abs(m.y-g.y);x<f&&(f=x,d=_)}break;case n.sideTop:case n.sideBottom:if(y(u.x,g.x,m.x)&&y(c.x,g.x,m.x)){var k=Math.abs(m.x-g.x);k<f&&(f=k,d=_)}}}t[a+3]=d}}},{key:"calcDeltas",value:function(t,i,r){for(var n=i.length,s=0;s<n;s+=4){var a=e.calcDelta(s,i,r,[]);t.push(i[s]),t.push(i[s+1]),t.push(i[s+2]),t.push(a)}}},{key:"calcDelta",value:function(t,i,r,n){var s=i[t+3];if(-1===s)return 0;var a=n.length;return a>1&&n[a-2]===s?0:(n.push(s),e.calcDelta(s,r,i,n)+1)}},{key:"addDeltas",value:function(e,t){for(var i=e.length,r=0,s=0;s<i;s+=4){var a=e[s+3];a>r&&(r=a)}for(var l=0;l<i;l+=4){var o=t[e[l]],h=e[l+1],u=r-e[l+3];switch(e[l+2]){case n.sideLeft:o[h-1].x-=u,o[h].x-=u,1===h&&(o[o.length-1].x-=u),h===o.length-1&&(o[0].x-=u);break;case n.sideRight:o[h-1].x+=u,o[h].x+=u,1===h&&(o[o.length-1].x+=u),h===o.length-1&&(o[0].x+=u);break;case n.sideTop:o[h-1].y-=u,o[h].y-=u,1===h&&(o[o.length-1].y-=u),h===o.length-1&&(o[0].y-=u);break;case n.sideBottom:o[h-1].y+=u,o[h].y+=u,1===h&&(o[o.length-1].y+=u),h===o.length-1&&(o[0].y+=u)}}}}]),e}(),y=function(e,t,i){return e>=t&&e<=i||e>=i&&e<=t}},26554:function(e,t,i){i.d(t,{Y:function(){return o},m:function(){return h}});var r=i(37762),n=i(93433),s=i(46228),a=i(16889),l=function(e){return"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e};function o(e,t,i){var r=(0,a.fp)(Math.ceil(i)),n=l(t)?8*r:16*r,s=2*r;e.width=n,e.height=n;var o=e.getContext("2d");o.strokeStyle="#FFFFFF",o.lineWidth=r,o.beginPath(),"vertical"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSVertical"!==t||(o.moveTo(n/2,-s),o.lineTo(n/2,n+s)),"horizontal"!==t&&"cross"!==t&&"esriSFSCross"!==t&&"esriSFSHorizontal"!==t||(o.moveTo(-s,n/2),o.lineTo(n+s,n/2)),"forward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSDiagonalCross"!==t&&"esriSFSForwardDiagonal"!==t||(o.moveTo(-s,-s),o.lineTo(n+s,n+s),o.moveTo(n-s,-s),o.lineTo(n+s,s),o.moveTo(-s,n-s),o.lineTo(s,n+s)),"backward-diagonal"!==t&&"diagonal-cross"!==t&&"esriSFSBackwardDiagonal"!==t&&"esriSFSDiagonalCross"!==t||(o.moveTo(n+s,-s),o.lineTo(-s,n+s),o.moveTo(s,-s),o.lineTo(-s,s),o.moveTo(n+s,n-s),o.lineTo(n-s,n+s)),o.stroke();for(var h,u=o.getImageData(0,0,e.width,e.height),c=new Uint8Array(u.data),y=0;y<c.length;y+=4)h=c[y+3]/255,c[y]=c[y]*h,c[y+1]=c[y+1]*h,c[y+2]=c[y+2]*h;return[c,e.width,e.height]}function h(e,t){var i="Butt"===t,a="Square"===t,l=!i&&!a;e.length%2==1&&(e=[].concat((0,n.Z)(e),(0,n.Z)(e)));var o,h=15.5,u=0,c=(0,r.Z)(e);try{for(c.s();!(o=c.n()).done;){u+=o.value}}catch(R){c.e(R)}finally{c.f()}var y,f=Math.round(u*h),d=new Float32Array(31*f),_=7.75,v=0,p=0,g=.5,m=!0,x=(0,r.Z)(e);try{for(x.s();!(y=x.n()).done;){var k=y.value;for(v=p,p+=k*h;g<=p;){for(var w=.5;w<31;){var b=(w-.5)*f+g-.5,S=l?(w-h)*(w-h):Math.abs(w-h);d[b]=m?i?Math.max(Math.max(v+_-g,S),Math.max(g-p+_,S)):S:l?Math.min((g-v)*(g-v)+S,(g-p)*(g-p)+S):a?Math.min(Math.max(g-v,S),Math.max(p-g,S)):Math.min(Math.max(g-v+_,S),Math.max(p+_-g,S)),w++}g++}m=!m}}catch(R){x.e(R)}finally{x.f()}for(var T=d.length,Z=new Uint8Array(4*T),I=0;I<T;++I){var C=(l?Math.sqrt(d[I]):d[I])/h;(0,s.I)(C,Z,4*I)}return[Z,f,31]}},99201:function(e,t,i){i.d(t,{DQ:function(){return h},FM:function(){return r},Or:function(){return u},RD:function(){return n},k3:function(){return c},nF:function(){return l},sX:function(){return y},yF:function(){return s}});var r=Number.POSITIVE_INFINITY,n=Math.PI,s=2*n,a=128/n,l=n/180,o=1/Math.LN2;function h(e,t){return(e%=t)>=0?e:e+t}function u(e){return h(e*a,256)}function c(e){return Math.log(e)*o}function y(e,t,i){return e*(1-i)+t*i}},12233:function(e,t,i){i.d(t,{Z:function(){return s}});var r=i(15671),n=i(43144),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;(0,r.Z)(this,e),this.x=t,this.y=i,this.width=n,this.height=s}return(0,n.Z)(e,[{key:"isEmpty",get:function(){return this.width<=0||this.height<=0}},{key:"union",value:function(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}]),e}()},55067:function(e,t,i){i.d(t,{Z:function(){return v}});var r=i(37762),n=i(15671),s=i(43144),a=i(88301),l=i(61120),o=i(60136),h=i(29388),u=i(93169),c=i(80613),y=i(86438),f=i(52424),d=i(40655),_=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},v=function(e){(0,o.Z)(i,e);var t=(0,h.Z)(i);function i(e){var r;return(0,n.Z)(this,i),(r=t.call(this))._tileInfoView=e,r}return(0,s.Z)(i,[{key:"renderChildren",value:function(e){this.sortChildren(_),this.setStencilReference(e),(0,a.Z)((0,l.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,r=(0,a.Z)((0,l.Z)(i.prototype),"createRenderParams",this).call(this,e);return r.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,r.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),r}},{key:"prepareRenderPasses",value:function(e){var t=this,r=(0,a.Z)((0,l.Z)(i.prototype),"prepareRenderPasses",this).call(this,e);return r.push(e.registerRenderPass({name:"stencil",brushes:[d.Z],drawPhase:c.jx.DEBUG|c.jx.MAP|c.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,u.Z)("esri-tiles-debug")&&r.push(e.registerRenderPass({name:"tileInfo",brushes:[f.Z],drawPhase:c.jx.DEBUG,target:function(){return t.children}})),r}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,i=1,n=(0,r.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.stencilRef=i++}}catch(s){n.e(s)}finally{n.f()}}}]),i}(y.Z)},72900:function(e,t,i){i.d(t,{I:function(){return c}});var r=i(29439),n=i(15671),s=i(43144),a=i(60136),l=i(29388),o=i(22753),h=i(87422),u=i(73828),c=function(e){(0,a.Z)(i,e);var t=(0,l.Z)(i);function i(e,r,s,a,l,o){var h,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l,y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:o;return(0,n.Z)(this,i),(h=t.call(this)).triangleCountReportedInDebug=0,h.triangleCount=0,h.texture=null,h.key=new u.Z(e),h.resolution=r,h.x=s,h.y=a,h.width=l,h.height=o,h.rangeX=c,h.rangeY=y,h}return(0,s.Z)(i,[{key:"destroy",value:function(){this.texture&&(this.texture.dispose(),this.texture=null)}},{key:"setTransform",value:function(e){var t=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,n=e.toScreenNoRotation([0,0],[this.x,this.y]),s=(0,r.Z)(n,2),a=s[0],l=s[1],h=this.width/this.rangeX*t,u=this.height/this.rangeY*t;(0,o.s)(i,h,0,0,0,u,0,a,l,1),(0,o.m)(this.transforms.dvs,e.displayViewMat3,i)}}]),i}(h.s)},67258:function(e,t,i){i.r(t),i.d(t,{default:function(){return Ve}});var r=i(37762),n=i(74165),s=i(15861),a=i(15671),l=i(43144),o=i(88301),h=i(61120),u=i(60136),c=i(29388),y=i(27366),f=i(52639),d=i(84652),_=i(32718),v=i(92026),p=i(66978),g=i(49861),m=(i(25243),i(69912)),x=i(48732),k=i(65156),w=i(92975),b=i(10106),S=i(1413),T=i(35995),Z=i(70431),I=i(12233),C=function(){function e(t,i){(0,a.Z)(this,e),this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new I.Z(0,0,t,i))}return(0,l.Z)(e,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"allocate",value:function(e,t){if(e>this._width||t>this._height)return new I.Z;for(var i=null,r=-1,n=0;n<this._free.length;++n){var s=this._free[n];e<=s.width&&t<=s.height&&(null===i||s.y<=i.y&&s.x<=i.x)&&(i=s,r=n)}return null===i?new I.Z:(this._free.splice(r,1),i.width<i.height?(i.width>e&&this._free.push(new I.Z(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new I.Z(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new I.Z(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new I.Z(i.x,i.y+t,e,i.height-t))),new I.Z(i.x,i.y,e,t))}},{key:"release",value:function(e){for(var t=0;t<this._free.length;++t){var i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}]),e}(),R=i(8548),D=i(57808),M=i(52311),P=function(){function e(t,i,r){(0,a.Z)(this,e),this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new C(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}return(0,l.Z)(e,[{key:"getGlyphItems",value:function(e,t){var i,n=this,s=[],a=this._glyphSource,l=new Set,o=(0,r.Z)(t);try{for(o.s();!(i=o.n()).done;){var h=i.value,u=Math.floor(.00390625*h);l.add(u)}}catch(y){o.e(y)}finally{o.f()}var c=[];return l.forEach((function(t){var i=e+t;if(n._rangePromises.has(i))c.push(n._rangePromises.get(i));else{var r=a.getRange(e,t).then((function(){n._rangePromises.delete(i)}),(function(){n._rangePromises.delete(i)}));n._rangePromises.set(i,r),c.push(r)}})),Promise.all(c).then((function(){var i=n._glyphIndex[e];i||(i={},n._glyphIndex[e]=i);var l,o=(0,r.Z)(t);try{for(o.s();!(l=o.n()).done;){var h=l.value,u=i[h];if(u)s[h]={sdf:!0,rect:u.rect,metrics:u.metrics,page:u.page,code:h};else{var c=a.getGlyph(e,h);if(null!==c&&void 0!==c&&c.metrics){var f=c.metrics,d=void 0;if(0===f.width)d=new I.Z(0,0,0,0);else{var _=f.width+6,v=f.height+6,p=_%4?4-_%4:4,g=v%4?4-v%4:4;1===p&&(p=5),1===g&&(g=5),(d=n._binPack.allocate(_+p,v+g)).isEmpty&&(n._dirties[n._currentPage]||(n._glyphData[n._currentPage]=null),n._currentPage=n._glyphData.length,n._glyphData.push(new Uint8Array(n.width*n.height)),n._dirties.push(!0),n._textures.push(void 0),n._binPack=new C(n.width-4,n.height-4),d=n._binPack.allocate(_+p,v+g));var m=n._glyphData[n._currentPage],x=c.bitmap,k=void 0,w=void 0;if(x)for(var b=0;b<v;b++){k=_*b,w=n.width*(d.y+b+1)+d.x;for(var S=0;S<_;S++)m[w+S+1]=x.at(k+S)}}i[h]={rect:d,metrics:f,tileIDs:null,page:n._currentPage},s[h]={sdf:!0,rect:d,metrics:f,page:n._currentPage,code:h},n._dirties[n._currentPage]=!0}}}}catch(y){o.e(y)}finally{o.f()}return s}))}},{key:"removeGlyphs",value:function(e){for(var t in this._glyphIndex){var i=this._glyphIndex[t];if(i){var r=void 0;for(var n in i)if((r=i[n]).tileIDs.delete(e),0===r.tileIDs.size){for(var s=this._glyphData[r.page],a=r.rect,l=void 0,o=void 0,h=0;h<a.height;h++)for(l=this.width*(a.y+h)+a.x,o=0;o<a.width;o++)s[l+o]=0;delete i[n],this._dirties[r.page]=!0}}}}},{key:"bind",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!this._textures[i]){var n=new M.X;n.pixelFormat=R.VI.ALPHA,n.wrapMode=R.e8.CLAMP_TO_EDGE,n.width=this.width,n.height=this.height,this._textures[i]=new D.x(e,n,new Uint8Array(this.width*this.height))}var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(this._glyphData[i]),e.bindTexture(s,r),this._dirties[i]=!1}},{key:"destroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this._glyphData.length=0,this._binPack=null;var e,t=(0,r.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(n){t.e(n)}finally{t.f()}this._textures.length=0}}]),e}(),L=i(29439),A=i(76200),U=i(78084),O=function(){function e(t){if((0,a.Z)(this,e),this._metrics=[],t){for(var i=new Map,n=0;t.next();)if(1===t.tag()){for(var s=t.getMessage();s.next();)if(3===s.tag()){for(var l=s.getMessage(),o=void 0,h=void 0,u=void 0,c=void 0,y=void 0,f=void 0,d=void 0;l.next();)switch(l.tag()){case 1:o=l.getUInt32();break;case 2:h=l.getBytes();break;case 3:u=l.getUInt32();break;case 4:c=l.getUInt32();break;case 5:y=l.getSInt32();break;case 6:f=l.getSInt32();break;case 7:d=l.getUInt32();break;default:l.skip()}if(l.release(),o){var _,v,p=null!==(_=null===(v=h)||void 0===v?void 0:v.length)&&void 0!==_?_:0;this._metrics[o]={width:u,height:c,left:y,top:f,advance:d,startOffset:n,length:p},i.set(o,h),n+=p}}else s.skip();s.release()}else t.skip();var g,m=new Uint8Array(n),x=this._metrics,k=(0,r.Z)(i);try{for(k.s();!(g=k.n()).done;){var w=(0,L.Z)(g.value,2),b=w[0],S=w[1],T=x[b],Z=T.startOffset,I=T.length;if(S)for(var C=0;C<I;++C)m[Z+C]=S[C]}}catch(R){k.e(R)}finally{k.f()}this._allBitmaps=m}else this._allBitmaps=null}return(0,l.Z)(e,[{key:"getMetrics",value:function(e){return this._metrics[e]}},{key:"getBitmap",value:function(e){if(this._allBitmaps){var t=this._metrics[e];if(void 0!==t){var i=t.startOffset,r=t.length;return 0!==r?new F(this._allBitmaps,i,r):void 0}}}}]),e}(),V=function(){function e(){(0,a.Z)(this,e),this._ranges=[]}return(0,l.Z)(e,[{key:"ranges",get:function(){return this._ranges}},{key:"getRange",value:function(e){return this._ranges[e]}},{key:"addRange",value:function(e,t){this._ranges[e]=t}}]),e}(),E=function(){function e(t){(0,a.Z)(this,e),this._glyphInfo={},this._baseURL=t}return(0,l.Z)(e,[{key:"getRange",value:function(e,t){var i=this._getFontStack(e);if(i.getRange(t))return Promise.resolve();var r=256*t,n=r+255;if(this._baseURL){var s=this._baseURL.replace("{fontstack}",e).replace("{range}",r+"-"+n);return(0,A.Z)(s,{responseType:"array-buffer"}).then((function(e){i.addRange(t,new O(new U.Z(new Uint8Array(e.data),new DataView(e.data))))})).catch((function(){i.addRange(t,new O)}))}return i.addRange(t,new O),Promise.resolve()}},{key:"getGlyph",value:function(e,t){var i=this._getFontStack(e);if(i){var r=Math.floor(t/256),n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}}},{key:"_getFontStack",value:function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new V),t}}]),e}(),F=function(){function e(t,i,r){(0,a.Z)(this,e),this._array=t,this._start=i,this.length=r}return(0,l.Z)(e,[{key:"at",value:function(e){return 0<=e&&e<this.length?this._array[this._start+e]:void 0}}]),e}(),z=i(26554),H=function(){function e(t,i){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,a.Z)(this,e),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(t<=0||i<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=t,this._pageHeight=i,r>0&&(this._maxItemSize=r),this._binPack=new C(t-4,i-4)}return(0,l.Z)(e,[{key:"destroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};var e,t=(0,r.Z)(this._textures);try{for(t.s();!(e=t.n()).done;){var i=e.value;i&&i.dispose()}}catch(n){t.e(n)}finally{t.f()}this._textures.length=0}},{key:"getWidth",value:function(e){return e>=this._size.length?-1:this._size[e][0]}},{key:"getHeight",value:function(e){return e>=this._size.length?-1:this._size[e][1]}},{key:"getPageSize",value:function(e){return e>=this._size.length?null:this._size[e]}},{key:"setSpriteSource",value:function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new C(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),i=Math.floor(this._pageHeight),r=new Uint32Array(t*i);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}},{key:"getSpriteItem",value:function(e){var t,i,r,n,s,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=this._mosaicRects[e];if(l)return l;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith("dasharray-")?(t=this._rasterizeDash(e),n=(i=(0,L.Z)(t,2))[0],s=i[1],a=!0):n=this._sprites.getSpriteInfo(e),null===(r=n)||void 0===r||!r.width||!n.height||n.width<0||n.height<0)return null;var o=n.width,h=n.height,u=this._allocateImage(o,h),c=(0,L.Z)(u,3),y=c[0],f=c[1],d=c[2];return y.width<=0?null:(this._copy(y,n,f,d,a,s),l={rect:y,width:o,height:h,sdf:n.sdf,simplePattern:!1,pixelRatio:n.pixelRatio,page:f},this._mosaicRects[e]=l,l)}},{key:"getSpriteItems",value:function(e){var t,i={},n=(0,r.Z)(e);try{for(n.s();!(t=n.n()).done;){var s=t.value;i[s.name]=this.getSpriteItem(s.name,s.repeat)}}catch(a){n.e(a)}finally{n.f()}return i}},{key:"getMosaicItemPosition",value:function(e,t){var i=this.getSpriteItem(e,t),r=i&&i.rect;if(!r)return null;r.width=i.width,r.height=i.height;var n=i.width,s=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+n,r.y+2+s],page:i.page}}},{key:"bind",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!(i>=this._size.length||i>=this._mosaicsData.length)){if(!this._textures[i]){var n=new M.X;n.wrapMode=R.e8.CLAMP_TO_EDGE,n.width=this._size[i][0],n.height=this._size[i][1],this._textures[i]=new D.x(e,n,new Uint8Array(this._mosaicsData[i].buffer))}var s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(s,r),this._dirties[i]=!1}}},{key:"_copy",value:function(t,i,r,n,s,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(r>=this._mosaicsData.length)){var l=new Uint32Array(a?a.buffer:this._sprites.image.buffer),o=this._mosaicsData[r];o&&l||console.error("Source or target images are uninitialized!");var h=a?i.width:this._sprites.width;e._copyBits(l,h,i.x,i.y,o,n[0],t.x+2,t.y+2,i.width,i.height,s),this._dirties[r]=!0}}},{key:"_allocateImage",value:function(e,t){e+=2,t+=2;var i=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<i){var r=new I.Z(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[r,this._mosaicsData.length-1,[e,t]]}var n=e%4?4-e%4:4,s=t%4?4-t%4:4;1===n&&(n=5),1===s&&(s=5);var a=this._binPack.allocate(e+n,t+s);return a.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new C(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[a,this._currentPage,[this._pageWidth,this._pageHeight]]}},{key:"_rasterizeDash",value:function(e){var t=e.match(/\[(.*?)\]/);if(!t)return null;var i=t[1].split(",").map(Number),r=e.slice(e.lastIndexOf("-")+1),n=(0,z.m)(i,r),s=(0,L.Z)(n,3),a=s[0];return[{x:0,y:0,width:s[1],height:s[2],sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}],[{key:"_copyBits",value:function(e,t,i,r,n,s,a,l,o,h,u){var c=r*t+i,y=l*s+a;if(u){y-=s;for(var f=-1;f<=h;c=((++f+h)%h+r)*t+i,y+=s)for(var d=-1;d<=o;d++)n[y+d]=e[c+(d+o)%o]}else for(var _=0;_<h;_++){for(var v=0;v<o;v++)n[y+v]=e[c+v];c+=t,y+=s}}}]),e}(),B=i(73828),q=function(){function e(t,i,r){(0,a.Z)(this,e),this._layer=t,this._styleRepository=i,this.devicePixelRatio=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}return(0,l.Z)(e,[{key:"destroy",value:function(){var e,t,i;null!==(e=this._connection)&&void 0!==e&&e.close(),this._connection=null,this._styleRepository=null,this._layer=null,null!==(t=this._spriteMosaic)&&void 0!==t&&t.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=(0,v.IM)(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&null!==(i=this._startOptionsInputSignal)&&void 0!==i&&i.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}},{key:"spriteMosaic",get:function(){var e=this;return this._spriteSourcePromise.then((function(){return e._spriteMosaic}))}},{key:"glyphMosaic",get:function(){return this._glyphMosaic}},{key:"start",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var i,r,s=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._requestSprite(t),i=this._layer.currentStyleInfo.glyphsUrl,r=new E(i?(0,T.fl)(i,(0,S.Z)((0,S.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),this._glyphMosaic=new P(1024,1024,r),this._broadcastPromise=(0,Z.bA)("WorkerTileHandler",{client:this,schedule:t.schedule,signal:t.signal}).then((function(e){var i;if(s._layer&&(null!==(i=s._connection)&&void 0!==i&&i.close(),s._connection=e,s._layer&&!s._connection.closed)){var r=e.broadcast("setStyle",s._layer.currentStyleInfo.style,t);Promise.all(r).catch((function(e){return(0,p.H9)(e)}))}}));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_requestSprite",value:function(e){var t,i,r=this;null===(t=this._spriteSourceAbortController)||void 0===t||t.abort();var n=new AbortController;this._spriteSourceAbortController=n;var s=null===e||void 0===e?void 0:e.signal;this._inputSignalEventListener&&null!==(i=this._startOptionsInputSignal)&&void 0!==i&&i.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,s&&(this._inputSignalEventListener=function(e){return function(){return e.abort()}}(n),s.addEventListener("abort",this._inputSignalEventListener,{once:!0}));var a=n.signal,l=(0,S.Z)((0,S.Z)({},e),{},{signal:a});this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,l),this._spriteSourcePromise.then((function(e){(0,p.r9)(a),r._spriteMosaic=new H(1024,1024,250),r._spriteMosaic.setSpriteSource(e)}))}},{key:"updateStyle",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),e.abrupt("return",this._broadcastPromise);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSpriteSource",value:function(e){var t=new H(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),this._spriteSourceAbortController=null,t}},{key:"setStyle",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,i){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._broadcastPromise;case 2:return this._styleRepository=t,this._requestSprite(),r=new E(this._layer.currentStyleInfo.glyphsUrl?(0,T.fl)(this._layer.currentStyleInfo.glyphsUrl,(0,S.Z)((0,S.Z)({},this._layer.customParameters),{},{token:this._layer.apiKey})):null),e.abrupt("return",(this._glyphMosaic=new P(1024,1024,r),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",i)),this._broadcastPromise));case 6:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"fetchTileData",value:function(e,t){var i=this;return this._getRefKeys(e,t).then((function(e){var r=i._layer.sourceNameToSource,n=[];for(var s in r)n.push(s);return i._getSourcesData(n,e,t)}))}},{key:"parseTileData",value:function(e,t){var i=this,r=e&&e.data;if(!r)return Promise.resolve(null);var n=r.sourceName2DataAndRefKey,s=r.transferList;return 0===Object.keys(n).length?Promise.resolve(null):this._broadcastPromise.then((function(){return i._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:n,styleLayerUIDs:e.styleLayerUIDs},(0,S.Z)((0,S.Z)({},t),{},{transferList:s}))}))}},{key:"getSprites",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._spriteSourcePromise;case 2:return e.abrupt("return",this._spriteMosaic.getSpriteItems(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getGlyphs",value:function(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}},{key:"_getTilePayload",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,i,r){var s,a,l,o,h;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=B.Z.pool.acquire(t.id),a=this._layer.sourceNameToSource[i],l=s.level,o=s.row,h=s.col,B.Z.pool.release(s),e.prev=2,e.next=5,a.requestTile(l,o,h,r);case 5:return e.t0=e.sent,e.t1=i,e.abrupt("return",{protobuff:e.t0,sourceName:e.t1});case 10:if(e.prev=10,e.t2=e.catch(2),!(0,p.D_)(e.t2)){e.next=14;break}throw e.t2;case 14:return e.abrupt("return",{protobuff:null,sourceName:i});case 15:case"end":return e.stop()}}),e,this,[[2,10]])})));return function(t,i,r){return e.apply(this,arguments)}}()},{key:"_getRefKeys",value:function(e,t){var i=this._layer.sourceNameToSource,r=new Array;for(var n in i){var s=i[n].getRefKey(e,t);r.push(s)}return Promise.allSettled(r)}},{key:"_getSourcesData",value:function(e,t,i){for(var r=[],n=0;n<t.length;n++){var s=t[n],a="fulfilled"===s.status?s.value:null;if(null==a||null==e[n])r.push(null);else{var l=this._getTilePayload(a,e[n],i);r.push(l)}}return Promise.allSettled(r).then((function(e){for(var i={},r=[],n=0;n<e.length;n++){var s=e[n],a="fulfilled"===s.status?s.value:null,l=null===a||void 0===a?void 0:a.protobuff;if(a&&null!==l&&void 0!==l&&l.byteLength){var o=t[n],h="fulfilled"===o.status?o.value:null;if(h){var u=h.id;i[a.sourceName]={refKey:u,protobuff:l},r.push(l)}}}return{sourceName2DataAndRefKey:i,transferList:r}}))}}]),e}();var N=i(16054),W=i(48790),Q=function(e,t){return e+1/(1<<2*t)},J=function(){function e(t,i){(0,a.Z)(this,e),this._tiles=new Map,this._tileCache=new N.z(40,(function(e){return e.dispose()})),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=t.acquireTile,this.releaseTile=t.releaseTile,this.tileInfoView=t.tileInfoView,this._container=i}return(0,l.Z)(e,[{key:"destroy",value:function(){var e,t=(0,r.Z)(this._tiles);try{for(t.s();!(e=t.n()).done;){var i=(0,L.Z)(e.value,2);i[0];i[1].dispose()}}catch(n){t.e(n)}finally{t.f()}this._tiles=null,this._tileCache.clear(),this._tileCache=null}},{key:"update",value:function(e){this._updateCacheSize(e);var t=this.tileInfoView,i=t.getTileCoverage(e.state,0,!0,"smallest");if(!i)return!0;var n,s=i.spans,a=i.lodInfo,l=a.level,o=this._tiles,h=new Set,u=new Set,c=(0,r.Z)(s);try{for(c.s();!(n=c.n()).done;)for(var y=n.value,f=y.row,d=y.colFrom,_=y.colTo,v=d;v<=_;v++){var p=B.Z.getId(l,f,a.normalizeCol(v),a.getWorldForColumn(v)),g=this._getOrAcquireTile(p);h.add(p),g.processed()?this._addToContainer(g):u.add(new B.Z(p))}}catch(V){c.e(V)}finally{c.f()}var m,x=(0,r.Z)(o);try{for(x.s();!(m=x.n()).done;){var k=(0,L.Z)(m.value,2),w=k[0];k[1].isCoverage=h.has(w)}}catch(V){x.e(V)}finally{x.f()}var b,S=(0,r.Z)(u);try{for(S.s();!(b=S.n()).done;){var T=b.value;this._findPlaceholdersForMissingTiles(T,h)}}catch(V){S.e(V)}finally{S.f()}var Z,I=!1,C=(0,r.Z)(o);try{for(C.s();!(Z=C.n()).done;){var R=(0,L.Z)(Z.value,2),D=R[0],M=R[1];M.neededForCoverage=h.has(D),M.neededForCoverage||M.isHoldingForFade&&t.intersects(i,M.key)&&h.add(D),M.isFading&&(I=!0)}}catch(V){C.e(V)}finally{C.f()}var P,A=(0,r.Z)(this._tiles);try{for(A.s();!(P=A.n()).done;){var U=(0,L.Z)(P.value,2),O=U[0];U[1];h.has(O)||this._releaseTile(O)}}catch(V){A.e(V)}finally{A.f()}return W.Z.pool.release(i),!I}},{key:"clear",value:function(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}},{key:"clearCache",value:function(){this._tileCache.clear()}},{key:"_findPlaceholdersForMissingTiles",value:function(e,t){var i,n=[],s=(0,r.Z)(this._tiles);try{for(s.s();!(i=s.n()).done;){var a=(0,L.Z)(i.value,2),l=(a[0],a[1]);this._addPlaceholderChild(n,l,e,t)}}catch(h){s.e(h)}finally{s.f()}var o=n.reduce(Q,0);Math.abs(1-o)<1e-6||this._addPlaceholderParent(e.id,t)}},{key:"_addPlaceholderChild",value:function(e,t,i,r){t.key.level<=i.level||!t.hasData()||function(e,t){var i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}},{key:"_addPlaceholderParent",value:function(e,t){for(var i=this._tiles,r=e;;){if(!(r=G(r))||t.has(r))return;var n=i.get(r);if(n&&n.hasData())return this._addToContainer(n),void t.add(n.id)}}},{key:"_getOrAcquireTile",value:function(e){var t=this._tiles.get(e);return t||((t=this._tileCache.pop(e))||(t=this.acquireTile(new B.Z(e))),this._tiles.set(e,t),t)}},{key:"_releaseTile",value:function(e){var t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}},{key:"_addToContainer",value:function(e){var t,i=[],n=this._container;if(!n.contains(e)){var s,a=this._visibleTiles,l=(0,r.Z)(a);try{for(l.s();!(s=l.n()).done;){var o=(0,L.Z)(s.value,2),h=(o[0],o[1]);this._canConnectDirectly(e,h)&&i.push(h),null==t&&this._canConnectDirectly(h,e)&&(t=h)}}catch(v){l.e(v)}finally{l.f()}if(null!=t){var u,c=(0,r.Z)(i);try{for(c.s();!(u=c.n()).done;){var y=u.value;t.childrenTiles.delete(y),e.childrenTiles.add(y),y.parentTile=e}}catch(v){c.e(v)}finally{c.f()}t.childrenTiles.add(e),e.parentTile=t}else{var f,d=(0,r.Z)(i);try{for(d.s();!(f=d.n()).done;){var _=f.value;e.childrenTiles.add(_),_.parentTile=e}}catch(v){d.e(v)}finally{d.f()}}a.set(e.id,e),n.addChild(e)}}},{key:"_removeFromContainer",value:function(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),null!=e.parentTile){e.parentTile.childrenTiles.delete(e);var t,i=(0,r.Z)(e.childrenTiles);try{for(i.s();!(t=i.n()).done;){var n=t.value;null!=e.parentTile&&e.parentTile.childrenTiles.add(n)}}catch(l){i.e(l)}finally{i.f()}}var s,a=(0,r.Z)(e.childrenTiles);try{for(a.s();!(s=a.n()).done;){s.value.parentTile=e.parentTile}}catch(l){a.e(l)}finally{a.f()}e.parentTile=null,e.childrenTiles.clear()}},{key:"_canConnectDirectly",value:function(e,t){for(var i=e.key,r=t.key,n=r.level,s=r.row,a=r.col,l=r.world,o=this._visibleTiles;n>0;){if(n--,s>>=1,a>>=1,i.level===n&&i.row===s&&i.col===a&&i.world===l)return!0;if(o.has("".concat(n,"/").concat(s,"/").concat(a,"/").concat(l)))return!1}return!1}},{key:"_updateCacheSize",value:function(e){var t=e.state.size;if(t[0]!==this._viewSize[0]||t[1]!==this._viewSize[1]){var i=Math.ceil(t[0]/512)+1,r=Math.ceil(t[1]/512)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*r}}}]),e}();function G(e){var t=e.split("/"),i=(0,L.Z)(t,4),r=i[0],n=i[1],s=i[2],a=i[3],l=parseInt(r,10);return 0===l?null:"".concat(l-1,"/").concat(parseInt(n,10)>>1,"/").concat(parseInt(s,10)>>1,"/").concat(parseInt(a,10))}i(93169);var Y=i(22753),j=i(23588),K=i(18722),X=(0,l.Z)((function e(t){(0,a.Z)(this,e),this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=t})),$=(0,l.Z)((function e(){(0,a.Z)(this,e),this.tileSymbols=[],this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1}));function ee(e,t,i,r,n,s){var a=i-n;if(a>=0)return(t>>a)+(r-(s<<a))*(e>>a);var l=-a;return t-(s-(r<<l))*(e>>l)<<l}var te=function(){function e(t,i,r){(0,a.Z)(this,e),this._rows=Math.ceil(i/r),this._columns=Math.ceil(t/r),this._cellSize=r,this.cells=new Array(this._rows);for(var n=0;n<this._rows;n++){this.cells[n]=new Array(this._columns);for(var s=0;s<this._columns;s++)this.cells[n][s]=[]}}return(0,l.Z)(e,[{key:"getCell",value:function(e,t){var i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}},{key:"getCellSpan",value:function(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}},{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]),e}();function ie(e,t,i,n,s){var a=e.layerData.get(s);if(a.type===b.al.SYMBOL){var l,o=(0,r.Z)(n);try{for(o.s();!(l=o.n()).done;){var h=l.value,u=h.unique,c=void 0;if(h.selectedForRendering){var y=u.parts[0],f=y.startOpacity,d=y.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===d;var _=i?Math.floor(127*f)|d<<7:d?255:0;c=_<<24|_<<16|_<<8|_}else c=0;var v,p=(0,r.Z)(h.iconVertexRanges);try{for(p.s();!(v=p.n()).done;)for(var g=(0,L.Z)(v.value,2),m=g[0],x=g[1],k=m;k<m+x;k+=4)a.iconOpacity[k/4]=c}catch(A){p.e(A)}finally{p.f()}if(h.selectedForRendering){var w=u.parts[1],S=w.startOpacity,T=w.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===T;var Z=i?Math.floor(127*S)|T<<7:T?255:0;c=Z<<24|Z<<16|Z<<8|Z}else c=0;var I,C=(0,r.Z)(h.textVertexRanges);try{for(C.s();!(I=C.n()).done;)for(var R=(0,L.Z)(I.value,2),D=R[0],M=R[1],P=D;P<D+M;P+=4)a.textOpacity[P/4]=c}catch(A){C.e(A)}finally{C.f()}}}catch(A){o.e(A)}finally{o.f()}a.lastOpacityUpdate=t,a.opacityChanged=!0}}var re=i(44070),ne=i(45412),se=function(){function e(t,i){(0,a.Z)(this,e),this.layerUIDs=[],this.isDestroyed=!1,this._data=t;var r=1,n=new Uint32Array(t);this.layerUIDs=[];for(var s=n[r++],l=0;l<s;l++)this.layerUIDs[l]=n[r++];this.bufferDataOffset=r,i&&(this.layer=i.getStyleLayerByUID(this.layerUIDs[0]))}return(0,l.Z)(e,[{key:"isPreparedForRendering",get:function(){return null==this._data}},{key:"offset",get:function(){return this.bufferDataOffset}},{key:"data",get:function(){return this._data}},{key:"destroy",value:function(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}},{key:"prepareForRendering",value:function(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}]),e}(),ae=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e,r){var n;(0,a.Z)(this,i),(n=t.call(this,e,r)).type=b.al.LINE,n.lineIndexStart=0,n.lineIndexCount=0;var s=new Uint32Array(e),l=n.bufferDataOffset;n.lineIndexStart=s[l++],n.lineIndexCount=s[l++];var o=s[l++];if(o>0){n.patternMap=new Map;for(var h=0;h<o;h++){var u=s[l++],c=s[l++],y=s[l++];n.patternMap.set(u,[c,y])}}return n.bufferDataOffset=l,n}return(0,l.Z)(i,[{key:"memoryUsed",get:function(){var e,t,i,r;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(i=null===(r=this.vao)||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)}},{key:"hasData",value:function(){return this.lineIndexCount>0}},{key:"triangleCount",value:function(){return this.lineIndexCount/3}},{key:"doDestroy",value:function(){this.vao=(0,v.M2)(this.vao)}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],a=re.f.createVertex(e,R.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,s));i+=s;var l=r[i++],o=re.f.createIndex(e,R.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,l));i+=l;var h=this.layer.lineMaterial;this.vao=new ne.U(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},o)}}]),i}(se),le=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e,r){var n;(0,a.Z)(this,i),(n=t.call(this,e,r)).type=b.al.FILL,n.fillIndexStart=0,n.fillIndexCount=0,n.outlineIndexStart=0,n.outlineIndexCount=0;var s=new Uint32Array(e),l=n.bufferDataOffset;n.fillIndexStart=s[l++],n.fillIndexCount=s[l++],n.outlineIndexStart=s[l++],n.outlineIndexCount=s[l++];var o=s[l++];if(o>0){n.patternMap=new Map;for(var h=0;h<o;h++){var u=s[l++],c=s[l++],y=s[l++];n.patternMap.set(u,[c,y])}}return n.bufferDataOffset=l,n}return(0,l.Z)(i,[{key:"memoryUsed",get:function(){var e,t,i,r,n,s;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(i=null===(r=this.fillVAO)||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)+(null!==(n=null===(s=this.outlineVAO)||void 0===s?void 0:s.usedMemory)&&void 0!==n?n:0)}},{key:"hasData",value:function(){return this.fillIndexCount>0||this.outlineIndexCount>0}},{key:"triangleCount",value:function(){return(this.fillIndexCount+this.outlineIndexCount)/3}},{key:"doDestroy",value:function(){this.fillVAO=(0,v.M2)(this.fillVAO),this.outlineVAO=(0,v.M2)(this.outlineVAO)}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],a=re.f.createVertex(e,R.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,s));i+=s;var l=r[i++],o=re.f.createIndex(e,R.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,l));i+=l;var h=r[i++],u=re.f.createVertex(e,R.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;var c=r[i++],y=re.f.createIndex(e,R.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,c));i+=c;var f=this.layer,d=f.fillMaterial,_=f.outlineMaterial;this.fillVAO=new ne.U(e,d.getAttributeLocations(),d.getLayoutInfo(),{geometry:a},o),this.outlineVAO=new ne.U(e,_.getAttributeLocations(),_.getLayoutInfo(),{geometry:u},y)}}]),i}(se),oe=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e,r,n){var s;(0,a.Z)(this,i),(s=t.call(this,e,r)).type=b.al.SYMBOL,s.iconPerPageElementsMap=new Map,s.glyphPerPageElementsMap=new Map,s.symbolInstances=[],s.isIconSDF=!1,s.opacityChanged=!1,s.lastOpacityUpdate=0,s.symbols=[];var l=new Uint32Array(e),o=new Int32Array(e),h=new Float32Array(e),u=s.bufferDataOffset;s.isIconSDF=!!l[u++];for(var c=l[u++],y=0;y<c;y++){var f=l[u++],d=l[u++],_=l[u++];s.iconPerPageElementsMap.set(f,[d,_])}for(var v=l[u++],p=0;p<v;p++){var g=l[u++],m=l[u++],x=l[u++];s.glyphPerPageElementsMap.set(g,[m,x])}var k=l[u++],w=l[u++];return s.iconOpacity=new Int32Array(k),s.textOpacity=new Int32Array(w),u=function(e,t,i,r,n,s){for(var a=t[r++],l=0;l<a;l++){var o=new X(s);o.xTile=t[r++],o.yTile=t[r++],o.hash=t[r++],o.priority=t[r++];for(var h=t[r++],u=0;u<h;u++){var c=t[r++],y=t[r++],f=t[r++],d=t[r++],_=!!t[r++],v=t[r++],p=i[r++],g=i[r++],m=t[r++],x=t[r++];o.colliders.push({xTile:c,yTile:y,dxPixels:f,dyPixels:d,hard:_,partIndex:v,width:m,height:x,minLod:p,maxLod:g})}for(var k=e[r++],w=0;w<k;w++)o.textVertexRanges.push([e[r++],e[r++]]);for(var b=e[r++],S=0;S<b;S++)o.iconVertexRanges.push([e[r++],e[r++]]);n.push(o)}return r}(l,o,h,u,s.symbols,n),s.bufferDataOffset=u,s}return(0,l.Z)(i,[{key:"memoryUsed",get:function(){var e,t,i,r,n,s;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(i=null===(r=this.iconVAO)||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)+(null!==(n=null===(s=this.textVAO)||void 0===s?void 0:s.usedMemory)&&void 0!==n?n:0)+(0,K.Xw)(this.iconOpacity)+(0,K.Xw)(this.textOpacity)}},{key:"hasData",value:function(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}},{key:"triangleCount",value:function(){var e,t=0,i=(0,r.Z)(this.iconPerPageElementsMap);try{for(i.s();!(e=i.n()).done;){var n=(0,L.Z)(e.value,2);n[0];t+=n[1][1]}}catch(o){i.e(o)}finally{i.f()}var s,a=(0,r.Z)(this.glyphPerPageElementsMap);try{for(a.s();!(s=a.n()).done;){var l=(0,L.Z)(s.value,2);l[0];t+=l[1][1]}}catch(o){a.e(o)}finally{a.f()}return t/3}},{key:"doDestroy",value:function(){this.iconVAO=(0,v.M2)(this.iconVAO),this.textVAO=(0,v.M2)(this.textVAO)}},{key:"updateOpacityInfo",value:function(){if(this.opacityChanged){this.opacityChanged=!1;var e=this.iconOpacity,t=this.iconVAO.vertexBuffers.opacity;e.length>0&&e.byteLength===t.byteLength&&t.setSubData(e,0,0,e.length);var i=this.textOpacity,r=this.textVAO.vertexBuffers.opacity;i.length>0&&i.byteLength===r.byteLength&&r.setSubData(i,0,0,i.length)}}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],a=re.f.createVertex(e,R.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,s));i+=s;var l=r[i++],o=re.f.createIndex(e,R.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,l));i+=l;var h=r[i++],u=re.f.createVertex(e,R.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,h));i+=h;var c=r[i++],y=re.f.createIndex(e,R.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,c));i+=c;var f=re.f.createVertex(e,R.l1.STATIC_DRAW,this.iconOpacity.buffer),d=re.f.createVertex(e,R.l1.STATIC_DRAW,this.textOpacity.buffer),_=this.layer,v=_.iconMaterial,p=_.textMaterial;this.iconVAO=new ne.U(e,v.getAttributeLocations(),v.getLayoutInfo(),{geometry:a,opacity:f},o),this.textVAO=new ne.U(e,p.getAttributeLocations(),p.getLayoutInfo(),{geometry:u,opacity:d},y)}}]),i}(se),he=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e,r){var n;(0,a.Z)(this,i),(n=t.call(this,e,r)).type=b.al.CIRCLE,n.circleIndexStart=0,n.circleIndexCount=0;var s=new Uint32Array(e),l=n.bufferDataOffset;return n.circleIndexStart=s[l++],n.circleIndexCount=s[l++],n.bufferDataOffset=l,n}return(0,l.Z)(i,[{key:"memoryUsed",get:function(){var e,t,i,r;return(null!==(e=null===(t=this.data)||void 0===t?void 0:t.byteLength)&&void 0!==e?e:0)+(null!==(i=null===(r=this.vao)||void 0===r?void 0:r.usedMemory)&&void 0!==i?i:0)}},{key:"hasData",value:function(){return this.circleIndexCount>0}},{key:"triangleCount",value:function(){return this.circleIndexCount/3}},{key:"doDestroy",value:function(){this.vao=(0,v.M2)(this.vao)}},{key:"doPrepareForRendering",value:function(e,t,i){var r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],a=re.f.createVertex(e,R.l1.STATIC_DRAW,new Int32Array(n.buffer,4*i,s));i+=s;var l=r[i++],o=re.f.createIndex(e,R.l1.STATIC_DRAW,new Uint32Array(r.buffer,4*i,l));i+=l;var h=this.layer.circleMaterial;this.vao=new ne.U(e,h.getAttributeLocations(),h.getLayoutInfo(),{geometry:a},o)}}]),i}(se),ue=i(46618),ce=i(72900),ye=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e,r,n,s,l,o,h){var u,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return(0,a.Z)(this,i),(u=t.call(this,e,r,n,s,l,o,4096,4096)).styleRepository=h,u._memCache=c,u.type="vector-tile",u._referenced=0,u._hasSymbolBuckets=!1,u._memoryUsedByLayerData=0,u.layerData=new Map,u.status="loading",u.allSymbolsFadingOut=!1,u.lastOpacityUpdate=0,u.symbols=new Map,u.isCoverage=!1,u.neededForCoverage=!1,u.decluttered=!1,u.parentTile=null,u.childrenTiles=new Set,u._processed=!1,u._referenced=1,u.id=e.id,u}return(0,l.Z)(i,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<ue.v7}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<ue.v7)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"setData",value:function(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}},{key:"deleteLayerData",value:function(e){var t,i,n=!1,s=(0,r.Z)(e);try{for(s.s();!(i=s.n()).done;){var a=i.value,l=this.layerData.get(a);l&&(this._memoryUsedByLayerData-=l.memoryUsed,l.type===b.al.SYMBOL&&this.symbols.delete(a)&&(n=!0),l.destroy(),this.layerData.delete(a))}}catch(o){s.e(o)}finally{s.f()}null!==(t=this._memCache)&&void 0!==t&&t.updateSize(this.key.id,this,this._memoryUsedByLayerData),n&&this.emit("symbols-changed"),this.requestRender()}},{key:"processed",value:function(){return this._processed}},{key:"hasData",value:function(){return this.layerData.size>0}},{key:"dispose",value:function(){"unloaded"!==this.status&&(fe.delete(this),i._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=0,this.destroy(),this.status="unloaded")}},{key:"release",value:function(){return 0==--this._referenced&&(this.dispose(),this.stage=null,!0)}},{key:"retain",value:function(){++this._referenced}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsed",get:function(){return this._memoryUsedByLayerData+256}},{key:"changeDataImpl",value:function(e){var t=!1;if(e){var i,n=e.bucketsWithData,s=e.emptyBuckets,a=this._createRenderBuckets(n);if(s&&s.byteLength>0){var l,o=new Uint32Array(s),h=(0,r.Z)(o);try{for(h.s();!(l=h.n()).done;){var u=l.value;this._deleteLayerData(u)}}catch(m){h.e(m)}finally{h.f()}}var c,y=(0,r.Z)(a);try{for(y.s();!(c=y.n()).done;){var f=(0,L.Z)(c.value,2),d=f[0],_=f[1];this._deleteLayerData(d),_.type===b.al.SYMBOL&&(this.symbols.set(d,_.symbols),t=!0),this._memoryUsedByLayerData+=_.memoryUsed,this.layerData.set(d,_)}}catch(m){y.e(m)}finally{y.f()}null===(i=this._memCache)||void 0===i||i.updateSize(this.key.id,this,this.memoryUsed)}this._hasSymbolBuckets=!1;var v,p=(0,r.Z)(this.layerData);try{for(p.s();!(v=p.n()).done;){var g=(0,L.Z)(v.value,2);g[0];g[1].type===b.al.SYMBOL&&(this._hasSymbolBuckets=!0)}}catch(m){p.e(m)}finally{p.f()}t&&this.emit("symbols-changed")}},{key:"attachWithContext",value:function(e){this.stage={context:e,trashDisplayObject:function(e){e.processDetach()},untrashDisplayObject:function(){return!1}}}},{key:"setTransform",value:function(e){(0,o.Z)((0,h.Z)(i.prototype),"setTransform",this).call(this,e);var t=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*t,n=this.height/this.rangeY*t,s=[0,0];e.toScreen(s,[this.x,this.y]);var a=this.transforms.tileUnitsToPixels;(0,Y.g)(a),(0,Y.h)(a,a,s),(0,Y.r)(a,a,Math.PI*e.rotation/180),(0,Y.c)(a,a,[r,n,1])}},{key:"_createTransforms",value:function(){return{dvs:(0,j.c)(),tileMat3:(0,j.c)(),tileUnitsToPixels:(0,j.c)()}}},{key:"_createRenderBuckets",value:function(e){var t,i=new Map,n=new Map,s=(0,r.Z)(e);try{for(s.s();!(t=s.n()).done;){var a,l=t.value,o=this._deserializeBucket(l,n),h=(0,r.Z)(o.layerUIDs);try{for(h.s();!(a=h.n()).done;){var u=a.value;i.set(u,o)}}catch(c){h.e(c)}finally{h.f()}}}catch(c){s.e(c)}finally{s.f()}return i}},{key:"_deserializeBucket",value:function(e,t){var i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case b.al.FILL:i=new le(e,this.styleRepository);break;case b.al.LINE:i=new ae(e,this.styleRepository);break;case b.al.SYMBOL:i=new oe(e,this.styleRepository,this);break;case b.al.CIRCLE:i=new he(e,this.styleRepository)}return t.set(e,i),i}},{key:"_deleteLayerData",value:function(e){if(this.layerData.has(e)){var t=this.layerData.get(e);this._memoryUsedByLayerData-=t.memoryUsed,t.destroy(),this.layerData.delete(e)}}}],[{key:"_destroyRenderBuckets",value:function(e){if(e){var t,i=new Set,n=(0,r.Z)(e.values());try{for(n.s();!(t=n.n()).done;){var s=t.value;i.has(s)||(s.destroy(),i.add(s))}}catch(a){n.e(a)}finally{n.f()}e.clear()}}}]),i}(ce.I),fe=new Map;var de=i(76432),_e=i(21391);function ve(e,t,i,n,s,a){var l,o=n.iconRotationAlignment,h=n.textRotationAlignment,u=n.iconTranslate,c=n.iconTranslateAnchor,y=n.textTranslate,f=n.textTranslateAnchor,d=0,_=(0,r.Z)(e.colliders);try{for(_.s();!(l=_.n()).done;){var v=l.value,p=0===v.partIndex?u:y,g=(0,L.Z)(p,2),m=g[0],x=g[1],k=0===v.partIndex?c:f,w=v.minLod<=a&&a<=v.maxLod;d+=w?0:1,v.enabled=w,v.xScreen=v.xTile*s[0]+v.yTile*s[3]+s[6],v.yScreen=v.xTile*s[1]+v.yTile*s[4]+s[7],k===_e.fD.MAP?(v.xScreen+=i*m-t*x,v.yScreen+=t*m+i*x):(v.xScreen+=m,v.yScreen+=x),_e.aF.VIEWPORT===(0===v.partIndex?o:h)?(v.dxScreen=v.dxPixels,v.dyScreen=v.dyPixels):(v.dxScreen=i*(v.dxPixels+v.width/2)-t*(v.dyPixels+v.height/2)-v.width/2,v.dyScreen=t*(v.dxPixels+v.width/2)+i*(v.dyPixels+v.height/2)-v.height/2)}}catch(b){_.e(b)}finally{_.f()}e.colliders.length>0&&d===e.colliders.length&&(e.unique.show=!1)}var pe=function(){function e(t,i,n,s,l,o){(0,a.Z)(this,e),this._symbols=t,this._styleRepository=s,this._zoom=l,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new te(i,n,ue.cn),this._si=Math.sin(Math.PI*o/180),this._co=Math.cos(Math.PI*o/180);var h,u=(0,r.Z)(t);try{for(u.s();!(h=u.n()).done;){var c,y=h.value,f=(0,r.Z)(y.symbols);try{for(f.s();!(c=f.n()).done;){var d=c.value;this._allNeededMatrices.has(d.tile)||this._allNeededMatrices.set(d.tile,(0,j.a)(d.tile.transforms.tileUnitsToPixels))}}catch(_){f.e(_)}finally{f.f()}}}catch(_){u.e(_)}finally{u.f()}}return(0,l.Z)(e,[{key:"work",value:function(e){var t=this._gridIndex;function i(e){for(var i=e.xScreen+e.dxScreen,n=e.yScreen+e.dyScreen,s=i+e.width,a=n+e.height,l=t.getCellSpan(i,n,s,a),o=(0,L.Z)(l,4),h=o[0],u=o[1],c=o[2],y=o[3],f=u;f<=y;f++)for(var d=h;d<=c;d++){var _,v=t.cells[f][d],p=(0,r.Z)(v);try{for(p.s();!(_=p.n()).done;){var g=_.value,m=g.xScreen+g.dxScreen,x=g.yScreen+g.dyScreen,k=m+g.width,w=x+g.height;if(!(s<m||i>k||a<x||n>w))return!0}}catch(b){p.e(b)}finally{p.f()}}return!1}for(var n=performance.now();this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0)for(var s=this._symbols[this._currentLayerCursor],a=this._getProperties(s.styleLayerUID);this._currentSymbolCursor<s.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-n>e)return!1;var l=s.symbols[this._currentSymbolCursor];if(l.unique.show){ve(l,this._si,this._co,a,this._allNeededMatrices.get(l.tile),this._zoom);var o=l.unique;if(o.show){var h,u=a.iconAllowOverlap,c=a.iconIgnorePlacement,y=a.textAllowOverlap,f=a.textIgnorePlacement,d=(0,r.Z)(l.colliders);try{for(d.s();!(h=d.n()).done;){var _=h.value;if(_.enabled){var v=o.parts[_.partIndex];v.show&&!(_.partIndex?y:u)&&i(_)&&(_.hard?o.show=!1:v.show=!1)}}}catch(P){d.e(P)}finally{d.f()}if(o.show){var p,g=(0,r.Z)(l.colliders);try{for(g.s();!(p=g.n()).done;){var m=p.value;if(m.enabled&&(!(m.partIndex?f:c)&&o.parts[m.partIndex].show))for(var x=m.xScreen+m.dxScreen,k=m.yScreen+m.dyScreen,w=x+m.width,b=k+m.height,S=this._gridIndex.getCellSpan(x,k,w,b),T=(0,L.Z)(S,4),Z=T[0],I=T[1],C=T[2],R=T[3],D=I;D<=R;D++)for(var M=Z;M<=C;M++)this._gridIndex.cells[D][M].push(m)}}catch(P){g.e(P)}finally{g.f()}}}}}return!0}},{key:"_getProperties",value:function(e){var t=this._styleProps.get(e);if(t)return t;var i=this._zoom,r=this._styleRepository.getStyleLayerByUID(e),n=r.getLayoutValue("symbol-placement",i)!==_e.R.POINT,s=r.getLayoutValue("icon-rotation-alignment",i);s===_e.aF.AUTO&&(s=n?_e.aF.MAP:_e.aF.VIEWPORT);var a=r.getLayoutValue("text-rotation-alignment",i);a===_e.aF.AUTO&&(a=n?_e.aF.MAP:_e.aF.VIEWPORT);var l=r.getPaintValue("icon-translate",i),o=r.getPaintValue("icon-translate-anchor",i),h=r.getPaintValue("text-translate",i),u=r.getPaintValue("text-translate-anchor",i),c={iconAllowOverlap:r.getLayoutValue("icon-allow-overlap",i),iconIgnorePlacement:r.getLayoutValue("icon-ignore-placement",i),textAllowOverlap:r.getLayoutValue("text-allow-overlap",i),textIgnorePlacement:r.getLayoutValue("text-ignore-placement",i),iconRotationAlignment:s,textRotationAlignment:a,iconTranslateAnchor:o,iconTranslate:l,textTranslateAnchor:u,textTranslate:h};return this._styleProps.set(e,c),c}}]),e}();function ge(e,t){if(e.priority-t.priority)return e.priority-t.priority;var i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}var me=function(){function e(t,i,r,n,s,l){(0,a.Z)(this,e),this._visibleTiles=t,this._symbolRepository=i,this._createCollisionJob=r,this._assignTileSymbolsOpacity=n,this._symbolLayerSorter=s,this._isLayerVisible=l,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}return(0,l.Z)(e,[{key:"running",get:function(){return this._running}},{key:"setScreenSize",value:function(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}},{key:"restart",value:function(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}},{key:"continue",value:function(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){var t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){var i=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-i))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){var r=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-r))))return!1}return this._running=!1,!0}},{key:"_createSelectionJob",value:function(){for(var e=this._symbolRepository.uniqueSymbols,t=0;t<e.length;t++)for(var i=e[t],n=0;n<i.uniqueSymbols.length;n++){var s,a=i.uniqueSymbols[n],l=(0,r.Z)(a.tileSymbols);try{for(l.s();!(s=l.n()).done;){s.value.selectedForRendering=!1}}catch(f){l.e(f)}finally{l.f()}}var o=[],h=0,u=0,c=this._isLayerVisible;var y=this._symbolLayerSorter;return{work:function(t){for(var i,n=performance.now();u<e.length;u++,h=0){var s=e[u],a=s.styleLayerUID;if(c(a)){o[u]=o[u]||{styleLayerUID:a,symbols:[]};for(var l=o[u];h<s.uniqueSymbols.length;h++){if(i=s.uniqueSymbols[h],h%100==99&&performance.now()-n>t)return!1;var y,d=null,_=!1,v=!1,p=(0,r.Z)(i.tileSymbols);try{for(p.s();!(y=p.n()).done;){var g=y.value;if(!v||!_){var m=g.tile;(!d||m.isCoverage||m.neededForCoverage&&!_)&&(d=g,(m.neededForCoverage||m.isCoverage)&&(v=!0),m.isCoverage&&(_=!0))}}}catch(f){p.e(f)}finally{p.f()}if(d.selectedForRendering=!0,v){l.symbols.push(d),i.show=!0;var x,k=(0,r.Z)(i.parts);try{for(k.s();!(x=k.n()).done;){x.value.show=!0}}catch(f){k.e(f)}finally{k.f()}}else i.show=!1}}else o[u]||(o[u]={styleLayerUID:a,symbols:[]})}var w,b=(0,r.Z)(o);try{for(b.s();!(w=b.n()).done;){w.value.symbols.sort(ge)}}catch(f){b.e(f)}finally{b.f()}return!0},get sortedSymbols(){return o.sort(y)}}}},{key:"_createOpacityJob",value:function(){var e=this._assignTileSymbolsOpacity,t=this._visibleTiles,i=0;function n(t,i){var s,a=t.symbols,l=(0,r.Z)(a);try{for(l.s();!(s=l.n()).done;){var o=(0,L.Z)(s.value,2);o[0];xe(o[1],i)}}catch(c){l.e(c)}finally{l.f()}e(t,i);var h,u=(0,r.Z)(t.childrenTiles);try{for(u.s();!(h=u.n()).done;){n(h.value,i)}}catch(c){u.e(c)}finally{u.f()}}return{work:function(e){for(var r=performance.now();i<t.length;i++){if(performance.now()-r>e)return!1;var s=t[i];null==s.parentTile&&n(s,performance.now())}return!0}}}}]),e}();function xe(e,t){var i,n=(0,r.Z)(e);try{for(n.s();!(i=n.n()).done;){var s,a=i.value.unique,l=(0,r.Z)(a.parts);try{for(l.s();!(s=l.n()).done;){var o=s.value,h=o.targetOpacity>.5?1:-1;o.startOpacity+=h*((t-o.startTime)/ue.v7),o.startOpacity=Math.min(Math.max(o.startOpacity,0),1),o.startTime=t,o.targetOpacity=a.show&&o.show?1:0}}catch(u){l.e(u)}finally{l.f()}}}catch(u){n.e(u)}finally{n.f()}}var ke=function(){function e(t,i,r){(0,a.Z)(this,e),this.tileCoordRange=t,this._visibleTiles=i,this._createUnique=r,this._tiles=new Map,this._uniqueSymbolsReferences=new Map}return(0,l.Z)(e,[{key:"uniqueSymbols",get:function(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}},{key:"add",value:function(e,t){this._uniqueSymbolLayerArray=null;var i=this._tiles.get(e.id);i||(i={symbols:new Map},this._tiles.set(e.id,i));var n=new Map;if(t){var s,a=(0,r.Z)(t);try{for(a.s();!(s=a.n()).done;){var l=s.value;i.symbols.has(l)&&(n.set(l,i.symbols.get(l)),i.symbols.delete(l))}}catch(T){a.e(T)}finally{a.f()}}else{var o,h=(0,r.Z)(e.layerData);try{for(h.s();!(o=h.n()).done;){var u=(0,L.Z)(o.value,2),c=u[0];u[1];i.symbols.has(c)&&(n.set(c,i.symbols.get(c)),i.symbols.delete(c))}}catch(T){h.e(T)}finally{h.f()}}this._removeSymbols(n);var y,f=e.symbols,d=new Map,_=(0,r.Z)(f);try{for(_.s();!(y=_.n()).done;){var v=(0,L.Z)(y.value,2),p=v[0],g=v[1],m=g.length;if(m>=32){var x=this.tileCoordRange;do{x/=2,m/=4}while(m>8&&x>64);var k=new te(this.tileCoordRange,this.tileCoordRange,x);d.set(p,{flat:g,index:k}),i.symbols.set(p,{flat:g,index:k});var w,b=(0,r.Z)(g);try{for(b.s();!(w=b.n()).done;){var S=w.value;k.getCell(S.xTile,S.yTile).push(S)}}catch(T){b.e(T)}finally{b.f()}}else d.set(p,{flat:g}),i.symbols.set(p,{flat:g})}}catch(T){_.e(T)}finally{_.f()}this._addSymbols(e.key,f)}},{key:"deleteStyleLayers",value:function(e){this._uniqueSymbolLayerArray=null;var t,i=(0,r.Z)(this._tiles);try{for(i.s();!(t=i.n()).done;){var n,s=(0,L.Z)(t.value,2),a=s[0],l=s[1],o=new Map,h=(0,r.Z)(e);try{for(h.s();!(n=h.n()).done;){var u=n.value;l.symbols.has(u)&&(o.set(u,l.symbols.get(u)),l.symbols.delete(u))}}catch(c){h.e(c)}finally{h.f()}this._removeSymbols(o),0===l.symbols.size&&this._tiles.delete(a)}}catch(c){i.e(c)}finally{i.f()}}},{key:"removeTile",value:function(e){this._uniqueSymbolLayerArray=null;var t=this._tiles.get(e.id);if(t){var i,n=new Map,s=(0,r.Z)(e.symbols);try{for(s.s();!(i=s.n()).done;){var a=(0,L.Z)(i.value,2),l=a[0];a[1];t.symbols.has(l)&&(n.set(l,t.symbols.get(l)),t.symbols.delete(l))}}catch(o){s.e(o)}finally{s.f()}this._removeSymbols(n),0===t.symbols.size&&this._tiles.delete(e.id)}}},{key:"_removeSymbols",value:function(e){var t,i=(0,r.Z)(e);try{for(i.s();!(t=i.n()).done;){var n,s=(0,L.Z)(t.value,2),a=s[0],l=s[1].flat,o=(0,r.Z)(l);try{for(o.s();!(n=o.n()).done;){for(var h=n.value,u=h.unique,c=u.tileSymbols,y=c.length-1,f=0;f<y;f++)if(c[f]===h){c[f]=c[y];break}if(c.length=y,0===y){var d=this._uniqueSymbolsReferences.get(a);d.delete(u),0===d.size&&this._uniqueSymbolsReferences.delete(a)}h.unique=null}}catch(_){o.e(_)}finally{o.f()}}}catch(_){i.e(_)}finally{i.f()}}},{key:"_addSymbols",value:function(e,t){if(0!==t.size){var i,n=this._visibleTiles,s=(0,r.Z)(n);try{for(s.s();!(i=s.n()).done;){var a=i.value;a.parentTile||a.key.world!==e.world||a.key.level===e.level&&!a.key.equals(e)||this._matchSymbols(a,e,t)}}catch(p){s.e(p)}finally{s.f()}var l,o=(0,r.Z)(t);try{for(o.s();!(l=o.n()).done;){var h,u=(0,L.Z)(l.value,2),c=u[0],y=u[1],f=(0,r.Z)(y);try{for(f.s();!(h=f.n()).done;){var d=h.value;if(null==d.unique){var _=this._createUnique();d.unique=_,_.tileSymbols.push(d);var v=this._uniqueSymbolsReferences.get(c);v||(v=new Set,this._uniqueSymbolsReferences.set(c,v)),v.add(_)}}}catch(p){f.e(p)}finally{f.f()}}}catch(p){o.e(p)}finally{o.f()}}}},{key:"_matchSymbols",value:function(e,t,i){if(e.key.level>t.level){var n=e.key.level-t.level;if(e.key.row>>n!==t.row||e.key.col>>n!==t.col)return}if(t.level>e.key.level){var s=t.level-e.key.level;if(t.row>>s!==e.key.row||t.col>>s!==e.key.col)return}if(t.equals(e.key)){var a,l=(0,r.Z)(e.childrenTiles);try{for(l.s();!(a=l.n()).done;){var o=a.value;this._matchSymbols(o,t,i)}}catch(B){l.e(B)}finally{l.f()}}else{var h,u=new Map,c=(0,r.Z)(i);try{for(c.s();!(h=c.n()).done;){var y,f=(0,L.Z)(h.value,2),d=f[0],_=f[1],v=[],p=(0,r.Z)(_);try{for(p.s();!(y=p.n()).done;){var g=y.value,m=ee(this.tileCoordRange,g.xTile,t.level,t.col,e.key.level,e.key.col),x=ee(this.tileCoordRange,g.yTile,t.level,t.row,e.key.level,e.key.row);m>=0&&m<this.tileCoordRange&&x>=0&&x<this.tileCoordRange&&v.push({symbol:g,xTransformed:m,yTransformed:x})}}catch(B){p.e(B)}finally{p.f()}var k=[],w=e.key.level<t.level?1:1<<e.key.level-t.level,b=this._tiles.get(e.id).symbols.get(d);if(b){var S,T=b.flat,Z=(0,r.Z)(v);try{for(Z.s();!(S=Z.n()).done;){var I,C=S.value,R=!1,D=C.xTransformed,M=C.yTransformed;I=null!=b.index?b.index.getCell(D,M):T;var P,A=C.symbol,U=A.hash,O=(0,r.Z)(I);try{for(O.s();!(P=O.n()).done;){var V=P.value;if(U===V.hash&&Math.abs(D-V.xTile)<=w&&Math.abs(M-V.yTile)<=w){var E=V.unique;A.unique=E,E.tileSymbols.push(A),R=!0;break}}}catch(B){O.e(B)}finally{O.f()}R||k.push(A)}}catch(B){Z.e(B)}finally{Z.f()}}k.length>0&&u.set(d,k)}}catch(B){c.e(B)}finally{c.f()}var F,z=(0,r.Z)(e.childrenTiles);try{for(z.s();!(F=z.n()).done;){var H=F.value;this._matchSymbols(H,t,u)}}catch(B){z.e(B)}finally{z.f()}}}},{key:"_createUniqueSymbolLayerArray",value:function(){var e,t,i=this._uniqueSymbolsReferences,n=new Array(i.size),s=0,a=(0,r.Z)(i);try{for(a.s();!(t=a.n()).done;){var l=(0,L.Z)(t.value,2),o=l[0],h=l[1],u=new Array(h.size);e=0;var c,y=(0,r.Z)(h);try{for(y.s();!(c=y.n()).done;){var f=c.value;u[e++]=f}}catch(d){y.e(d)}finally{y.f()}n[s]={styleLayerUID:o,uniqueSymbols:u},s++}}catch(d){a.e(d)}finally{a.f()}return n}}]),e}(),we=1e-6,be=function(){function e(t,i){var n=this;(0,a.Z)(this,e),this.styleRepository=t,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._completed=!1,this._fading=(0,de.t)(!1),this._symbolRepository=new ke(4096,i,(function(){return new $})),this._symbolDeclutterer=new me(i,this._symbolRepository,(function(e,t,i){return new pe(e,t,i,n.styleRepository,n._zoom,n._viewState.rotation)}),(function(e,t){e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,function(e,t,i){var n,s=(0,r.Z)(e.symbols);try{for(s.s();!(n=s.n()).done;){var a=(0,L.Z)(n.value,2),l=a[0];ie(e,t,i,a[1],l)}}catch(o){s.e(o)}finally{s.f()}}(e,t,!0),e.decluttered=!0,e.requestRender()}),(function(e,t){return n.styleRepository.getStyleLayerByUID(e.styleLayerUID).z-n.styleRepository.getStyleLayerByUID(t.styleLayerUID).z}),(function(e){var t=n.styleRepository.getStyleLayerByUID(e);if(n._zoom+we<t.minzoom||n._zoom-we>=t.maxzoom)return!1;var i=t.getLayoutProperty("visibility");return!i||i.getValue()!==_e.EE.NONE}))}return(0,l.Z)(e,[{key:"fading",get:function(){return this._fading.value}},{key:"addTile",value:function(e){var t=this;e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",(function(){t._symbolRepository.add(e),t.restartDeclutter()}))),this._symbolRepository.add(e),this.restartDeclutter()}},{key:"removeTile",value:function(e){var t=this._tileToHandle.get(e);t&&(this._symbolRepository.removeTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}},{key:"update",value:function(e,t){return this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]},this._continueDeclutter(),this._completed}},{key:"restartDeclutter",value:function(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}},{key:"clear",value:function(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach((function(e){return e.remove()})),this._tileToHandle.clear()}},{key:"stale",get:function(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}},{key:"deleteStyleLayers",value:function(e){this._symbolRepository.deleteStyleLayers(e)}},{key:"_continueDeclutter",value:function(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(ue.JM),this._completed&&this._scheduleNotifyStable())}},{key:"_scheduleNotifyStable",value:function(){var e=this;null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout((function(){e._stableNotificationHandle=null,e._fading.value=!1}),1.5*ue.v7)}},{key:"_notifyUnstable",value:function(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}}]),e}(),Se=i(80613),Te=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,l.Z)(i,[{key:"_createTransforms",value:function(){return{dvs:(0,j.c)(),tileMat3:(0,j.c)()}}}]),i}(ce.I),Ze=i(55067),Ie=1e-6;function Ce(e,t){if(e){var i=e.getLayoutProperty("visibility");if(!i||i.getValue()!==_e.EE.NONE&&(void 0===e.minzoom||e.minzoom<t+Ie)&&(void 0===e.maxzoom||e.maxzoom>=t-Ie))return!0}return!1}var Re=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e){var r;return(0,a.Z)(this,i),(r=t.call(this,e))._backgroundTiles=[],r._pointToCallbacks=new Map,r}return(0,l.Z)(i,[{key:"destroy",value:function(){var e,t;this.removeAllChildren(),null!==(e=this._spriteMosaic)&&void 0!==e&&e.dispose(),this._spriteMosaic=null,null!==(t=this._glyphMosaic)&&void 0!==t&&t.dispose(),this._glyphMosaic=null,null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[],this._pointToCallbacks.clear()}},{key:"fading",get:function(){var e,t;return null!==(e=null===(t=this._symbolFader)||void 0===t?void 0:t.fading)&&void 0!==e&&e}},{key:"setStyleResources",value:function(e,t,i){this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,null==this._symbolFader&&(this._symbolFader=new be(this._styleRepository,this.children)),this._symbolFader.styleRepository=i}},{key:"setSpriteMosaic",value:function(e){var t;null!==(t=this._spriteMosaic)&&void 0!==t&&t.dispose(),this._spriteMosaic=e}},{key:"deleteStyleLayers",value:function(e){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(e)}},{key:"hitTest",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t){var i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,p.hh)(),e.abrupt("return",(this._pointToCallbacks.set(t,i),this.requestRender(),i.promise));case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createRenderParams",value:function(e){return(0,S.Z)((0,S.Z)({},(0,o.Z)((0,h.Z)(i.prototype),"createRenderParams",this).call(this,e)),{},{renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos})}},{key:"doRender",value:function(e){!this.visible||e.drawPhase!==Se.jx.MAP&&e.drawPhase!==Se.jx.DEBUG||void 0===this._spriteMosaic||(0,o.Z)((0,h.Z)(i.prototype),"doRender",this).call(this,e)}},{key:"addChild",value:function(e){return(0,o.Z)((0,h.Z)(i.prototype),"addChild",this).call(this,e),null!=this._symbolFader?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}},{key:"removeChild",value:function(e){return null!=this._symbolFader&&this._symbolFader.removeTile(e),this.requestRender(),(0,o.Z)((0,h.Z)(i.prototype),"removeChild",this).call(this,e)}},{key:"renderChildren",value:function(e){var t=e.drawPhase;if(t!==Se.jx.DEBUG){if(this._doRender(e),this._pointToCallbacks.size>0){e.drawPhase=Se.jx.HITTEST;var r=e.painter.effects.hittestVTL;r.bind(e),this._doRender(e),r.draw(e,this._pointToCallbacks),r.unbind(e),e.drawPhase=t}}else(0,o.Z)((0,h.Z)(i.prototype),"renderChildren",this).call(this,e)}},{key:"removeAllChildren",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];null!=this._symbolFader&&this._symbolFader.removeTile(t),t.dispose()}(0,o.Z)((0,h.Z)(i.prototype),"removeAllChildren",this).call(this)}},{key:"getStencilTarget",value:function(){return this.children.filter((function(e){return e.neededForCoverage&&e.hasData()}))}},{key:"restartDeclutter",value:function(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}},{key:"_doRender",value:function(e){var t=e.context,n=this._styleRepository;if(n){var s=n.layers,a=!0;e.drawPhase===Se.jx.HITTEST&&(a=!1),n.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,n.backgroundBucketIds)),(0,o.Z)((0,h.Z)(i.prototype),"renderChildren",this).call(this,e),e.drawPhase===Se.jx.MAP&&this._fade(e.displayLevel,e.state);var l=this.children.filter((function(e){return e.visible&&e.hasData()}));if(!l||0===l.length)return t.bindVAO(),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);var u,c=(0,r.Z)(l);try{for(c.s();!(u=c.n()).done;){u.value.triangleCount=0}}catch(d){c.e(d)}finally{c.f()}t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(R.xS.KEEP,R.xS.KEEP,R.xS.REPLACE),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(R.wb.LEQUAL),t.setClearDepth(1),t.clear(t.gl.DEPTH_BUFFER_BIT),e.renderPass="opaque";for(var y=s.length-1;y>=0;y--)this._renderStyleLayer(s[y],e,l);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(a),t.setBlendFunctionSeparate(R.zi.ONE,R.zi.ONE_MINUS_SRC_ALPHA,R.zi.ONE,R.zi.ONE_MINUS_SRC_ALPHA),e.renderPass="translucent";for(var f=0;f<s.length;f++)this._renderStyleLayer(s[f],e,l);t.bindVAO(),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0)}}},{key:"_fade",value:function(e,t){null!=this._symbolFader&&(this._symbolFader.update(e,t)||this.requestRender())}},{key:"_renderStyleLayer",value:function(e,t,i){var n=t.painter,s=t.renderPass;if(void 0!==e){var a=e.getLayoutProperty("visibility");if(!a||a.getValue()!==_e.EE.NONE){var l;switch(e.type){case _e.fR.BACKGROUND:return;case _e.fR.FILL:if("opaque"!==s&&"translucent"!==t.renderPass)return;l="vtlFill";break;case _e.fR.LINE:if("translucent"!==s)return;l="vtlLine";break;case _e.fR.CIRCLE:if("translucent"!==s)return;l="vtlCircle";break;case _e.fR.SYMBOL:if("translucent"!==s)return;l="vtlSymbol"}if(i=e.type===_e.fR.SYMBOL?i.filter((function(e){return e.decluttered})):i.filter((function(e){return e.neededForCoverage})),"vtlSymbol"!==l){var o=t.displayLevel;if(0===i.length||void 0!==e.minzoom&&e.minzoom>=o+Ie||void 0!==e.maxzoom&&e.maxzoom<o-Ie)return}var h=e.uid;t.styleLayerUID=h,t.styleLayer=e;var u,c=(0,r.Z)(i);try{for(c.s();!(u=c.n()).done;){if(u.value.layerData.has(h)){n.renderObjects(t,i,l);break}}}catch(y){c.e(y)}finally{c.f()}}}}},{key:"_renderBackgroundLayers",value:function(e,t){var i,n=e.context,s=e.displayLevel,a=e.painter,l=e.state,o=this._styleRepository,h=!1,u=(0,r.Z)(t);try{for(u.s();!(i=u.n()).done;){var c=i.value;if(o.getLayerById(c).type===_e.fR.BACKGROUND&&Ce(o.getLayerById(c),s)){h=!0;break}}}catch(F){u.e(F)}finally{u.f()}if(h){var y=this._tileInfoView.getTileCoverage(e.state,0,!0,"smallest"),f=y.spans,d=y.lodInfo,_=d.level,v=(0,k.Ue)(),p=[];if(this._renderPasses){var g=this._renderPasses[0];null!=this._clippingInfos&&(g.brushes[0].prepareState(e),g.brushes[0].drawMany(e,this._clippingInfos))}var m,x,w=this._backgroundTiles,b=0,S=(0,r.Z)(f);try{for(S.s();!(x=S.n()).done;)for(var T=x.value,Z=T.row,I=T.colFrom,C=T.colTo,D=I;D<=C;D++){if(b<w.length)(m=w[b]).key.set(_,Z,d.normalizeCol(D),d.getWorldForColumn(D)),this._tileInfoView.getTileBounds(v,m.key,!1),m.x=v[0],m.y=v[3],m.resolution=this._tileInfoView.getTileResolution(_);else{var M=new B.Z(_,Z,d.normalizeCol(D),d.getWorldForColumn(D)),P=this._tileInfoView.getTileBounds((0,k.Ue)(),M),L=this._tileInfoView.getTileResolution(_);m=new Te(M,L,P[0],P[3],512,512,4096,4096),w.push(m)}m.setTransform(l),p.push(m),b++}}catch(F){S.e(F)}finally{S.f()}n.setStencilWriteMask(0),n.setColorMask(!0,!0,!0,!0),n.setStencilOp(R.xS.KEEP,R.xS.KEEP,R.xS.REPLACE),n.setStencilFunction(R.wb.EQUAL,0,255);var A=!0;e.drawPhase===Se.jx.HITTEST&&(A=!1),n.setStencilTestEnabled(A);var U,O=(0,r.Z)(t);try{for(O.s();!(U=O.n()).done;){var V=U.value,E=o.getLayerById(V);E.type===_e.fR.BACKGROUND&&Ce(E,s)&&(e.styleLayerUID=E.uid,e.styleLayer=E,a.renderObjects(e,p,"vtlBackground"))}}catch(F){O.e(F)}finally{O.f()}W.Z.pool.release(y)}}}]),i}(Ze.Z),De=i(30969),Me=i(95986),Pe=i(22824),Le=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments))._fullCacheLodInfos=null,e._levelByScale={},e}return(0,l.Z)(i,[{key:"getTileParentId",value:function(e){var t=B.Z.pool.acquire(e),i=0===t.level?null:B.Z.getId(t.level-1,t.row>>1,t.col>>1,t.world);return B.Z.pool.release(t),i}},{key:"getTileCoverage",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3?arguments[3]:void 0,s=(0,o.Z)((0,h.Z)(i.prototype),"getTileCoverage",this).call(this,e,t,r,n);if(!s)return s;var a=1<<s.lodInfo.level;return s.spans=s.spans.filter((function(e){return e.row>=0&&e.row<a})),s}},{key:"scaleToLevel",value:function(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];var t,i,r=this._fullCacheLodInfos;if(e>r[0].scale)return r[0].level;for(var n=0;n<r.length-1;n++)if(e>(i=r[n+1]).scale)return(t=r[n]).level+(t.scale-e)/(t.scale-i.scale);return r[r.length-1].level}},{key:"_initializeFullCacheLODs",value:function(e){var t;if(0===e[0].level)t=e.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}));else{var i=this.tileInfo.size[0],r=this.tileInfo.spatialReference;t=Pe.Z.create({size:i,spatialReference:r}).lods.map((function(e){return{level:e.level,resolution:e.resolution,scale:e.scale}}))}for(var n=0;n<t.length;n++)this._levelByScale[t[n].scale]=t[n].level;this._fullCacheLodInfos=t}}]),i}(i(37995).Z),Ae=i(32344),Ue=i(67581),Oe=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments))._styleChanges=[],e._fetchQueue=null,e._parseQueue=null,e._tileHandlerPromise=null,e._isTileHandlerReady=!1,e}return(0,l.Z)(i,[{key:"fading",get:function(){var e,t;return null!==(e=null===(t=this._vectorTileContainer)||void 0===t?void 0:t.fading)&&void 0!==e&&e}},{key:"hitTest",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,i){var r,s,a,l,o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._tileHandlerPromise){e.next=2;break}return e.abrupt("return",null);case 2:return e.next=4,this._tileHandlerPromise;case 4:return e.next=6,this._vectorTileContainer.hitTest(i);case 6:if((r=e.sent)&&0!==r.length){e.next=9;break}return e.abrupt("return",null);case 9:if(s=r[0]-1,a=this._styleRepository,l=a.getStyleLayerByUID(s)){e.next=12;break}return e.abrupt("return",null);case 12:return o=a.getStyleLayerIndex(l.id),e.abrupt("return",[{type:"graphic",mapPoint:t,layer:this.layer,graphic:new f.Z({attributes:{layerId:o,layerName:l.id,layerUID:s},layer:this.layer,sourceLayer:this.layer})}]);case 14:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"update",value:function(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),void(this._tileHandler.devicePixelRatio=e.pixelRatio)):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))}},{key:"attach",value:function(){var e=this,t=this.layer.currentStyleInfo.style;this._styleRepository=new De.Z(t),this._tileInfoView=new Le(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new Re(this._tileInfoView),this._tileHandler=new q(this.layer,this._styleRepository,window.devicePixelRatio||1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this.layer.on("paint-change",(function(t){if(t.isDataDriven)e._styleChanges.push({type:b.Fr.PAINTER_CHANGED,data:t}),e.requestUpdate();else{var i,r,n=e._styleRepository,s=n.getLayerById(t.layer);if(!s)return;var a=s.type===_e.fR.SYMBOL;n.setPaintProperties(t.layer,t.paint),a&&null!==(i=e._vectorTileContainer)&&void 0!==i&&i.restartDeclutter(),null===(r=e._vectorTileContainer)||void 0===r||r.requestRender()}})),this.layer.on("layout-change",(function(t){var i=e._styleRepository,r=i.getLayerById(t.layer);if(r){var n=(0,x.Hg)(r.layout,t.layout);if(null!=n){var s,a;if((0,x.uD)(n,"visibility")&&1===function(e){if(null==e)return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(n))return i.setLayoutProperties(t.layer,t.layout),r.type===_e.fR.SYMBOL&&null!==(s=e._vectorTileContainer)&&void 0!==s&&s.restartDeclutter(),void(null===(a=e._vectorTileContainer)||void 0===a||a.requestRender());e._styleChanges.push({type:b.Fr.LAYOUT_CHANGED,data:t}),e.requestUpdate()}}})),this.layer.on("style-layer-visibility-change",(function(t){var i,r,n=e._styleRepository,s=n.getLayerById(t.layer);s&&(n.setStyleLayerVisibility(t.layer,t.visibility),s.type===_e.fR.SYMBOL&&null!==(i=e._vectorTileContainer)&&void 0!==i&&i.restartDeclutter(),null===(r=e._vectorTileContainer)||void 0===r||r.requestRender())})),this.layer.on("style-layer-change",(function(t){e._styleChanges.push({type:b.Fr.LAYER_CHANGED,data:t}),e.requestUpdate()})),this.layer.on("delete-style-layer",(function(t){e._styleChanges.push({type:b.Fr.LAYER_REMOVED,data:t}),e.requestUpdate()})),this.layer.on("load-style",(function(){return e._loadStyle()})),this.layer.on("spriteSource-change",(function(t){e._styleChanges.push({type:b.Fr.SPRITES_CHANGED,data:t});var i,n=e._styleRepository.layers,s=(0,r.Z)(n);try{for(s.s();!(i=s.n()).done;){var a=i.value;switch(a.type){case _e.fR.SYMBOL:a.getLayoutProperty("icon-image")&&e._styleChanges.push({type:b.Fr.LAYOUT_CHANGED,data:{layer:a.id,layout:a.layout}});break;case _e.fR.LINE:a.getPaintProperty("line-pattern")&&e._styleChanges.push({type:b.Fr.PAINTER_CHANGED,data:{layer:a.id,paint:a.paint,isDataDriven:a.isPainterDataDriven()}});break;case _e.fR.FILL:a.getLayoutProperty("fill-pattern")&&e._styleChanges.push({type:b.Fr.PAINTER_CHANGED,data:{layer:a.id,paint:a.paint,isDataDriven:a.isPainterDataDriven()}})}}}catch(l){s.e(l)}finally{s.f()}e.requestUpdate()}))])}},{key:"detach",value:function(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=(0,v.SC)(this._vectorTileContainer),this._tileHandler=(0,v.SC)(this._tileHandler)}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"supportsSpatialReference",value:function(e){var t;return(0,w.fS)(null===(t=this.layer.tileInfo)||void 0===t?void 0:t.spatialReference,e)}},{key:"canResume",value:function(){var e=(0,o.Z)((0,h.Z)(i.prototype),"canResume",this).call(this),t=this.layer.currentStyleInfo;if(e&&null!==t&&void 0!==t&&t.layerDefinition){var r=this.view.scale,n=t.layerDefinition,s=n.minScale,a=n.maxScale;(null===t||void 0===t?void 0:t.layerDefinition)&&(s&&s<r&&(e=!1),a&&a>r&&(e=!1))}return e}},{key:"isUpdating",value:function(){return this.fading}},{key:"acquireTile",value:function(e){var t=this,i=this._createVectorTile(e);return this._updatingHandles.addPromise(this._fetchQueue.push(i.key).then((function(e){return t._parseQueue.push({key:i.key,data:e})})).then((function(e){i.once("attach",(function(){return t.requestUpdate()})),i.setData(e),t.requestUpdate()})).catch((function(e){(0,p.D_)(e)||_.Z.getLogger(t).error(e)}))),i}},{key:"releaseTile",value:function(e){var t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}},{key:"_start",value:function(){var e=this;if(this._stop(),this._tileManager=new J({acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},tileInfoView:this._tileInfoView},this._vectorTileContainer),this.layer.currentStyleInfo){var t=new AbortController,i=this._tileHandler.start({signal:t.signal}).then((function(){e._fetchQueue=new Ae.Z({tileInfoView:e._tileInfoView,process:function(t,i){return e._getTileData(t,i)},concurrency:15}),e._parseQueue=new Ae.Z({tileInfoView:e._tileInfoView,process:function(t,i){return e._parseTileData(t,i)},concurrency:8}),e.requestUpdate(),e._isTileHandlerReady=!0}));this._tileHandler.spriteMosaic.then((function(t){e._vectorTileContainer.setStyleResources(t,e._tileHandler.glyphMosaic,e._styleRepository),e.requestUpdate()})),this._tileHandlerAbortController=t,this._tileHandlerPromise=i}}},{key:"_stop",value:function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=(0,v.SC)(this._fetchQueue),this._parseQueue=(0,v.SC)(this._parseQueue),this._tileManager=(0,v.SC)(this._tileManager),this._vectorTileContainer.removeAllChildren()}}},{key:"_getTileData",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.fetchTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_parseTileData",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(t,i){return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._tileHandler.parseTileData(t,i));case 1:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"_applyStyleChanges",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(){var t,i,s,a,l,o,h,u,c,y,f,d,v,p=this;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._tileManager.clearCache(),t=this._styleChanges,e.prev=2,e.next=5,this._tileHandler.updateStyle(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),_.Z.getLogger(this).error("error applying vector-tiles style update",e.t0.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0;case 10:if(i=this._styleRepository,s=new Set,t.forEach((function(e){if(e.type===b.Fr.LAYER_REMOVED){var t=e.data,r=i.getLayerById(t.layer);r&&s.add(r.uid)}})),a=new Set,t.forEach((function(e){var t;switch(e.type){case b.Fr.PAINTER_CHANGED:i.setPaintProperties(e.data.layer,e.data.paint),t=e.data.layer;break;case b.Fr.LAYOUT_CHANGED:i.setLayoutProperties(e.data.layer,e.data.layout),t=e.data.layer;break;case b.Fr.LAYER_REMOVED:return void i.deleteStyleLayer(e.data.layer);case b.Fr.LAYER_CHANGED:i.setStyleLayer(e.data.layer,e.data.index),t=e.data.layer.id;break;case b.Fr.SPRITES_CHANGED:p._vectorTileContainer.setSpriteMosaic(p._tileHandler.setSpriteSource(e.data.spriteSource))}if(t){var r=i.getLayerById(t);r&&a.add(r.uid)}})),l=this._vectorTileContainer.children,s.size>0){o=Array.from(s),this._vectorTileContainer.deleteStyleLayers(o),h=(0,r.Z)(l);try{for(h.s();!(u=h.n()).done;)u.value.deleteLayerData(o)}catch(g){h.e(g)}finally{h.f()}}if(this._fetchQueue.resume(),this._parseQueue.resume(),!(a.size>0)){e.next=36;break}c=Array.from(a),y=[],f=(0,r.Z)(l),e.prev=19,v=(0,n.Z)().mark((function e(){var t,i;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=d.value,i=p._updatingHandles.addPromise(p._fetchQueue.push(t.key).then((function(e){return p._parseQueue.push({key:t.key,data:e,styleLayerUIDs:c})})).then((function(e){return t.setData(e)}))),y.push(i);case 3:case"end":return e.stop()}}),e)})),f.s();case 22:if((d=f.n()).done){e.next=26;break}return e.delegateYield(v(),"t1",24);case 24:e.next=22;break;case 26:e.next=31;break;case 28:e.prev=28,e.t2=e.catch(19),f.e(e.t2);case 31:return e.prev=31,f.f(),e.finish(31);case 34:return e.next=36,Promise.all(y);case 36:this._styleChanges=[],this._isTileHandlerReady=!0,this.requestUpdate();case 37:case"end":return e.stop()}}),e,this,[[2,7],[19,28,31,34]])})));return function(){return e.apply(this,arguments)}}()},{key:"_loadStyle",value:function(){var e=(0,s.Z)((0,n.Z)().mark((function e(){var t,i,r,s;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.currentStyleInfo.style,i=(0,d.d9)(t),this._isTileHandlerReady=!1,this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.clear(),this._parseQueue.clear(),this._styleRepository=new De.Z(i),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController,r=this._tileHandlerAbortController.signal,e.prev=3,this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,i),e.next=7,this._tileHandlerPromise;case 7:e.next=13;break;case 9:if(e.prev=9,e.t0=e.catch(3),(0,p.D_)(e.t0)){e.next=13;break}throw e.t0;case 13:if(!r.aborted){e.next=15;break}return e.abrupt("return",(this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,void this.requestUpdate()));case 15:return e.next=17,this._tileHandler.spriteMosaic;case 17:s=e.sent,this._vectorTileContainer.setStyleResources(s,this._tileHandler.glyphMosaic,this._styleRepository),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=!0,this.requestUpdate();case 19:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"_createVectorTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,k.Ue)(),e),i=this._tileInfoView.getTileResolution(e.level);return new ye(e,i,t[0],t[3],512,512,this._styleRepository)}}]),i}((0,Me.y)(Ue.Z));(0,y._)([(0,g.Cb)()],Oe.prototype,"_isTileHandlerReady",void 0);var Ve=Oe=(0,y._)([(0,m.j)("esri.views.2d.layers.VectorTileLayerView2D")],Oe)}}]);
//# sourceMappingURL=5436.ff9f3e1e.chunk.js.map