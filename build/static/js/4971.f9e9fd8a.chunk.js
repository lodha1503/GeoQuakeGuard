"use strict";(self.webpackChunkamit_kumar_rathi=self.webpackChunkamit_kumar_rathi||[]).push([[4971,9951],{70116:function(e,t,n){var i;n.d(t,{Y:function(){return i}}),function(e){e[e.KILOBYTES=1024]="KILOBYTES",e[e.MEGABYTES=1048576]="MEGABYTES",e[e.GIGABYTES=1073741824]="GIGABYTES"}(i||(i={}))},86950:function(e,t,n){n.d(t,{EX:function(){return k},Y3:function(){return b},_Y:function(){return g},sJ:function(){return _},xr:function(){return y}});var i=n(51995);n(90045),n(67077);function r(e){return"h"in e&&"s"in e&&"v"in e}function a(e){return"l"in e&&"a"in e&&"b"in e}function o(e){return"l"in e&&"c"in e&&"h"in e}var l,s=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],u=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function c(e,t){var n,i,r=[];if(e[0].length!==t.length)throw new Error("dimensions do not match");var a=e.length,o=e[0].length,l=0;for(n=0;n<a;n++){for(l=0,i=0;i<o;i++)l+=e[n][i]*t[i];r.push(l)}return r}function d(e){var t=[e.r/255,e.g/255,e.b/255].map((function(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)})),n=c(s,t);return{x:100*n[0],y:100*n[1],z:100*n[2]}}function p(e){var t=c(u,[e.x/100,e.y/100,e.z/100]).map((function(e){var t=e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;return Math.min(1,Math.max(t,0))}));return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function f(e){var t=[e.x/95.047,e.y/100,e.z/108.883].map((function(e){return e>Math.pow(6/29,3)?Math.pow(e,1/3):1/3*Math.pow(29/6,2)*e+4/29}));return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function h(e){var t=e.l,n=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map((function(e){return e>6/29?Math.pow(e,3):3*Math.pow(6/29,2)*(e-4/29)}));return{x:95.047*n[0],y:100*n[1],z:108.883*n[2]}}function v(e){return function(e){var t=e.l,n=e.a,i=e.b,r=Math.sqrt(n*n+i*i),a=Math.atan2(i,n);return{l:t,c:r,h:a=a>0?a:a+2*Math.PI}}(f(d(e)))}function m(e){return p(h(function(e){var t=e.l,n=e.c,i=e.h;return{l:t,a:n*Math.cos(i),b:n*Math.sin(i)}}(e)))}function y(e){return function(e){return"r"in e&&"g"in e&&"b"in e}(e)?e:o(e)?m(e):a(e)?function(e){return p(h(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?p(e):r(e)?function(e){var t,n=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,a=r*i,o=a*(1-Math.abs(n%2-1));switch(Math.floor(n)){case 0:t={r:a,g:o,b:0};break;case 1:t={r:o,g:a,b:0};break;case 2:t={r:0,g:a,b:o};break;case 3:t={r:0,g:o,b:a};break;case 4:t={r:o,g:0,b:a};break;case 5:case 6:t={r:a,g:0,b:o};break;default:t={r:0,g:0,b:0}}return t.r=Math.round(t.r+r-a),t.g=Math.round(t.g+r-a),t.b=Math.round(t.b+r-a),t}(e):e}function g(e){return r(e)?e:function(e){var t=e.r,n=e.g,i=e.b,r=Math.max(t,n,i),a=r-Math.min(t,n,i),o=r,l=0===a?0:r===t?(n-i)/a%6:r===n?(i-t)/a+2:(t-n)/a+4,s=0===a?0:a/o;return l<0&&(l+=6),{h:l*=60,s:s*=100,v:o*=100/255}}(y(e))}function b(e){return a(e)?e:function(e){return f(d(e))}(y(e))}function _(e){return o(e)?e:v(y(e))}function w(e){var t=e.r,n=e.g,r=e.b,a=e.a;return a<1&&(t=Math.round(a*t+255*(1-a)),n=Math.round(a*n+255*(1-a)),r=Math.round(a*r+255*(1-a))),new i.Z({r:t,g:n,b:r})}function k(e,t){var n=null!==t&&void 0!==t&&t.ignoreAlpha?e:w(e);return.2126*n.r+.7152*n.g+.0722*n.b}!function(e){e[e.Low=160]="Low",e[e.High=225]="High"}(l||(l={}))},71277:function(e,t,n){function i(e){return e=e||globalThis.location.hostname,u.some((function(t){var n;return null!=(null===(n=e)||void 0===n?void 0:n.match(t))}))}function r(e,t){return e&&(t=t||globalThis.location.hostname)?null!=t.match(a)||null!=t.match(l)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=t.match(o)||null!=t.match(s)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e}n.d(t,{XO:function(){return i},pJ:function(){return r}});var a=/^devext.arcgis.com$/,o=/^qaext.arcgis.com$/,l=/^[\w-]*\.mapsdevext.arcgis.com$/,s=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,a,o,/^jsapps.esri.com$/,l,s]},14916:function(e,t,n){function i(e,t,n,i){var r=null,a=1e3;"number"==typeof t?(a=t,i=n):(r=null!==t&&void 0!==t?t:null,a=n);var o,l=0,s=function(){l=0,e.apply(i,o)},u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];r&&r.apply(i,t),o=t,a?l||(l=setTimeout(s,a)):s()};return u.remove=function(){l&&(clearTimeout(l),l=0)},u.forceUpdate=function(){l&&(clearTimeout(l),s())},u.hasPendingUpdates=function(){return!!l},u}n.d(t,{P:function(){return i}})},22585:function(e,t,n){function i(e){var t={};for(var n in e)if("declaredClass"!==n){var r=e[n];if(null!=r&&"function"!=typeof r)if(Array.isArray(r)){t[n]=[];for(var a=0;a<r.length;a++)t[n][a]=i(r[a])}else"object"==typeof r?r.toJSON&&(t[n]=JSON.stringify(r)):t[n]=r}return t}n.d(t,{A:function(){return i}})},77946:function(e,t,n){n.d(t,{F:function(){return p},e:function(){return c}});var i=n(1413),r=n(74165),a=n(15861),o=n(23084),l=n(5192),s=n(49818),u=n(86638);function c(e,t,n){return d.apply(this,arguments)}function d(){return d=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(t,n,i);case 2:return a=e.sent,e.abrupt("return",s.Z.fromJSON(a));case 4:case"end":return e.stop()}}),e)}))),d.apply(this,arguments)}function p(e,t,n){return f.apply(this,arguments)}function f(){return f=(0,a.Z)((0,r.Z)().mark((function e(t,n,a){var s,c,d,p,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=(0,o.en)(t),c=(0,i.Z)({},a),d=u.Z.from(n),e.next=5,(0,l.JT)(s,d,d.sourceSpatialReference,c);case 5:return p=e.sent,f=p.data,e.abrupt("return",f);case 8:case"end":return e.stop()}}),e)}))),f.apply(this,arguments)}},5192:function(e,t,n){n.d(t,{Ev:function(){return w},JT:function(){return m},Vr:function(){return x},hH:function(){return k},n7:function(){return _},qp:function(){return g}});var i=n(1413),r=n(74165),a=n(15861),o=n(76200),l=n(35995),s=n(77981),u=n(91340),c=n(92975),d=n(22585),p=n(27607),f=n(68620),h="Layer does not support extent calculation.";function v(e,t){var n,i=e.geometry,r=e.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;var a,o,l,u=r;if(null!=i&&(o=i.spatialReference,l=(0,c.B9)(o),u.geometryType=(0,s.Ji)(i),u.geometry=function(e,t){if(t&&"extent"===e.type)return"".concat(e.xmin,",").concat(e.ymin,",").concat(e.xmax,",").concat(e.ymax);if(t&&"point"===e.type)return"".concat(e.x,",").concat(e.y);var n=e.toJSON();return delete n.spatialReference,JSON.stringify(n)}(i,e.compactGeometryEnabled),u.inSR=l),r.groupByFieldsForStatistics&&(u.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(u.objectIds=r.objectIds.join(",")),r.orderByFields&&(u.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(null!==t&&void 0!==t&&t.returnCountOnly||null!==t&&void 0!==t&&t.returnExtentOnly||null!==t&&void 0!==t&&t.returnIdsOnly)?delete u.outFields:r.outFields.includes("*")?u.outFields="*":u.outFields=r.outFields.join(","),r.outSR?(u.outSR=(0,c.B9)(r.outSR),a=e.outSpatialReference):i&&(r.returnGeometry||r.returnCentroid)&&(u.outSR=u.inSR,a=o),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(u.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(u.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(u.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=o&&null!=(null===(n=e.quantizationParameters)||void 0===n?void 0:n.extent)&&o.equals(e.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,u.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(u.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(u.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(u.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){var d=r.timeExtent,p=d.start,f=d.end;null==p&&null==f||(u.time=p===f?p:"".concat(null!==p&&void 0!==p?p:"null",",").concat(null!==f&&void 0!==f?f:"null")),delete r.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=o&&null!=a&&o.equals(a)&&(u.defaultSR=u.inSR,delete u.inSR,delete u.outSR),u}function m(e,t,n,i){return y.apply(this,arguments)}function y(){return(y=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a){var o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n.timeExtent||!n.timeExtent.isEmpty){e.next=4;break}e.t0={data:{features:[]}},e.next=7;break;case 4:return e.next=6,M(t,n,"json",a);case 6:e.t0=e.sent;case 7:return o=e.t0,e.abrupt("return",((0,f.p)(n,i,o.data),o));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,t,n,i){return b.apply(this,arguments)}function b(){return(b=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a){var o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n.timeExtent||!n.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:i.createFeatureResult()});case 2:return e.next=4,_(t,n,a);case 4:return o=e.sent,l=o,e.abrupt("return",(l.data=(0,p.C)(o.data,i),l));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(e,t,n){return M(e,t,"pbf",n)}function w(e,t,n){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):M(e,t,"json",n,{returnIdsOnly:!0})}function k(e,t,n){return null!=t.timeExtent&&t.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):M(e,t,"json",n,{returnIdsOnly:!0,returnCountOnly:!0})}function x(e,t,n){return C.apply(this,arguments)}function C(){return(C=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n.timeExtent||!n.timeExtent.isEmpty){e.next=2;break}return e.abrupt("return",{data:{count:0,extent:null}});case 2:return e.next=4,M(t,n,"json",i,{returnExtentOnly:!0,returnCountOnly:!0});case 4:if(a=e.sent,!(o=a.data).hasOwnProperty("extent")){e.next=8;break}return e.abrupt("return",a);case 8:if(!o.features){e.next=10;break}throw new Error(h);case 10:if(!o.hasOwnProperty("count")){e.next=12;break}throw new Error(h);case 12:return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,n){return I.apply(this,arguments)}function I(){return I=(0,a.Z)((0,r.Z)().mark((function e(t,n,a){var s,c,p,f,h,m,y,g=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=g.length>3&&void 0!==g[3]?g[3]:{},c=g.length>4&&void 0!==g[4]?g[4]:{},p="string"==typeof t?(0,l.mN)(t):t,f=n.geometry?[n.geometry]:[],e.next=6,(0,u.aX)(f,null,{signal:s.signal});case 6:return h=e.sent,null!=(m=null===h||void 0===h?void 0:h[0])&&((n=n.clone()).geometry=m),y=(0,d.A)((0,i.Z)((0,i.Z)((0,i.Z)({},p.query),{},{f:a},c),v(n,c))),e.abrupt("return",(0,o.Z)((0,l.v_)(p.path,F(n,c)?"query3d":"query"),(0,i.Z)((0,i.Z)({},s),{},{responseType:"pbf"===a?"array-buffer":"json",query:(0,i.Z)((0,i.Z)({},y),s.query)})));case 11:case"end":return e.stop()}}),e)}))),I.apply(this,arguments)}function F(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}},11812:function(e,t,n){n.d(t,{Z:function(){return m}});var i,r=n(15671),a=n(43144),o=n(60136),l=n(29388),s=n(27366),u=n(46784),c=n(49861),d=n(25243),p=(n(63780),n(93169),n(69912));function f(e){var t=e.exifInfo,n=e.exifName,i=e.tagName;if(!t||!n||!i)return null;var r=t.find((function(e){return e.name===n}));return r?function(e){var t=e.tagName,n=e.tags;if(!n||!t)return null;var i=n.find((function(e){return e.name===t}));return(null===i||void 0===i?void 0:i.value)||null}({tagName:i,tags:r.tags}):null}var h={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}},v=i=function(e){(0,o.Z)(n,e);var t=(0,l.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).contentType=null,i.exifInfo=null,i.id=null,i.globalId=null,i.keywords=null,i.name=null,i.parentGlobalId=null,i.parentObjectId=null,i.size=null,i.url=null,i}return(0,a.Z)(n,[{key:"orientationInfo",get:function(){var e=f({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:this.exifInfo});return h[e]||null}},{key:"clone",value:function(){return new i({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}}]),n}(u.wq);(0,s._)([(0,c.Cb)({type:String})],v.prototype,"contentType",void 0),(0,s._)([(0,c.Cb)()],v.prototype,"exifInfo",void 0),(0,s._)([(0,c.Cb)({readOnly:!0})],v.prototype,"orientationInfo",null),(0,s._)([(0,c.Cb)({type:d.z8})],v.prototype,"id",void 0),(0,s._)([(0,c.Cb)({type:String})],v.prototype,"globalId",void 0),(0,s._)([(0,c.Cb)({type:String})],v.prototype,"keywords",void 0),(0,s._)([(0,c.Cb)({type:String})],v.prototype,"name",void 0),(0,s._)([(0,c.Cb)({json:{read:!1}})],v.prototype,"parentGlobalId",void 0),(0,s._)([(0,c.Cb)({json:{read:!1}})],v.prototype,"parentObjectId",void 0),(0,s._)([(0,c.Cb)({type:d.z8})],v.prototype,"size",void 0),(0,s._)([(0,c.Cb)({json:{read:!1}})],v.prototype,"url",void 0);var m=v=i=(0,s._)([(0,p.j)("esri.layers.support.AttachmentInfo")],v)},62734:function(e,t,n){n.d(t,{$8:function(){return s},a8:function(){return l}});var i=n(1413),r=n(76969),a=n(37270),o=(n(819),n(23037),n(6701));new Set(["integer","small-integer"]);function l(e){return(0,a.y2)(e)||(0,a.UQ)(e)||(0,a.ig)(e)}function s(e,t){var n,a,l,s=null!==t&&void 0!==t?t:{},u=s.format,c=s.timeZoneOptions,d=s.fieldType;if(c&&(a=(n=(0,o.Np)(c.layerTimeZone,c.datesInUnknownTimezone,c.viewTimeZone,(0,r.Ze)(u||"short-date-short-time"),d)).timeZone,l=n.timeZoneName),"string"==typeof e&&isNaN(Date.parse("time-only"===d?"1970-01-01T".concat(e,"Z"):e)))return e;switch(d){case"date-only":var p=(0,r.Ze)(u||"short-date");return"string"==typeof e?(0,r.o8)(e,(0,i.Z)({},p)):(0,r.p6)(e,(0,i.Z)((0,i.Z)({},p),{},{timeZone:o.pt}));case"time-only":var f=(0,r.Ze)(u||"short-time");return"string"==typeof e?(0,r.LJ)(e,f):(0,r.p6)(e,(0,i.Z)((0,i.Z)({},f),{},{timeZone:o.pt}));case"timestamp-offset":if(!a&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;var h=u||c?(0,r.Ze)(u||"short-date-short-time"):void 0,v=h?(0,i.Z)((0,i.Z)({},h),{},{timeZone:a,timeZoneName:l}):void 0;return"string"==typeof e?(0,r.i$)(e,v):(0,r.p6)(e,v);default:var m=u||c?(0,r.Ze)(u||"short-date-short-time"):void 0;return(0,r.p6)("string"==typeof e?new Date(e):e,m?(0,i.Z)((0,i.Z)({},m),{},{timeZone:a,timeZoneName:l}):void 0)}}},36009:function(e,t,n){n.r(t),n.d(t,{getPatternDescriptor:function(){return A},getSizeFromOptions:function(){return N},getSymbolLayerFill:function(){return Z},previewSymbol3D:function(){return D}});var i=n(74165),r=n(1413),a=n(15861),o=n(65905),l=n(86950),s=(n(93169),n(10064)),u=n(32718),c=n(17842),d=n(79563),p=n(29122),f=n(73627),h=n(37817),v=n(69157),m=n(74579),y=n(19951),g=h.b_.size,b=h.b_.maxSize,_=h.b_.maxOutlineSize,w=h.b_.lineWidth,k=h.b_.tallSymbolWidth;function x(e){var t=e.outline,n=null!=e.material?e.material.color:null,i=null!=n?n.toHex():null;if(null==t||"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type&&"none"===t.pattern.style)return"fill"===e.type&&"#ffffff"===i?{color:"#bdc3c7",width:.75}:null;var r=(0,c.F2)(t.size)||0;return{color:"rgba("+(null!=t.color?t.color.toRgba():"255,255,255,1")+")",width:Math.min(r,_),style:"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type?(0,d.Sp)(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function C(e,t){return M.apply(this,arguments)}function M(){return(M=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,l,s,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=t.thumbnail)||void 0===r||!r.url){e.next=2;break}return e.abrupt("return",t.thumbnail.url);case 2:if("icon"!==n.type){e.next=6;break}if(!(null===n||void 0===n||null===(a=n.resource)||void 0===a?void 0:a.href)){e.next=6;break}return e.abrupt("return",(0,m.nf)(n));case 6:if(l=(0,o.V)("esri/images/Legend/legend3dsymboldefault.png"),!t.styleOrigin||!t.styleOrigin.styleName&&!t.styleOrigin.styleUrl){e.next=13;break}return e.next=10,(0,y.resolveWebStyleSymbol)(t.styleOrigin,{portal:t.styleOrigin.portal},"webRef").catch((function(){return null}));case 10:if(!((u=e.sent)&&"thumbnail"in u&&null!==(s=u.thumbnail)&&void 0!==s&&s.url)){e.next=13;break}return e.abrupt("return",u.thumbnail.url);case 13:return e.abrupt("return",l);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e.a,i=(0,l._Y)(e),r=i.h,a=i.s/t,o=100-(100-i.v)/t,s=(0,l.xr)({h:r,s:a,v:o});return[s.r,s.g,s.b,n]}function F(e){var t;return"water"===e.type?null==e.color?null:e.color:null==(null===(t=e.material)||void 0===t?void 0:t.color)?null:e.material.color}function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=F(e);if(!n){if("fill"===e.type)return null;var i=d.Ne.r,r=(0,h.uH)(i,t);return[r,r,r,100]}for(var a=n.toRgba(),o=0;o<3;o++)a[o]=(0,h.uH)(a[o],t);return a}function A(e,t){return L.apply(this,arguments)}function L(){return(L=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("none"!==(r=t.style)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,(0,d.Od)((0,o.V)("esri/symbols/patterns/".concat(r,".png")),n.toCss(!0));case 5:return e.t0=e.sent,e.abrupt("return",{type:"pattern",x:0,y:0,src:e.t0,width:5,height:5});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e){return e.outline?x(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function P(e,t){var n=F(e);if(!n)return null;var i="rgba(";return i+=(0,h.uH)(n.r,t)+",",i+=(0,h.uH)(n.g,t)+",",(i+=(0,h.uH)(n.b,t)+",")+n.a+");"}function T(e,t){var n=P(e,t);return n?"pattern"in e&&null!=e.pattern&&"style"===e.pattern.type&&"none"===e.pattern.style?null:{color:n,width:Math.min(e.size?(0,c.F2)(e.size):.75,_),style:"pattern"in e&&null!=e.pattern&&"style"===e.pattern.type?(0,d.Sp)(e.pattern.style):null,cap:"cap"in e?e.cap:null,join:"join"in e?"miter"===e.join?(0,c.F2)(2):e.join:null}:{}}function S(e,t,n){var i=null!=n?.75*n:0;return{type:"linear",x1:i?.25*i:0,y1:i?.5*i:0,x2:i||4,y2:i?.5*i:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function R(e){var t=e.depth,n=e.height,i=e.width;return 0!==i&&0!==t&&0!==n&&i===t&&null!=i&&null!=n&&i<n}function O(e,t,n){var i=[];if(!e)return i;switch(e.type){case"icon":var r=t,a=t;switch(e.resource&&e.resource.primitive||p.S){case"circle":i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:Z(e,0),stroke:x(e)});break;case"square":i.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[0,0]},{command:"L",values:[r,0]},{command:"L",values:[r,a]},{command:"Z",values:[]}]},fill:Z(e,0),stroke:x(e)});break;case"triangle":i.push({shape:{type:"path",path:[{command:"M",values:[0,a]},{command:"L",values:[.5*r,0]},{command:"L",values:[r,a]},{command:"Z",values:[]}]},fill:Z(e,0),stroke:x(e)});break;case"cross":i.push({shape:{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[.5*r,a]},{command:"M",values:[0,.5*a]},{command:"L",values:[r,.5*a]}]},stroke:E(e)});break;case"x":i.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[r,a]},{command:"M",values:[r,0]},{command:"L",values:[0,a]}]},stroke:E(e)});break;case"kite":i.push({shape:{type:"path",path:[{command:"M",values:[0,.5*a]},{command:"L",values:[.5*r,0]},{command:"L",values:[r,.5*a]},{command:"L",values:[.5*r,a]},{command:"Z",values:[]}]},fill:Z(e,0),stroke:x(e)})}break;case"object":switch(e.resource&&e.resource.primitive||f.S){case"cone":var o=S(Z(e,0),Z(e,-.6),n?k:t),l=(0,h.TE)(t,n);i.push({shape:l[0],fill:o},{shape:l[1],fill:o});break;case"inverted-cone":var s=Z(e,0),u=S(s,Z(e,-.6),t),c=(0,h.DY)(t);i.push({shape:c[0],fill:u},{shape:c[1],fill:s});break;case"cube":var d=(0,h.Pc)(t,n);i.push({shape:d[0],fill:Z(e,0)},{shape:d[1],fill:Z(e,-.3)},{shape:d[2],fill:Z(e,-.5)});break;case"cylinder":var v=S(Z(e,0),Z(e,-.6),n?k:t),m=(0,h.EB)(t,n);i.push({shape:m[0],fill:v},{shape:m[1],fill:v},{shape:m[2],fill:Z(e,0)});break;case"diamond":var y=(0,h.XX)(t);i.push({shape:y[0],fill:Z(e,-.3)},{shape:y[1],fill:Z(e,0)},{shape:y[2],fill:Z(e,-.3)},{shape:y[3],fill:Z(e,-.7)});break;case"sphere":var g=S(Z(e,0),Z(e,-.6));g.x1=0,g.y1=0,g.x2=.25*t,g.y2=.25*t,i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:g});break;case"tetrahedron":var b=(0,h.tp)(t);i.push({shape:b[0],fill:Z(e,-.3)},{shape:b[1],fill:Z(e,0)},{shape:b[2],fill:Z(e,-.6)})}}return i}function N(e){var t="number"==typeof(null===e||void 0===e?void 0:e.size)?null===e||void 0===e?void 0:e.size:null;return t?(0,c.F2)(t):null}function z(e){return"icon"===e.type?"multiply":"tint"}function V(){return(V=(0,a.Z)((0,i.Z)().mark((function e(t,n){var r,a,o,l,s,d,p,f,h,m,y,_;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=N(n),o=null!==n&&void 0!==n&&n.maxSize?(0,c.F2)(n.maxSize):null,l=null!==(r=null===n||void 0===n?void 0:n.disableUpsampling)&&void 0!==r&&r,s=t.symbolLayers,d=[],p=0,f=0,(h=s.at(-1))&&"icon"===h.type&&(m=h.size&&(0,c.F2)(h.size)),s.forEach((function(e){var i;if("icon"===e.type||"object"===e.type){var r="icon"===e.type?e.size&&(0,c.F2)(e.size):0,s=a||r?Math.ceil(Math.min(a||r,o||b)):g;if(null!==e&&void 0!==e&&null!==(i=e.resource)&&void 0!==i&&i.href){var u=C(t,e).then((function(t){var n,i=null===e||void 0===e||null===(n=e.material)||void 0===n?void 0:n.color,r=z(e);return(0,v.rG)(t,s,i,r,l)})).then((function(e){var t=e.width,n=e.height;return p=Math.max(p,t),f=Math.max(f,n),[{shape:{type:"image",x:0,y:0,width:t,height:n,src:e.url},fill:null,stroke:null}]}));d.push(u)}else{var h,y=s;"icon"===e.type&&m&&a&&(y=s*(r/m));var _="tall"===(null===n||void 0===n?void 0:n.symbolConfig)||(null===n||void 0===n||null===(h=n.symbolConfig)||void 0===h?void 0:h.isTall)||"object"===e.type&&R(e);p=Math.max(p,_?k:y),f=Math.max(f,y),d.push(Promise.resolve(O(e,y,_)))}}})),e.next=6,Promise.allSettled(d);case 6:return y=e.sent,_=[],e.abrupt("return",(y.forEach((function(e){"fulfilled"===e.status?_.push(e.value):e.reason&&u.Z.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.reason)})),(0,v.wh)(_,[p,f],{node:null===n||void 0===n?void 0:n.node,scale:!1,opacity:null===n||void 0===n?void 0:n.opacity,ariaLabel:null===n||void 0===n?void 0:n.ariaLabel})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(){return(B=(0,a.Z)((0,i.Z)().mark((function e(t,n){var a,o,l,s,u,d,p,f,m,y,_,w,k,C,M,L,E,S,R,O,z,V,B,D,j,q,W,H,Y,U,G,J,Q,$,X;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="mesh-3d"===t.type,o=t.symbolLayers,l=N(n),s=null!==n&&void 0!==n&&n.maxSize?(0,c.F2)(n.maxSize):null,u=l||g,d=[],p=0,f=0,m=!1,y=0;case 3:if(!(y<o.length)){e.next=44;break}if(_=o.at(y),w=[],a&&"fill"!==_.type){e.next=41;break}e.t0=_.type,e.next="fill"===e.t0?9:"line"===e.t0?24:"extrude"===e.t0?30:"water"===e.t0?35:40;break;case 9:if(k=Math.min(u,s||b),p=Math.max(p,k),f=Math.max(f,k),m=!0,!a){e.next=15;break}C=h.JZ.meshSymbol3DFill,M=P(_,-.4),L=M?{color:M,width:1,join:"round"}:{},w.push({shape:C[0],fill:Z(_,0),stroke:L},{shape:C[1],fill:Z(_,-.2),stroke:L},{shape:C[2],fill:Z(_,-.6),stroke:L}),e.next=23;break;case 15:if(E=Z(_,0),S="pattern"in _?_.pattern:null,R=x(_),O=F(_),e.t1=null!=S&&"style"===S.type&&"solid"!==S.style&&O,!e.t1){e.next=22;break}return e.next=21,A(S,O);case 21:E=e.sent;case 22:w.push({shape:h.JZ.fill[0],fill:E,stroke:R});case 23:return e.abrupt("break",40);case 24:if(null!=(z=T(_,0))){e.next=27;break}return e.abrupt("break",40);case 27:return V={stroke:z,shape:h.JZ.fill[0]},p=Math.max(p,g),f=Math.max(f,g),w.push(V),e.abrupt("break",40);case 30:return B=(0,r.Z)({join:"round",width:1},T(_,-.4)),D=Z(_,0),j=Z(_,-.2),q=Math.min(u,s||b),W=(0,h.EV)(q),B.width=1,w.push({shape:W[0],fill:j,stroke:B},{shape:W[1],fill:j,stroke:B},{shape:W[2],fill:D,stroke:B}),H=g,Y=.7*g+.5*q,p=Math.max(p,H),f=Math.max(f,Y),e.abrupt("break",40);case 35:return U=F(_),G=I(U),J=I(U,2),Q=I(U,3),$=(0,h.ht)(),m=!0,w.push({shape:$[0],fill:G},{shape:$[1],fill:J},{shape:$[2],fill:Q}),X=Math.min(u,s||b),p=Math.max(p,X),f=Math.max(f,X),e.abrupt("break",40);case 40:d.push(w);case 41:y++,e.next=3;break;case 44:return e.abrupt("return",(0,v.wh)(d,[p,f],{node:null===n||void 0===n?void 0:n.node,scale:m,opacity:null===n||void 0===n?void 0:n.opacity,ariaLabel:null===n||void 0===n?void 0:n.ariaLabel}));case 45:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){if(0===e.symbolLayers.length)return Promise.reject(new s.Z("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return function(e,t){return V.apply(this,arguments)}(e,t);case"line-3d":return function(e,t){var n,i=e.symbolLayers,a=[],o=(0,m.YW)(e),l=N(t),s=(null!==t&&void 0!==t&&t.maxSize?(0,c.F2)(t.maxSize):null)||_,u=0,d=0;return i.forEach((function(e,t){if(e&&("line"===e.type||"path"===e.type)){var i=[];switch(e.type){case"line":var o=T(e,0);if(null==o)break;var c=(null===o||void 0===o?void 0:o.width)||0;0===t&&(n=c);var p=Math.min(l||c,s),f=0===t?p:l?p*(c/n):p,v=f>w/2?2*f:w;d=Math.max(d,f),u=Math.max(u,v),o.width=f,i.push({shape:{type:"path",path:[{command:"M",values:[0,.5*d]},{command:"L",values:[u,.5*d]}]},stroke:o});break;case"path":var m=Math.min(l||g,s),y=Z(e,0),b=Z(e,-.2),_=P(e,-.4),k=_?{color:_,width:1}:{};if("quad"===e.profile){var x=e.width,C=e.height,M=(0,h.eb)(x&&C?x/C:1,0===C,0===x),I=(0,r.Z)((0,r.Z)({},k),{},{join:"bevel"});i.push({shape:M[0],fill:b,stroke:I},{shape:M[1],fill:b,stroke:I},{shape:M[2],fill:y,stroke:I})}else i.push({shape:h.JZ.pathSymbol3DLayer[0],fill:b,stroke:k},{shape:h.JZ.pathSymbol3DLayer[1],fill:y,stroke:k});d=Math.max(d,m),u=d}a.push(i)}})),Promise.resolve((0,v.wh)(a,[u,d],{node:null===t||void 0===t?void 0:t.node,scale:o,opacity:null===t||void 0===t?void 0:t.opacity,ariaLabel:null===t||void 0===t?void 0:t.ariaLabel}))}(e,t);case"polygon-3d":case"mesh-3d":return function(e,t){return B.apply(this,arguments)}(e,t)}return Promise.reject(new s.Z("symbolPreview: swatchInfo3D","symbol not supported."))}},37817:function(e,t,n){n.d(t,{DY:function(){return p},EB:function(){return c},EV:function(){return l},JZ:function(){return a},Pc:function(){return u},TE:function(){return d},XX:function(){return f},b_:function(){return i},dc:function(){return m},eb:function(){return o},ht:function(){return s},tp:function(){return h},uH:function(){return v}});var i,r=n(51995);!function(e){e[e.size=22]="size",e[e.lineWidth=50]="lineWidth",e[e.maxSize=120]="maxSize",e[e.maxOutlineSize=80]="maxOutlineSize",e[e.tallSymbolWidth=20]="tallSymbolWidth"}(i||(i={}));var a={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};function o(e,t,n){var r=i.size,a=r,o=r;e<1?a*=.75:e>1&&(o*=1.25);var l=r,s=r;return t&&n&&(a=o=l=s=0),[{type:"path",path:[{command:"M",values:[l,0]},{command:"L",values:[n?l:.875*l,0]},{command:"L",values:[n?a-.5*l:0,o-.5*s]},{command:"L",values:[a-.5*l,o-.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[l,0]},{command:"L",values:[l,t?0:.125*s]},{command:"L",values:[a-.5*l,t?o-.5*s:s]},{command:"L",values:[a-.5*l,o-.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[a-.5*l,o-.5*s]},{command:"L",values:[n?a-.5*l:0,o-.5*s]},{command:"L",values:[n?a-.5*l:0,t?o-.5*s:s]},{command:"L",values:[a-.5*l,t?o-.5*s:s]},{command:"Z",values:[]}]}]}function l(e){var t=i.size,n=.5*e;return[{type:"path",path:[{command:"M",values:[0,.7*t*.5]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+n]},{command:"L",values:[0,.7*t+n-.7*t*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,.7*t]},{command:"L",values:[.3*t,.7*t+n]},{command:"L",values:[t,n]},{command:"L",values:[t,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*t,0]},{command:"L",values:[t,0]},{command:"L",values:[.3*t,.7*t]},{command:"L",values:[0,.7*t*.5]},{command:"Z",values:[]}]}]}function s(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]}function u(e,t){var n=t?i.tallSymbolWidth:e,r=e,a=t?4:6;n<=i.size?n-=.5*a:n-=a;var o=t?.35*n:.5*n;return[{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,.5*o]},{command:"L",values:[.5*n,o]},{command:"L",values:[0,.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*n,o]},{command:"L",values:[.5*n,r]},{command:"L",values:[0,r-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*n,o]},{command:"L",values:[.5*n,r]},{command:"L",values:[n,r-.5*o]},{command:"L",values:[n,.5*o]},{command:"Z",values:[]}]}]}function c(e,t){var n=t?i.tallSymbolWidth:e,r=e,a=t?4:6;n<=i.size?n-=.5*a:n-=a;var o=.5*n,l=.15*n,s=r-l;return[{type:"ellipse",cx:.5*n,cy:s,rx:o,ry:l},{type:"path",path:[{command:"M",values:[0,l]},{command:"L",values:[0,s]},{command:"L",values:[n,s]},{command:"L",values:[n,l]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*n,cy:l,rx:o,ry:l}]}function d(e,t){var n=t?i.tallSymbolWidth:e,r=e,a=t?4:6;n<=i.size?n-=.5*a:n-=a;var o=.15*n,l=r-o;return[{type:"ellipse",cx:.5*n,cy:l,rx:.5*n,ry:o},{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]}]}function p(e){var t=e,n=e;t<i.size?t-=3:t-=6;var r=.15*t;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,n-r]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:r}]}function f(e){var t=e,n=e;t<i.size?t-=2:t-=4;var r=t,a=n,o=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[r,.5*a-o]},{command:"L",values:[.45*r-o,.5*a+o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,0]},{command:"L",values:[.45*r-o,.5*a+o]},{command:"L",values:[0,.5*a-o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*a-o]},{command:"L",values:[.45*r-o,.5*a+o]},{command:"L",values:[.45*r,n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*r,n]},{command:"L",values:[r,.5*a-o]},{command:"L",values:[.45*r-o,.5*a+o]},{command:"Z",values:[]}]}]}function h(e){var t=e,n=e;n<i.size?n-=1:n-=2;return[{type:"path",path:[{command:"M",values:[.45*t,0]},{command:"L",values:[t,n]},{command:"L",values:[.45*t,.6*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,0]},{command:"L",values:[.45*t,.6*n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[.45*t,.6*n]},{command:"L",values:[t,n]},{command:"Z",values:[]}]}]}function v(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}function m(e,t){if(null==e)return new r.Z;if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;var n=new r.Z(e);return new r.Z([v(n.r,t),v(n.g,t),v(n.b,t),n.a])}},69157:function(e,t,n){n.d(t,{rG:function(){return h},wh:function(){return p}});var i=n(19545),r=n(76200),a=n(86950),o=n(10064),l=n(93169),s=(n(42877),n(88367)),u=n(99653),c=n(74579),d=(0,s.E)();function p(e,t,n){var i=Math.ceil(t[0]),r=Math.ceil(t[1]);if(!e.some((function(e){return!!e.length})))return null;var a=(null===n||void 0===n?void 0:n.node)||document.createElement("div");return null!=n.opacity&&(a.style.opacity=n.opacity.toString()),null!=n.effectView&&(a.style.filter=(0,c.wJ)(n.effectView)),function(e,t){d.append(e,t),d.detach(t)}(a,(function(){return(0,u.KB)(e,i,r,n)})),a}function f(e,t,n,i,r){if("multiply"===r)e[t]*=n[0],e[t+1]*=n[1],e[t+2]*=n[2],e[t+3]*=n[3];else{var o=(0,a._Y)({r:e[t],g:e[t+1],b:e[t+2]});o.h=i.h,o.s=i.s,o.v=o.v/100*i.v;var l=(0,a.xr)(o);e[t]=l.r,e[t+1]=l.g,e[t+2]=l.b,e[t+3]*=n[3]}}function h(e,t,n,s,u){return function(e,t,n){return e?(0,r.Z)(e,{responseType:"image"}).then((function(e){var i=e.data,r=i.width,a=i.height,o=r/a,l=t;if(n){var s=Math.max(r,a);l=Math.min(l,s)}return{image:i,width:o<=1?Math.ceil(l*o):l,height:o<=1?l:Math.ceil(l/o)}})):Promise.reject(new o.Z("renderUtils: imageDataSize","href not provided."))}(e,t,u).then((function(r){var o,u,c=null!==(o=r.width)&&void 0!==o?o:t,d=null!==(u=r.height)&&void 0!==u?u:t;if(r.image&&function(e,t){return!(!e||"ignore"===t)&&("multiply"!==t||255!==e.r||255!==e.g||255!==e.b||1!==e.a)}(n,s)){var p=r.image.width,h=r.image.height;(0,l.Z)("edge")&&/\.svg$/i.test(e)&&(p-=1,h-=1);var v=function(e,t){e=Math.ceil(e),t=Math.ceil(t);var n=document.createElement("canvas");n.width=e,n.height=t,n.style.width=e+"px",n.style.height=t+"px";var i=n.getContext("2d");return i.clearRect(0,0,e,t),i}(c,d);v.drawImage(r.image,0,0,p,h,0,0,c,d);for(var m=v.getImageData(0,0,c,d),y=[n.r/255,n.g/255,n.b/255,n.a],g=(0,a._Y)(n),b=0;b<m.data.length;b+=4)f(m.data,b,y,g,s);v.putImageData(m,0,0),e=v.canvas.toDataURL("image/png")}else{var _=null===i.id||void 0===i.id?void 0:i.id.findCredential(e);if(null!==_&&void 0!==_&&_.token){var w=e.includes("?")?"&":"?";e="".concat(e).concat(w,"token=").concat(_.token)}}return{url:e,width:c,height:d}})).catch((function(){return{url:e,width:t,height:t}}))}},99653:function(e,t,n){n.d(t,{KB:function(){return z}});var i=n(37762),r=n(51995),a=n(93169),o=n(92026),l=n(11245),s=n(22018),u=(n(80975),n(67005)),c="http://www.w3.org/2000/svg",d=0,p=0,f=(0,a.Z)("android"),h=(0,a.Z)("chrome")||f&&f>=4?"auto":"optimizeLegibility",v={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},m=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g,y={},g={},b={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},_=Math.PI,w=1;function k(e,t){var n=e*(_/180);return Math.abs(t*Math.sin(n))+Math.abs(t*Math.cos(n))}function x(e){return e.map((function(e){return"".concat(e.command," ").concat(e.values.join(" "))})).join(" ").trim()}function C(e,t,n,i){if(e){if("circle"===e.type)return(0,u.u)("circle",{cx:e.cx,cy:e.cy,fill:t,"fill-rule":"evenodd",r:e.r,stroke:n.color,"stroke-dasharray":n.dashArray,"stroke-dashoffset":n.dashOffset,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-miterlimit":"4","stroke-width":n.width});if("ellipse"===e.type)return(0,u.u)("ellipse",{cx:e.cx,cy:e.cy,fill:t,"fill-rule":"evenodd",rx:e.rx,ry:e.ry,stroke:n.color,"stroke-dasharray":n.dashArray,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-miterlimit":"4","stroke-width":n.width});if("rect"===e.type)return(0,u.u)("rect",{fill:t,"fill-rule":"evenodd",height:e.height,stroke:n.color,"stroke-dasharray":n.dashArray,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-miterlimit":"4","stroke-width":n.width,width:e.width,x:e.x,y:e.y});if("image"===e.type)return(0,u.u)("image",{height:e.height,href:e.src,preserveAspectRatio:"none",width:e.width,x:e.x,y:e.y});if("path"===e.type){var r="string"!=typeof e.path?x(e.path):e.path;return(0,u.u)("path",{d:r,fill:t,"fill-rule":"evenodd",stroke:n.color,"stroke-dasharray":n.dashArray,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-miterlimit":"4","stroke-width":n.width})}if("text"===e.type)return(0,o.O3)(i),(0,u.u)("text",{"dominant-baseline":i.dominantBaseline,fill:t,"fill-rule":"evenodd","font-family":i.font.family,"font-size":i.font.size,"font-style":i.font.style,"font-variant":i.font.variant,"font-weight":i.font.weight,kerning:i.kerning,rotate:i.rotate,stroke:n.color,"stroke-dasharray":n.dashArray,"stroke-linecap":n.cap,"stroke-linejoin":n.join,"stroke-miterlimit":"4","stroke-width":n.width,"text-anchor":i.align,"text-decoration":i.decoration,"text-rendering":h,x:e.x,y:e.y},e.text)}return null}function M(e){var t={fill:"none",pattern:null,linearGradient:null};if(e)if("type"in e&&"pattern"===e.type){var n="patternId-"+ ++d;t.fill="url(#".concat(n,")"),t.pattern={id:n,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}}}else if("type"in e&&"linear"===e.type){var i="linearGradientId-"+ ++p;t.fill="url(#".concat(i,")"),t.linearGradient={id:i,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map((function(e){return{offset:e.offset,color:e.color&&new r.Z(e.color).toString()}}))}}else if(e){var a=new r.Z(e);t.fill=a.toString()}return t}function I(e){var t={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};if(e&&(null!=e.width&&(t.width=e.width),e.cap&&(t.cap=e.cap),e.join&&(t.join=e.join.toString()),e.color&&(t.color=new r.Z(e.color).toString()),e.dashArray&&(t.dashArray=e.dashArray),e.dashArray&&(t.dashOffset=e.dashoffset),e.style)){var n=null;if(e.style in b&&(n=b[e.style]),Array.isArray(n)){var i;n=n.slice(0);for(var a=null!==(i=e.width)&&void 0!==i?i:0,o=0;o<n.length;++o)n[o]*=a;if("butt"!==e.cap){for(var l=0;l<n.length;l+=2)n[l]-=a,n[l]<1&&(n[l]=1);for(var s=1;s<n.length;s+=2)n[s]+=a}n=n.join(",")}t.dashArray=n}return t}function F(e,t){var n={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(e){var i=e.alignBaseline,r="baseline"===i?"auto":"top"===i?"text-top":"bottom"===i?"hanging":i;n.align=e.align,n.dominantBaseline=r,n.decoration=e.decoration,n.kerning=e.kerning?"auto":"0",n.rotate=e.rotated?"90":"0",(0,o.O3)(t),n.font.style=t.style||"normal",n.font.variant=t.variant||"normal",n.font.weight=t.weight||"normal",n.font.size=t.size&&t.size.toString()||"10pt",n.font.family=t.family||"serif"}return n}function Z(e){var t=e.pattern,n=e.linearGradient;if(t)return(0,u.u)("pattern",{height:t.height,id:t.id,patternUnits:"userSpaceOnUse",width:t.width,x:t.x,y:t.y},(0,u.u)("image",{height:t.image.height,href:t.image.href,width:t.image.width,x:t.image.x,y:t.image.y}));if(n){var i=n.stops.map((function(e,t){return(0,u.u)("stop",{key:"".concat(t,"-stop"),offset:e.offset,"stop-color":e.color})}));return(0,u.u)("linearGradient",{gradientUnits:"userSpaceOnUse",id:n.id,x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2},i)}return null}function A(e,t){if(!e||0===e.length)return null;var n,r=[],a=(0,i.Z)(e);try{for(a.s();!(n=a.n()).done;){var o=n.value,l=o.shape,s=o.fill,c=o.stroke,d=o.font,p=M(s),f=I(c),h="text"===l.type?F(l,d):null,v=C(l,p.fill,f,h);v&&r.push(v)}}catch(m){a.e(m)}finally{a.f()}return(0,u.u)("mask",{id:t,maskUnits:"userSpaceOnUse"},(0,u.u)("g",null,r))}function L(e,t,n){return(0,s.t)(e,(0,s.c)(e),[t,n])}function E(e,t,n,i,r){return(0,s.s)(e,(0,s.c)(e),[t,n]),e[4]=e[4]*t-i*t+i,e[5]=e[5]*n-r*n+r,e}function P(e,t){y&&"left"in y?(null!=y.left&&y.left>e&&(y.left=e),(null==y.right||y.right<e)&&(y.right=e),(null==y.top||y.top>t)&&(y.top=t),(null==y.bottom||y.bottom<t)&&(y.bottom=t)):y={left:e,bottom:t,right:e,top:t}}function T(e){var t,n=e.args,i=n.length;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(t=0;t<i;t+=2)P(n[t],n[t+1]);g.x=n[i-2],g.y=n[i-1];break;case"H":for(t=0;t<i;++t)P(n[t],g.y);g.x=n[i-1];break;case"V":for(t=0;t<i;++t)P(g.x,n[t]);g.y=n[i-1];break;case"m":var r=0;"x"in g||(P(g.x=n[0],g.y=n[1]),r=2);for(t=r;t<i;t+=2)P(g.x+=n[t],g.y+=n[t+1]);break;case"l":case"t":for(t=0;t<i;t+=2)P(g.x+=n[t],g.y+=n[t+1]);break;case"h":for(t=0;t<i;++t)P(g.x+=n[t],g.y);break;case"v":for(t=0;t<i;++t)P(g.x,g.y+=n[t]);break;case"c":for(t=0;t<i;t+=6)P(g.x+n[t],g.y+n[t+1]),P(g.x+n[t+2],g.y+n[t+3]),P(g.x+=n[t+4],g.y+=n[t+5]);break;case"s":case"q":for(t=0;t<i;t+=4)P(g.x+n[t],g.y+n[t+1]),P(g.x+=n[t+2],g.y+=n[t+3]);break;case"A":for(t=0;t<i;t+=7)P(n[t+5],n[t+6]);g.x=n[i-2],g.y=n[i-1];break;case"a":for(t=0;t<i;t+=7)P(g.x+=n[t+5],g.y+=n[t+6])}}function S(e,t,n){var i,r=v[e.toLowerCase()];"number"==typeof r&&(r?t.length>=r&&(i={action:e,args:t.slice(0,t.length-t.length%r)},n.push(i),T(i)):(i={action:e,args:[]},n.push(i),T(i)))}function R(e){var t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){var n=function(e){var t=("string"!=typeof e.path?x(e.path):e.path).match(m),n=[];if(y={},g={},!t)return null;for(var i="",r=[],a=t.length,o=0;o<a;++o){var l=t[o],s=parseFloat(l);isNaN(s)?(i&&S(i,r,n),r=[],i=l):r.push(s)}S(i,r,n);var u={x:0,y:0,width:0,height:0};return y&&"left"in y&&(u.x=y.left,u.y=y.top,u.width=y.right-y.left,u.height=y.bottom-y.top),u}(e);t.x=n.x,t.y=n.y,t.width=n.width,t.height=n.height}return t}function O(e){var t,n={x:0,y:0,width:0,height:0},r=null,a=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY,l=(0,i.Z)(e);try{for(l.s();!(t=l.n()).done;){var s=t.value;r?(r.x=Math.min(r.x,s.x),r.y=Math.min(r.y,s.y),a=Math.max(a,s.x+s.width),o=Math.max(o,s.y+s.height)):((r=n).x=s.x,r.y=s.y,a=s.x+s.width,o=s.y+s.height)}}catch(u){l.e(u)}finally{l.f()}return r&&(r.width=a-r.x,r.height=o-r.y),r}function N(e,t,n,i,r,a,o,u,c){var d=(o&&a?k(a,t):t)/2,p=(o&&a?k(a,n):n)/2;if(c){var f=c[0],h=c[1];d=(o&&a?k(a,f):f)/2,p=(o&&a?k(a,h):h)/2}var v=e.width+i,m=e.height+i,y=(0,l.c)(),g=(0,l.c)(),b=!1;if(r&&0!==v&&0!==m){var _=t!==n?t/n:v/m,w=t>n?t:n,x=1,C=1;isNaN(w)||(_>1?(x=w/v,C=w/_/m):(C=w/m,x=w*_/v)),(0,s.m)(g,g,E(y,x,C,d,p)),b=!0}var M=e.x+(v-i)/2,I=e.y+(m-i)/2;if((0,s.m)(g,g,L(y,d-M,p-I)),!b&&(v>t||m>n)){var F=v/t>m/n,Z=(F?t:n)/(F?v:m);(0,s.m)(g,g,E(y,Z,Z,M,I))}return a&&(0,s.m)(g,g,function(e,t,n,i){var r=t%360*Math.PI/180;(0,s.r)(e,(0,s.c)(e),r);var a=Math.cos(r),o=Math.sin(r),l=e[4],u=e[5];return e[4]=l*a-u*o+i*o-n*a+n,e[5]=u*a+l*o-n*o-i*a+i,e}(y,a,M,I)),u&&(0,s.m)(g,g,L(y,u[0],u[1])),"matrix(".concat(g[0],",").concat(g[1],",").concat(g[2],",").concat(g[3],",").concat(g[4],",").concat(g[5],")")}function z(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=[],l=[],s=++w,d=function(e,t,n){var i=null===e||void 0===e?void 0:e.effects.find((function(e){return"bloom"===e.type}));if(!i)return null;var r=i.strength,a=i.radius,o=r>0?a:0,l=(r+o)*t,s=4*r+1;return(0,u.u)("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:"bloom".concat(n),width:"300%",x:"-100%",y:"-100%"},(0,u.u)("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:(r+.5*o)*(Math.pow(5,t/100)*(.4+t/100)),result:"dilate"}),(0,u.u)("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:l/25}),(0,u.u)("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:l/50}),(0,u.u)("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},(0,u.u)("feFuncR",{slope:s,type:"linear"}),(0,u.u)("feFuncG",{slope:s,type:"linear"}),(0,u.u)("feFuncB",{slope:s,type:"linear"})),(0,u.u)("feMerge",null,(0,u.u)("feMergeNode",{in:"intensityBlur"}),(0,u.u)("feMergeNode",{in:"intensityBrightness"}),(0,u.u)("feGaussianBlur",{stdDeviation:r/10})))}(r.effectView,t,s),p=null;if(d){var f,h=null===(f=r.effectView)||void 0===f?void 0:f.effects.find((function(e){return"bloom"===e.type})),v=(h.strength?h.strength+h.radius/2:0)/3,m=t+t*v,y=n+n*v;p=[Math.max(m,10),Math.max(y,10)]}for(var g=0;g<e.length;g++){var b,_,x,L=e[g],E=[],P=[],T=0,S=0,z=0,V=(0,i.Z)(L);try{for(V.s();!(x=V.n()).done;){var B=x.value,D=B.shape,j=B.fill,q=B.stroke,W=B.font,H=B.offset;r.ignoreStrokeWidth||"text"===D.type||(T+=(null===q||void 0===q?void 0:q.width)||0);var Y=M(j),U=I(q),G="text"===D.type?F(D,W):null;a.push(Z(Y)),E.push(C(D,Y.fill,U,G)),P.push(R(D)),H&&(S+=H[0],z+=H[1])}}catch(K){V.e(K)}finally{V.f()}var J=N(O(P),t,n,T,null!==(b=r.scale)&&void 0!==b&&b,r.rotation,null!==(_=r.useRotationSize)&&void 0!==_&&_,[S,z],p),Q=null;if(r.masking){var $="mask-".concat(g),X=r.masking[g];a.push(A(X,$)),Q="url(#".concat($,")")}l.push(Q?(0,u.u)("g",{mask:Q},(0,u.u)("g",{transform:J},E)):(0,u.u)("g",{transform:J},E))}r.useRotationSize&&r.rotation&&(t=k(r.rotation,t),n=k(r.rotation,n)),d&&((0,o.O3)(p),t=p[0],n=p[1]);return(0,u.u)("svg",{"aria-labelledby":r.ariaLabel,focusable:!1,height:n,role:"img",style:"display: block;",width:t,xmlns:c},d,(0,u.u)("defs",null,a),d?(0,u.u)("g",{filter:"url(#bloom".concat(s,")")},l):l)}},19951:function(e,t,n){n.r(t),n.d(t,{fetchSymbolFromStyle:function(){return v},getStyleItemFromStyle:function(){return h},resolveWebStyleSymbol:function(){return f}});var i=n(51508),r=n(71277),a=n(10064),o=n(35995),l=n(7575),s=n(53283),u=n(42283),c=n(1472),d=n(38048),p=n(81854);function f(e,t,n,i){var r=e.name;return null==r?Promise.reject(new a.Z("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):e.styleName&&"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,n){var i=d.wm.replaceAll(/\{SymbolName\}/gi,e),r=null!=t.portal?t.portal:l.Z.getDefault();return(0,d.EJ)(i,n).then((function(e){var t=(0,d.KV)(e.data);return(0,u.im)(t,{portal:r,url:(0,o.mN)((0,o.Yd)(i)),origin:"portal-item"})}))}(r,t,i):(0,d.n2)(e,t,i).then((function(e){return v(e,r,t,n,d.v9,i)}))}function h(e,t){return t.items.find((function(t){return t.name===e}))}function v(e,t,n,f,v,m){var y,g,b,_,w=null!=(null===n||void 0===n?void 0:n.portal)?n.portal:l.Z.getDefault(),k={portal:w,url:(0,o.mN)(e.baseUrl),origin:"portal-item"},x=h(t,e.data);if(!x){var C="The symbol name '".concat(t,"' could not be found");return Promise.reject(new a.Z("symbolstyleutils:symbol-name-not-found",C,{symbolName:t}))}var M=(0,s.f)(v(x,f),k),I=null!==(y=null===(g=x.thumbnail)||void 0===g?void 0:g.href)&&void 0!==y?y:null,F=null===(b=x.thumbnail)||void 0===b?void 0:b.imageData;(0,r.XO)()&&(M=null!==(_=(0,r.pJ)(M))&&void 0!==_?_:"",I=(0,r.pJ)(I));var Z={portal:w,url:(0,o.mN)((0,o.Yd)(M)),origin:"portal-item"};return(0,d.EJ)(M,m).then((function(r){var a="cimRef"===f?(0,d.KV)(r.data):r.data,o=(0,u.im)(a,Z);if(o&&(0,i.dU)(o)){if(I){var l=(0,s.f)(I,k);o.thumbnail=new p.p({url:l})}else F&&(o.thumbnail=new p.p({url:"data:image/png;base64,".concat(F)}));e.styleUrl?o.styleOrigin=new c.Z({portal:n.portal,styleUrl:e.styleUrl,name:t}):e.styleName&&(o.styleOrigin=new c.Z({portal:n.portal,styleName:e.styleName,name:t}))}return o}))}},14971:function(e,t,n){n.r(t),n.d(t,{default:function(){return Vr}});var i=n(29439),r=n(74165),a=n(15861),o=n(4942),l=n(1413),s=n(15671),u=n(43144),c=n(60136),d=n(29388),p=n(27366),f=n(44927),h=n(32718),v=n(94172),m=n(49861),y=(n(25243),n(63780)),g=(n(93169),n(69912)),b=n(6945),_=n(93433),w=n(97326),k=(n(59166),n(40281)),x=n(98928),C=n(14916),M=n(89125),I=n(33565),F=n(10064),Z=n(70116),A=(n(17768),n(16889)),L=n(68860);function E(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"arithmetic";return{type:(0,L.UF)(t),value:e,unit:t,rotationType:n}}(function(e,t){(0,L.UF)(t)})(0,"meters"),function(e,t){(0,L.UF)(t)}(0,"square-meters"),E(0,"radians"),E(0,"degrees");var P=n(643),T=n(6291);new Map;var S=["B","kB","MB","GB","TB"];var R=n(52639),O=n(7138),N=n(11812),z=n(99837),V=n(76969),B=n(37270),D=n(37933),j=n(62734),q=n(819),W=n(6701),H=h.Z.getLogger("esri.widgets.Feature.support.featureUtils"),Y=/href=(""|'')/gi,U=/(\{([^\{\r\n]+)\})/g,G=/\'/g,J=/^\s*expression\//i,Q=/(\n)/gi,$=/[\u00A0-\u9999<>\&]/gim,X=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi,K=/^(?:mailto:|tel:)/,ee="relationships/",te=(0,V.Ze)("short-date-short-time");function ne(e){var t;if(null!=e)return null!==(t=e.sourceLayer||e.layer)&&void 0!==t?t:void 0}function ie(e,t){return re.apply(this,arguments)}function re(){return(re=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return","function"==typeof t?t(n):t);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(e)return!K.test(e.trim().toLowerCase())}function oe(e){return!!e&&J.test(e)}function le(e,t){var n=function(e,t){if(!oe(t)||!e)return null;var n=t.replace(J,"").toLowerCase(),i=null;return e.some((function(e){return e.name.toLowerCase()===n&&(i=e,!0)})),i}(t,null===e||void 0===e?void 0:e.fieldName);return n?n.title||null:e?e.label||e.fieldName:null}function se(e,t){var n=ue(t,e);return n?n.name:e}function ue(e,t){var n;return e&&"function"==typeof e.getField&&t&&null!==(n=e.getField(t))&&void 0!==n?n:null}function ce(e){return"".concat(e).trim()}function de(e){var t=e.attributes,n=e.globalAttributes,i=e.layer,r=e.text,a=e.expressionAttributes,o=e.fieldInfoMap;return r?pe({formattedAttributes:n,template:ve(r,(0,l.Z)((0,l.Z)((0,l.Z)({},n),a),t),i),fieldInfoMap:o}):""}function pe(e){var t=e.formattedAttributes,n=e.template,i=e.fieldInfoMap;return ce(function(e){return e.replaceAll(Y,"")}((0,P.gx)((0,P.gx)(n,(function(e){return function(e,t){var n=t.get(e.toLowerCase());return"{".concat((null===n||void 0===n?void 0:n.fieldName)||e,"}")}(e,i)})),t)))}function fe(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,l.Z)({},e);return Object.keys(n).forEach((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=t[e];if("string"==typeof i){var r=(n?encodeURIComponent(i):i).replaceAll(G,"%27");t[e]=r}}(e,n,t)})),n}function he(e,t){return e.replaceAll(U,(function(e,n,i){var r=ue(t,i);return r?"{".concat(r.name,"}"):n}))}function ve(e,t,n){var i=he(e,n);return i?i.replaceAll(X,(function(e,n,i){return function(e,t,n){var i=(t=ce(t))&&"{"!==t[0];return(0,P.gx)(e,fe(n,i||!1))}(e,n||i,t)})):i}function me(e){return function(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type)&&"when"in e}(e)&&function(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}(e)}function ye(e,t){var n=t.fieldInfos,i=t.fieldName,r=t.preventPlacesFormatting,a=t.layer,o=t.timeZone,s=be(n,i),u=ue(a,i);if(s&&!(0,B.Ec)(i)){var c,d=null===u||void 0===u?void 0:u.type,p=null===(c=s.format)||void 0===c?void 0:c.dateFormat;if("date"===d||"date-only"===d||"time-only"===d||"timestamp-offset"===d||p)return(0,j.$8)(e,{format:p,fieldType:d,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a))&&!!a.datesInUnknownTimezone}})}var f=null===s||void 0===s?void 0:s.format;return"string"==typeof e&&(0,B.Ec)(i)&&f?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?ge(e,",",", ",t):e.includes(";")?ge(e,";","; ",t):e.includes(" ")?ge(e," "," ",t):(0,T.uf)(Number(e),(0,T.sh)(t))}(e,f):"string"==typeof(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){var n=Number(e);if(!isNaN(n))return n}return e}(e,f))||null==e||null==f?ke(e):(0,T.uf)(e,r?(0,l.Z)((0,l.Z)({},(0,T.sh)(f)),{},{minimumFractionDigits:0,maximumFractionDigits:20}):(0,T.sh)(f))}function ge(e,t,n,i){return e.trim().split(t).map((function(e){return(0,T.uf)(Number(e),(0,T.sh)(i))})).join(n)}function be(e,t){if(null!==e&&void 0!==e&&e.length&&t)return e.find((function(e){var n;return(null===(n=e.fieldName)||void 0===n?void 0:n.toLowerCase())===t.toLowerCase()}))}function _e(e){var t=[];if(!e)return t;var n=e.fieldInfos,i=e.content;return n&&t.push.apply(t,(0,_.Z)(n)),i&&Array.isArray(i)?(i.forEach((function(e){if("fields"===e.type){var n=null===e||void 0===e?void 0:e.fieldInfos;n&&t.push.apply(t,(0,_.Z)(n))}})),t):t}function we(e){return e.replaceAll($,(function(e){return"&#".concat(e.charCodeAt(0),";")}))}function ke(e){return"string"==typeof e?e.replaceAll(Q,'<br class="esri-text-new-line" />'):e}function xe(e){var t,n=e.value,i=e.fieldName,r=e.fieldInfos,a=e.fieldInfoMap,o=e.layer,l=e.graphic,s=e.timeZone;if(null==n)return"";var u=function(e){var t=e.fieldName,n=e.value,i=e.graphic,r=e.layer;if(Ee(t))return null;if(!r||"function"!=typeof r.getFieldDomain)return null;var a=i&&r.getFieldDomain(t,{feature:i});return a&&"coded-value"===a.type?a.getName(n):null}({fieldName:i,value:n,graphic:l,layer:o});if(u)return u;var c=function(e){var t=e.fieldName,n=e.graphic,i=e.layer;if(Ee(t))return null;if(!i||"function"!=typeof i.getFeatureType)return null;var r=i.typeIdField;if(!r||t!==r)return null;var a=i.getFeatureType(n);return a?a.name:null}({fieldName:i,graphic:l,layer:o});if(c)return c;if(a.get(i.toLowerCase()))return ye(n,{fieldInfos:r||Array.from(a.values()),fieldName:i,layer:o,timeZone:s});var d=null===o||void 0===o||null===(t=o.fieldsIndex)||void 0===t?void 0:t.get(i);return d&&((0,j.a8)(d)||(0,B.sX)(d))?(0,j.$8)(n,{fieldType:d.type,timeZoneOptions:{layerTimeZone:o&&"preferredTimeZone"in o?o.preferredTimeZone:null,viewTimeZone:s,datesInUnknownTimezone:!(!o||!("datesInUnknownTimezone"in o))&&!!o.datesInUnknownTimezone}}):ke(n)}function Ce(e){var t=e.fieldInfos,n=e.attributes,i=e.layer,r=e.graphic,a=e.fieldInfoMap,o=e.relatedInfos,l=e.timeZone,s={};return null!==o&&void 0!==o&&o.forEach((function(e){return function(e){var t,n,i=e.attributes,r=e.relatedInfo,a=e.fieldInfoMap,o=e.fieldInfos,l=e.layer,s=e.timeZone;i&&r&&(null!==(t=r.relatedFeatures)&&void 0!==t&&t.forEach((function(e){return Pe({attributes:i,graphic:e,relatedInfo:r,fieldInfoMap:a,fieldInfos:o,layer:l,timeZone:s})})),null===(n=r.relatedStatsFeatures)||void 0===n||n.forEach((function(e){return Pe({attributes:i,graphic:e,relatedInfo:r,fieldInfoMap:a,fieldInfos:o,layer:l,timeZone:s})})))}({attributes:s,relatedInfo:e,fieldInfoMap:a,fieldInfos:t,layer:i,timeZone:l})})),n&&Object.keys(n).forEach((function(e){var o=n[e];s[e]=xe({fieldName:e,fieldInfos:t,fieldInfoMap:a,layer:i,value:o,graphic:r,timeZone:l})})),s}function Me(e,t){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,l,s,u,c,d,p,f,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.layer,o=t.graphic,l=t.outFields,s=t.objectIds,u=t.returnGeometry,c=t.spatialReference,"number"==typeof(d=s[0])||"string"==typeof d){e.next=4;break}return"Could not query required fields for the specified feature. The feature's ID is invalid.",p={layer:a,graphic:o,objectId:d,requiredFields:l},e.abrupt("return",(H.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",p),null));case 4:if(null!==(i=(0,D.S1)(a))&&void 0!==i&&null!==(i=i.operations)&&void 0!==i&&i.supportsQuery){e.next=7;break}return"The specified layer cannot be queried. The following fields will not be available.",f={layer:a,graphic:o,requiredFields:l,returnGeometry:u},e.abrupt("return",(H.warn("The specified layer cannot be queried. The following fields will not be available.",f),null));case 7:return(h=a.createQuery()).objectIds=s,h.outFields=null!==l&&void 0!==l&&l.length?l:[a.objectIdField],h.returnGeometry=!!u,h.returnZ=!!u,h.returnM=!!u,h.outSpatialReference=c,e.next=11,a.queryFeatures(h,n);case 11:return e.abrupt("return",e.sent.features[0]);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fe(e){return Ze.apply(this,arguments)}function Ze(){return(Ze=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(n=t.expressionInfos)&&void 0!==n&&n.length){e.next=2;break}return e.abrupt("return",!1);case 2:return e.next=4,(0,q.LC)();case 4:return i=e.sent,a=i.arcadeUtils.hasGeometryFunctions,e.abrupt("return",a(t));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ae(e,t){return Le.apply(this,arguments)}function Le(){return(Le=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o,s,u,c,d,p,f,h,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.graphic,a=t.popupTemplate,o=t.layer,s=t.spatialReference,o&&a){e.next=3;break}return e.abrupt("return");case 3:if(e.t0="function"==typeof o.load,!e.t0){e.next=7;break}return e.next=7,o.load(n);case 7:if(i.attributes){e.next=9;break}return e.abrupt("return");case 9:if(null!=(u=i.attributes[o.objectIdField])){e.next=12;break}return e.abrupt("return");case 12:return c=[u],e.next=15,a.getRequiredFields(o.fieldsIndex);case 15:if(d=e.sent,p=(0,B.R9)(d,i),f=p?[]:d,e.t1=a.returnGeometry,e.t1){e.next=23;break}return e.next=22,Fe(a);case 22:e.t1=e.sent;case 23:if(h=e.t1,!p||h){e.next=26;break}return e.abrupt("return");case 26:return e.next=28,Me({layer:o,graphic:i,outFields:f,objectIds:c,returnGeometry:h,spatialReference:s},n);case 28:(v=e.sent)&&(v.geometry&&(i.geometry=v.geometry),v.attributes&&(i.attributes=(0,l.Z)((0,l.Z)({},i.attributes),v.attributes)));case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ee(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!e&&e.includes(ee)}function Pe(e){var t=e.attributes,n=e.graphic,i=e.relatedInfo,r=e.fieldInfos,a=e.fieldInfoMap,o=e.layer,l=e.timeZone;t&&n&&i&&Object.keys(n.attributes).forEach((function(e){var s=function(e){return e?"".concat(ee).concat(e.layerId,"/").concat(e.fieldName):""}({layerId:i.relation.id.toString(),fieldName:e}),u=n.attributes[e];t[s]=xe({fieldName:s,fieldInfos:r,fieldInfoMap:a,layer:o,value:u,graphic:n,timeZone:l})}))}var Te=function(e){if(!e)return!1;var t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},Se=function(e){var t,n=e.layer,i=e.method,r=e.query,a=e.definitionExpression;if(null!==(t=n.capabilities)&&void 0!==t&&null!==(t=t.query)&&void 0!==t&&t.supportsCacheHint&&"attachments"!==i){var o=null!=r.where?r.where:null,l=null!=r.geometry?r.geometry:null;Te(a)||Te(o)||"extent"===(null===l||void 0===l?void 0:l.type)||"tile"===r.resultType||(r.cacheHint=!0)}};function Re(e,t,n){var i="scene"===t.type&&t.associatedLayer?t.associatedLayer.url:t.url;return e.filter(me).find((function(e){return e!==t&&e.url===i&&e.layerId===n.relatedTableId}))}var Oe={editing:!1,operations:{add:!0,update:!0,delete:!0}},Ne=k.Z.ofType(N.Z),ze=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._getAttachmentsPromise=null,i._attachmentLayer=null,i.capabilities=(0,l.Z)({},Oe),i.activeAttachmentInfo=null,i.activeFileInfo=null,i.attachmentInfos=new Ne,i.fileInfos=new k.Z,i.graphic=null,i.mode="view",i.filesEnabled=!1,i.addHandles((0,v.YP)((function(){return i.graphic}),(function(){return i._graphicChanged()}),v.nn)),i}return(0,u.Z)(n,[{key:"destroy",value:function(){this._attachmentLayer=null,this.graphic=null}},{key:"castCapabilities",value:function(e){return(0,l.Z)((0,l.Z)({},Oe),e)}},{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){var e=this.graphic;if(!e)return!1;var t=e.layer||e.sourceLayer;return(null===t||void 0===t?void 0:t.loaded)&&"capabilities"in t&&t.capabilities&&"operations"in t.capabilities&&"supportsResizeAttachments"in t.capabilities.operations&&t.capabilities.operations.supportsResizeAttachments||!1}},{key:"getAttachments",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i,a,o,l,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._attachmentLayer,n=this.attachmentInfos,t&&"function"==typeof t.queryAttachments){e.next=3;break}throw new F.Z("invalid-layer","getAttachments(): A valid layer is required.");case 3:return i=this._getObjectId(),a=new z.Z({objectIds:[i],returnMetadata:!0}),o=[],l=t.queryAttachments(a).then((function(e){return e[i]||o})).catch((function(){return o})),this._getAttachmentsPromise=l,this.notifyChange("state"),e.next=7,l;case 7:return s=e.sent,e.abrupt("return",(n.removeAll(),s.length&&n.addMany(s),this._getAttachmentsPromise=null,this.notifyChange("state"),s));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addAttachment",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c=this,d=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=d.length>1&&void 0!==d[1]?d[1]:this.graphic,a=this._attachmentLayer,o=this.attachmentInfos,l=this.capabilities,i){e.next=4;break}throw new F.Z("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:i});case 4:if(t){e.next=6;break}throw new F.Z("invalid-attachment","addAttachment(): An attachment is required.",{attachment:t});case 6:if(null!==(n=l.operations)&&void 0!==n&&n.add){e.next=8;break}throw new F.Z("invalid-capabilities","addAttachment(): add capabilities are required.");case 8:if(a&&"function"==typeof a.addAttachment){e.next=10;break}throw new F.Z("invalid-layer","addAttachment(): A valid layer is required.");case 10:return s=a.addAttachment(i,t).then((function(e){return c._queryAttachment(e.objectId,i)})),e.next=13,s;case 13:return u=e.sent,e.abrupt("return",(o.add(u),u));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteAttachment",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._attachmentLayer,a=this.attachmentInfos,o=this.graphic,l=this.capabilities,t){e.next=3;break}throw new F.Z("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:t});case 3:if(null!==(n=l.operations)&&void 0!==n&&n.delete){e.next=5;break}throw new F.Z("invalid-capabilities","deleteAttachment(): delete capabilities are required.");case 5:if(i&&"function"==typeof i.deleteAttachments){e.next=7;break}throw new F.Z("invalid-layer","deleteAttachment(): A valid layer is required.");case 7:if(o){e.next=9;break}throw new F.Z("invalid-graphic","deleteAttachment(): A graphic is required.");case 9:return s=i.deleteAttachments(o,[t.id]).then((function(){return t})),e.next=12,s;case 12:return u=e.sent,e.abrupt("return",(a.remove(u),u));case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateAttachment",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c,d,p=this,f=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=f.length>1&&void 0!==f[1]?f[1]:this.activeAttachmentInfo,a=this._attachmentLayer,o=this.attachmentInfos,l=this.graphic,s=this.capabilities,t){e.next=4;break}throw new F.Z("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:t});case 4:if(i){e.next=6;break}throw new F.Z("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:i});case 6:if(null!==(n=s.operations)&&void 0!==n&&n.update){e.next=8;break}throw new F.Z("invalid-capabilities","updateAttachment(): Update capabilities are required.");case 8:if(u=o.indexOf(i),a&&"function"==typeof a.updateAttachment){e.next=11;break}throw new F.Z("invalid-layer","updateAttachment(): A valid layer is required.");case 11:if(l){e.next=13;break}throw new F.Z("invalid-graphic","updateAttachment(): A graphic is required.");case 13:return c=a.updateAttachment(l,i.id,t).then((function(e){return p._queryAttachment(e.objectId)})),e.next=16,c;case 16:return d=e.sent,e.abrupt("return",(o.splice(u,1,d),d));case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"commitFiles",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.fileInfos.items.map((function(e){return t.addAttachment(e.form)})));case 2:return this.fileInfos.removeAll(),e.abrupt("return",this.getAttachments());case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addFile",value:function(e,t){if(!e||!t)return null;var n={file:e,form:t};return this.fileInfos.add(n),n}},{key:"updateFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.activeFileInfo;if(!e||!t||!n)return null;var i=this.fileInfos.indexOf(n);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}},{key:"deleteFile",value:function(e){var t=this.fileInfos.find((function(t){return t.file===e}));return t?(this.fileInfos.remove(t),t):null}},{key:"_queryAttachment",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this._attachmentLayer,t&&null!==i&&void 0!==i&&i.queryAttachments){e.next=3;break}throw new F.Z("invalid-attachment-id","Could not query attachment.");case 3:return a=this._getObjectId(n),o=new z.Z({objectIds:[a],attachmentsWhere:"AttachmentId=".concat(t),returnMetadata:!0}),e.abrupt("return",i.queryAttachments(o).then((function(e){return e[a][0]})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getObjectId",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.graphic;return null!==(e=null===t||void 0===t?void 0:t.getObjectId())&&void 0!==e?e:null}},{key:"_graphicChanged",value:function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch((function(){})))}},{key:"_setAttachmentLayer",value:function(){var e=ne(this.graphic);this._attachmentLayer=e?"scene"===e.type&&null!=e.associatedLayer?e.associatedLayer:e:null}}]),n}(O.Z);(0,p._)([(0,m.Cb)()],ze.prototype,"capabilities",void 0),(0,p._)([(0,M.p)("capabilities")],ze.prototype,"castCapabilities",null),(0,p._)([(0,m.Cb)()],ze.prototype,"activeAttachmentInfo",void 0),(0,p._)([(0,m.Cb)()],ze.prototype,"activeFileInfo",void 0),(0,p._)([(0,m.Cb)({readOnly:!0,type:Ne})],ze.prototype,"attachmentInfos",void 0),(0,p._)([(0,m.Cb)()],ze.prototype,"fileInfos",void 0),(0,p._)([(0,m.Cb)({type:R.Z})],ze.prototype,"graphic",void 0),(0,p._)([(0,m.Cb)()],ze.prototype,"mode",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ze.prototype,"state",null),(0,p._)([(0,m.Cb)()],ze.prototype,"filesEnabled",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ze.prototype,"supportsResizeAttachments",null);var Ve=ze=(0,p._)([(0,g.j)("esri.widgets.Attachments.AttachmentsViewModel")],ze),Be=n(65905);function De(e){var t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t}var je=n(8905),qe=n(7021),We=n(33095),He=n(80975),Ye=n(80532),Ue=n(67005),Ge={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},Je="esri-attachments",Qe={base:Je,loaderContainer:"".concat(Je,"__loader-container"),loader:"".concat(Je,"__loader"),fadeIn:"".concat(Je,"--fade-in"),container:"".concat(Je,"__container"),containerList:"".concat(Je,"__container--list"),containerPreview:"".concat(Je,"__container--preview"),actions:"".concat(Je,"__actions"),deleteButton:"".concat(Je,"__delete-button"),addAttachmentButton:"".concat(Je,"__add-attachment-button"),errorMessage:"".concat(Je,"__error-message"),items:"".concat(Je,"__items"),item:"".concat(Je,"__item"),itemButton:"".concat(Je,"__item-button"),itemMask:"".concat(Je,"__item-mask"),itemMaskIcon:"".concat(Je,"__item-mask--icon"),itemImage:"".concat(Je,"__image"),itemImageResizable:"".concat(Je,"__image--resizable"),itemLabel:"".concat(Je,"__label"),itemFilename:"".concat(Je,"__filename"),itemChevronIcon:"".concat(Je,"__item-chevron-icon"),itemLink:"".concat(Je,"__item-link"),itemLinkOverlay:"".concat(Je,"__item-link-overlay"),itemLinkOverlayIcon:"".concat(Je,"__item-link-overlay-icon"),itemEditIcon:"".concat(Je,"__item-edit-icon"),itemAddIcon:"".concat(Je,"__item-add-icon"),itemAddButton:"".concat(Je,"__item-add-button"),formNode:"".concat(Je,"__form-node"),fileFieldset:"".concat(Je,"__file-fieldset"),fileLabel:"".concat(Je,"__file-label"),fileName:"".concat(Je,"__file-name"),fileInput:"".concat(Je,"__file-input"),metadata:"".concat(Je,"__metadata"),metadataFieldset:"".concat(Je,"__metadata-fieldset"),progressBar:"".concat(Je,"__progress-bar")},$e=window.CSS,Xe=function(e){(0,c.Z)(i,e);var t=(0,d.Z)(i);function i(e,n){var r;return(0,s.Z)(this,i),(r=t.call(this,e,n)).displayType="auto",r.messages=null,r.messagesUnits=null,r.selectedFile=null,r.submitting=!1,r.viewModel=null,r.visibleElements=(0,l.Z)({},Ge),r._supportsImageOrientation=$e&&$e.supports&&$e.supports("image-orientation","from-image"),r._addAttachmentForm=null,r._updateAttachmentForm=null,r}return(0,u.Z)(i,[{key:"normalizeCtorArgs",value:function(e){var t;return null!==(t=e)&&void 0!==t&&t.viewModel||(e=(0,l.Z)({viewModel:new Ve},e)),e}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,v.on)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.attachmentInfos}),"change",(function(){return e.scheduleRender()})),(0,v.on)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.fileInfos}),"change",(function(){return e.scheduleRender()})),(0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.mode}),(function(){return e._modeChanged()}),v.nn)])}},{key:"loadDependencies",value:function(){return(0,je.h)({icon:function(){return n.e(7474).then(n.bind(n,87474))}})}},{key:"capabilities",get:function(){return this.viewModel.capabilities},set:function(e){this.viewModel.capabilities=e}},{key:"effectiveDisplayType",get:function(){var e=this.displayType;return e&&"auto"!==e?e:this.viewModel.supportsResizeAttachments?"preview":"list"}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"castVisibleElements",value:function(e){return(0,l.Z)((0,l.Z)({},Ge),e)}},{key:"addAttachment",value:function(){var e=this,t=this._addAttachmentForm,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.addAttachment(t).then((function(t){return e._set("submitting",!1),e._set("error",null),n.mode="view",t})).catch((function(t){throw e._set("submitting",!1),e._set("error",new F.Z("attachments:add-attachment",e.messages.addErrorMessage,t)),t}))}},{key:"deleteAttachment",value:function(e){var t=this,n=this.viewModel;return this._set("submitting",!0),this._set("error",null),n.deleteAttachment(e).then((function(e){return t._set("submitting",!1),t._set("error",null),n.mode="view",e})).catch((function(e){throw t._set("submitting",!1),t._set("error",new F.Z("attachments:delete-attachment",t.messages.deleteErrorMessage,e)),e}))}},{key:"updateAttachment",value:function(){var e=this,t=this.viewModel,n=this._updateAttachmentForm;return this._set("submitting",!0),this._set("error",null),t.updateAttachment(n).then((function(n){return e._set("submitting",!1),e._set("error",null),t.mode="view",n})).catch((function(t){throw e._set("submitting",!1),e._set("error",new F.Z("attachments:update-attachment",e.messages.updateErrorMessage,t)),t}))}},{key:"addFile",value:function(){var e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}},{key:"updateFile",value:function(){var e=this.viewModel,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}},{key:"deleteFile",value:function(e){var t,n=this.viewModel.deleteFile(e||(null===(t=this.viewModel.activeFileInfo)||void 0===t?void 0:t.file));return this.viewModel.mode="view",n}},{key:"render",value:function(){var e=this.submitting,t=this.viewModel.state;return(0,Ue.u)("div",{class:this.classes(Qe.base,qe.z.widget)},e?this._renderProgressBar():null,"loading"===t?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}},{key:"_renderErrorMessage",value:function(){var e=this.error,t=this.visibleElements;return e&&t.errorMessage?(0,Ue.u)("div",{class:Qe.errorMessage,key:"error-message"},e.message):null}},{key:"_renderAttachments",value:function(){var e=this.viewModel,t=e.activeFileInfo,n=e.mode,i=e.activeAttachmentInfo;return"add"===n?this._renderAddForm():"edit"===n?this._renderDetailsForm(i||t):this._renderAttachmentContainer()}},{key:"_renderLoading",value:function(){return(0,Ue.u)("div",{class:Qe.loaderContainer,key:"loader"},(0,Ue.u)("div",{class:Qe.loader}))}},{key:"_renderProgressBar",value:function(){return this.visibleElements.progressBar?(0,Ue.u)("div",{class:Qe.progressBar,key:"progress-bar"}):null}},{key:"_renderAddForm",value:function(){var e=this.submitting,t=this.selectedFile,n=e||!t,i=this.visibleElements.cancelAddButton?(0,Ue.u)("button",{bind:this,class:this.classes(qe.z.button,qe.z.buttonTertiary,qe.z.buttonSmall,qe.z.buttonHalf,e&&qe.z.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,r=this.visibleElements.addSubmitButton?(0,Ue.u)("button",{class:this.classes(qe.z.button,qe.z.buttonSecondary,qe.z.buttonSmall,qe.z.buttonHalf,(0,o.Z)({},qe.z.buttonDisabled,n)),disabled:n,type:"submit"},this.messages.add):null,a=t?(0,Ue.u)("span",{class:Qe.fileName,key:"file-name"},t.name):null,l=(0,Ue.u)("form",{afterCreate:He.Yo,afterRemoved:He.pV,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},(0,Ue.u)("fieldset",{class:Qe.fileFieldset},a,(0,Ue.u)("label",{class:this.classes(Qe.fileLabel,qe.z.button,qe.z.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,(0,Ue.u)("input",{bind:this,class:Qe.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),r,i);return(0,Ue.u)("div",{class:Qe.formNode,key:"add-form-container"},l)}},{key:"_renderDetailsForm",value:function(e){var t,n,i,r,a,l,s,u,c=this,d=this.visibleElements,p=this.viewModel,f=this.selectedFile,h=this.submitting,v=p.capabilities,m=h||!f;f?(a=f.type,l=f.name,s=f.size):e&&"file"in e?(a=e.file.type,l=e.file.name,s=e.file.size):e&&"contentType"in e&&(a=e.contentType,l=e.name,s=e.size,u=e.url);var y=v.editing&&null!==(t=v.operations)&&void 0!==t&&t.delete&&d.deleteButton?(0,Ue.u)("button",{bind:this,class:this.classes(qe.z.button,qe.z.buttonSmall,qe.z.buttonTertiary,Qe.deleteButton,(0,o.Z)({},qe.z.buttonDisabled,h)),disabled:h,key:"delete-button",onclick:function(t){return c._submitDeleteAttachment(t,e)},type:"button"},this.messages.delete):void 0,g=v.editing&&null!==(n=v.operations)&&void 0!==n&&n.update&&d.updateButton?(0,Ue.u)("button",{class:this.classes(qe.z.button,qe.z.buttonSmall,qe.z.buttonThird,(0,o.Z)({},qe.z.buttonDisabled,m)),disabled:m,key:"update-button",type:"submit"},this.messages.update):void 0,b=this.visibleElements.cancelUpdateButton?(0,Ue.u)("button",{bind:this,class:this.classes(qe.z.button,qe.z.buttonSmall,qe.z.buttonTertiary,qe.z.buttonThird,(0,o.Z)({},qe.z.buttonDisabled,h)),disabled:h,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,_=v.editing&&null!==(i=v.operations)&&void 0!==i&&i.update?(0,Ue.u)("fieldset",{class:Qe.fileFieldset,key:"file"},(0,Ue.u)("span",{class:Qe.fileName,key:"file-name"},l),(0,Ue.u)("label",{class:this.classes(Qe.fileLabel,qe.z.button,qe.z.buttonSecondary)},this.messages.changeFile,(0,Ue.u)("input",{bind:this,class:Qe.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,w=(0,Ue.u)("fieldset",{class:Qe.metadataFieldset,key:"size"},(0,Ue.u)("label",null,function(e,t){var n=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(Z.Y.KILOBYTES));n=(0,A.uZ)(n,0,S.length-1);var i=(0,T.uf)(t/Math.pow(Z.Y.KILOBYTES,n),{maximumFractionDigits:2});return(0,P.gx)(e.units.bytes[S[n]],{fileSize:i})}(this.messagesUnits,null!==(r=s)&&void 0!==r?r:0))),k=(0,Ue.u)("fieldset",{class:Qe.metadataFieldset,key:"content-type"},(0,Ue.u)("label",null,a)),x=null!=u?(0,Ue.u)("a",{class:Qe.itemLink,href:u,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),(0,Ue.u)("div",{class:Qe.itemLinkOverlay},(0,Ue.u)("span",{class:Qe.itemLinkOverlayIcon},(0,Ue.u)("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),C=(0,Ue.u)("form",{afterCreate:He.Yo,afterRemoved:He.pV,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:function(t){return c._submitUpdateAttachment(t,e)}},(0,Ue.u)("div",{class:Qe.metadata},w,k),_,(0,Ue.u)("div",{class:Qe.actions},y,b,g));return(0,Ue.u)("div",{class:Qe.formNode,key:"edit-form-container"},x,C)}},{key:"_renderImageMask",value:function(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}},{key:"_renderGenericImageMask",value:function(e,t){var n=this.viewModel.supportsResizeAttachments,i=function(e){var t=(0,Be.V)("esri/themes/base/images/files/");return e?"text/plain"===e?"".concat(t,"text-32.svg"):"application/pdf"===e?"".concat(t,"pdf-32.svg"):"text/csv"===e?"".concat(t,"csv-32.svg"):"application/gpx+xml"===e?"".concat(t,"gpx-32.svg"):"application/x-dwf"===e?"".concat(t,"cad-32.svg"):"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?"".concat(t,"code-32.svg"):"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?"".concat(t,"zip-32.svg"):e.includes("image/")?"".concat(t,"image-32.svg"):e.includes("audio/")?"".concat(t,"sound-32.svg"):e.includes("video/")?"".concat(t,"video-32.svg"):e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?"".concat(t,"excel-32.svg"):e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?"".concat(t,"word-32.svg"):e.includes("powerpoint")||e.includes("presentationml")?"".concat(t,"report-32.svg"):"".concat(t,"generic-32.svg"):"".concat(t,"generic-32.svg")}(t),r=(0,o.Z)({},Qe.itemImageResizable,n);return(0,Ue.u)("div",{class:this.classes(Qe.itemMaskIcon,Qe.itemMask),key:i},(0,Ue.u)("img",{alt:e,class:this.classes(r,Qe.itemImage),src:i,title:e}))}},{key:"_renderImageMaskForAttachment",value:function(e,t){var n=this.viewModel.supportsResizeAttachments;if(!e)return null;var i=e.contentType,r=e.name,a=e.url;if(!n||!De(i))return this._renderGenericImageMask(r,i);var l=this._getCSSTransform(e),s=l?{transform:l,"image-orientation":"none"}:{},u="".concat(a).concat(null!==a&&void 0!==a&&a.includes("?")?"&":"?","w=").concat(t),c=(0,o.Z)({},Qe.itemImageResizable,n);return(0,Ue.u)("div",{class:this.classes(Qe.itemMask),key:u},(0,Ue.u)("img",{alt:r,class:this.classes(c,Qe.itemImage),src:u,styles:s,title:r}))}},{key:"_renderFile",value:function(e){var t=this,n=e.file;return(0,Ue.u)("li",{class:Qe.item,key:n},(0,Ue.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:Qe.itemButton,key:"details-button",onclick:function(){return t._startEditFile(e)},title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),(0,Ue.u)("label",{class:Qe.itemLabel},(0,Ue.u)("span",{class:Qe.itemFilename},n.name||this.messages.noTitle),(0,Ue.u)("span",{"aria-hidden":"true",class:this.classes(Qe.itemChevronIcon,(0,He.dZ)(this.container)?We.W.left:We.W.right)}))))}},{key:"_renderAttachmentInfo",value:function(e){var t=this,n=e.attachmentInfo,i=e.displayType,r=this.viewModel,a=this.effectiveDisplayType,o=r.capabilities,l=r.supportsResizeAttachments,s=n.contentType,u=n.name,c=n.url,d=this._renderImageMask(n,"list"===i?48:400),p=o.editing?(0,Ue.u)("span",{"aria-hidden":"true",class:this.classes(Qe.itemChevronIcon,(0,He.dZ)(this.container)?We.W.left:We.W.right)}):null,f=[d,"preview"===a&&l&&De(s)?null:(0,Ue.u)("label",{class:Qe.itemLabel},(0,Ue.u)("span",{class:Qe.itemFilename},u||this.messages.noTitle),p)],h=o.editing?(0,Ue.u)("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:Qe.itemButton,"data-attachment-info-id":n.id,key:"details-button",onclick:function(){return t._startEditAttachment(n)},title:this.messages.attachmentDetails,type:"button"},f):(0,Ue.u)("a",{class:Qe.itemButton,href:null!==c&&void 0!==c?c:void 0,key:"details-link",target:"_blank"},f);return(0,Ue.u)("li",{class:Qe.item,key:n},h)}},{key:"_renderAttachmentContainer",value:function(){var e,t,n=this,i=this.effectiveDisplayType,r=this.viewModel,a=this.visibleElements,l=r.attachmentInfos,s=r.capabilities,u=r.fileInfos,c=!(null===l||void 0===l||!l.length),d=!(null===u||void 0===u||!u.length),p=(e={},(0,o.Z)(e,Qe.containerList,"preview"!==i),(0,o.Z)(e,Qe.containerPreview,"preview"===i),e),f=s.editing&&null!==(t=s.operations)&&void 0!==t&&t.add&&a.addButton?(0,Ue.u)("button",{bind:this,class:this.classes(qe.z.button,qe.z.buttonTertiary,Qe.addAttachmentButton),onclick:function(){return n._startAddAttachment()},type:"button"},(0,Ue.u)("span",{"aria-hidden":"true",class:this.classes(Qe.itemAddIcon,We.W.plus)}),this.messages.add):void 0,h=c?(0,Ue.u)("ul",{class:Qe.items,key:"attachments-list"},l.toArray().map((function(e){return n._renderAttachmentInfo({attachmentInfo:e,displayType:i})}))):void 0,v=d?(0,Ue.u)("ul",{class:Qe.items,key:"file-list"},u.toArray().map((function(e){return n._renderFile(e)}))):void 0,m=d||c?void 0:(0,Ue.u)("div",{class:qe.z.empty},this.messages.noAttachments);return(0,Ue.u)("div",{class:this.classes(Qe.container,p),key:"attachments-container"},h,v,m,f)}},{key:"_modeChanged",value:function(){this._set("error",null),this._set("selectedFile",null)}},{key:"_handleFileInputChange",value:function(e){var t,n=null===(t=e.target.files)||void 0===t?void 0:t.item(0);this._set("selectedFile",n)}},{key:"_submitDeleteAttachment",value:function(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}},{key:"_submitAddAttachment",value:function(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}},{key:"_submitUpdateAttachment",value:function(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}},{key:"_startEditAttachment",value:function(e){var t=this.viewModel;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}},{key:"_startEditFile",value:function(e){var t=this.viewModel;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}},{key:"_startAddAttachment",value:function(){this.viewModel.mode="add"}},{key:"_cancelForm",value:function(e){e.preventDefault(),this.viewModel.mode="view"}},{key:"_getCSSTransform",value:function(e){var t=e.orientationInfo;return!this._supportsImageOrientation&&t?[t.rotation?"rotate(".concat(t.rotation,"deg)"):"",t.mirrored?"scaleX(-1)":""].join(" "):""}}]),i}(I.Z);(0,p._)([(0,m.Cb)()],Xe.prototype,"capabilities",null),(0,p._)([(0,m.Cb)()],Xe.prototype,"displayType",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"effectiveDisplayType",null),(0,p._)([(0,m.Cb)()],Xe.prototype,"graphic",null),(0,p._)([(0,m.Cb)()],Xe.prototype,"label",null),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Attachments/t9n/Attachments")],Xe.prototype,"messages",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/core/t9n/Units")],Xe.prototype,"messagesUnits",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"selectedFile",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"submitting",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Xe.prototype,"error",void 0),(0,p._)([(0,m.Cb)({type:Ve})],Xe.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)()],Xe.prototype,"visibleElements",void 0),(0,p._)([(0,M.p)("visibleElements")],Xe.prototype,"castVisibleElements",null);var Ke=Xe=(0,p._)([(0,g.j)("esri.widgets.Attachments")],Xe),et=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).description=null,i.title=null,i}return(0,u.Z)(n)}(Ve);(0,p._)([(0,m.Cb)()],et.prototype,"description",void 0),(0,p._)([(0,m.Cb)()],et.prototype,"title",void 0);var tt=et=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],et),nt=n(44925),it=["level","class"];function rt(e,t){var n=e.level,i=e.class,r=(0,nt.Z)(e,it),a=at(n);return(0,Ue.u)("h".concat(a),(0,l.Z)((0,l.Z)({},r),{},{"aria-level":String(a),class:(0,He.Sh)(qe.z.heading,i),role:"heading"}),t)}function at(e){return(0,A.uZ)(Math.ceil(e),1,6)}var ot="esri-feature-element-info",lt={base:ot,title:"".concat(ot,"__title"),description:"".concat(ot,"__description")},st=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i)).description=null,r.headingLevel=2,r.title=null,r}return(0,u.Z)(n,[{key:"render",value:function(){return(0,Ue.u)("div",{class:lt.base},this._renderTitle(),this._renderDescription())}},{key:"_renderTitle",value:function(){var e=this.title;return e?(0,Ue.u)(rt,{class:lt.title,level:this.headingLevel},e):null}},{key:"_renderDescription",value:function(){var e=this.description;return e?(0,Ue.u)("div",{class:lt.description,key:"description"},e):null}}]),n}(I.Z);(0,p._)([(0,m.Cb)()],st.prototype,"description",void 0),(0,p._)([(0,m.Cb)()],st.prototype,"headingLevel",void 0),(0,p._)([(0,m.Cb)()],st.prototype,"title",void 0);var ut=st=(0,p._)([(0,g.j)("esri.widgets.Feature.support.FeatureElementInfo")],st),ct="esri-feature-attachments",dt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i))._featureElementInfo=null,r.attachmentsWidget=new Ke,r.headingLevel=2,r.viewModel=new tt,r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new ut,this.addHandles([(0,v.YP)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.description,null===(n=e.viewModel)||void 0===n?void 0:n.title,e.headingLevel]}),(function(){return e._setupFeatureElementInfo()}),v.nn),(0,v.YP)((function(){return e.viewModel}),(function(t){return e.attachmentsWidget.viewModel=t}),v.nn)])}},{key:"destroy",value:function(){var e;this.attachmentsWidget.viewModel=null,this.attachmentsWidget.destroy(),null===(e=this._featureElementInfo)||void 0===e||e.destroy()}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"displayType",get:function(){return this.attachmentsWidget.displayType},set:function(e){this.attachmentsWidget.displayType=e}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"render",value:function(){var e,t=this.attachmentsWidget;return(0,Ue.u)("div",{class:ct},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),null===t||void 0===t?void 0:t.render())}},{key:"_setupFeatureElementInfo",value:function(){var e,t=this.description,n=this.title,i=this.headingLevel;null===(e=this._featureElementInfo)||void 0===e||e.set({description:t,title:n,headingLevel:i})}}]),n}(I.Z);(0,p._)([(0,m.Cb)({readOnly:!0})],dt.prototype,"attachmentsWidget",void 0),(0,p._)([(0,m.Cb)()],dt.prototype,"description",null),(0,p._)([(0,m.Cb)()],dt.prototype,"displayType",null),(0,p._)([(0,m.Cb)()],dt.prototype,"graphic",null),(0,p._)([(0,m.Cb)()],dt.prototype,"headingLevel",void 0),(0,p._)([(0,m.Cb)()],dt.prototype,"title",null),(0,p._)([(0,m.Cb)({type:tt})],dt.prototype,"viewModel",void 0);var pt=dt=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureAttachments")],dt),ft=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._loadingPromise=null,i.created=null,i.creator=null,i.destroyer=null,i.graphic=null,i.addHandles((0,v.YP)((function(){return i.creator}),(function(e){i._destroyContent(),i._createContent(e)}),v.nn)),i}return(0,u.Z)(n,[{key:"destroy",value:function(){this._destroyContent()}},{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}},{key:"_destroyContent",value:function(){var e=this.created,t=this.graphic,n=this.destroyer;e&&t&&(ie(n,{graphic:t}).catch((function(){return null})),this._set("created",null))}},{key:"_createContent",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=this.graphic)&&t){e.next=3;break}return e.abrupt("return");case 3:return i=ie(t,{graphic:n}).catch((function(){return null})),this._loadingPromise=i,this.notifyChange("state"),e.next=7,i;case 7:a=e.sent,i===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",a));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(O.Z);(0,p._)([(0,m.Cb)({readOnly:!0})],ft.prototype,"created",void 0),(0,p._)([(0,m.Cb)()],ft.prototype,"creator",void 0),(0,p._)([(0,m.Cb)()],ft.prototype,"destroyer",void 0),(0,p._)([(0,m.Cb)({type:R.Z})],ft.prototype,"graphic",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ft.prototype,"state",null);var ht=ft=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],ft),vt=n(53963),mt="esri-feature-content",yt={base:mt,loaderContainer:"".concat(mt,"__loader-container"),loader:"".concat(mt,"__loader")},gt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i)).viewModel=null,r._addTargetToAnchors=function(e){Array.from(e.querySelectorAll("a")).forEach((function(e){ae(e.href)&&!e.hasAttribute("target")&&e.setAttribute("target","_blank")}))},r}return(0,u.Z)(n,[{key:"creator",get:function(){var e;return null===(e=this.viewModel)||void 0===e?void 0:e.creator},set:function(e){this.viewModel&&(this.viewModel.creator=e)}},{key:"graphic",get:function(){var e;return null===(e=this.viewModel)||void 0===e?void 0:e.graphic},set:function(e){this.viewModel&&(this.viewModel.graphic=e)}},{key:"render",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.state;return(0,Ue.u)("div",{class:yt.base},"loading"===t?this._renderLoading():this._renderCreated())}},{key:"_renderLoading",value:function(){return(0,Ue.u)("div",{class:yt.loaderContainer,key:"loader"},(0,Ue.u)("div",{class:yt.loader}))}},{key:"_renderCreated",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.created;return t?t instanceof HTMLElement?(0,Ue.u)("div",{afterCreate:this._attachToNode,bind:t,key:t}):(0,vt.Qd)(t)?(0,Ue.u)("div",{key:t},!t.destroyed&&t.render()):(0,Ue.u)("div",{afterCreate:this._addTargetToAnchors,innerHTML:t,key:t}):null}},{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(I.Z);(0,p._)([(0,m.Cb)()],gt.prototype,"creator",null),(0,p._)([(0,m.Cb)()],gt.prototype,"graphic",null),(0,p._)([(0,m.Cb)({type:ht})],gt.prototype,"viewModel",void 0);var bt=gt=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureContent")],gt),_t=n(89860),wt=n(16698),kt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).attributes=null,i.expressionInfos=null,i.description=null,i.fieldInfos=null,i.title=null,i}return(0,u.Z)(n,[{key:"formattedFieldInfos",get:function(){var e=this.expressionInfos,t=this.fieldInfos,n=[];return null!==t&&void 0!==t&&t.forEach((function(t){if(!t.hasOwnProperty("visible")||t.visible){var i=t.clone();i.label=le(i,e),n.push(i)}})),n}}]),n}(O.Z);(0,p._)([(0,m.Cb)()],kt.prototype,"attributes",void 0),(0,p._)([(0,m.Cb)({type:[_t.Z]})],kt.prototype,"expressionInfos",void 0),(0,p._)([(0,m.Cb)()],kt.prototype,"description",void 0),(0,p._)([(0,m.Cb)({type:[wt.Z]})],kt.prototype,"fieldInfos",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],kt.prototype,"formattedFieldInfos",null),(0,p._)([(0,m.Cb)()],kt.prototype,"title",void 0);var xt=kt=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],kt),Ct=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];function Mt(e,t){if("string"!=typeof t||!t)return t;var n=function(e){var t=null;return Ct.some((function(n){return n.pattern.test(e)&&(t=n),!!t})),t}(t);if(!n)return t;var i=t.match(n.pattern),r=i&&i[2],a=(0,P.gx)((0,P.gx)(n.label,{messages:e,hierPart:r}),{appName:n.appName}),o=n.target?' target="'.concat(n.target,'"'):"",l="_blank"===n.target?' rel="noreferrer"':"";return t.replace(n.pattern,"<a".concat(o,' href="$1"').concat(l,">").concat(a,"</a>"))}var It="esri-feature-fields",Ft={base:It,fieldHeader:"".concat(It,"__field-header"),fieldData:"".concat(It,"__field-data"),fieldDataDate:"".concat(It,"__field-data--date")},Zt=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i))._featureElementInfo=null,r.viewModel=new xt,r.messages=null,r.messagesURIUtils=null,r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new ut,this.addHandles((0,v.YP)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.description,null===(n=e.viewModel)||void 0===n?void 0:n.title]}),(function(){return e._setupFeatureElementInfo()}),v.nn))}},{key:"destroy",value:function(){var e;null===(e=this._featureElementInfo)||void 0===e||e.destroy()}},{key:"attributes",get:function(){return this.viewModel.attributes},set:function(e){this.viewModel.attributes=e}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"expressionInfos",get:function(){return this.viewModel.expressionInfos},set:function(e){this.viewModel.expressionInfos=e}},{key:"fieldInfos",get:function(){return this.viewModel.fieldInfos},set:function(e){this.viewModel.fieldInfos=e}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"render",value:function(){var e;return(0,Ue.u)("div",{class:Ft.base},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),this._renderFields())}},{key:"_renderFieldInfo",value:function(e,t){var n=this.viewModel.attributes,i=e.fieldName,r=e.label||i,a=n?null==n[i]?"":n[i]:"",l=!(!e.format||!e.format.dateFormat),s="number"!=typeof a||l?Mt(this.messagesURIUtils,a):this._forceLTR(a),u=(0,o.Z)({},Ft.fieldDataDate,l);return(0,Ue.u)("tr",{key:"fields-element-info-row-".concat(i,"-").concat(t)},(0,Ue.u)("th",{class:Ft.fieldHeader,innerHTML:r,key:"fields-element-info-row-header-".concat(i,"-").concat(t)}),(0,Ue.u)("td",{class:this.classes(Ft.fieldData,u),innerHTML:s,key:"fields-element-info-row-data-".concat(i,"-").concat(t)}))}},{key:"_renderFields",value:function(){var e=this,t=this.viewModel.formattedFieldInfos;return null!==t&&void 0!==t&&t.length?(0,Ue.u)("table",{class:qe.z.table,summary:this.messages.fieldsSummary},(0,Ue.u)("tbody",null,t.map((function(t,n){return e._renderFieldInfo(t,n)})))):null}},{key:"_setupFeatureElementInfo",value:function(){var e,t=this.description,n=this.title;null===(e=this._featureElementInfo)||void 0===e||e.set({description:t,title:n})}},{key:"_forceLTR",value:function(e){return"&lrm;".concat(e)}}]),n}(I.Z);(0,p._)([(0,m.Cb)()],Zt.prototype,"attributes",null),(0,p._)([(0,m.Cb)()],Zt.prototype,"description",null),(0,p._)([(0,m.Cb)()],Zt.prototype,"expressionInfos",null),(0,p._)([(0,m.Cb)()],Zt.prototype,"fieldInfos",null),(0,p._)([(0,m.Cb)()],Zt.prototype,"title",null),(0,p._)([(0,m.Cb)({type:xt,nonNullable:!0})],Zt.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Feature/t9n/Feature")],Zt.prototype,"messages",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/support/t9n/uriUtils")],Zt.prototype,"messagesURIUtils",void 0);var At=Zt=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureFields")],Zt),Lt=n(37762),Et=n(77427);var Pt={maximumFractionDigits:20};n(57203);var Tt=n(74579),St=n(51995),Rt=(n(51508),n(16851),"<"),Ot=">";function Nt(e,t,n,i){var r="";return 0===t?r="".concat(Rt," "):t===n&&(r="".concat(Ot," ")),r+(i?(0,j.$8)(e,i):function(e){return(0,T.uf)(e,Pt)}(e))}var zt=new St.Z([64,64,64]);function Vt(e,t){var n=[],i=e.length-1;return 5===e.length?n.push(0,2,4):n.push(0,i),e.map((function(e,r){return n.includes(r)?Nt(e,r,i,t):null}))}function Bt(e,t,n){return Dt.apply(this,arguments)}function Dt(){return Dt=(0,a.Z)((0,r.Z)().mark((function e(t,i,o){var l,s,u,c,d,p,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=!1,s=[],u=[],t.stops&&(c=t.stops,s=c.map((function(e){return e.value})),l=c.some((function(e){return!!e.label})),l&&(u=c.map((function(e){return e.label})))),d=s[0],p=s[s.length-1],null!=d||null!=p){e.next=5;break}return e.abrupt("return",null);case 5:return f=l?null:Vt(s,o),e.next=8,Promise.all(s.map(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(a,o){var s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a,"opacity"!==t.type){e.next=7;break}return e.next=4,jt(a,t,i);case 4:e.t1=e.sent,e.next=10;break;case 7:return e.next=9,Promise.resolve().then(n.bind(n,56011));case 9:e.t1=e.sent.getColor(t,a);case 10:return e.t2=e.t1,e.t3=l?u[o]:null!==(s=null===f||void 0===f?void 0:f[o])&&void 0!==s?s:"",e.abrupt("return",{value:e.t0,color:e.t2,label:e.t3});case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 8:return e.abrupt("return",e.sent.reverse());case 9:case"end":return e.stop()}}),e)}))),Dt.apply(this,arguments)}function jt(e,t,n){return qt.apply(this,arguments)}function qt(){return(qt=(0,a.Z)((0,r.Z)().mark((function e(t,i,a){var o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=new St.Z(null!==a&&void 0!==a?a:zt),e.next=3,Promise.resolve().then(n.bind(n,56011));case 3:return l=e.sent.getOpacity(i,t),e.abrupt("return",(null!=l&&(o.a=l),o));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Wt=n(6711);function Ht(e){if(!e.colorStops)return[];var t=(0,_.Z)(e.colorStops).filter((function(e){var t;return(null===(t=e.color)||void 0===t?void 0:t.a)>0})),n=t.length-1;if(t&&t[0]){var i=t[n];i&&1!==i.ratio&&(t.push(new Wt.Z({ratio:1,color:i.color})),n++)}return t.map((function(t,i){var r,a,o="";return 0===i?o=(null===(r=e.legendOptions)||void 0===r?void 0:r.minLabel)||"low":i===n&&(o=(null===(a=e.legendOptions)||void 0===a?void 0:a.maxLabel)||"high"),{color:t.color,label:o,ratio:t.ratio}})).reverse()}h.Z.getLogger("esri.renderers.support.utils"),(0,V.Ze)("short-date");function Yt(e,t,n){return Ut.apply(this,arguments)}function Ut(){return(Ut=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(a=(0,Et.s1)(t,n,(function(){return[]}))).push.apply(a,(0,_.Z)(i));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gt(e){return Jt.apply(this,arguments)}function Jt(){return(Jt=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c,d,p,f,h,v,m,g,b,_,w,k,x,C,M,I,F,Z,A,L,E,P;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new Map,t){e.next=3;break}return e.abrupt("return",i);case 3:if(!("visualVariables"in t)||!t.visualVariables){e.next=34;break}a=t.visualVariables.filter((function(e){return"color"===e.type})),o=(0,Lt.Z)(a),e.prev=6,o.s();case 8:if((l=o.n()).done){e.next=26;break}return u=l.value,e.next=12,Bt(u);case 12:if(e.t1=s=e.sent,e.t0=null!==e.t1,!e.t0){e.next=16;break}e.t0=void 0!==s;case 16:if(!e.t0){e.next=20;break}e.t2=s,e.next=21;break;case 20:e.t2=[];case 21:return c=e.t2.map((function(e){return e.color})),e.next=24,Yt(i,u.field||u.valueExpression,c);case 24:e.next=8;break;case 26:e.next=31;break;case 28:e.prev=28,e.t3=e.catch(6),o.e(e.t3);case 31:return e.prev=31,o.f(),e.finish(31);case 34:if("heatmap"!==t.type){e.next=40;break}return d=Ht(t).map((function(e){return e.color})),e.next=38,Yt(i,t.field||t.valueExpression,d);case 38:e.next=130;break;case 40:if("pie-chart"!==t.type){e.next=62;break}f=(0,Lt.Z)(t.attributes),e.prev=42,f.s();case 44:if((h=f.n()).done){e.next=50;break}return v=h.value,e.next=48,Yt(i,v.field||v.valueExpression,[v.color]);case 48:e.next=44;break;case 50:e.next=55;break;case 52:e.prev=52,e.t4=e.catch(42),f.e(e.t4);case 55:return e.prev=55,f.f(),e.finish(55);case 58:return e.next=60,Yt(i,"default",[null===t||void 0===t||null===(p=t.othersCategory)||void 0===p?void 0:p.color,(0,Tt._h)(t.backgroundFillSymbol,null)]);case 60:e.next=130;break;case 62:if("dot-density"!==t.type){e.next=84;break}m=(0,Lt.Z)(t.attributes),e.prev=64,m.s();case 66:if((g=m.n()).done){e.next=72;break}return b=g.value,e.next=70,Yt(i,b.field||b.valueExpression,[b.color]);case 70:e.next=66;break;case 72:e.next=77;break;case 74:e.prev=74,e.t5=e.catch(64),m.e(e.t5);case 77:return e.prev=77,m.f(),e.finish(77);case 80:return e.next=82,Yt(i,"default",[t.backgroundColor]);case 82:e.next=130;break;case 84:if("unique-value"!==t.type){e.next=120;break}if("predominance"!==(null===(n=t.authoringInfo)||void 0===n?void 0:n.type)){e.next=105;break}w=(0,Lt.Z)(null!==(_=t.uniqueValueInfos)&&void 0!==_?_:[]),e.prev=87,w.s();case 89:if((k=w.n()).done){e.next=95;break}return x=k.value,e.next=93,Yt(i,x.value.toString(),[(0,Tt._h)(x.symbol,null)]);case 93:e.next=89;break;case 95:e.next=100;break;case 97:e.prev=97,e.t6=e.catch(87),w.e(e.t6);case 100:return e.prev=100,w.f(),e.finish(100);case 103:e.next=118;break;case 105:if(M=(null!==(C=t.uniqueValueInfos)&&void 0!==C?C:[]).map((function(e){return(0,Tt._h)(e.symbol,null)})),I=t.field,F=t.field2,Z=t.field3,A=t.valueExpression,e.t7=I||A,!e.t7){e.next=110;break}return e.next=110,Yt(i,I||A,M);case 110:if(e.t8=F,!e.t8){e.next=114;break}return e.next=114,Yt(i,F,M);case 114:if(e.t9=Z,!e.t9){e.next=118;break}return e.next=118,Yt(i,Z,M);case 118:e.next=130;break;case 120:if("class-breaks"!==t.type){e.next=126;break}return L=t.classBreakInfos.map((function(e){return(0,Tt._h)(e.symbol,null)})),E=t.field,P=t.valueExpression,e.next=124,Yt(i,null!==E&&void 0!==E?E:P,L);case 124:e.next=130;break;case 126:if(e.t10="simple"===t.type,!e.t10){e.next=130;break}return e.next=130,Yt(i,"default",[(0,Tt._h)(t.symbol,null)]);case 130:if(e.t11="defaultSymbol"in t&&t.defaultSymbol,!e.t11){e.next=134;break}return e.next=134,Yt(i,"default",[(0,Tt._h)(t.defaultSymbol,null)]);case 134:return i.forEach((function(e,t){var n=(0,y.Tw)(e.filter(Boolean),(function(e,t){return JSON.stringify(e)===JSON.stringify(t)}));i.set(t,n)})),e.abrupt("return",i);case 136:case"end":return e.stop()}}),e,null,[[6,28,31,34],[42,52,55,58],[64,74,77,80],[87,97,100,103]])})))).apply(this,arguments)}var Qt=n(60260),$t=n(76200),Xt=n(66978),Kt=(n(64020),n(77946)),en=(n(42265),n(19545),n(35995),n(83448),n(92975),n(83406),n(53866),n(32238),n(77577),n(585)),tn=(n(80885),n(29909),n(91340),n(78084),n(49818),n(86638)),nn=(n(59486),n(99086)),rn=(n(54307),n(33997)),an=h.Z.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),on=new Map;function ln(e){if(!Ee(e))return null;var t=e.split("/").slice(1),n=(0,i.Z)(t,2);return{layerId:n[0],fieldName:n[1]}}function sn(e){var t=e.originRelationship,n=e.relationships,i=e.layerId,r=null;return n&&n.some((function(e){return"".concat(e.relatedTableId)===i&&e.id===(null===t||void 0===t?void 0:t.id)&&(r=e),!!r})),r}function un(e,t){var n=t.toLowerCase();for(var i in e)if(i.toLowerCase()===n)return e[i];return null}function cn(e,t){var n=function(e,t){if(!t.relationships)return null;var n=null;return t.relationships.some((function(t){return t.id===parseInt(e,10)&&(n=t,!0)})),n}(e,t);if(n)return{url:"".concat(t.url,"/").concat(n.relatedTableId),sourceSpatialReference:t.spatialReference,relation:n,relatedFields:[],outStatistics:[]}}function dn(e,t){if(t&&e){var n=e.features,i=e.statsFeatures,r=null===n||void 0===n?void 0:n.value;t.relatedFeatures=r?r.features:[];var a=null===i||void 0===i?void 0:i.value;t.relatedStatsFeatures=a?a.features:[]}}function pn(e,t,n,i){var r,a,o=new nn.default;return o.outFields=["*"],o.relationshipId="number"==typeof t.id?t.id:parseInt(t.id,10),o.objectIds=[e.attributes[n.objectIdField]],null!==(r=null===(a=n.queryRelatedFeatures)||void 0===a?void 0:a.call(n,o,i))&&void 0!==r?r:Promise.resolve({})}function fn(e,t,n){for(var i=0,r=[];i<t.length;)r.push("".concat(e," IN (").concat(t.slice(i,n+i),")")),i+=n;return r.join(" OR ")}function hn(e){return e?(0,y.Tw)(e):void 0}function vn(e){return e?(0,y.Tw)(e,(function(e,t){return JSON.stringify(e.toJSON())===JSON.stringify(t.toJSON())})):void 0}function mn(){return mn=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a){var o,l,s,u,c,d,p,f,h,v,m,y,g,b,_,w,k,x,C,M,I;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=i.layerId.toString(),l=n.layerInfo,s=n.relation,u=n.relatedFields,c=n.outStatistics,d=n.url,p=n.sourceSpatialReference,f=hn(u),h=vn(c),l&&s){e.next=3;break}return e.abrupt("return",null);case 3:if(null===(v=sn({originRelationship:s,relationships:l.relationships,layerId:o}))||void 0===v||!v.relationshipTableId||!v.keyFieldInRelationshipTable){e.next=17;break}return e.next=7,pn(t,v,i,a);case 7:if(e.t0=t.attributes[i.objectIdField],m=e.sent[e.t0]){e.next=11;break}return e.abrupt("return",null);case 11:if(y=m.features.map((function(e){return e.attributes[l.objectIdField]})),null===h||void 0===h||!h.length||!l.supportsStatistics){e.next=17;break}return(g=new tn.Z).where=fn(l.objectIdField,y,1e3),g.outFields=f,g.outStatistics=h,g.sourceSpatialReference=p,b={features:Promise.resolve(m),statsFeatures:(0,Kt.e)(d,g)},e.abrupt("return",(0,Xt.as)(b));case 17:if(!(_=null===v||void 0===v?void 0:v.keyField)){e.next=21;break}return w=(0,B.H7)(bn(l.fields,_)),k=un(t.attributes,s.keyField),x=w?"".concat(_,"=").concat(k):"".concat(_,"='").concat(k,"'"),C=(0,Kt.e)(d,new tn.Z({where:x,outFields:f,sourceSpatialReference:p}),a),M=null!==h&&void 0!==h&&h.length&&l.supportsStatistics?(0,Kt.e)(d,new tn.Z({where:x,outFields:f,outStatistics:h,sourceSpatialReference:p}),a):null,I={features:C},e.abrupt("return",(M&&(I.statsFeatures=M),(0,Xt.as)(I)));case 21:return e.abrupt("return",null);case 22:case"end":return e.stop()}}),e)}))),mn.apply(this,arguments)}function yn(e,t){var n=e.relatedInfos,i=e.layer,r={};return n.forEach((function(e,t){var n=e.relation;if(!n){var a=new F.Z("relation-required","A relation is required on a layer to retrieve related records.");throw an.error(a),a}var o=n.relatedTableId;if("number"!=typeof o){var l=new F.Z("A related table ID is required on a layer to retrieve related records.");throw an.error(l),l}var s="".concat(i.url,"/").concat(o),u=on.get(s),c=null!==u&&void 0!==u?u:function(e,t){return(0,$t.Z)(e,{query:{f:"json"},signal:null===t||void 0===t?void 0:t.signal})}(s);u||on.set(s,c),r[t]=c})),(0,Xt.Hl)((0,Xt.as)(r),t)}function gn(e,t){var n=e.graphic,i=e.relatedInfos,r=e.layer,a={};return i.forEach((function(e,i){e.layerInfo&&(a[i]=function(e,t,n,i){return mn.apply(this,arguments)}(n,e,r,t))})),(0,Xt.as)(a)}function bn(e,t){if(null!=e){t=t.toLowerCase();var n,i=(0,Lt.Z)(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;if(r&&r.name.toLowerCase()===t)return r}}catch(a){i.e(a)}finally{i.f()}}return null}var _n={chartAnimation:!0},wn=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).abilities=(0,l.Z)({},_n),i.activeMediaInfoIndex=0,i.attributes=null,i.description=null,i.fieldInfoMap=null,i.formattedAttributes=null,i.expressionAttributes=null,i.isAggregate=!1,i.layer=null,i.mediaInfos=null,i.popupTemplate=null,i.relatedInfos=null,i.title=null,i}return(0,u.Z)(n,[{key:"castAbilities",value:function(e){return(0,l.Z)((0,l.Z)({},_n),e)}},{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}},{key:"setActiveMedia",value:function(e){this._setContentElementMedia(e)}},{key:"next",value:function(){this._pageContentElementMedia(1)}},{key:"previous",value:function(){this._pageContentElementMedia(-1)}},{key:"_setContentElementMedia",value:function(e){var t=this.formattedMediaInfoCount,n=(e+t)%t;this.activeMediaInfoIndex=n}},{key:"_pageContentElementMedia",value:function(e){var t=this.activeMediaInfoIndex+e;this._setContentElementMedia(t)}},{key:"_formatMediaInfos",value:function(){var e,t,n,i,r,a=this,o=this.mediaInfos,l=this.layer,s=null!==(e=this.attributes)&&void 0!==e?e:{},u=null!==(t=this.formattedAttributes)&&void 0!==t?t:{},c=null!==(n=this.expressionAttributes)&&void 0!==n?n:{},d=null!==(i=this.fieldInfoMap)&&void 0!==i?i:new Map;return null!==(r=null===o||void 0===o?void 0:o.map((function(e){var t=null===e||void 0===e?void 0:e.clone();if(!t)return null;if(t.title=de({attributes:s,fieldInfoMap:d,globalAttributes:u,expressionAttributes:c,layer:l,text:t.title}),t.caption=de({attributes:s,fieldInfoMap:d,globalAttributes:u,expressionAttributes:c,layer:l,text:t.caption}),t.altText=de({attributes:s,fieldInfoMap:d,globalAttributes:u,expressionAttributes:c,layer:l,text:t.altText}),"image"===t.type){var n=t.value;return a._setImageValue({value:n,formattedAttributes:u,layer:l}),t.value.sourceURL?t:void 0}if("pie-chart"===t.type||"line-chart"===t.type||"column-chart"===t.type||"bar-chart"===t.type){var i=t.value;return a._setChartValue({value:i,chartType:t.type,attributes:s,formattedAttributes:u,layer:l,expressionAttributes:c}),t}return null})).filter(y.pC))&&void 0!==r?r:[]}},{key:"_setImageValue",value:function(e){var t,n=null!==(t=this.fieldInfoMap)&&void 0!==t?t:new Map,i=e.value,r=e.formattedAttributes,a=e.layer,o=i.linkURL,l=i.sourceURL;if(l){var s=he(l,a);i.sourceURL=pe({formattedAttributes:r,template:s,fieldInfoMap:n})}if(o){var u=he(o,a);i.linkURL=pe({formattedAttributes:r,template:u,fieldInfoMap:n})}}},{key:"_setChartValue",value:function(e){var t,n=this,i=e.value,r=e.attributes,a=e.formattedAttributes,o=e.chartType,l=e.layer,s=e.expressionAttributes,u=this.popupTemplate,c=this.relatedInfos,d=i.fields,p=i.normalizeField,f=l;if(i.fields=function(e,t){return e&&e.map((function(e){return se(e,t)}))}(d,f),p&&(i.normalizeField=se(p,f)),d.some((function(e){return!!(null!=a[e]||Ee(e)&&null!==c&&void 0!==c&&c.size)}))){var h=null!==(t=null===u||void 0===u?void 0:u.fieldInfos)&&void 0!==t?t:[];d.forEach((function(e,t){var l,u=null===(l=i.colors)||void 0===l?void 0:l[t];if(Ee(e))i.series=[].concat((0,_.Z)(i.series),(0,_.Z)(n._getRelatedChartInfos({fieldInfos:h,fieldName:e,formattedAttributes:a,chartType:o,value:i,color:u})));else{var c=n._getChartOption({value:i,attributes:r,chartType:o,formattedAttributes:a,expressionAttributes:s,fieldName:e,fieldInfos:h,color:u});i.series.push(c)}}))}}},{key:"_getRelatedChartInfos",value:function(e){var t,n=this,i=e.fieldInfos,r=e.fieldName,a=e.formattedAttributes,o=e.chartType,l=e.value,s=e.color,u=[],c=ln(r),d=c&&(null===(t=this.relatedInfos)||void 0===t?void 0:t.get(c.layerId.toString()));if(!d)return u;var p=d.relatedFeatures,f=d.relation;if(!f||!p)return u;var h=f.cardinality;return p.forEach((function(e){var t=e.attributes;t&&Object.keys(t).forEach((function(e){e===c.fieldName&&u.push(n._getChartOption({value:l,attributes:t,formattedAttributes:a,fieldName:r,chartType:o,relatedFieldName:e,hasMultipleRelatedFeatures:(null===p||void 0===p?void 0:p.length)>1,fieldInfos:i,color:s}))}))})),"one-to-many"===h||"many-to-many"===h?u:[u[0]]}},{key:"_getTooltip",value:function(e){var t=e.label,n=e.value;return"pie-chart"===e.chartType?"".concat(t):"".concat(t,": ").concat(n)}},{key:"_getChartOption",value:function(e){var t,n,i=e.value,r=e.attributes,a=e.formattedAttributes,o=e.expressionAttributes,l=e.fieldName,s=e.relatedFieldName,u=e.fieldInfos,c=e.chartType,d=e.hasMultipleRelatedFeatures,p=e.color,f=this.layer,h=null!==(t=this.fieldInfoMap)&&void 0!==t?t:new Map,v=i.normalizeField,m=i.tooltipField,y=v?Ee(v)?r[ln(v).fieldName]:r[v]:null,g=oe(l)&&o&&void 0!==o[l]?o[l]:s&&void 0!==r[s]?r[s]:void 0!==r[l]?r[l]:a[l],b=new Qt.Z({fieldName:l,color:p,value:void 0===g?null:g&&y?g/y:g});if(Ee(l)){var _,w,k,x,C,M=h.get(l.toLowerCase()),I=m&&h.get(m.toLowerCase()),F=null!==(_=null===M||void 0===M?void 0:M.fieldName)&&void 0!==_?_:l,Z=d&&m?ln(m).fieldName:null!==(w=null===I||void 0===I?void 0:I.fieldName)&&void 0!==w?w:m,A=d&&Z?r[Z]:null!==(k=null!==(x=null!==(C=a[Z])&&void 0!==C?C:null===M||void 0===M?void 0:M.label)&&void 0!==x?x:null===M||void 0===M?void 0:M.fieldName)&&void 0!==k?k:s,L=d&&s?r[s]:a[F];return b.tooltip=this._getTooltip({label:A,value:L,chartType:c}),b}var E=be(u,l),P=se(l,f),T=m&&void 0!==a[m]?a[m]:le(E||new wt.Z({fieldName:P}),null===(n=this.popupTemplate)||void 0===n?void 0:n.expressionInfos),S=a[P];return b.tooltip=this._getTooltip({label:T,value:S,chartType:c}),b}}]),n}(O.Z);(0,p._)([(0,m.Cb)()],wn.prototype,"abilities",void 0),(0,p._)([(0,M.p)("abilities")],wn.prototype,"castAbilities",null),(0,p._)([(0,m.Cb)()],wn.prototype,"activeMediaInfoIndex",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wn.prototype,"activeMediaInfo",null),(0,p._)([(0,m.Cb)()],wn.prototype,"attributes",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"description",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"fieldInfoMap",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"formattedAttributes",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"expressionAttributes",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wn.prototype,"formattedMediaInfos",null),(0,p._)([(0,m.Cb)()],wn.prototype,"isAggregate",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"layer",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wn.prototype,"formattedMediaInfoCount",null),(0,p._)([(0,m.Cb)()],wn.prototype,"mediaInfos",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"popupTemplate",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"relatedInfos",void 0),(0,p._)([(0,m.Cb)()],wn.prototype,"title",void 0);var kn=wn=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],wn),xn=n(37384),Cn=n(8704),Mn="esri-feature-media",In={base:Mn,mediaContainer:"".concat(Mn,"__container"),mediaItemContainer:"".concat(Mn,"__item-container"),mediaItem:"".concat(Mn,"__item"),mediaItemText:"".concat(Mn,"__item-text"),mediaItemTitle:"".concat(Mn,"__item-title"),mediaItemCaption:"".concat(Mn,"__item-caption"),mediaNavigation:"".concat(Mn,"__item-navigation"),mediaPagination:"".concat(Mn,"__pagination"),mediaPaginationText:"".concat(Mn,"__pagination-text"),mediaPrevious:"".concat(Mn,"__previous"),mediaPreviousIconLTR:"".concat(Mn,"__previous-icon"),mediaPreviousIconRTL:"".concat(Mn,"__previous-icon--rtl"),mediaNext:"".concat(Mn,"__next"),mediaNextIconLTR:"".concat(Mn,"__next-icon"),mediaNextIconRTL:"".concat(Mn,"__next-icon--rtl"),mediaChart:"".concat(Mn,"__chart"),mediaPaginationButton:"".concat(Mn,"__pagination-button"),mediaPaginationIcon:"".concat(Mn,"__pagination-icon"),mediaChartRendered:"".concat(Mn,"__chart--rendered")},Fn="category",Zn="value",An=function(e){(0,c.Z)(p,e);var t=(0,d.Z)(p);function p(e,i){var o;return(0,s.Z)(this,p),(o=t.call(this,e,i))._refreshTimer=null,o._refreshIntervalInfo=null,o._featureElementInfo=null,o._chartRootMap=new WeakMap,o.viewModel=new kn,o.messages=null,o._disposeChart=function(e){var t;null!==(t=o._chartRootMap.get(e))&&void 0!==t&&t.dispose(),o._chartRootMap.delete(e)},o._createChart=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,l,s,u,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(0,w.Z)(o),a=i.destroyed,l=i.viewModel,!a&&l&&t){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Promise.all([n.e(4390),n.e(4788),n.e(85)]).then(n.bind(n,70085));case 5:return s=e.sent,u=s.createRoot,e.next=9,u(t);case 9:c=e.sent,o._chartRootMap.set(t,c),o._renderChart({mediaInfo:l.activeMediaInfo,root:c});case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o}return(0,u.Z)(p,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new ut,this.addHandles([(0,v.YP)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.activeMediaInfo,null===(n=e.viewModel)||void 0===n?void 0:n.activeMediaInfoIndex]}),(function(){return e._setupMediaRefreshTimer()}),v.nn),(0,v.YP)((function(){var t,n;return[null===(t=e.viewModel)||void 0===t?void 0:t.description,null===(n=e.viewModel)||void 0===n?void 0:n.title]}),(function(){return e._setupFeatureElementInfo()}),v.nn)])}},{key:"loadDependencies",value:function(){return(0,je.h)({icon:function(){return n.e(7474).then(n.bind(n,87474))}})}},{key:"destroy",value:function(){var e;this._clearMediaRefreshTimer(),null===(e=this._featureElementInfo)||void 0===e||e.destroy()}},{key:"attributes",get:function(){return this.viewModel.attributes},set:function(e){this.viewModel.attributes=e}},{key:"activeMediaInfoIndex",get:function(){return this.viewModel.activeMediaInfoIndex},set:function(e){this.viewModel.activeMediaInfoIndex=e}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"fieldInfoMap",get:function(){return this.viewModel.fieldInfoMap},set:function(e){this.viewModel.fieldInfoMap=e}},{key:"layer",get:function(){return this.viewModel.layer},set:function(e){this.viewModel.layer=e}},{key:"mediaInfos",get:function(){return this.viewModel.mediaInfos},set:function(e){this.viewModel.mediaInfos=e}},{key:"popupTemplate",get:function(){return this.viewModel.popupTemplate},set:function(e){this.viewModel.popupTemplate=e}},{key:"relatedInfos",get:function(){return this.viewModel.relatedInfos},set:function(e){this.viewModel.relatedInfos=e}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"render",value:function(){var e;return(0,Ue.u)("div",{bind:this,class:In.base,onkeyup:this._handleMediaKeyup},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),this._renderMedia())}},{key:"_renderMedia",value:function(){var e=this.viewModel,t=e.formattedMediaInfoCount,n=e.activeMediaInfoIndex,i=this._renderMediaText();return t?(0,Ue.u)("div",{class:In.mediaContainer,key:"media-element-container"},this._renderMediaInfo(),(0,Ue.u)("div",{class:In.mediaNavigation},i,t>1?(0,Ue.u)("div",{class:In.mediaPagination},this._renderMediaPageButton("previous"),(0,Ue.u)("span",{class:In.mediaPaginationText},(0,Cn.n)(this.messages.pageText,{index:n+1,total:t})),this._renderMediaPageButton("next")):null)):null}},{key:"_renderMediaText",value:function(){var e=this.viewModel.activeMediaInfo;if(!e)return null;var t=e&&e.title?(0,Ue.u)("div",{class:In.mediaItemTitle,innerHTML:e.title,key:"media-title"}):null,n=e&&e.caption?(0,Ue.u)("div",{class:In.mediaItemCaption,innerHTML:e.caption,key:"media-caption"}):null;return t||n?(0,Ue.u)("div",{class:In.mediaItemText,key:"media-text"},t,n):null}},{key:"_renderImageMediaInfo",value:function(e){var t,n=this._refreshIntervalInfo,i=this.viewModel,r=i.activeMediaInfoIndex,a=i.formattedMediaInfoCount,o=e.value,l=e.refreshInterval,s=e.altText,u=e.title,c=e.type,d=o.sourceURL,p=o.linkURL,f=ae(null!==p&&void 0!==p?p:void 0)?"_blank":"_self",h="_blank"===f?"noreferrer":"",v=l?n:null,m=v?v.timestamp:0,y=v?v.sourceURL:d,g=(0,Ue.u)("img",{alt:s||u,key:"media-".concat(c,"-").concat(r,"-").concat(a,"-").concat(m),src:null!==y&&void 0!==y?y:void 0});return null!==(t=p?(0,Ue.u)("a",{href:p,rel:h,target:f,title:u},g):null)&&void 0!==t?t:g}},{key:"_renderChartMediaInfo",value:function(e){var t=this.viewModel,n=t.activeMediaInfoIndex,i=t.formattedMediaInfoCount;return(0,Ue.u)("div",{afterCreate:this._createChart,afterRemoved:this._disposeChart,bind:this,class:In.mediaChart,key:"media-".concat(e.type,"-").concat(n,"-").concat(i)})}},{key:"_renderMediaInfoType",value:function(){var e=this.viewModel.activeMediaInfo;return e?"image"===e.type?this._renderImageMediaInfo(e):e.type.includes("chart")?this._renderChartMediaInfo(e):null:null}},{key:"_renderMediaInfo",value:function(){return this.viewModel.activeMediaInfo?(0,Ue.u)("div",{class:In.mediaItemContainer,key:"media-container"},(0,Ue.u)("div",{class:In.mediaItem,key:"media-item-container"},this._renderMediaInfoType())):null}},{key:"_renderMediaPageButton",value:function(e){if(this.viewModel.formattedMediaInfoCount<2)return null;var t="previous"===e,n=t?this.messages.previous:this.messages.next,i=t?"chevron-left":"chevron-right",r=t?"media-previous":"media-next",a=t?this._previous:this._next;return(0,Ue.u)("button",{"aria-label":n,bind:this,class:In.mediaPaginationButton,key:r,onclick:a,tabIndex:0,title:n,type:"button"},(0,Ue.u)("calcite-icon",{class:In.mediaPaginationIcon,icon:i,scale:"s"}))}},{key:"_setupFeatureElementInfo",value:function(){var e,t=this.description,n=this.title;null===(e=this._featureElementInfo)||void 0===e||e.set({description:t,title:n})}},{key:"_next",value:function(){this.viewModel.next()}},{key:"_previous",value:function(){this.viewModel.previous()}},{key:"_getRenderer",value:function(){if(this.viewModel){var e=this.viewModel,t=e.isAggregate,n=e.layer;return t&&null!==n&&void 0!==n&&n.featureReduction&&"renderer"in n.featureReduction?n.featureReduction.renderer:null===n||void 0===n?void 0:n.renderer}}},{key:"_getSeriesColors",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 2:return i=e.sent,a=i.colorAm5,o=new Map,e.abrupt("return",(t.forEach((function(e){e.color&&o.set(e,a(e.color.toCss(!0)))})),o));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getRendererColors",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,i,a,o,l,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 2:if(t=e.sent,i=t.colorAm5,a=new Map,o=this._getRenderer(),l="default",o){e.next=9;break}return e.abrupt("return",a);case 9:return e.next=11,Gt(o);case 11:return(s=e.sent).delete(l),e.abrupt("return",Array.from(s.values()).every((function(e){return 1===(null===e||void 0===e?void 0:e.length)}))?(Array.from(s.keys()).forEach((function(e){var t,n=null===(t=s.get(e))||void 0===t||null===(t=t[0])||void 0===t?void 0:t.toCss(!0);n&&a.set(e,i(n))})),a):a);case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_handleMediaKeyup",value:function(e){var t=(0,x.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this.viewModel.previous()),"ArrowRight"===t&&(e.stopPropagation(),this.viewModel.next())}},{key:"_canAnimateChart",value:function(){return!!this.viewModel&&!!this.viewModel.abilities.chartAnimation&&!window.matchMedia("(prefers-reduced-motion: reduce)").matches}},{key:"_getChartAnimationMS",value:function(){return this._canAnimateChart()?250:0}},{key:"_getChartSeriesAnimationMS",value:function(){return this._canAnimateChart()?500:0}},{key:"_renderChart",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,s,u,c,d,p,f,h,v,m,y,g,b,_,w,k,x,C;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.root,a=t.mediaInfo,s=a.value,u=a.type,e.next=6,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 6:return c=e.sent,d=c.ResponsiveThemeAm5,p=c.DarkThemeAm5,f=c.AnimatedThemeAm5,h=c.ColorSetAm5,v=c.ThemeAm5,m=c.esriChartColorSet,(y=v.new(i)).rule("ColorSet").set("colors",m),y.rule("ColorSet").set("reuse",!0),g=[d.new(i),y],(0,xn.$o)()&&g.push(p.new(i)),this._canAnimateChart()&&g.push(f.new(i)),i.setThemes(g),e.next=19,this._getRendererColors();case 19:return b=e.sent,e.next=22,this._getSeriesColors(s.series);case 22:_=e.sent,w=h.new(i,{}),k=_.get(s.series[0]),x=k?{lineSettings:{stroke:k}}:void 0,C=s.series.map((function(e,t){var n,i=_.get(e)||b.get(e.fieldName)||w.getIndex(t);return(0,l.Z)((n={},(0,o.Z)(n,Fn,e.tooltip),(0,o.Z)(n,Zn,e.value),(0,o.Z)(n,"columnSettings",{fill:i,stroke:i}),n),x)})).filter((function(e){return"pie-chart"!==u||null!=e.value&&e.value>0})),"pie-chart"===u?this._createPieChart(t,C):this._createXYChart(t,C);case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_getDirection",value:function(){return(0,He.dZ)(this.container)?"rtl":"ltr"}},{key:"_isInversed",value:function(){return!!(0,He.dZ)(this.container)}},{key:"_customizeChartTooltip",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var i,a,o,l,s=arguments;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:"horizontal",e.next=3,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 3:o=e.sent,l=o.colorAm5,t.setAll({pointerOrientation:a}),null!==(i=t.get("background"))&&void 0!==i&&i.setAll({stroke:l("rgba(50, 50, 50, 1)")}),t.label.setAll({direction:this._getDirection(),oversizedBehavior:"wrap",maxWidth:200});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createPieChart",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var a,o,l,s,u,c,d,p,f,h,v,m,y;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 2:return a=e.sent,o=a.TooltipAm5,e.next=6,Promise.all([n.e(4390),n.e(4788),n.e(7228),n.e(7011)]).then(n.bind(n,77011));case 6:l=e.sent,s=l.PieChartAm5,u=l.PieSeriesAm5,c=t.mediaInfo,d=t.root,p=c.title,5,f=(null===c||void 0===c?void 0:c.altText)||(null===c||void 0===c?void 0:c.title)||"",h=d.container.children.push(s.new(d,{ariaLabel:f,focusable:!0,paddingBottom:5,paddingTop:5,paddingLeft:5,paddingRight:5})),v="{category}: {valuePercentTotal.formatNumber('0.00')}%\n ({value})",m=o.new(d,{labelText:v}),(y=h.series.push(u.new(d,{name:p,valueField:Zn,categoryField:Fn,tooltip:m}))).ticks.template.set("forceHidden",!0),y.labels.template.set("forceHidden",!0),y.slices.template.states.create("active",{shiftRadius:5}),this._customizeChartTooltip(m),y.slices.template.setAll({ariaLabel:v,focusable:!0,templateField:"columnSettings"}),y.data.setAll(i),y.appear(this._getChartSeriesAnimationMS()),h.appear(this._getChartAnimationMS()),h.root.dom.classList.toggle(In.mediaChartRendered,!0);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getMinSeriesValue",value:function(e){var t=0;return e.forEach((function(e){return t=Math.min(e.value,t)})),t}},{key:"_createColumnChart",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i,a){var o,l,s,u,c,d,p,f,h,v,m,y,g,b,_,w,k,x;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 2:return o=e.sent,l=o.TooltipAm5,s=o.ScrollbarAm5,e.next=7,Promise.all([n.e(4390),n.e(4788),n.e(7228),n.e(7372)]).then(n.bind(n,27372));case 7:u=e.sent,c=u.CategoryAxisAm5,d=u.AxisRendererXAm5,p=u.ValueAxisAm5,f=u.AxisRendererYAm5,h=u.ColumnSeriesAm5,v=i.mediaInfo,m=i.root,y=v.value,g=v.title,t.setAll({wheelX:"panX",wheelY:"zoomX"}),(b=t.xAxes.push(c.new(m,{renderer:d.new(m,{inversed:this._isInversed()}),categoryField:Fn}))).get("renderer").labels.template.setAll({forceHidden:!0}),(_=t.yAxes.push(p.new(m,{renderer:f.new(m,{inside:!1}),min:this._getMinSeriesValue(y.series)}))).get("renderer").labels.template.setAll({direction:this._getDirection()}),w="{categoryX}",k=l.new(m,{labelText:w}),x=t.series.push(h.new(m,{name:g,xAxis:b,yAxis:_,valueYField:Zn,categoryXField:Fn,tooltip:k})),this._customizeChartTooltip(k),x.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),y.series.length>15&&t.set("scrollbarX",s.new(m,{orientation:"horizontal"})),b.data.setAll(a),x.data.setAll(a),x.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS());case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_createBarChart",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i,a){var o,l,s,u,c,d,p,f,h,v,m,y,g,b,_,w,k,x;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 2:return o=e.sent,l=o.TooltipAm5,s=o.ScrollbarAm5,e.next=7,Promise.all([n.e(4390),n.e(4788),n.e(7228),n.e(7372)]).then(n.bind(n,27372));case 7:u=e.sent,c=u.CategoryAxisAm5,d=u.AxisRendererXAm5,p=u.ValueAxisAm5,f=u.AxisRendererYAm5,h=u.ColumnSeriesAm5,v=i.mediaInfo,m=i.root,y=v.value,g=v.title,t.setAll({wheelX:"panY",wheelY:"zoomY"}),(b=t.yAxes.push(c.new(m,{renderer:f.new(m,{inversed:!0}),categoryField:Fn}))).get("renderer").labels.template.setAll({forceHidden:!0}),(_=t.xAxes.push(p.new(m,{renderer:d.new(m,{inside:!1,inversed:this._isInversed()}),min:this._getMinSeriesValue(y.series)}))).get("renderer").labels.template.setAll({direction:this._getDirection()}),w="{categoryY}",k=l.new(m,{labelText:w}),x=t.series.push(h.new(m,{name:g,xAxis:_,yAxis:b,valueXField:Zn,categoryYField:Fn,tooltip:k})),this._customizeChartTooltip(k,"vertical"),x.columns.template.setAll({ariaLabel:w,focusable:!0,templateField:"columnSettings"}),y.series.length>15&&t.set("scrollbarY",s.new(m,{orientation:"vertical"})),b.data.setAll(a),x.data.setAll(a),x.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS());case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_createLineChart",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i,a){var o,l,s,u,c,d,p,f,h,v,m,y,g,b,_,w,k,x,C,M;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(9815)]).then(n.bind(n,29815));case 2:return s=e.sent,u=s.TooltipAm5,c=s.ScrollbarAm5,e.next=7,Promise.all([n.e(4390),n.e(4788),n.e(7228),n.e(7372)]).then(n.bind(n,27372));case 7:d=e.sent,p=d.CategoryAxisAm5,f=d.AxisRendererXAm5,h=d.ValueAxisAm5,v=d.AxisRendererYAm5,m=d.LineSeriesAm5,y=i.root,g=i.mediaInfo,b=g.value,_=g.title,t.setAll({wheelX:"panX",wheelY:"zoomX"}),(w=t.xAxes.push(p.new(y,{renderer:f.new(y,{inversed:this._isInversed()}),categoryField:Fn}))).get("renderer").labels.template.setAll({forceHidden:!0}),(k=t.yAxes.push(h.new(y,{renderer:v.new(y,{inside:!1}),min:this._getMinSeriesValue(b.series)}))).get("renderer").labels.template.setAll({direction:this._getDirection()}),"{categoryX}",x=null===(o=a[0])||void 0===o||null===(o=o.lineSettings)||void 0===o?void 0:o.stroke,C=u.new(y,{getFillFromSprite:!x,labelText:"{categoryX}"}),x&&(null===(l=C.get("background"))||void 0===l||l.setAll({fill:x})),(M=t.series.push(m.new(y,{name:_,xAxis:w,yAxis:k,valueYField:Zn,categoryXField:Fn,tooltip:C}))).strokes.template.setAll({templateField:"lineSettings"}),this._customizeChartTooltip(C,"vertical"),b.series.length>15&&t.set("scrollbarX",c.new(y,{orientation:"horizontal"})),w.data.setAll(a),M.data.setAll(a),M.appear(this._getChartSeriesAnimationMS()),t.appear(this._getChartAnimationMS());case 26:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_createXYChart",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,i){var a,o,l,s,u,c,d,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([n.e(4390),n.e(4788),n.e(7228),n.e(7372)]).then(n.bind(n,27372));case 2:if(a=e.sent,o=a.XYChartAm5,l=a.XYCursorAm5,s=t.root,u=t.mediaInfo,c=u.type,d=(null===u||void 0===u?void 0:u.altText)||(null===u||void 0===u?void 0:u.title)||"",(p=s.container.children.push(o.new(s,{ariaLabel:d,focusable:!0,panX:!0,panY:!0}))).set("cursor",l.new(s,{})),e.t0="column-chart"===c,!e.t0){e.next=15;break}return e.next=15,this._createColumnChart(p,t,i);case 15:if(e.t1="bar-chart"===c,!e.t1){e.next=19;break}return e.next=19,this._createBarChart(p,t,i);case 19:if(e.t2="line-chart"===c,!e.t2){e.next=23;break}return e.next=23,this._createLineChart(p,t,i);case 23:p.root.dom.classList.toggle(In.mediaChartRendered,!0);case 24:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_clearMediaRefreshTimer",value:function(){var e=this._refreshTimer;e&&(clearTimeout(e),this._refreshTimer=null)}},{key:"_updateMediaInfoTimestamp",value:function(e){var t=Date.now();this._refreshIntervalInfo={timestamp:t,sourceURL:e&&this._getImageSource(e,t)}}},{key:"_setupMediaRefreshTimer",value:function(){this._clearMediaRefreshTimer();var e=this.viewModel.activeMediaInfo;e&&"image"===e.type&&e.refreshInterval&&this._setRefreshTimeout(e)}},{key:"_setRefreshTimeout",value:function(e){var t=this,n=e.refreshInterval,i=e.value;if(n){var r=6e4*n;this._updateMediaInfoTimestamp(i.sourceURL);var a=setInterval((function(){t._updateMediaInfoTimestamp(i.sourceURL)}),r);this._refreshTimer=a}}},{key:"_getImageSource",value:function(e,t){var n=e.includes("?")?"&":"?",r=e.split("#"),a=(0,i.Z)(r,2),o=a[0],l=a[1],s=void 0===l?"":l;return"".concat(o).concat(n,"timestamp=").concat(t).concat(s?"#":"").concat(s)}}]),p}(I.Z);(0,p._)([(0,m.Cb)()],An.prototype,"_refreshIntervalInfo",void 0),(0,p._)([(0,m.Cb)()],An.prototype,"attributes",null),(0,p._)([(0,m.Cb)()],An.prototype,"activeMediaInfoIndex",null),(0,p._)([(0,m.Cb)()],An.prototype,"description",null),(0,p._)([(0,m.Cb)()],An.prototype,"fieldInfoMap",null),(0,p._)([(0,m.Cb)()],An.prototype,"layer",null),(0,p._)([(0,m.Cb)()],An.prototype,"mediaInfos",null),(0,p._)([(0,m.Cb)()],An.prototype,"popupTemplate",null),(0,p._)([(0,m.Cb)()],An.prototype,"relatedInfos",null),(0,p._)([(0,m.Cb)()],An.prototype,"title",null),(0,p._)([(0,m.Cb)({type:kn})],An.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Feature/t9n/Feature")],An.prototype,"messages",void 0);var Ln=An=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureMedia")],An),En=(n(26418),n(23046),n(1374),n(39384),n(29230)),Pn=n(29514),Tn=(n(44051),n(98752)),Sn=n(26538),Rn=n(64326),On=["$datastore","$map","$layer","$aggregatedfeatures"],Nn=h.Z.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");function zn(e){return"string"==typeof e?ke(we(e)):Array.isArray(e)?function(e){return'<ul class="esri-widget__list">'.concat(e.map((function(e){return"<li>".concat("string"==typeof e?ke(we(e)):e,"</li>")})).join(""),"</ul>")}(e):"esri.arcade.Dictionary"===(null===e||void 0===e?void 0:e.declaredClass)?function(e){return'<table class="esri-widget__table">'.concat(e.keys().map((function(t){var n=e.field(t);return"<tr><th>".concat(t,"</th><td>").concat("string"==typeof n?ke(we(n)):n,"</td></tr>")})).join(""),"</table>")}(e):e}function Vn(e){var t=e.aggregatedFeatures,n=e.arcadeUtils,i=e.featureSetVars,r=e.context,a=e.viewInfo,o=e.map,s=e.graphic,u=e.interceptor;i.forEach((function(e){var i=e.toLowerCase(),c=a.sr,d={map:o,spatialReference:c,interceptor:u};if("$map"===i&&(r.vars[i]=n.convertMapToFeatureSetCollection(d)),"$layer"===i&&(r.vars[i]=n.convertFeatureLayerToFeatureSet({layer:s.sourceLayer,spatialReference:c,interceptor:u})),"$datastore"===i&&(r.vars[i]=n.convertServiceUrlToWorkspace({url:s.sourceLayer.url,spatialReference:c,interceptor:u})),"$aggregatedfeatures"===i){var p=s.layer,f=p.fields,h=p.objectIdField,v=p.geometryType,m=p.spatialReference,y=p.displayField,g=new Rn.default((0,l.Z)((0,l.Z)({fields:f,objectIdField:h,geometryType:v,spatialReference:m,displayField:y},"feature"===p.type?{templates:p.templates,typeIdField:p.typeIdField,types:p.types}:null),{},{source:t}));r.vars[i]=n.convertFeatureLayerToFeatureSet({layer:g,spatialReference:m,interceptor:u})}}))}function Bn(){return Promise.all([n.e(5026),n.e(3013)]).then(n.bind(n,53013))}function Dn(e){return"createQuery"in e&&"queryFeatures"in e}function jn(e){return qn.apply(this,arguments)}function qn(){return(qn=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.graphic,i=t.view,a=n.isAggregate,o=n.layer,a&&o&&"2d"===(null===i||void 0===i?void 0:i.type)){e.next=4;break}return e.abrupt("return",[]);case 4:return e.next=6,i.whenLayerView(o);case 6:if(Dn(l=e.sent)){e.next=9;break}return e.abrupt("return",[]);case 9:return s=l.createQuery(),u=n.getObjectId(),s.aggregateIds=null!=u?[u]:[],e.next=13,l.queryFeatures(s);case 13:return c=e.sent,d=c.features,e.abrupt("return",d);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wn(e){return Hn.apply(this,arguments)}function Hn(){return Hn=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,o,l,s,u,c,d,p,f,h,v,m,y,g;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.expressionInfo,a=t.arcadeUtils,o=t.interceptor,l=t.spatialReference,s=t.map,u=t.graphic,c=t.view,null!==n&&void 0!==n&&n.expression){e.next=3;break}return e.abrupt("return",null);case 3:return d=a.createSyntaxTree(n.expression),p=On.filter((function(e){return a.hasVariable(d,e)})),e.next=7,Promise.all([jn({graphic:u,view:c}),a.loadScriptDependencies(d,!0,p)]);case 7:return f=e.sent,h=(0,i.Z)(f,1),v=h[0],m=a.getViewInfo({spatialReference:l}),(y=a.createExecContext(u,m,null===c||void 0===c?void 0:c.timeZone)).interceptor=o,y.useAsync=!0,Vn({aggregatedFeatures:v,arcadeUtils:a,featureSetVars:p,context:y,viewInfo:m,map:s,graphic:u,interceptor:o}),g=a.createFunction(d,y),e.abrupt("return",a.executeAsyncFunction(g,y).catch((function(e){return Nn.error("arcade-execution-error",{error:e,graphic:u,expressionInfo:n})})));case 15:case"end":return e.stop()}}),e)}))),Hn.apply(this,arguments)}function Yn(e){return Un.apply(this,arguments)}function Un(){return Un=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c,d,p,f,h,v,m;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.expressionInfos,i=t.spatialReference,a=t.graphic,o=t.interceptor,l=t.map,s=t.view,null!==n&&void 0!==n&&n.length){e.next=3;break}return e.abrupt("return",{});case 3:return e.next=5,Bn();case 5:u=e.sent,c={},d=(0,Lt.Z)(n);try{for(d.s();!(p=d.n()).done;)f=p.value,c["expression/".concat(f.name)]=Wn({expressionInfo:f,arcadeUtils:u,interceptor:o,spatialReference:i,map:l,graphic:a,view:s})}catch(r){d.e(r)}finally{d.f()}return e.next=11,(0,Xt.as)(c);case 11:for(m in h=e.sent,v={},h)v[m]=zn(h[m].value);return e.abrupt("return",v);case 15:case"end":return e.stop()}}),e)}))),Un.apply(this,arguments)}var Gn=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._abortController=null,i.expressionInfo=null,i.graphic=null,i.contentElement=null,i.contentElementViewModel=null,i.interceptor=null,i.view=null,i._cancelQuery=function(){var e=(0,w.Z)(i)._abortController;e&&e.abort(),i._abortController=null},i._createVM=function(){var e,t,n=null===(e=i.contentElement)||void 0===e?void 0:e.type;null===(t=i.contentElementViewModel)||void 0===t||t.destroy();var r="fields"===n?new xt:"media"===n?new kn:"text"===n?new ht:null;i._set("contentElementViewModel",r)},i._compile=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i._cancelQuery(),t=new AbortController,i._abortController=t,e.next=5,i._compileExpression();case 5:i._abortController===t&&(i._abortController=null);case 6:case"end":return e.stop()}}),e)}))),i._compileThrottled=(0,C.P)(i._compile,1,(0,w.Z)(i)),i._compileExpression=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a,o,l,s,u,c,d,p,f,h,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,w.Z)(i),n=t.expressionInfo,a=t.graphic,o=t.interceptor,l=t.spatialReference,s=t.map,u=t.view,c=t._abortController,n&&a&&l&&s){e.next=3;break}return e.abrupt("return",void i._set("contentElement",null));case 3:return e.next=5,Bn();case 5:if(d=e.sent,c===i._abortController){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,Wn({arcadeUtils:d,expressionInfo:n,graphic:a,interceptor:o,map:s,spatialReference:l,view:u});case 10:if((p=e.sent)&&"esri.arcade.Dictionary"===p.declaredClass){e.next=13;break}return e.abrupt("return",void i._set("contentElement",null));case 13:return e.next=15,p.castAsJsonAsync(null===c||void 0===c?void 0:c.signal);case 15:f=e.sent,h=null===f||void 0===f?void 0:f.type,v="media"===h?Pn.Z.fromJSON(f):"text"===h?Tn.Z.fromJSON(f):"fields"===h?En.Z.fromJSON(f):null,i._set("contentElement",v);case 19:case"end":return e.stop()}}),e)}))),i.addHandles([(0,v.YP)((function(){return[i.expressionInfo,i.graphic,i.map,i.spatialReference,i.view]}),(function(){return i._compileThrottled()}),v.nn),(0,v.YP)((function(){return[i.contentElement]}),(function(){return i._createVM()}),v.nn)]),i}return(0,u.Z)(n,[{key:"initialize",value:function(){this.addHandles(this._compileThrottled)}},{key:"destroy",value:function(){var e;this._cancelQuery(),null!==(e=this.contentElementViewModel)&&void 0!==e&&e.destroy(),this._set("contentElementViewModel",null),this._set("contentElement",null)}},{key:"spatialReference",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null},set:function(e){this._override("spatialReference",e)}},{key:"state",get:function(){var e=this._abortController,t=this.contentElement,n=this.contentElementViewModel;return e?"loading":t||n?"ready":"disabled"}},{key:"map",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.map)&&void 0!==e?e:null},set:function(e){this._override("map",e)}}]),n}(O.Z);(0,p._)([(0,m.Cb)()],Gn.prototype,"_abortController",void 0),(0,p._)([(0,m.Cb)({type:Sn.Z})],Gn.prototype,"expressionInfo",void 0),(0,p._)([(0,m.Cb)({type:R.Z})],Gn.prototype,"graphic",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Gn.prototype,"contentElement",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Gn.prototype,"contentElementViewModel",void 0),(0,p._)([(0,m.Cb)()],Gn.prototype,"interceptor",void 0),(0,p._)([(0,m.Cb)()],Gn.prototype,"spatialReference",null),(0,p._)([(0,m.Cb)({readOnly:!0})],Gn.prototype,"state",null),(0,p._)([(0,m.Cb)()],Gn.prototype,"map",null),(0,p._)([(0,m.Cb)()],Gn.prototype,"view",void 0);var Jn=Gn=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],Gn),Qn="esri-feature",$n={base:"".concat(Qn,"-expression"),loadingSpinnerContainer:"".concat(Qn,"__loading-container"),spinner:"".concat(Qn,"__loading-spinner")},Xn=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i))._contentWidget=null,r.viewModel=new Jn,r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.contentElementViewModel}),(function(){return e._setupExpressionWidget()}),v.nn))}},{key:"destroy",value:function(){this._destroyContentWidget()}},{key:"render",value:function(){var e,t=this.viewModel.state;return(0,Ue.u)("div",{class:$n.base},"loading"===t?this._renderLoading():"disabled"===t?null:null===(e=this._contentWidget)||void 0===e?void 0:e.render())}},{key:"_renderLoading",value:function(){return(0,Ue.u)("div",{class:$n.loadingSpinnerContainer,key:"loading-container"},(0,Ue.u)("span",{class:this.classes(We.W.loadingIndicator,qe.z.rotating,$n.spinner)}))}},{key:"_destroyContentWidget",value:function(){var e=this._contentWidget;e&&(e.viewModel=null,e.destroy()),this._contentWidget=null}},{key:"_setupExpressionWidget",value:function(){var e=this.viewModel,t=e.contentElementViewModel,n=e.contentElement,i=null===n||void 0===n?void 0:n.type;this._destroyContentWidget();var r=t?"fields"===i?new At({viewModel:t}):"media"===i?new Ln({viewModel:t}):"text"===i?new bt({viewModel:t}):null:null;this._contentWidget=r,this.scheduleRender()}}]),n}(I.Z);(0,p._)([(0,m.Cb)({type:Jn})],Xn.prototype,"viewModel",void 0);var Kn=Xn=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureExpression")],Xn),ei=n(92026),ti=n(11582),ni=n(79056);n(41644),n(29890),n(83651);var ii;!function(e){e.TOO_SHORT="length-validation-error::too-short"}(ii||(ii={}));var ri=function(e){var t=[];if(e.formTemplate){var n,i=e.formTemplate,r=i.description,a=i.title;null===(n=e.fields)||void 0===n||n.forEach((function(e){var n=a&&(0,P.pZ)(a,e.name),i=r&&(0,P.pZ)(r,e.name);(n||i)&&t.push(e.name)}))}return t};var ai=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._loaded=!1,i._queryAbortController=null,i._queryPageAbortController=null,i._queryFeatureCountAbortController=null,i.featuresPerPage=10,i.description=null,i.graphic=null,i.layer=null,i.map=null,i.orderByFields=null,i.featureCount=0,i.relationshipId=null,i.showAllEnabled=!1,i.title=null,i._cancelQuery=function(){var e=(0,w.Z)(i)._queryAbortController;e&&e.abort(),i._queryAbortController=null},i._cancelQueryFeatureCount=function(){var e=(0,w.Z)(i)._queryFeatureCountAbortController;e&&e.abort(),i._queryFeatureCountAbortController=null},i._cancelQueryPage=function(){var e=(0,w.Z)(i)._queryPageAbortController;e&&e.abort(),i._queryPageAbortController=null},i._queryController=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i._cancelQuery(),t=new AbortController,i._queryAbortController=t,e.next=5,(0,Xt.R8)(i._query());case 5:i._queryAbortController===t&&(i._queryAbortController=null);case 6:case"end":return e.stop()}}),e)}))),i._queryFeatureCountController=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i._loaded=!1,i._cancelQueryFeatureCount(),t=new AbortController,i._queryFeatureCountAbortController=t,e.next=5,(0,Xt.R8)(i._queryFeatureCount());case 5:i._queryFeatureCountAbortController===t&&(i._queryFeatureCountAbortController=null),i._loaded=!0;case 7:case"end":return e.stop()}}),e)}))),i._queryPageController=(0,a.Z)((0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new AbortController,i._queryPageAbortController=t,e.next=4,(0,Xt.R8)(i._queryPage());case 4:i._queryPageAbortController===t&&(i._queryPageAbortController=null);case 5:case"end":return e.stop()}}),e)}))),i._queryDebounced=(0,Xt.Ds)(i._queryController,100),i._queryFeatureCountDebounced=(0,Xt.Ds)(i._queryFeatureCountController,100),i._queryPageDebounced=(0,Xt.Ds)(i._queryPageController,100),i._query=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(0,w.Z)(i),n=t._queryAbortController,a=t.relatedFeatures,e.t0=i.featureCount,!e.t0){e.next=15;break}if(i._destroyRelatedFeatureViewModels(),i.featurePage=1,a.removeAll(),e.t1=i.destroyed,e.t1){e.next=15;break}return e.t2=a,e.t3=i,e.next=12,i._queryRelatedFeatures({signal:null===n||void 0===n?void 0:n.signal});case 12:e.t4=e.sent,e.t5=e.t3._sliceFeatures.call(e.t3,e.t4),e.t2.addMany.call(e.t2,e.t5);case 15:case"end":return e.stop()}}),e)}))),i.addHandles([(0,v.YP)((function(){var e;return[i.displayCount,i.graphic,i.layer,null===(e=i.layer)||void 0===e?void 0:e.loaded,i.map,i.orderByFields,i.relationshipId,i.featuresPerPage,i.showAllEnabled,i.canQuery,i.featureCount]}),(function(){return i._queryDebounced()}),v.nn),(0,v.YP)((function(){return[i.featurePage,i.showAllEnabled]}),(function(){return i._queryPageDebounced()})),(0,v.YP)((function(){return[i.layer,i.relationshipId,i.objectId,i.canQuery]}),(function(){return i._queryFeatureCountDebounced()}))]),i}return(0,u.Z)(n,[{key:"destroy",value:function(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.removeAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}},{key:"featurePage",get:function(){return this._get("featurePage")},set:function(e){var t=this.featuresPerPage,n=this.featureCount,i=Math.ceil(n/t)||1;this._set("featurePage",Math.min(Math.max(e,1),i))}},{key:"orderByFieldsFixedCasing",get:function(){var e=this.orderByFields,t=this.relatedLayer;return e&&null!==t&&void 0!==t&&t.loaded?e.map((function(e){var n=e.clone();return n.field=se(e.field,t),n})):null!==e&&void 0!==e?e:[]}},{key:"supportsCacheHint",get:function(){var e;return!(null===(e=this.layer)||void 0===e||null===(e=e.capabilities)||void 0===e||null===(e=e.queryRelated)||void 0===e||!e.supportsCacheHint)}},{key:"canLoad",get:function(){return!!this.map&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId}},{key:"canQuery",get:function(){var e,t=null===(e=this.layer)||void 0===e||null===(e=e.capabilities)||void 0===e?void 0:e.queryRelated;return!!(this.relatedLayer&&this.relationship&&"number"==typeof this.relationshipId&&"number"==typeof this.objectId&&null!==t&&void 0!==t&&t.supportsCount&&null!==t&&void 0!==t&&t.supportsPagination)}},{key:"itemDescriptionFieldName",get:function(){var e;return(null===(e=this.orderByFieldsFixedCasing[0])||void 0===e?void 0:e.field)||null}},{key:"displayCount",get:function(){return this._get("displayCount")},set:function(e){this._set("displayCount",Math.min(Math.max(e,0),10))}},{key:"objectId",get:function(){var e,t;return null!==(e=this.objectIdField&&(null===(t=this.graphic)||void 0===t||null===(t=t.attributes)||void 0===t?void 0:t[this.objectIdField]))&&void 0!==e?e:null}},{key:"objectIdField",get:function(){var e;return(null===(e=this.layer)||void 0===e?void 0:e.objectIdField)||null}},{key:"relatedFeatures",get:function(){return this._get("relatedFeatures")||new k.Z}},{key:"relatedLayer",get:function(){var e,t=this.layer,n=this.map,i=this.relationship;return null!==t&&void 0!==t&&t.loaded&&n&&i&&null!==(e=function(e,t,n){return e&&t&&n?Re(e.allLayers,t,n)||Re(e.allTables,t,n):null}(n,t,i))&&void 0!==e?e:null}},{key:"relationship",get:function(){var e,t,n=this.relationshipId,i=this.layer;return"number"==typeof n&&null!==(e=null===i||void 0===i||null===(t=i.relationships)||void 0===t?void 0:t.find((function(e){return e.id===n})))&&void 0!==e?e:null}},{key:"relatedFeatureViewModels",get:function(){return this._get("relatedFeatureViewModels")||new k.Z}},{key:"state",get:function(){var e=this._queryAbortController,t=this._queryFeatureCountAbortController,n=this._queryPageAbortController,i=this.canQuery,r=this._loaded,a=this.canLoad;return t||a&&!r?"loading":e||n?"querying":i?"ready":"disabled"}},{key:"getRelatedFeatureByObjectId",value:function(e){return this.relatedFeatures.find((function(t){return t.getObjectId()===e}))}},{key:"_destroyRelatedFeatureViewModels",value:function(){var e;null!==(e=this.relatedFeatureViewModels)&&void 0!==e&&e.forEach((function(e){return!e.destroyed&&e.destroy()})),this.relatedFeatureViewModels.removeAll()}},{key:"_queryFeatureCount",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i,a,o,l,s,u,c,d,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.layer,i=this.relatedLayer,a=this.relationshipId,o=this.objectId,l=this._queryFeatureCountAbortController,s=this.canQuery,u=this.supportsCacheHint,e.next=3,null===n||void 0===n?void 0:n.load();case 3:return e.next=5,null===i||void 0===i?void 0:i.load();case 5:if(s&&n&&i){e.next=7;break}return e.abrupt("return",void this._set("featureCount",0));case 7:return c=i.createQuery(),d=new nn.default({cacheHint:u,relationshipId:a,returnGeometry:!1,objectIds:[o],where:null!==(t=c.where)&&void 0!==t?t:void 0}),e.next=11,n.queryRelatedFeaturesCount(d,{signal:null===l||void 0===l?void 0:l.signal});case 11:p=e.sent,this._set("featureCount",p[o]||0);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_sliceFeatures",value:function(e){var t=this.showAllEnabled,n=this.displayCount;return t?e:n?e.slice(0,n):[]}},{key:"_queryPage",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.relatedFeatures,n=this.featurePage,i=this.showAllEnabled,a=this._queryPageAbortController,o=this.featureCount,e.t0=!i||n<2||!o,e.t0){e.next=8;break}return e.t1=t,e.next=6,this._queryRelatedFeatures({signal:null===a||void 0===a?void 0:a.signal});case 6:e.t2=e.sent,e.t1.addMany.call(e.t1,e.t2);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_queryRelatedFeatures",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c,d,p,f,h,v,m,g,b,w,k,x,C,M,I,F;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.orderByFieldsFixedCasing,o=this.showAllEnabled,l=this.featuresPerPage,s=this.displayCount,u=this.layer,c=this.relationshipId,d=this.featurePage,p=this.featureCount,f=this.relatedLayer,h=this.supportsCacheHint,v=this.canQuery,m=this.objectId,v&&u&&f){e.next=3;break}return e.abrupt("return",[]);case 3:return g=o?((d-1)*l+p)%p:0,b=o?l:s,w=f.objectIdField,k=[].concat((0,_.Z)(a.map((function(e){return e.field}))),(0,_.Z)(ri(f)),[w]).filter(y.pC),x=a.map((function(e){return"".concat(e.field," ").concat(e.order)})),C=f.createQuery(),M=new nn.default({orderByFields:x,start:g,num:b,outFields:k,cacheHint:h,relationshipId:c,returnGeometry:!1,objectIds:[m],where:null!==(n=C.where)&&void 0!==n?n:void 0}),e.next=12,u.queryRelatedFeatures(M,{signal:null===t||void 0===t?void 0:t.signal});case 12:return I=e.sent,F=(null===(i=I[m])||void 0===i?void 0:i.features)||[],e.abrupt("return",(F.forEach((function(e){e.sourceLayer=f,e.layer=f})),F));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}((0,ti.J)((0,ni.IG)(O.Z)));(0,p._)([(0,m.Cb)()],ai.prototype,"_loaded",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"_queryAbortController",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"_queryPageAbortController",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"_queryFeatureCountAbortController",void 0),(0,p._)([(0,m.Cb)({value:1})],ai.prototype,"featurePage",null),(0,p._)([(0,m.Cb)()],ai.prototype,"featuresPerPage",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"orderByFieldsFixedCasing",null),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"supportsCacheHint",null),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"canLoad",null),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"canQuery",null),(0,p._)([(0,m.Cb)()],ai.prototype,"description",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"itemDescriptionFieldName",null),(0,p._)([(0,m.Cb)({value:3})],ai.prototype,"displayCount",null),(0,p._)([(0,m.Cb)({type:R.Z})],ai.prototype,"graphic",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"layer",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"map",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"objectId",null),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"objectIdField",null),(0,p._)([(0,m.Cb)()],ai.prototype,"orderByFields",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"relatedFeatures",null),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"relatedLayer",null),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"relationship",null),(0,p._)([(0,m.Cb)()],ai.prototype,"featureCount",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],ai.prototype,"relatedFeatureViewModels",null),(0,p._)([(0,m.Cb)()],ai.prototype,"relationshipId",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"showAllEnabled",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"state",null),(0,p._)([(0,m.Cb)()],ai.prototype,"title",void 0),(0,p._)([(0,m.Cb)()],ai.prototype,"getRelatedFeatureByObjectId",null);var oi=ai=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],ai),li="esri-feature",si="".concat(li,"-relationship"),ui={base:si,listContainer:"".concat(si,"__list"),listItem:"".concat(si,"__list-item"),listItemHidden:"".concat(si,"__list-item--hidden"),listContainerQuerying:"".concat(si,"__list--querying"),featureObserver:"".concat(li,"__feature-observer"),stickySpinnerContainer:"".concat(li,"__sticky-loading-container"),loadingSpinnerContainer:"".concat(li,"__loading-container"),spinner:"".concat(li,"__loading-spinner")},ci={title:!0,description:!0},di=function(e){(0,c.Z)(p,e);var t=(0,d.Z)(p);function p(e,n){var r;return(0,s.Z)(this,p),(r=t.call(this,e,n))._featureElementInfo=null,r._relatedFeatureIntersectionObserverNode=null,r._relatedFeatureIntersectionObserver=new IntersectionObserver((function(e){var t=(0,i.Z)(e,1)[0];(null===t||void 0===t?void 0:t.isIntersecting)&&r._increaseFeaturePage()}),{root:window.document}),r.headingLevel=2,r.viewModel=new oi,r.messages=null,r.messagesCommon=null,r.visibleElements=(0,l.Z)({},ci),r._increaseFeaturePage=function(){var e=r.viewModel,t=e.state,n=e.showAllEnabled,i=e.relatedFeatures,a=e.featuresPerPage,o=e.featurePage;"ready"===t&&n&&i.length>=a*o&&r.viewModel.featurePage++},r}return(0,u.Z)(p,[{key:"initialize",value:function(){var e=this;this._featureElementInfo=new ut,this.addHandles([(0,v.YP)((function(){return[e.viewModel.description,e.viewModel.title,e.headingLevel]}),(function(){return e._setupFeatureElementInfo()}),v.nn),(0,v.YP)((function(){return[e.viewModel.state,e.viewModel.showAllEnabled,e._relatedFeatureIntersectionObserverNode]}),(function(){return e._handleRelatedFeatureObserverChange()})),(0,v.on)((function(){return e.viewModel.relatedFeatureViewModels}),"change",(function(){return e._setupRelatedFeatureViewModels()}))])}},{key:"loadDependencies",value:function(){return(0,je.h)({icon:function(){return n.e(7474).then(n.bind(n,87474))},list:function(){return Promise.all([n.e(6997),n.e(2054),n.e(8501)]).then(n.bind(n,18501))},"list-item":function(){return Promise.all([n.e(6997),n.e(5138),n.e(7205)]).then(n.bind(n,7205))},notice:function(){return Promise.all([n.e(6997),n.e(1617)]).then(n.bind(n,51617))}})}},{key:"destroy",value:function(){this._unobserveRelatedFeatureObserver(),this._featureElementInfo=(0,ei.SC)(this._featureElementInfo)}},{key:"displayShowAllButton",get:function(){var e=this.viewModel,t=e.showAllEnabled,n=e.featureCount,i=e.displayCount,r=e.state;return!t&&!!n&&"ready"===r&&(n>i||0===i)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||this.viewModel.relatedFeatureViewModels.length>0}},{key:"description",get:function(){return this.viewModel.description},set:function(e){this.viewModel.description=e}},{key:"featureCountDescription",get:function(){var e=this.messages,t=this.viewModel.featureCount;return(0,Cn.n)(null===e||void 0===e?void 0:e.numberRecords,{number:t})}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"castVisibleElements",value:function(e){return(0,l.Z)((0,l.Z)({},ci),e)}},{key:"render",value:function(){var e,t=this.viewModel.state;return(0,Ue.u)("div",{class:this.classes(ui.base,qe.z.widget)},null===(e=this._featureElementInfo)||void 0===e?void 0:e.render(),"loading"===t?this._renderLoading():"disabled"===t?this._renderRelationshipNotFound():this._renderRelatedFeatures())}},{key:"_renderStickyLoading",value:function(){return"querying"===this.viewModel.state?(0,Ue.u)("div",{class:ui.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}},{key:"_renderLoadingIcon",value:function(){return(0,Ue.u)("span",{class:this.classes(We.W.loadingIndicator,qe.z.rotating,ui.spinner)})}},{key:"_renderLoading",value:function(){return(0,Ue.u)("div",{class:ui.loadingSpinnerContainer,key:"loading-container"},this._renderLoadingIcon())}},{key:"_renderShowAllIconNode",value:function(){return(0,Ue.u)("calcite-icon",{icon:"list",scale:"s",slot:"content-end"})}},{key:"_renderChevronIconNode",value:function(){var e=(0,He.dZ)(this.container)?"chevron-left":"chevron-right";return(0,Ue.u)("calcite-icon",{icon:e,scale:"s",slot:"content-end"})}},{key:"_renderRelatedFeature",value:function(e){var t,n,i=this,r=this.viewModel.itemDescriptionFieldName,a=e.title;e.description=r&&(null===(t=e.formattedAttributes)||void 0===t?void 0:t.global[r]);var l="loading"===e.state;return(0,Ue.u)("calcite-list-item",{class:this.classes(ui.listItem,(0,o.Z)({},ui.listItemHidden,l)),description:null!==(n=e.description)&&void 0!==n?n:"",key:e.uid,label:a,onCalciteListItemSelect:function(){return i.emit("select-record",{featureViewModel:e})}},this._renderChevronIconNode())}},{key:"_renderShowAllListItem",value:function(){var e,t=this;return this.displayShowAllButton?(0,Ue.u)("calcite-list-item",{description:this.featureCountDescription,key:"show-all-item",label:null===(e=this.messages)||void 0===e?void 0:e.showAll,onCalciteListItemSelect:function(){return t.emit("show-all-records")}},this._renderShowAllIconNode()):null}},{key:"_renderNoRelatedFeaturesMessage",value:function(){var e;return(0,Ue.u)("calcite-notice",{icon:"information",key:"no-related-features-message",kind:"brand",open:!0,scale:"s",width:"full"},(0,Ue.u)("div",{slot:"message"},null===(e=this.messages)||void 0===e?void 0:e.noRelatedFeatures))}},{key:"_renderFeatureObserver",value:function(){return(0,Ue.u)("div",{afterCreate:this._relatedFeatureIntersectionObserverCreated,bind:this,class:ui.featureObserver,key:"feature-observer"})}},{key:"_renderList",value:function(){var e=this,t=this.viewModel.relatedFeatureViewModels;return(0,Ue.u)("calcite-list",null,t.toArray().map((function(t){return e._renderRelatedFeature(t)})),this._renderShowAllListItem())}},{key:"_renderRelatedFeatures",value:function(){var e=this.displayListItems,t=this.viewModel.state;return(0,Ue.u)("div",{class:this.classes(ui.listContainer,(0,o.Z)({},ui.listContainerQuerying,"querying"===t)),key:"list-container"},e?this._renderList():"ready"===t?this._renderNoRelatedFeaturesMessage():null,this._renderStickyLoading(),this._renderFeatureObserver())}},{key:"_renderRelationshipNotFound",value:function(){var e;return(0,Ue.u)("calcite-notice",{icon:"exclamation-mark-triangle",key:"relationship-not-found",kind:"danger",open:!0,scale:"s",width:"full"},(0,Ue.u)("div",{slot:"message"},null===(e=this.messages)||void 0===e?void 0:e.relationshipNotFound))}},{key:"_setupRelatedFeatureViewModels",value:function(){var e=this,t=this.viewModel.relatedFeatureViewModels,n="related-feature-viewmodels";this.removeHandles(n),null!==t&&void 0!==t&&t.forEach((function(t){e.addHandles((0,v.YP)((function(){return[t.title,t.state]}),(function(){return e.scheduleRender()}),v.nn),n)})),this.scheduleRender()}},{key:"_setupFeatureElementInfo",value:function(){var e,t=this.headingLevel,n=this.visibleElements,i=n.description&&this.description,r=n.title&&this.title;null===(e=this._featureElementInfo)||void 0===e||e.set({description:i,title:r,headingLevel:t})}},{key:"_handleRelatedFeatureObserverChange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._unobserveRelatedFeatureObserver(),t=this.viewModel,n=t.state,i=t.showAllEnabled,e.next=4,(0,Xt.e4)(0);case 4:this._relatedFeatureIntersectionObserverNode&&"ready"===n&&i&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_relatedFeatureIntersectionObserverCreated",value:function(e){this._relatedFeatureIntersectionObserverNode=e}},{key:"_unobserveRelatedFeatureObserver",value:function(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)}}]),p}(I.Z);(0,p._)([(0,m.Cb)()],di.prototype,"_relatedFeatureIntersectionObserverNode",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],di.prototype,"displayShowAllButton",null),(0,p._)([(0,m.Cb)({readOnly:!0})],di.prototype,"displayListItems",null),(0,p._)([(0,m.Cb)()],di.prototype,"description",null),(0,p._)([(0,m.Cb)({readOnly:!0})],di.prototype,"featureCountDescription",null),(0,p._)([(0,m.Cb)()],di.prototype,"headingLevel",void 0),(0,p._)([(0,m.Cb)()],di.prototype,"title",null),(0,p._)([(0,m.Cb)({type:oi})],di.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Feature/t9n/Feature")],di.prototype,"messages",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/t9n/common")],di.prototype,"messagesCommon",void 0),(0,p._)([(0,m.Cb)()],di.prototype,"visibleElements",void 0),(0,p._)([(0,M.p)("visibleElements")],di.prototype,"castVisibleElements",null);var pi,fi=di=(0,p._)([(0,g.j)("esri.widgets.Feature.FeatureRelationship")],di),hi=(0,u.Z)((function e(t,n){(0,s.Z)(this,e),this.preLayerQueryCallback=t,this.preRequestCallback=n,this.preLayerQueryCallback||(this.preLayerQueryCallback=function(e){}),this.preRequestCallback||(this.preLayerQueryCallback=function(e){})})),vi="content-view-models",mi="relationship-view-models",yi={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0},gi=pi=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._error=null,i._featureAbortController=null,i._graphicChangedThrottled=(0,C.P)(i._graphicChanged,1,(0,w.Z)(i)),i._expressionAttributes=null,i._graphicExpressionAttributes=null,i.abilities=(0,l.Z)({},yi),i.content=null,i.contentViewModels=[],i.description=null,i.defaultPopupTemplateEnabled=!1,i.formattedAttributes=null,i.lastEditInfo=null,i.relatedInfos=new Map,i.title="",i.view=null,i._isAllowedContentType=function(e){var t=(0,w.Z)(i).abilities;return"attachments"===e.type&&!!t.attachmentsContent||"custom"===e.type&&!!t.customContent||"fields"===e.type&&!!t.fieldsContent||"media"===e.type&&!!t.mediaContent||"text"===e.type&&!!t.textContent||"expression"===e.type&&!!t.expressionContent||"relationship"===e.type&&!!t.relationshipContent},i.addHandles((0,v.YP)((function(){return[i.graphic,i._effectivePopupTemplate,i.abilities]}),(function(){return i._graphicChangedThrottled()}),v.nn)),i}return(0,u.Z)(n,[{key:"initialize",value:function(){this.addHandles(this._graphicChangedThrottled)}},{key:"destroy",value:function(){this._clear(),this._cancelFeatureQuery(),this._error=null,this.graphic=null,this._destroyContentViewModels(),this.relatedInfos.clear()}},{key:"_effectivePopupTemplate",get:function(){return null!=this.graphic?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return function(e,t){var n=new Map;return e?(e.forEach((function(e){var i=se(e.fieldName,t);e.fieldName=i,n.set(i.toLowerCase(),e)})),n):n}(_e(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return ne(this.graphic)}},{key:"castAbilities",value:function(e){return(0,l.Z)((0,l.Z)({},yi),e)}},{key:"isTable",get:function(){var e;return(null===(e=this._sourceLayer)||void 0===e?void 0:e.isTable)||!1}},{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(e){this._set("graphic",e?e.clone():null)}},{key:"spatialReference",get:function(){var e,t;return null!==(e=null===(t=this.view)||void 0===t?void 0:t.spatialReference)&&void 0!==e?e:null},set:function(e){this._override("spatialReference",e)}},{key:"map",get:function(){var e;return(null===(e=this.view)||void 0===e?void 0:e.map)||null},set:function(e){this._override("map",e)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}},{key:"setActiveMedia",value:function(e,t){var n=this.contentViewModels[e];n instanceof kn&&n.setActiveMedia(t)}},{key:"nextMedia",value:function(e){var t=this.contentViewModels[e];t instanceof kn&&t.next()}},{key:"previousMedia",value:function(e){var t=this.contentViewModels[e];t instanceof kn&&t.previous()}},{key:"updateGeometry",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i,a,o,l,s,u,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.graphic,i=this.spatialReference,a=this._sourceLayer,e.next=3,null===a||void 0===a?void 0:a.load();case 3:if((o=null===a||void 0===a?void 0:a.objectIdField)&&n&&a){e.next=6;break}return e.abrupt("return");case 6:if(null!=(l=null===n||void 0===n||null===(t=n.attributes)||void 0===t?void 0:t[o])){e.next=9;break}return e.abrupt("return");case 9:if(s=[l],n.geometry){e.next=16;break}return e.next=13,Me({layer:a,graphic:n,outFields:[],objectIds:s,returnGeometry:!0,spatialReference:i});case 13:u=e.sent,(c=null===u||void 0===u?void 0:u.geometry)&&(n.geometry=c);case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_clear",value:function(){this._set("title",""),this._set("content",null),this._set("formattedAttributes",null)}},{key:"_graphicChanged",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._cancelFeatureQuery(),this._error=null,this._clear(),t=this.graphic){e.next=4;break}return e.abrupt("return");case 4:return n=new AbortController,this._featureAbortController=n,e.prev=6,e.next=9,this._queryFeature({signal:n.signal});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),(0,Xt.D_)(e.t0)||(this._error=e.t0,h.Z.getLogger(this).error("error","The popupTemplate could not be displayed for this feature.",{error:e.t0,graphic:t,popupTemplate:this._effectivePopupTemplate}));case 14:this._featureAbortController===n&&(this._featureAbortController=null);case 15:case"end":return e.stop()}}),e,this,[[6,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"_cancelFeatureQuery",value:function(){var e=this._featureAbortController;e&&e.abort(),this._featureAbortController=null}},{key:"_compileContentElement",value:function(e,t){return"attachments"===e.type?this._compileAttachments(e,t):"custom"===e.type?this._compileCustom(e,t):"fields"===e.type?this._compileFields(e,t):"media"===e.type?this._compileMedia(e,t):"text"===e.type?this._compileText(e,t):"expression"===e.type?this._compileExpression(e,t):"relationship"===e.type?this._compileRelationship(e,t):void 0}},{key:"_compileContent",value:function(e){var t=this;if(this._destroyContentViewModels(),this.graphic)return Array.isArray(e)?e.filter(this._isAllowedContentType).map((function(e,n){return t._compileContentElement(e,n)})).filter(y.pC):"string"==typeof e?this._compileText(new Tn.Z({text:e}),0).text:e}},{key:"_destroyContentViewModels",value:function(){this.removeHandles(mi),this.removeHandles(vi),this.contentViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("contentViewModels",[])}},{key:"_matchesFeature",value:function(e,t){var n,i=null===e||void 0===e||null===(n=e.graphic)||void 0===n?void 0:n.getObjectId(),r=null===t||void 0===t?void 0:t.getObjectId();return null!=i&&null!=r&&i===r}},{key:"_setRelatedFeaturesViewModels",value:function(e){var t=this,n=e.relatedFeatureViewModels,i=e.relatedFeatures,r=e.map,a=this.view,o=this.spatialReference;null!==i&&void 0!==i&&i.filter(Boolean).forEach((function(e){n.find((function(n){return t._matchesFeature(n,e)}))||n.add(new pi({abilities:{relationshipContent:!1},map:r,view:a,spatialReference:o,graphic:e}))})),n.forEach((function(e){var r=null===i||void 0===i?void 0:i.find((function(n){return t._matchesFeature(e,n)}));r||n.remove(e)}))}},{key:"_setExpressionContentVM",value:function(e,t){var n=this.formattedAttributes,i=e.contentElement,r=e.contentElementViewModel,a=null===i||void 0===i?void 0:i.type;r&&a&&("fields"===a&&(this._createFieldsFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:n}),r.set(this._createFieldsVMParams(i,t))),"media"===a&&(this._createMediaFormattedAttributes({contentElement:i,contentElementIndex:t,formattedAttributes:n}),r.set(this._createMediaVMParams(i,t))),"text"===a&&r.set(this._createTextVMParams(i)))}},{key:"_compileRelationship",value:function(e,t){var n=this,i=e.displayCount,r=e.orderByFields,a=e.relationshipId,o=e.title,s=e.description,u=this._sourceLayer,c=this.graphic,d=this.map;if(me(u)){var p=new oi((0,l.Z)({displayCount:i,graphic:c,orderByFields:r,relationshipId:a,layer:u,map:d},this._compileTitleAndDesc({title:o,description:s})));return this.contentViewModels[t]=p,this.addHandles((0,v.on)((function(){return p.relatedFeatures}),"change",(function(){return n._setRelatedFeaturesViewModels(p)})),mi),e}}},{key:"_compileExpression",value:function(e,t){var n=this,i=e.expressionInfo,r=this.graphic,a=this.map,o=this.spatialReference,l=this.view,s=new Jn({expressionInfo:i,graphic:r,interceptor:pi.interceptor,map:a,spatialReference:o,view:l});return this.contentViewModels[t]=s,this.addHandles((0,v.YP)((function(){return s.contentElementViewModel}),(function(){return n._setExpressionContentVM(s,t)}),v.nn),vi),e}},{key:"_compileAttachments",value:function(e,t){var n=this.graphic,i=e.description,r=e.title;return this.contentViewModels[t]=new tt((0,l.Z)({graphic:n},this._compileTitleAndDesc({title:r,description:i}))),e}},{key:"_compileCustom",value:function(e,t){var n=this.graphic,i=e.creator,r=e.destroyer;return this.contentViewModels[t]=new ht({graphic:n,creator:i,destroyer:r}),e}},{key:"_compileTitleAndDesc",value:function(e){var t=e.title,n=e.description,i=this._fieldInfoMap,r=this._sourceLayer,a=this.graphic,o=this.formattedAttributes,l=null===a||void 0===a?void 0:a.attributes,s=this._expressionAttributes,u=o.global;return{title:de({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:s,layer:r,text:t}),description:de({attributes:l,fieldInfoMap:i,globalAttributes:u,expressionAttributes:s,layer:r,text:n})}}},{key:"_createFieldsVMParams",value:function(e,t){var n=this._effectivePopupTemplate,i=this.formattedAttributes,r=(0,l.Z)((0,l.Z)({},null===i||void 0===i?void 0:i.global),null===i||void 0===i?void 0:i.content[t]),a=(null===e||void 0===e?void 0:e.fieldInfos)||(null===n||void 0===n?void 0:n.fieldInfos),o=null===a||void 0===a?void 0:a.filter((function(e){var t=e.fieldName;return oe(t)||Ee(t)||r.hasOwnProperty(t)})),s=null===n||void 0===n?void 0:n.expressionInfos,u=e.description,c=e.title;return(0,l.Z)({attributes:r,expressionInfos:s,fieldInfos:o},this._compileTitleAndDesc({title:c,description:u}))}},{key:"_compileFields",value:function(e,t){var n=e.clone(),i=new xt(this._createFieldsVMParams(e,t));return this.contentViewModels[t]=i,n.fieldInfos=i.formattedFieldInfos.slice(0),n}},{key:"_createMediaVMParams",value:function(e,t){var n,i=this.abilities,r=this.graphic,a=this._fieldInfoMap,o=this._effectivePopupTemplate,s=this.relatedInfos,u=this._sourceLayer,c=this._expressionAttributes,d=this.formattedAttributes,p=null!==(n=null===r||void 0===r?void 0:r.attributes)&&void 0!==n?n:{},f=e.description,h=e.mediaInfos,v=e.title;return(0,l.Z)({abilities:{chartAnimation:i.chartAnimation},activeMediaInfoIndex:e.activeMediaInfoIndex||0,attributes:p,isAggregate:null===r||void 0===r?void 0:r.isAggregate,layer:u,fieldInfoMap:a,formattedAttributes:(0,l.Z)((0,l.Z)({},null===d||void 0===d?void 0:d.global),null===d||void 0===d?void 0:d.content[t]),expressionAttributes:c,mediaInfos:h,popupTemplate:o,relatedInfos:s},this._compileTitleAndDesc({title:v,description:f}))}},{key:"_compileMedia",value:function(e,t){var n=e.clone(),i=new kn(this._createMediaVMParams(e,t));return n.mediaInfos=i.formattedMediaInfos.slice(0),this.contentViewModels[t]=i,n}},{key:"_createTextVMParams",value:function(e){var t=this.graphic,n=this._fieldInfoMap,i=this._sourceLayer,r=this._expressionAttributes;if(e&&e.text){var a,o,l,s=null!==(a=null===t||void 0===t?void 0:t.attributes)&&void 0!==a?a:{},u=null!==(o=null===(l=this.formattedAttributes)||void 0===l?void 0:l.global)&&void 0!==o?o:{};e.text=de({attributes:s,fieldInfoMap:n,globalAttributes:u,expressionAttributes:r,layer:i,text:e.text})}return{graphic:t,creator:e.text}}},{key:"_compileText",value:function(e,t){var n=e.clone();return this.contentViewModels[t]=new ht(this._createTextVMParams(n)),n}},{key:"_compileLastEditInfo",value:function(){var e,t=this._effectivePopupTemplate,n=this._sourceLayer,i=this.graphic,r=this.view;if(t){var a=t.lastEditInfoEnabled,o=null===n||void 0===n?void 0:n.editFieldsInfo;return a&&o?function(e,t,n,i){var r=e.creatorField,a=e.creationDateField,o=e.editorField,s=e.editDateField;if(t){var u=(0,W.Np)(i&&"preferredTimeZone"in i?i.preferredTimeZone:null,!(!i||!("datesInUnknownTimezone"in i))&&!!i.datesInUnknownTimezone,n,te,"date"),c=(0,l.Z)((0,l.Z)({},te),u),d=t[s];if("number"==typeof d){var p=t[o];return{type:"edit",date:(0,V.p6)(d,c),user:p}}var f=t[a];if("number"==typeof f){var h=t[r];return{type:"create",date:(0,V.p6)(f,c),user:h}}return null}}(o,null===i||void 0===i?void 0:i.attributes,null!==(e=null===r||void 0===r?void 0:r.timeZone)&&void 0!==e?e:W.By,n):void 0}}},{key:"_compileTitle",value:function(e){var t,n,i,r=this._fieldInfoMap,a=this._sourceLayer,o=this.graphic,l=this._expressionAttributes;return de({attributes:null!==(t=null===o||void 0===o?void 0:o.attributes)&&void 0!==t?t:{},fieldInfoMap:r,globalAttributes:null!==(n=null===(i=this.formattedAttributes)||void 0===i?void 0:i.global)&&void 0!==n?n:{},expressionAttributes:l,layer:a,text:e})}},{key:"_getTitle",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._effectivePopupTemplate,n=this.graphic){e.next=3;break}return e.abrupt("return",null);case 3:return i=null===t||void 0===t?void 0:t.title,e.abrupt("return",ie(i,{graphic:n}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_getContent",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this._effectivePopupTemplate,n=this.graphic){e.next=3;break}return e.abrupt("return",null);case 3:return i=null===t||void 0===t?void 0:t.content,e.abrupt("return",ie(i,{graphic:n}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_queryFeature",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,s,u,c,d,p,f,h,v;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this._featureAbortController,i=this._sourceLayer,a=this.graphic,o=this._effectivePopupTemplate,s=this.map,u=this.view,c=this.spatialReference,n===this._featureAbortController&&a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,Ae({graphic:a,popupTemplate:o,layer:i,spatialReference:c},t);case 5:return e.next=7,(0,Xt.as)({content:this._getContent(),title:this._getTitle()});case 7:return d=e.sent,p=d.content.value,f=d.title.value,e.next=12,(0,Xt.as)({checkForRelatedFeatures:this._checkForRelatedFeatures(t),expressionAttributes:Yn({expressionInfos:null===o||void 0===o?void 0:o.expressionInfos,spatialReference:c,graphic:a,map:s,interceptor:pi.interceptor,view:u})});case 12:h=e.sent,v=h.expressionAttributes.value,n===this._featureAbortController&&a&&(this._expressionAttributes=v,this._graphicExpressionAttributes=(0,l.Z)((0,l.Z)({},a.attributes),v),this._set("formattedAttributes",this._createFormattedAttributes(p)),this._set("title",this._compileTitle(f)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(p)||null));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_createMediaFormattedAttributes",value:function(e){var t,n,i=e.contentElement,r=e.contentElementIndex,a=e.formattedAttributes,o=this._effectivePopupTemplate,s=this.graphic,u=this.relatedInfos,c=this._sourceLayer,d=this._fieldInfoMap,p=this._graphicExpressionAttributes;a.content[r]=Ce({fieldInfos:null===o||void 0===o?void 0:o.fieldInfos,graphic:s,attributes:(0,l.Z)((0,l.Z)({},p),i.attributes),layer:c,fieldInfoMap:d,relatedInfos:u,timeZone:null!==(t=null===(n=this.view)||void 0===n?void 0:n.timeZone)&&void 0!==t?t:W.By})}},{key:"_createFieldsFormattedAttributes",value:function(e){var t=e.contentElement,n=e.contentElementIndex,i=e.formattedAttributes;if(t.fieldInfos){var r,a,o=this.graphic,s=this.relatedInfos,u=this._sourceLayer,c=this._fieldInfoMap,d=this._graphicExpressionAttributes;i.content[n]=Ce({fieldInfos:t.fieldInfos,graphic:o,attributes:(0,l.Z)((0,l.Z)({},d),t.attributes),layer:u,fieldInfoMap:c,relatedInfos:s,timeZone:null!==(r=null===(a=this.view)||void 0===a?void 0:a.timeZone)&&void 0!==r?r:W.By})}}},{key:"_createFormattedAttributes",value:function(e){var t,n,i=this,r=this._effectivePopupTemplate,a=this.graphic,o=this.relatedInfos,l=this._sourceLayer,s=this._fieldInfoMap,u=this._graphicExpressionAttributes,c={global:Ce({fieldInfos:null===r||void 0===r?void 0:r.fieldInfos,graphic:a,attributes:u,layer:l,fieldInfoMap:s,relatedInfos:o,timeZone:null!==(t=null===(n=this.view)||void 0===n?void 0:n.timeZone)&&void 0!==t?t:W.By}),content:[]};return Array.isArray(e)&&e.forEach((function(e,t){"fields"===e.type&&i._createFieldsFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:c}),"media"===e.type&&i._createMediaFormattedAttributes({contentElement:e,contentElementIndex:t,formattedAttributes:c})})),c}},{key:"_checkForRelatedFeatures",value:function(e){var t=this.graphic,n=this._effectivePopupTemplate;return this._queryRelatedInfos(t,_e(n),e)}},{key:"_queryRelatedInfos",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,o,l,s,u,c,d=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.relatedInfos,o=this._sourceLayer,a.clear(),null==(null===o||void 0===o?void 0:o.associatedLayer)){e.next=8;break}return e.next=5,null===o||void 0===o?void 0:o.associatedLayer.load(i);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=o;case 9:if((l=e.t0)&&t){e.next=12;break}return e.abrupt("return");case 12:if(s=n.filter((function(e){return e&&Ee(e.fieldName)})),null!==s&&void 0!==s&&s.length){e.next=15;break}return e.abrupt("return");case 15:return n.forEach((function(e){return d._configureRelatedInfo(e,l)})),e.next=18,yn({relatedInfos:a,layer:l},i);case 18:return u=e.sent,Object.keys(u).forEach((function(e){var t,n=a.get(e.toString()),i=null===(t=u[e])||void 0===t?void 0:t.value;n&&i&&(n.layerInfo=i.data)})),e.next=22,gn({graphic:t,relatedInfos:a,layer:l},i);case 22:c=e.sent,Object.keys(c).forEach((function(e){var t;dn(null===(t=c[e])||void 0===t?void 0:t.value,a.get(e.toString()))}));case 24:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"_configureRelatedInfo",value:function(e,t){var n=this.relatedInfos,i=ln(e.fieldName);if(i){var r=i.layerId,a=i.fieldName;if(r){var o=n.get(r.toString())||cn(r,t);o&&(function(e){var t,n=e.relatedInfo,i=e.fieldName,r=e.fieldInfo;if(null!==(t=n.relatedFields)&&void 0!==t&&t.push(i),r.statisticType){var a,o=new rn.Z({statisticType:r.statisticType,onStatisticField:i,outStatisticFieldName:i});null===(a=n.outStatistics)||void 0===a||a.push(o)}}({relatedInfo:o,fieldName:a,fieldInfo:e}),this.relatedInfos.set(r,o))}}}}]),n}((0,ni.IG)(O.Z));gi.interceptor=new hi((function(e){var t=e.query,n=e.layer,i=e.method;Se({layer:n,method:i,query:t,definitionExpression:"".concat(n.definitionExpression," ").concat(n.serviceDefinitionExpression)})}),(function(e){var t=e.queryPayload,n=e.layer,i=e.method;Se({layer:n,method:i,query:t,definitionExpression:"".concat(n.definitionExpression," ").concat(n.serviceDefinitionExpression)})})),(0,p._)([(0,m.Cb)()],gi.prototype,"_error",void 0),(0,p._)([(0,m.Cb)()],gi.prototype,"_featureAbortController",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"_effectivePopupTemplate",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"_fieldInfoMap",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"_sourceLayer",null),(0,p._)([(0,m.Cb)()],gi.prototype,"abilities",void 0),(0,p._)([(0,M.p)("abilities")],gi.prototype,"castAbilities",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"content",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"contentViewModels",void 0),(0,p._)([(0,m.Cb)()],gi.prototype,"description",void 0),(0,p._)([(0,m.Cb)({type:Boolean})],gi.prototype,"defaultPopupTemplateEnabled",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"isTable",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"state",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"formattedAttributes",void 0),(0,p._)([(0,m.Cb)({type:R.Z,value:null})],gi.prototype,"graphic",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"lastEditInfo",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"relatedInfos",void 0),(0,p._)([(0,m.Cb)()],gi.prototype,"spatialReference",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"title",void 0),(0,p._)([(0,m.Cb)()],gi.prototype,"map",null),(0,p._)([(0,m.Cb)({readOnly:!0})],gi.prototype,"waitingForContent",null),(0,p._)([(0,m.Cb)()],gi.prototype,"view",void 0);var bi,_i=gi=pi=(0,p._)([(0,g.j)("esri.widgets.FeatureViewModel")],gi),wi=n(29845),ki=function(e){var t=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).renderNodeContent=function(t){return(0,vt.Qd)(t)&&!t.destroyed?(0,Ue.u)("div",{class:wi.i.contentNode,key:t},t.render()):t instanceof HTMLElement?(0,Ue.u)("div",{afterCreate:e._attachToNode,bind:t,class:wi.i.contentNode,key:t}):(0,vt.o)(t)?(0,Ue.u)("div",{afterCreate:e._attachToNode,bind:t.domNode,class:wi.i.contentNode,key:t}):null},e}return(0,u.Z)(n,[{key:"_attachToNode",value:function(e){e.appendChild(this)}}]),n}(e);return t=(0,p._)([(0,g.j)("esri.widgets.Feature.ContentMixin")],t)},xi={title:!0,content:!0,lastEditedInfo:!0},Ci="relationship-handles",Mi=bi=function(e){(0,c.Z)(i,e);var t=(0,d.Z)(i);function i(e,n){var r;return(0,s.Z)(this,i),(r=t.call(this,e,n))._contentWidgets=[],r.flowItems=null,r.headingLevel=2,r.messages=null,r.messagesCommon=null,r.messagesURIUtils=null,r.visibleElements=(0,l.Z)({},xi),r.viewModel=new _i,r}return(0,u.Z)(i,[{key:"initialize",value:function(){var e=this;this.addHandles((0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.contentViewModels}),(function(){return e._setupContentWidgets()}),v.nn))}},{key:"loadDependencies",value:function(){return(0,je.h)({notice:function(){return Promise.all([n.e(6997),n.e(1617)]).then(n.bind(n,51617))}})}},{key:"destroy",value:function(){this._destroyContentWidgets()}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(e){this.viewModel.graphic=e}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(e){this.viewModel.defaultPopupTemplateEnabled=e}},{key:"isTable",get:function(){return this.viewModel.isTable}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(e){this.viewModel.spatialReference=e}},{key:"title",get:function(){return this.viewModel.title}},{key:"castVisibleElements",value:function(e){return(0,l.Z)((0,l.Z)({},xi),e)}},{key:"map",get:function(){return this.viewModel.map},set:function(e){this.viewModel.map=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"setActiveMedia",value:function(e,t){return this.viewModel.setActiveMedia(e,t)}},{key:"nextMedia",value:function(e){return this.viewModel.nextMedia(e)}},{key:"previousMedia",value:function(e){return this.viewModel.previousMedia(e)}},{key:"render",value:function(){var e=this.viewModel.state,t=(0,Ue.u)("div",{class:wi.i.container,key:"container"},this._renderTitle(),"error"===e?this._renderError():"loading"===e?this._renderLoading():this._renderContentContainer());return(0,Ue.u)("div",{class:this.classes(wi.i.base,qe.z.widget)},t)}},{key:"_renderError",value:function(){var e=this.messagesCommon,t=this.messages,n=this.visibleElements;return(0,Ue.u)("calcite-notice",{icon:"exclamation-mark-circle",kind:"danger",open:!0,scale:"s"},n.title?(0,Ue.u)("div",{key:"error-title",slot:"title"},e.errorMessage):null,(0,Ue.u)("div",{key:"error-message",slot:"message"},t.loadingError))}},{key:"_renderLoading",value:function(){return(0,Ue.u)("div",{class:wi.i.loadingSpinnerContainer,key:"loading-container"},(0,Ue.u)("span",{class:this.classes(We.W.loadingIndicator,qe.z.rotating,wi.i.spinner)}))}},{key:"_renderContentContainer",value:function(){return this.visibleElements.content?(0,Ue.u)("div",{class:wi.i.main},[this._renderContent(),this._renderLastEditInfo()]):null}},{key:"_renderTitle",value:function(){var e=this.visibleElements,t=this.title;return e.title?(0,Ue.u)(rt,{class:wi.i.title,innerHTML:t,level:this.headingLevel}):null}},{key:"_renderContent",value:function(){var e=this.viewModel.content,t="content";if(!e)return null;if(Array.isArray(e))return e.length?(0,Ue.u)("div",{class:wi.i.contentNode,key:"".concat(t,"-content-elements")},e.map(this._renderContentElement,this)):null;if("string"==typeof e){var n=this._contentWidgets[0];return!n||n.destroyed?null:(0,Ue.u)("div",{class:this.classes(wi.i.contentNode,wi.i.contentNodeText),key:"".concat(t,"-content")},n.render())}return this.renderNodeContent(e)}},{key:"_renderContentElement",value:function(e,t){var n,i=this.visibleElements;if("boolean"!=typeof i.content&&(null===(n=i.content)||void 0===n||!n[e.type]))return null;switch(e.type){case"attachments":return this._renderAttachments(t);case"custom":return this._renderCustom(e,t);case"fields":return this._renderFields(t);case"media":return this._renderMedia(t);case"text":return this._renderText(e,t);case"expression":return this._renderExpression(t);case"relationship":return this._renderRelationship(t);default:return null}}},{key:"_renderAttachments",value:function(e){var t=this._contentWidgets[e];if(!t||t.destroyed)return null;var n=t.viewModel,i=n.state,r=n.attachmentInfos;return"loading"===i||r.length>0?(0,Ue.u)("div",{class:this.classes(wi.i.contentElement),key:this._buildKey("attachments-element",e)},t.render()):null}},{key:"_renderRelationship",value:function(e){var t=this._contentWidgets[e];return t&&!t.destroyed&&this.flowItems?(0,Ue.u)("div",{class:wi.i.contentElement,key:this._buildKey("relationship-element",e)},t.render()):null}},{key:"_renderExpression",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,Ue.u)("div",{class:wi.i.contentElement,key:this._buildKey("expression-element",e)},t.render())}},{key:"_renderCustom",value:function(e,t){var n=e.creator,i=this._contentWidgets[t];return!i||i.destroyed?null:n?(0,Ue.u)("div",{class:wi.i.contentElement,key:this._buildKey("custom-element",t)},i.render()):null}},{key:"_renderFields",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,Ue.u)("div",{class:wi.i.contentElement,key:this._buildKey("fields-element",e)},t.render())}},{key:"_renderMedia",value:function(e){var t=this._contentWidgets[e];return!t||t.destroyed?null:(0,Ue.u)("div",{class:wi.i.contentElement,key:this._buildKey("media-element",e)},t.render())}},{key:"_renderLastEditInfo",value:function(){var e=this.visibleElements,t=this.messages,n=this.viewModel.lastEditInfo;if(!n||!e.lastEditedInfo)return null;var i=n.date,r=n.user,a="edit"===n.type?r?t.lastEditedByUser:t.lastEdited:r?t.lastCreatedByUser:t.lastCreated,o=(0,Cn.n)(a,{date:i,user:r});return(0,Ue.u)("div",{class:this.classes(wi.i.lastEditedInfo,wi.i.contentElement),key:"edit-info-element"},o)}},{key:"_renderText",value:function(e,t){var n=e.text,i=this._contentWidgets[t];return!i||i.destroyed?null:n?(0,Ue.u)("div",{class:this.classes(wi.i.contentElement,wi.i.text),key:this._buildKey("text-element",t)},i.render()):null}},{key:"_buildKey",value:function(e){for(var t,n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];return"".concat(e,"__").concat((null===(t=this.viewModel)||void 0===t||null===(t=t.graphic)||void 0===t?void 0:t.uid)||"0","-").concat(i.join("-"))}},{key:"_destroyContentWidget",value:function(e){e&&(e.viewModel=null,!e.destroyed&&e.destroy())}},{key:"_destroyContentWidgets",value:function(){var e=this;this.removeHandles(Ci),this._contentWidgets.forEach((function(t){return e._destroyContentWidget(t)})),this._contentWidgets=[]}},{key:"_addFeatureRelationshipHandles",value:function(e){var t=this,n=this.flowItems,i=this.visibleElements;this.addHandles([(0,v.on)((function(){return e}),"select-record",(function(e){var t=e.featureViewModel;n&&(t.abilities={relationshipContent:!0},n.push(new bi({flowItems:n,viewModel:t,visibleElements:i})))})),(0,v.on)((function(){return e}),"show-all-records",(function(){if(n){var i=e.viewModel;i.showAllEnabled=!0;var r=new fi({visibleElements:{title:!1,description:!1},viewModel:i});t._addFeatureRelationshipHandles(r),n.push(r)}}))],Ci)}},{key:"_setupContentWidgets",value:function(){var e,t=this;this._destroyContentWidgets();var n=this.headingLevel,i=this.visibleElements,r=null===(e=this.viewModel)||void 0===e?void 0:e.content,a=this.viewModel.contentViewModels;if(Array.isArray(r))r.forEach((function(e,r){if("attachments"===e.type&&(t._contentWidgets[r]=new pt({displayType:e.displayType,headingLevel:i.title?n+1:n,viewModel:a[r]})),"fields"===e.type&&(t._contentWidgets[r]=new At({viewModel:a[r]})),"media"===e.type&&(t._contentWidgets[r]=new Ln({viewModel:a[r]})),"text"===e.type&&(t._contentWidgets[r]=new bt({viewModel:a[r]})),"custom"===e.type&&(t._contentWidgets[r]=new bt({viewModel:a[r]})),"expression"===e.type&&(t._contentWidgets[r]=new Kn({viewModel:a[r]})),"relationship"===e.type){var o=new fi({viewModel:a[r]});t._addFeatureRelationshipHandles(o),t._contentWidgets[r]=o}}),this);else{var o=a[0];o&&!o.destroyed&&(this._contentWidgets[0]=new bt({viewModel:o}))}this.scheduleRender()}}]),i}(ki(I.Z));(0,p._)([(0,m.Cb)()],Mi.prototype,"graphic",null),(0,p._)([(0,m.Cb)()],Mi.prototype,"defaultPopupTemplateEnabled",null),(0,p._)([(0,m.Cb)()],Mi.prototype,"flowItems",void 0),(0,p._)([(0,m.Cb)()],Mi.prototype,"headingLevel",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Mi.prototype,"isTable",null),(0,p._)([(0,m.Cb)()],Mi.prototype,"label",null),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Feature/t9n/Feature")],Mi.prototype,"messages",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/t9n/common")],Mi.prototype,"messagesCommon",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/support/t9n/uriUtils")],Mi.prototype,"messagesURIUtils",void 0),(0,p._)([(0,m.Cb)()],Mi.prototype,"spatialReference",null),(0,p._)([(0,m.Cb)({readOnly:!0})],Mi.prototype,"title",null),(0,p._)([(0,m.Cb)()],Mi.prototype,"visibleElements",void 0),(0,p._)([(0,M.p)("visibleElements")],Mi.prototype,"castVisibleElements",null),(0,p._)([(0,m.Cb)()],Mi.prototype,"map",null),(0,p._)([(0,m.Cb)()],Mi.prototype,"view",null),(0,p._)([(0,m.Cb)({type:_i})],Mi.prototype,"viewModel",void 0);var Ii=Mi=bi=(0,p._)([(0,g.j)("esri.widgets.Feature")],Mi),Fi=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).location=null,i.screenLocationEnabled=!1,i.view=null,i.addHandles([(0,v.gx)((function(){var e=i.screenLocationEnabled?i.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null}),(function(){return i.notifyChange("screenLocation")})),(0,v.YP)((function(){return i.screenLocation}),(function(e,t){null!=e&&null!=t&&i.emit("view-change")}))]),i}return(0,u.Z)(n,[{key:"destroy",value:function(){this.view=null}},{key:"screenLocation",get:function(){var e=this.location,t=this.view;return this.screenLocationEnabled&&null!=e&&null!=t&&t.ready?t.toScreen(e):null}}]),n}(n(91505).Z.EventedAccessor);(0,p._)([(0,m.Cb)()],Fi.prototype,"location",void 0),(0,p._)([(0,m.Cb)()],Fi.prototype,"screenLocation",null),(0,p._)([(0,m.Cb)()],Fi.prototype,"screenLocationEnabled",void 0),(0,p._)([(0,m.Cb)()],Fi.prototype,"view",void 0);var Zi=Fi=(0,p._)([(0,g.j)("esri.widgets.support.AnchorElementViewModel")],Fi),Ai=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).visible=!1,i}return(0,u.Z)(n)}(Zi);(0,p._)([(0,m.Cb)()],Ai.prototype,"visible",void 0);var Li=Ai=(0,p._)([(0,g.j)("esri.widgets.CompassViewModel")],Ai),Ei="esri-spinner",Pi={base:Ei,spinnerStart:"".concat(Ei,"--start"),spinnerFinish:"".concat(Ei,"--finish")},Ti=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i))._animationDelay=500,r._animationPromise=null,r.viewModel=new Li,r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles((0,v.YP)((function(){return e.visible}),(function(t){return e._visibleChange(t)})))}},{key:"destroy",value:function(){this._animationPromise=null}},{key:"location",get:function(){return this.viewModel.location},set:function(e){this.viewModel.location=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"visible",get:function(){return this.viewModel.visible},set:function(e){this.viewModel.visible=e}},{key:"show",value:function(e){var t=this,n=null!==e&&void 0!==e?e:{},i=n.location,r=n.promise;i&&(this.viewModel.location=i),this.visible=!0;r&&r.catch((function(){})).then((function(){return t.hide()}))}},{key:"hide",value:function(){this.visible=!1}},{key:"render",value:function(){var e,t=this.visible,n=!!this.viewModel.screenLocation,i=t&&n,r=!t&&n,a=(e={},(0,o.Z)(e,Pi.spinnerStart,i),(0,o.Z)(e,Pi.spinnerFinish,r),e),l=this._getPositionStyles();return(0,Ue.u)("div",{class:this.classes(Pi.base,a),styles:l})}},{key:"_visibleChange",value:function(e){var t=this;if(e)this.viewModel.screenLocationEnabled=!0;else{var n=(0,Xt.e4)(this._animationDelay);this._animationPromise=n,n.catch((function(){})).then((function(){t._animationPromise===n&&(t.viewModel.screenLocationEnabled=!1,t._animationPromise=null)}))}}},{key:"_getPositionStyles",value:function(){var e=this.viewModel,t=e.screenLocation,n=e.view;if(null==n||null==t)return{};var i=n.padding;return{left:t.x-i.left+"px",top:t.y-i.top+"px"}}}]),n}(I.Z);(0,p._)([(0,m.Cb)()],Ti.prototype,"location",null),(0,p._)([(0,m.Cb)()],Ti.prototype,"view",null),(0,p._)([(0,m.Cb)({type:Li})],Ti.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)()],Ti.prototype,"visible",null);var Si=Ti=(0,p._)([(0,g.j)("esri.widgets.Spinner")],Ti),Ri="esri-features",Oi={icon:"".concat(Ri,"__icon"),actionImage:"".concat(Ri,"__action-image"),base:Ri,container:"".concat(Ri,"__container"),contentContainer:"".concat(Ri,"__content-container"),contentFeature:"".concat(Ri,"__content-feature"),flowItemCollapsed:"".concat(Ri,"__flow-item--collapsed"),header:"".concat(Ri,"__header"),footer:"".concat(Ri,"__footer"),featureMenuObserver:"".concat(Ri,"__feature-menu-observer"),actionExit:"".concat(Ri,"__action--exit"),loader:"".concat(Ri,"__loader"),featuresHeading:"".concat(Ri,"__heading"),paginationActionBar:"".concat(Ri,"__pagination-action-bar"),paginationPrevious:"".concat(Ri,"__pagination-previous"),paginationNext:"".concat(Ri,"__pagination-next")},Ni=function(e){(0,c.Z)(i,e);var t=(0,d.Z)(i);function i(e,n){var r;return(0,s.Z)(this,i),(r=t.call(this,e,n)).messages=null,r.closed=!1,r.closable=!0,r._handleOpenRelatedFeature=function(e){r.emit("open-related-feature",{feature:e})},r}return(0,u.Z)(i,[{key:"loadDependencies",value:function(){return(0,je.h)({action:function(){return Promise.all([n.e(6997),n.e(5138),n.e(6814)]).then(n.bind(n,6814))},"flow-item":function(){return Promise.all([n.e(6997),n.e(5138),n.e(1944),n.e(377)]).then(n.bind(n,10377))}})}},{key:"render",value:function(){var e=this,t=this.flowItems,n=null===t||void 0===t?void 0:t.toArray();return(0,Ue.u)(Ue.D,null,null===n||void 0===n?void 0:n.map((function(t){return e._renderRelatedRecordsFlowItem(t)})))}},{key:"_handleCloseClick",value:function(){this.emit("close")}},{key:"_handleExitClick",value:function(){this.emit("exit")}},{key:"_handleRelatedRecordsBackClick",value:function(){var e,t=null===(e=this.flowItems)||void 0===e?void 0:e.pop();t&&("showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t&&(t.viewModel=null,t.destroy()))}},{key:"_renderRelatedRecordsFlowItem",value:function(e){var t,n=this,i=this.messages,r=this.closable,a=this.closed,o="graphic"in e&&!e.isTable;return(0,Ue.u)("calcite-flow-item",{bind:this,closable:r,closed:a,description:this._getRelatedRecordsFlowItemDescription(e),heading:null!==(t=e.title)&&void 0!==t?t:"",key:"flow-item-".concat(e.viewModel.uid),onCalciteFlowItemBack:this._handleRelatedRecordsBackClick,onCalciteFlowItemClose:this._handleCloseClick},(0,Ue.u)("calcite-action",{appearance:"transparent",bind:this,class:Oi.actionExit,icon:"move-up",key:"exit-related-records-action",label:i.exitRelatedRecords,onclick:this._handleExitClick,scale:"m",slot:"header-actions-start",text:i.exitRelatedRecords,title:i.exitRelatedRecords}),o?(0,Ue.u)("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-related-feature-action",label:i.selectFeature,onclick:function(){return n._handleOpenRelatedFeature(e)},scale:"m",slot:"header-actions-end",text:i.selectFeature,title:i.selectFeature}):null,(0,Ue.u)("div",{class:Oi.container},e.render()))}},{key:"_getRelatedRecordsFlowItemDescription",value:function(e){var t;return"featureCountDescription"in e?e.featureCountDescription:null!==(t=e.viewModel.description)&&void 0!==t?t:""}}]),i}(I.Z);(0,p._)([(0,m.Cb)()],Ni.prototype,"flowItems",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Features/t9n/Features")],Ni.prototype,"messages",void 0),(0,p._)([(0,m.Cb)()],Ni.prototype,"closed",void 0),(0,p._)([(0,m.Cb)()],Ni.prototype,"closable",void 0);var zi=Ni=(0,p._)([(0,g.j)("esri.widgets.Features.FeaturesRelatedRecords")],Ni),Vi=n(39052),Bi=n(56885),Di=function(e,t){function n(){(0,s.Z)(this,n),this._set=new Set,this._observable=new Bi.s}return(0,u.Z)(n,[{key:"size",get:function(){return(0,Vi.it)(this._observable),this._set.size}},{key:"add",value:function(e){var t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}},{key:"clear",value:function(){this._set.size>0&&(this._set.clear(),this._observable.notify())}},{key:"delete",value:function(e){var t=this._set.delete(e);return t&&this._observable.notify(),t}},{key:"entries",value:function(){return(0,Vi.it)(this._observable),this._set.entries()}},{key:"forEach",value:function(e,t){var n=this;(0,Vi.it)(this._observable),this._set.forEach((function(i,r){return e.call(t,i,r,n)}),t)}},{key:"has",value:function(e){return(0,Vi.it)(this._observable),this._set.has(e)}},{key:"keys",value:function(){return(0,Vi.it)(this._observable),this._set.keys()}},{key:"values",value:function(){return(0,Vi.it)(this._observable),this._set.values()}},{key:e,value:function(){return(0,Vi.it)(this._observable),this._set[Symbol.iterator]()}},{key:t,get:function(){return this._set[Symbol.toStringTag]}}]),n}(Symbol.iterator,Symbol.toStringTag),ji=n(81753),qi=n(30651),Wi=(n(79563),n(37817),n(69157),n(99653),"esri-relationship-ramp"),Hi="".concat(Wi,"--diamond"),Yi="".concat(Wi,"--square");"".concat(Hi,"__container"),"".concat(Hi,"__left-column"),"".concat(Hi,"__right-column"),"".concat(Hi,"__middle-column"),"".concat(Hi,"__middle-column--label"),"".concat(Hi,"__middle-column--ramp"),"".concat(Yi,"__table"),"".concat(Yi,"__table-row"),"".concat(Yi,"__table-cell"),"".concat(Yi,"__table-label"),"".concat(Yi,"__table-label--left-bottom"),"".concat(Yi,"__table-label--right-bottom"),"".concat(Yi,"__table-label--left-top"),"".concat(Yi,"__table-label--right-top");n(84652),n(36009);function Ui(e){return e&&"opacity"in e?e.opacity*Ui(e.parent):1}function Gi(e,t){return Ji.apply(this,arguments)}function Ji(){return Ji=(0,a.Z)((0,r.Z)().mark((function e(t,i){var a,o,s,u,c,d,p,f,h,v,m,y,g,b,_,w,k,x,C,M,I,F,Z,A,L,E,P,T,S,R,O;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(c=t.sourceLayer,d=null!==(a=null!=i&&i.useSourceLayer?c:t.layer)&&void 0!==a?a:c,p=Ui(d),null==t.symbol||null!=i&&!0===i.ignoreGraphicSymbol){e.next=13;break}if("web-style"!==t.symbol.type){e.next=10;break}return e.next=7,(0,Tt.Q8)(t.symbol,(0,l.Z)((0,l.Z)({},i),{},{cache:null!=i?i.webStyleCache:null}));case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=t.symbol.clone();case 11:return f=e.t0,e.abrupt("return",((0,Tt.tb)(f,null,p),f));case 13:if(!(h=null!==(o=null!=i?i.renderer:null)&&void 0!==o?o:d&&"renderer"in d?d.renderer:null)||!("getSymbolAsync"in h)){e.next=20;break}return e.next=17,h.getSymbolAsync(t,i);case 17:e.t1=e.sent,e.next=21;break;case 20:e.t1=null;case 21:if(v=e.t1){e.next=24;break}return e.abrupt("return");case 24:if("web-style"!==v.type){e.next=30;break}return e.next=27,v.fetchSymbol((0,l.Z)((0,l.Z)({},i),{},{cache:null!=i?i.webStyleCache:null}));case 27:e.t2=e.sent,e.next=31;break;case 30:e.t2=v.clone();case 31:if(v=e.t2,h&&"visualVariables"in h&&null!==(s=h.visualVariables)&&void 0!==s&&s.length){e.next=34;break}return e.abrupt("return",((0,Tt.tb)(v,null,p),v));case 34:if(!("arcadeRequiredForVisualVariables"in h)||!h.arcadeRequiredForVisualVariables||null!=(null===(u=i)||void 0===u?void 0:u.arcade)){e.next=40;break}return m=(0,l.Z)({},i),e.next=38,(0,q.LC)();case 38:m.arcade=e.sent,i=m;case 40:return e.next=42,Promise.resolve().then(n.bind(n,56011));case 42:y=e.sent,g=y.getColor,b=y.getOpacity,_=y.getAllSizes,w=y.getRotationAngle,k=[],x=[],C=[],M=[],I=(0,Lt.Z)(h.visualVariables),e.prev=52,I.s();case 54:if((F=I.n()).done){e.next=68;break}Z=F.value,e.t3=Z.type,e.next="color"===e.t3?59:"opacity"===e.t3?61:"rotation"===e.t3?63:"size"===e.t3?65:66;break;case 59:return k.push(Z),e.abrupt("break",66);case 61:return x.push(Z),e.abrupt("break",66);case 63:return M.push(Z),e.abrupt("break",66);case 65:Z.target||C.push(Z);case 66:e.next=54;break;case 68:e.next=73;break;case 70:e.prev=70,e.t4=e.catch(52),I.e(e.t4);case 73:return e.prev=73,I.f(),e.finish(73);case 76:if(A=!!k.length&&k[k.length-1],L=A?g(A,t,i):null,E=!!x.length&&x[x.length-1],P=E?b(E,t,i):null,null!=p&&(P=null!=P?P*p:p),(0,Tt.tb)(v,L,P),!C.length){e.next=82;break}return T=_(C,t,i),e.next=82,(0,Tt.e3)(v,T);case 82:for(S=0,R=M;S<R.length;S++)O=R[S],(0,Tt.BR)(v,w(O,t,i),O.axis);return e.abrupt("return",v);case 84:case"end":return e.stop()}}),e,null,[[52,70,73,76]])}))),Ji.apply(this,arguments)}function Qi(e){return e&&"function"==typeof e.highlight}var $i=n(57976),Xi=n(9676),Ki=k.Z.ofType({key:"type",defaultKeyValue:"button",base:$i.Z,typeMap:{button:b.Z,toggle:Xi.Z}}),er=new b.Z({icon:"magnifying-glass-plus",id:"zoom-to-feature",title:"{messages.zoom}",className:We.W.zoomInMagnifyingGlass}),tr=new b.Z({icon:"trash",id:"remove-selected-feature",title:"{messages.remove}",className:We.W.trash}),nr=new b.Z({icon:"magnifying-glass-plus",id:"zoom-to-clustered-features",title:"{messages.zoom}",className:We.W.zoomInMagnifyingGlass}),ir=new Xi.Z({icon:"table",id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:We.W.table,value:!1}),rr=h.Z.getLogger("esri.widgets.Popup.PopupViewModel"),ar=function(e){var t=e.event,n=e.view,i=e.viewModel,r=t.action;if(!r)return Promise.reject(new F.Z("trigger-action:missing-arguments","Event has no action"));var a=r.disabled,o=r.id;if(!o)return Promise.reject(new F.Z("trigger-action:invalid-action","action.id is missing"));if(a)return Promise.reject(new F.Z("trigger-action:invalid-action","Action is disabled"));if(o===er.id)return function(e){return cr.apply(this,arguments)}(i).catch(Xt.H9);if(o===nr.id)return function(e){return dr.apply(this,arguments)}(i);if(o===ir.id)return i.browseClusterEnabled=!i.browseClusterEnabled,i.featureMenuOpen=i.browseClusterEnabled,Promise.resolve();if(o===tr.id){i.visible=!1;var l=i.selectedFeature;if(!l)return Promise.reject(new F.Z("trigger-action:".concat(tr.id),"selectedFeature is required",{selectedFeature:l}));var s=l.sourceLayer;return s?s.remove(l):null===n||void 0===n||n.graphics.remove(l),Promise.resolve()}return Promise.resolve()};function or(e){var t,n=e.selectedFeature,i=e.location;return e.view&&null!==(t=null!==n&&void 0!==n?n:i)&&void 0!==t?t:null}function lr(e){var t;return!!e&&e.isAggregate&&"cluster"===(null===(t=e.sourceLayer)||void 0===t||null===(t=t.featureReduction)||void 0===t?void 0:t.type)}function sr(e,t){return ur.apply(this,arguments)}function ur(){return(ur=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("3d"===(null===n||void 0===n?void 0:n.type)&&t&&"esri.Graphic"===t.declaredClass){e.next=2;break}return e.abrupt("return",!0);case 2:if(!(i=n.getViewForGraphic(t))||!("whenGraphicBounds"in i)){e.next=14;break}return a=null,e.prev=5,e.next=8,i.whenGraphicBounds(t,{useViewElevation:!0});case 8:a=e.sent,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:return e.abrupt("return",!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]);case 14:return e.abrupt("return",!0);case 15:case"end":return e.stop()}}),e,null,[[5,11]])})))).apply(this,arguments)}function cr(){return cr=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c,d,p,f,h;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.location,a=t.selectedFeature,o=t.view,l=t.zoomFactor,s=or(t),o&&s){e.next=4;break}throw u=new F.Z("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:s,view:o}),rr.error(u),u;case 4:if(c=o.scale/l,d=null===(n=t.selectedFeature)||void 0===n?void 0:n.geometry,p=null!==d&&void 0!==d?d:i,e.t0=null!=p&&"point"===p.type,!e.t0){e.next=12;break}return e.next=11,sr(a,o);case 11:e.t0=e.sent;case 12:return f=e.t0,er.active=!0,er.disabled=!0,e.prev=14,e.next=17,t.zoomTo({target:{target:s,scale:f?c:void 0}});case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(14),h=new F.Z("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:a}),rr.error(h);case 23:return e.prev=23,er.active=!1,er.disabled=!1,t.zoomToLocation=null,f&&(t.location=p),e.finish(23);case 26:case"end":return e.stop()}}),e,null,[[14,19,23,26]])}))),cr.apply(this,arguments)}function dr(){return(dr=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,o,l,s,u,c,d,p,f;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,"2d"===(null===(a=t.view)||void 0===a?void 0:a.type)){e.next=4;break}throw o=new F.Z("zoomToCluster:invalid-view","View must be 2d MapView.",{view:a}),rr.error(o),o;case 4:if(n&&lr(n)){e.next=7;break}throw l=new F.Z("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:n}),rr.error(l),l;case 7:return e.next=9,mr(a,n);case 9:return s=e.sent,u=(0,i.Z)(s,2),c=u[0],d=u[1],nr.active=!0,nr.disabled=!0,e.next=16,c.queryExtent(d);case 16:return p=e.sent,f=p.extent,e.next=20,t.zoomTo({target:f});case 20:nr.active=!1,nr.disabled=!1;case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pr(e){return fr.apply(this,arguments)}function fr(){return(fr=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,o,l,s,u,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.view,a=t.selectedFeature,n&&a){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,mr(n,a);case 5:return o=e.sent,l=(0,i.Z)(o,2),s=l[0],u=l[1],e.next=11,s.queryExtent(u);case 11:c=e.sent,d=c.extent,t.selectedClusterBoundaryFeature.geometry=d,n.graphics.add(t.selectedClusterBoundaryFeature);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function hr(e){return vr.apply(this,arguments)}function vr(){return(vr=(0,a.Z)((0,r.Z)().mark((function e(t){var n,a,o,l,s,u,c,d;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.selectedFeature,(a=t.view)&&n){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,mr(a,n);case 5:return o=e.sent,l=(0,i.Z)(o,2),s=l[0],u=l[1],ir.active=!0,ir.disabled=!0,e.next=12,s.queryFeatures(u);case 12:c=e.sent,d=c.features,ir.active=!1,ir.disabled=!1,ir.value=!0,null===t||void 0===t||t.open({features:[n].concat(d),featureMenuOpen:!0});case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mr(e,t){return yr.apply(this,arguments)}function yr(){return(yr=(0,a.Z)((0,r.Z)().mark((function e(t,n){var i,a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.whenLayerView(n.sourceLayer);case 2:return i=e.sent,a=i.createQuery(),o=n.getObjectId(),e.abrupt("return",(a.aggregateIds=null!=o?[o]:[],[i,a]));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gr(e){var t;if(null==e)return null;switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return null===(t=e.extent)||void 0===t?void 0:t.center;default:return null}}var br=n(99505),_r=n(61459),wr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._pendingPromises=new Di,i._fetchFeaturesController=null,i._highlightSelectedFeaturePromise=null,i._highlightActiveFeaturePromise=null,i._selectedClusterFeature=null,i.actions=new Ki,i.activeFeature=null,i.autoCloseEnabled=!1,i.autoOpenEnabled=!0,i.browseClusterEnabled=!1,i.content=null,i.defaultPopupTemplateEnabled=!1,i.featurePage=null,i.featuresPerPage=20,i.featureMenuOpen=!1,i.featureViewModelAbilities=null,i.featureViewModels=[],i.highlightEnabled=!0,i.includeDefaultActions=!0,i.selectedClusterBoundaryFeature=new R.Z({symbol:new _r.Z({outline:{width:1.5,color:"cyan"},style:"none"})}),i.title=null,i.updateLocationEnabled=!1,i.view=null,i.visible=!1,i.zoomFactor=4,i.zoomToLocation=null,i}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([this.on("view-change",(function(){return e._autoClose()})),(0,v.YP)((function(){return[e.highlightEnabled,e.selectedFeature,e.visible,e.view]}),(function(){return e._highlightSelectedFeature()})),(0,v.YP)((function(){return[e.highlightEnabled,e.activeFeature,e.visible,e.view]}),(function(){return e._highlightActiveFeature()})),(0,v.YP)((function(){var t;return null===(t=e.view)||void 0===t||null===(t=t.animation)||void 0===t?void 0:t.state}),(function(t){return e._animationStateChange(t)})),(0,v.YP)((function(){return e.location}),(function(t){return e._locationChange(t)})),(0,v.YP)((function(){return e.selectedFeature}),(function(t){return e._selectedFeatureChange(t)})),(0,v.YP)((function(){return[e.selectedFeatureIndex,e.featureCount,e.featuresPerPage]}),(function(){return e._selectedFeatureIndexChange()})),(0,v.YP)((function(){return[e.featurePage,e.selectedFeatureIndex,e.featureCount,e.featuresPerPage,e.featureViewModels]}),(function(){return e._setGraphicOnFeatureViewModels()})),(0,v.YP)((function(){return e.featureViewModels}),(function(){return e._featureViewModelsChange()})),this.on("trigger-action",(function(t){return ar({event:t,viewModel:e,view:e.view})})),(0,v.gx)((function(){return!e.waitingForResult}),(function(){return e._waitingForResultChange()}),v.Z_),(0,v.YP)((function(){var t,n;return[e.features,null===(t=e.view)||void 0===t?void 0:t.map,null===(n=e.view)||void 0===n?void 0:n.spatialReference]}),(function(){return e._updateFeatureVMs()})),(0,v.YP)((function(){var t;return null===(t=e.view)||void 0===t?void 0:t.scale}),(function(){return e._viewScaleChange()})),(0,v.gx)((function(){return!e.visible}),(function(){return e.browseClusterEnabled=!1})),(0,v.YP)((function(){return e.browseClusterEnabled}),(function(t){return t?e.enableClusterBrowsing():e.disableClusterBrowsing()}))])}},{key:"destroy",value:function(){this._cancelFetchingFeatures(),this._pendingPromises.clear(),this.browseClusterEnabled=!1,this.view=null}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){var e,t=this._get("allActions")||new Ki;t.removeAll();var n=this.actions,i=this.defaultActions,r=this.defaultPopupTemplateEnabled,a=this.includeDefaultActions,o=this.selectedFeature,l=a?i.concat(n):n,s=o&&("function"==typeof o.getEffectivePopupTemplate&&o.getEffectivePopupTemplate(r)||o.popupTemplate),u=null===s||void 0===s?void 0:s.actions,c=null!==s&&void 0!==s&&s.overwriteActions?u:null!==(e=null===u||void 0===u?void 0:u.concat(l))&&void 0!==e?e:l;return null!==c&&void 0!==c&&c.filter(Boolean).forEach((function(e){return t.add(e)})),t}},{key:"defaultActions",get:function(){var e=this._get("defaultActions")||new Ki;return e.removeAll(),e.addMany(lr(this.selectedFeature)?[nr.clone(),ir.clone()]:[er.clone()]),e}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",set:function(e){var t=e||[];this._set("features",t);var n=this.pendingPromisesCount,i=this.promiseCount,r=this.selectedFeatureIndex,a=i&&t.length;a&&n&&-1===r?this.selectedFeatureIndex=0:a&&-1!==r||(this.selectedFeatureIndex=t.length?0:-1)}},{key:"location",set:function(e){var t,n,i=e,r=null===(t=this.view)||void 0===t||null===(t=t.spatialReference)||void 0===t?void 0:t.isWebMercator;(null===e||void 0===e||null===(n=e.spatialReference)||void 0===n?void 0:n.isWGS84)&&r&&(i=(0,ji.$)(e)),this._set("location",i)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(e){var t=this;this._pendingPromises.clear(),this.features=[],Array.isArray(e)&&e.length?(this._set("promises",e),(e=e.slice(0)).forEach((function(e){t._pendingPromises.add(e);e.then((function(n){t._pendingPromises.has(e)&&t._updateFeatures(n),t._updatePendingPromises(e)}),(function(){return t._updatePendingPromises(e)}))}))):this._set("promises",[])}},{key:"selectedFeature",get:function(){var e=this.features,t=this.selectedFeatureIndex;return-1===t?null:e[t]||null}},{key:"selectedFeatureIndex",get:function(){var e=this._get("selectedFeatureIndex");return"number"==typeof e?e:-1},set:function(e){var t=this.featureCount;e=isNaN(e)||e<-1||!t?-1:(e+t)%t,this.activeFeature=null,this._set("selectedFeatureIndex",e)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){var e;return null!==(e=this.view)&&void 0!==e&&e.ready?"ready":"disabled"}},{key:"waitingForContents",get:function(){return this.featureViewModels.some((function(e){return e.waitingForContent}))}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||this.pendingPromisesCount>0)||0!==this.featureCount)}},{key:"centerAtLocation",value:function(){var e=this.view,t=or(this);return t&&e?this.callGoTo({target:{target:t,scale:e.scale}}):Promise.reject(new F.Z("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:t,view:e}))}},{key:"zoomTo",value:function(e){return this.callGoTo(e)}},{key:"clear",value:function(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})}},{key:"fetchFeatures",value:function(e,t){var n=this.view;if(!n||!e)throw new F.Z("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:e,view:n});return n.fetchPopupFeatures(e,{event:null===t||void 0===t?void 0:t.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:null===t||void 0===t?void 0:t.signal})}},{key:"open",value:function(e){var t=(0,l.Z)((0,l.Z)({updateLocationEnabled:!1,promises:[],fetchFeatures:!1},e),{},{visible:!0}),n=t.fetchFeatures;delete t.fetchFeatures,n&&this._setFetchFeaturesPromises(t.location);for(var i=0,r=["actionsMenuOpen","collapsed"];i<r.length;i++){delete t[r[i]]}this.set(t)}},{key:"triggerAction",value:function(e){var t=this.allActions.at(e);t&&!t.disabled&&this.emit("trigger-action",{action:t})}},{key:"next",value:function(){return this.selectedFeatureIndex++,this}},{key:"previous",value:function(){return this.selectedFeatureIndex--,this}},{key:"disableClusterBrowsing",value:function(){(function(e){ir.value=!1;var t=e.features.filter((function(e){return lr(e)}));t.length&&(e.features=t)})(this),this._clearBrowsedClusterGraphics()}},{key:"enableClusterBrowsing",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.view,n=this.selectedFeature,"2d"!==(null===t||void 0===t?void 0:t.type)){e.next=12;break}if(!lr(n)){e.next=9;break}return e.next=5,pr(this);case 5:return e.next=7,hr(this);case 7:e.next=10;break;case 9:h.Z.getLogger(this).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",n);case 10:e.next=13;break;case 12:h.Z.getLogger(this).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleViewClick",value:function(e){this.autoOpenEnabled&&this._fetchFeaturesAndOpen(e)}},{key:"_animationStateChange",value:function(e){this.zoomToLocation||(er.disabled="waiting-for-target"===e)}},{key:"_clearBrowsedClusterGraphics",value:function(){var e,t=[this.selectedClusterBoundaryFeature,this._selectedClusterFeature].filter(y.pC);null!==(e=this.view)&&void 0!==e&&null!==(e=e.graphics)&&void 0!==e&&e.removeMany(t),this._selectedClusterFeature=null,this.selectedClusterBoundaryFeature.geometry=null}},{key:"_viewScaleChange",value:function(){if(lr(this.selectedFeature))return this.browseClusterEnabled=!1,this.visible=!1,void this.clear();this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])}},{key:"_locationChange",value:function(e){var t=this.selectedFeature;this.updateLocationEnabled&&e&&(!t||t.geometry)&&this.centerAtLocation()}},{key:"_selectedFeatureIndexChange",value:function(){this.featurePage=this.featureCount>1?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null}},{key:"_featureViewModelsChange",value:function(){this.featurePage=this.featureCount>1?1:null}},{key:"_setGraphicOnFeatureViewModels",value:function(){var e=this.features,t=this.featureCount,n=this.featurePage,i=this.featuresPerPage,r=this.featureViewModels;if(null!==n){var a=((n-1)*i+t)%t,o=a+i;r.slice(a,o).forEach((function(t,n){var i;t&&(null!==(i=t.graphic)&&void 0!==i||(t.graphic=e[a+n]))}))}}},{key:"_selectedFeatureChange",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.location,i=this.updateLocationEnabled,a=this.view,!t||!a){e.next=19;break}if(!this.browseClusterEnabled){e.next=10;break}if(this._selectedClusterFeature&&(a.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),!lr(t)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,Gi(t);case 7:return t.symbol=e.sent,this._selectedClusterFeature=t,e.abrupt("return",void a.graphics.add(this._selectedClusterFeature));case 10:if((i||!n)&&t.geometry){e.next=18;break}if(!i||t.geometry){e.next=16;break}return e.next=14,this.centerAtLocation();case 14:(l=null===(o=a.center)||void 0===o?void 0:o.clone())&&(this.location=l);case 16:e.next=19;break;case 18:this.location=gr(t.geometry);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_waitingForResultChange",value:function(){!this.featureCount&&this.promises&&(this.visible=!1)}},{key:"_setFetchFeaturesPromises",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchFeaturesWithController(this._getScreenPoint(t||this.location));case 2:n=e.sent,i=n.clientOnlyGraphics,a=n.promisesPerLayerView,o=Promise.resolve(i),l=a.map((function(e){return e.promise})),this.promises=[o].concat((0,_.Z)(l));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_destroyFeatureVMs",value:function(){this.featureViewModels.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",[])}},{key:"_updateFeatureVMs",value:function(){var e=this,t=this.selectedFeature,n=this.features,i=this.featureViewModels,r=this.view;if(lr(t)||(this.browseClusterEnabled=!1),this._destroyFeatureVMs(),null!==n&&void 0!==n&&n.length){var a=i.slice(0),o=[];n.forEach((function(n,i){if(n){var l=null;if(a.some((function(e,t){return e&&e.graphic===n&&(l=e,a.splice(t,1)),!!l})),l)o[i]=l;else{var s=new _i({abilities:e.featureViewModelAbilities,defaultPopupTemplateEnabled:e.defaultPopupTemplateEnabled,spatialReference:null===r||void 0===r?void 0:r.spatialReference,graphic:n===t?n:null,map:null===r||void 0===r?void 0:r.map,view:r});o[i]=s}}})),a.forEach((function(e){return e&&!e.destroyed&&e.destroy()})),this._set("featureViewModels",o)}}},{key:"_getScreenPoint",value:function(e){var t=this.view;return t&&e&&"function"==typeof t.toScreen?t.toScreen(e):null}},{key:"_cancelFetchingFeatures",value:function(){var e=this._fetchFeaturesController;e&&e.abort(),this._fetchFeaturesController=null}},{key:"_fetchFeaturesWithController",value:function(e,t){var n=this;this._cancelFetchingFeatures();var i=new AbortController,r=i.signal;this._fetchFeaturesController=i;var a=this.fetchFeatures(e,{signal:r,event:t});return a.catch((function(){})).then((function(){n._fetchFeaturesController=null})),a}},{key:"_fetchFeaturesAndOpen",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,l,s,u,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.screenPoint,i=t.mapPoint,a=this.view,e.next=5,this._fetchFeaturesWithController(n,t);case 5:o=e.sent,l=o.clientOnlyGraphics,s=o.promisesPerLayerView,u=o.location,c=[Promise.resolve(l)].concat((0,_.Z)(s.map((function(e){return e.promise})))),(null===a||void 0===a?void 0:a.popup)&&"open"in a.popup&&a.popup.open({location:u||i,promises:c});case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updatePendingPromises",value:function(e){e&&this._pendingPromises.has(e)&&this._pendingPromises.delete(e)}},{key:"_autoClose",value:function(){this.autoCloseEnabled&&(this.visible=!1)}},{key:"_getLayerView",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.when();case 2:return e.abrupt("return",t.whenLayerView(n));case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_getHighlightLayer",value:function(e){var t=e.layer,n=e.sourceLayer;return n&&"layer"in n&&n.layer?n.layer:"map-notes"===(null===n||void 0===n?void 0:n.type)||"subtype-group"===(null===n||void 0===n?void 0:n.type)?n:t}},{key:"_getHighlightTarget",value:function(e,t){var n="imagery"===t.type?void 0:"objectIdField"in t?t.objectIdField||"OBJECTID":null,i=e.attributes;return i&&n&&i[n]||e}},{key:"_mapIncludesLayer",value:function(e){var t;return!(null===(t=this.view)||void 0===t||null===(t=t.map)||void 0===t||null===(t=t.allLayers)||void 0===t||!t.includes(e))}},{key:"_highlightActiveFeature",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i,a,o,l,s,u,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight-active-feature",this.removeHandles(t),n=this.highlightEnabled,i=this.view,a=this.activeFeature,o=this.visible,a&&i&&n&&o){e.next=5;break}return e.abrupt("return");case 5:if((l=this._getHighlightLayer(a))&&l instanceof qi.Z&&this._mapIncludesLayer(l)){e.next=8;break}return e.abrupt("return");case 8:return s=this._getLayerView(i,l),this._highlightActiveFeaturePromise=s,e.next=12,s;case 12:if((u=e.sent)&&Qi(u)&&this._highlightActiveFeaturePromise===s&&this.activeFeature&&this.highlightEnabled){e.next=15;break}return e.abrupt("return");case 15:c=u.highlight(this._getHighlightTarget(a,l)),this.addHandles(c,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_highlightSelectedFeature",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){var t,n,i,a,o,l,s,u,c;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t="highlight-selected-feature",this.removeHandles(t),n=this.selectedFeature,i=this.highlightEnabled,a=this.view,o=this.visible,n&&a&&i&&o){e.next=5;break}return e.abrupt("return");case 5:if((l=this._getHighlightLayer(n))&&l instanceof qi.Z&&this._mapIncludesLayer(l)){e.next=8;break}return e.abrupt("return");case 8:return s=this._getLayerView(a,l),this._highlightSelectedFeaturePromise=s,e.next=12,s;case 12:if((u=e.sent)&&Qi(u)&&this._highlightSelectedFeaturePromise===s&&this.selectedFeature&&this.highlightEnabled&&this.visible){e.next=15;break}return e.abrupt("return");case 15:c=u.highlight(this._getHighlightTarget(n,l)),this.addHandles(c,t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_updateFeatures",value:function(e){var t=this.features;if(null!==e&&void 0!==e&&e.length)if(t.length){var n=e.filter((function(e){return!t.includes(e)}));this.features=t.concat(n)}else this.features=e}}]),n}((0,br._)(Zi));(0,p._)([(0,m.Cb)()],wr.prototype,"_fetchFeaturesController",void 0),(0,p._)([(0,m.Cb)({type:Ki})],wr.prototype,"actions",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"active",null),(0,p._)([(0,m.Cb)()],wr.prototype,"activeFeature",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"allActions",null),(0,p._)([(0,m.Cb)()],wr.prototype,"autoCloseEnabled",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"autoOpenEnabled",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"browseClusterEnabled",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"content",void 0),(0,p._)([(0,m.Cb)({type:Ki,readOnly:!0})],wr.prototype,"defaultActions",null),(0,p._)([(0,m.Cb)({type:Boolean})],wr.prototype,"defaultPopupTemplateEnabled",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"featureCount",null),(0,p._)([(0,m.Cb)()],wr.prototype,"featurePage",void 0),(0,p._)([(0,m.Cb)({value:[]})],wr.prototype,"features",null),(0,p._)([(0,m.Cb)()],wr.prototype,"featuresPerPage",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"featureMenuOpen",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"featureViewModelAbilities",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"featureViewModels",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"highlightEnabled",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"includeDefaultActions",void 0),(0,p._)([(0,m.Cb)({type:en.Z})],wr.prototype,"location",null),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"pendingPromisesCount",null),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"promiseCount",null),(0,p._)([(0,m.Cb)()],wr.prototype,"promises",null),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"selectedClusterBoundaryFeature",void 0),(0,p._)([(0,m.Cb)({value:null,readOnly:!0})],wr.prototype,"selectedFeature",null),(0,p._)([(0,m.Cb)({value:-1})],wr.prototype,"selectedFeatureIndex",null),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"selectedFeatureViewModel",null),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"state",null),(0,p._)([(0,m.Cb)()],wr.prototype,"title",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"updateLocationEnabled",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"view",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"visible",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"waitingForContents",null),(0,p._)([(0,m.Cb)({readOnly:!0})],wr.prototype,"waitingForResult",null),(0,p._)([(0,m.Cb)()],wr.prototype,"zoomFactor",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"zoomToLocation",void 0),(0,p._)([(0,m.Cb)()],wr.prototype,"centerAtLocation",null);var kr=wr=(0,p._)([(0,g.j)("esri.widgets.Features.FeaturesViewModel")],wr),xr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).actionBar=!0,e.closeButton=!0,e.collapseButton=!1,e.featureNavigation=!0,e.heading=!0,e.spinner=!0,e}return(0,u.Z)(n)}(O.Z);(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],xr.prototype,"actionBar",void 0),(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],xr.prototype,"closeButton",void 0),(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],xr.prototype,"collapseButton",void 0),(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],xr.prototype,"featureNavigation",void 0),(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],xr.prototype,"heading",void 0),(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],xr.prototype,"spinner",void 0);var Cr=xr=(0,p._)([(0,g.j)("esri.widgets.Features.FeaturesVisibleElements")],xr);function Mr(e){return function(t){t.hasOwnProperty("_delegatedEventNames")||(t._delegatedEventNames=t._delegatedEventNames?t._delegatedEventNames.slice():[]);var n=t._delegatedEventNames,i=Array.isArray(e)?e:function(e){return e.split(",").map((function(e){return e.trim()}))}(e);n.push.apply(n,(0,_.Z)(i))}}var Ir="selected-index",Fr="features-spinner",Zr=function(e){(0,c.Z)(l,e);var t=(0,d.Z)(l);function l(e,n){var o;return(0,s.Z)(this,l),(o=t.call(this,e,n))._featureMenuIntersectionObserverCallback=function(e){var t=(0,i.Z)(e,1)[0];(null===t||void 0===t?void 0:t.isIntersecting)&&null!=o.viewModel.featurePage&&o.viewModel.featurePage++},o._featureMenuIntersectionObserver=new IntersectionObserver(o._featureMenuIntersectionObserverCallback,{root:window.document}),o._featureMenuIntersectionObserverNode=null,o._focusOn=null,o._spinner=null,o._feature=null,o._relatedRecordsFlowItems=new k.Z,o._relatedRecordsWidget=new zi({flowItems:o._relatedRecordsFlowItems}),o._rootFlowItemNode=null,o._featureMenuViewportNode=null,o.collapsed=!1,o.icon=null,o.featureNavigationTop=!1,o.headerActions=new Ki,o.headingLevel=2,o.messages=null,o.messagesCommon=null,o.responsiveActionsEnabled=!1,o.viewModel=new kr,o.visibleElements=new Cr,o._renderAction=function(e,t){var n=o._getActionTitle(e),i=e.type,r=e.active,a=e.uid,l=e.disabled,s=e.indicator;return e.visible?(0,Ue.u)("calcite-action",{active:"toggle"===i&&e.value,appearance:"solid",bind:(0,w.Z)(o),"data-action-uid":a,disabled:l,icon:o._getActionIcon(e),indicator:s,key:"action-".concat(t),loading:r,onclick:o._triggerAction,scale:"s",text:n,title:o._hideActionText?n:void 0},o._getFallbackIcon(e)):null},o._openFeatureMenu=function(){o.featureMenuOpen=!0},o._previousFeature=function(){o.viewModel.selectedFeatureIndex--},o._nextFeature=function(){o.viewModel.selectedFeatureIndex++},o._handleFeatureMenuBack=function(){o.featureMenuOpen&&(o._focusOn="root-flow-item",o.featureMenuOpen=!1)},o._focusFlowItemNode=function(e){o._focusOn===e&&requestAnimationFrame((0,a.Z)((0,r.Z)().mark((function t(){var n,i;return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=e,t.next="menu-flow-item"===t.t0?3:"root-flow-item"===t.t0?6:8;break;case 3:return t.next=5,null===(n=o._featureMenuViewportNode)||void 0===n?void 0:n.setFocus();case 5:return t.abrupt("break",8);case 6:return t.next=8,null===(i=o._rootFlowItemNode)||void 0===i?void 0:i.setFocus();case 8:o._focusOn=null;case 9:case"end":return t.stop()}}),t)}))))},o._focusFlowItemNodeThrottled=(0,C.P)(o._focusFlowItemNode,50),o._displaySpinnerThrottled=(0,C.P)((function(){return o._displaySpinner()}),0),o._addSelectedFeatureIndexHandle(),o.addHandles([o._displaySpinnerThrottled,o._focusFlowItemNodeThrottled,(0,v.YP)((function(){var e;return null===(e=o.viewModel)||void 0===e?void 0:e.active}),(function(){return o._toggleScreenLocationEnabled()})),(0,v.YP)((function(){var e;return null===(e=o.viewModel)||void 0===e?void 0:e.active}),(function(e){return o._relatedRecordsWidget.closed=!e})),(0,v.YP)((function(){var e;return null===(e=o.visibleElements)||void 0===e?void 0:e.closeButton}),(function(e){return o._relatedRecordsWidget.closable=e})),(0,v.YP)((function(){var e;return null===(e=o.visibleElements)||void 0===e?void 0:e.spinner}),(function(e){return o._spinnerEnabledChange(e)})),(0,v.YP)((function(){var e;return null===(e=o.viewModel)||void 0===e?void 0:e.view}),(function(e,t){return o._viewChange(e,t)})),(0,v.YP)((function(){var e;return null===(e=o.viewModel)||void 0===e||null===(e=e.view)||void 0===e?void 0:e.ready}),(function(e,t){return o._viewReadyChange(null!==e&&void 0!==e&&e,null!==t&&void 0!==t&&t)})),(0,v.YP)((function(){var e,t;return[null===(e=o.viewModel)||void 0===e?void 0:e.waitingForResult,null===(t=o.viewModel)||void 0===t?void 0:t.location]}),(function(){o._hideSpinner(),o._displaySpinnerThrottled()})),(0,v.YP)((function(){return o.selectedFeatureWidget}),(function(){return o._destroyRelatedRecordsFlowItemWidgets()})),(0,v.YP)((function(){var e,t=null===(e=o.selectedFeatureWidget)||void 0===e?void 0:e.viewModel;return[null===t||void 0===t?void 0:t.title,null===t||void 0===t?void 0:t.state]}),(function(){return o._setTitleFromFeatureWidget()})),(0,v.YP)((function(){var e,t=null===(e=o.selectedFeatureWidget)||void 0===e?void 0:e.viewModel;return[null===t||void 0===t?void 0:t.content,null===t||void 0===t?void 0:t.state]}),(function(){return o._setContentFromFeatureWidget()})),(0,v.YP)((function(){var e;return null===(e=o.viewModel)||void 0===e?void 0:e.featureViewModels}),(function(){return o._featureMenuViewportScrollTop()})),o._relatedRecordsWidget.on("close",(function(){return o.close()})),o._relatedRecordsWidget.on("exit",(function(){return o._destroyRelatedRecordsFlowItemWidgets()})),o._relatedRecordsWidget.on("open-related-feature",(function(e){var t=e.feature;return o._openRelatedFeature(t)}))]),o}return(0,u.Z)(l,[{key:"loadDependencies",value:function(){return(0,je.h)({action:function(){return Promise.all([n.e(6997),n.e(5138),n.e(6814)]).then(n.bind(n,6814))},"action-bar":function(){return Promise.all([n.e(6997),n.e(5138),n.e(1944),n.e(6214)]).then(n.bind(n,6214))},"action-group":function(){return Promise.all([n.e(6997),n.e(5138),n.e(1944),n.e(405)]).then(n.bind(n,70405))},button:function(){return Promise.all([n.e(6997),n.e(2054),n.e(9950)]).then(n.bind(n,99950))},flow:function(){return n.e(3049).then(n.bind(n,53049))},"flow-item":function(){return Promise.all([n.e(6997),n.e(5138),n.e(1944),n.e(377)]).then(n.bind(n,10377))},list:function(){return Promise.all([n.e(6997),n.e(2054),n.e(8501)]).then(n.bind(n,18501))},"list-item":function(){return Promise.all([n.e(6997),n.e(5138),n.e(7205)]).then(n.bind(n,7205))},"list-item-group":function(){return n.e(8800).then(n.bind(n,78800))},loader:function(){return n.e(2382).then(n.bind(n,92382))}})}},{key:"destroy",value:function(){var e,t;this._destroyRelatedRecordsFlowItemWidgets(),this._destroySelectedFeatureWidget(),this._destroySpinner(),this._unobserveFeatureMenuObserver(),null!==(e=this._featureMenuIntersectionObserver)&&void 0!==e&&e.disconnect(),null===(t=this._relatedRecordsWidget)||void 0===t||t.destroy()}},{key:"_hideActionText",get:function(){var e;if(!this.responsiveActionsEnabled)return!1;var t=null===(e=this.view)||void 0===e?void 0:e.widthBreakpoint;return"xsmall"===t||"small"===t||"medium"===t}},{key:"_featureNavigationVisible",get:function(){return this.viewModel.active&&this.viewModel.featureCount>1&&this.visibleElements.featureNavigation}},{key:"_isCollapsed",get:function(){return this._collapseEnabled&&this.collapsed}},{key:"_collapseEnabled",get:function(){return this.visibleElements.collapseButton&&!!this.title&&!!this.content}},{key:"content",get:function(){return this.viewModel.content},set:function(e){this.viewModel.content=e}},{key:"featureMenuOpen",get:function(){return this.viewModel.featureMenuOpen},set:function(e){this.viewModel.featureMenuOpen=e}},{key:"features",get:function(){return this.viewModel.features},set:function(e){this.viewModel.features=e}},{key:"location",get:function(){return this.viewModel.location},set:function(e){this.viewModel.location=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"promises",get:function(){return this.viewModel.promises},set:function(e){this.viewModel.promises=e}},{key:"selectedFeature",get:function(){return this.viewModel.selectedFeature}},{key:"selectedFeatureIndex",get:function(){return this.viewModel.selectedFeatureIndex},set:function(e){this.viewModel.selectedFeatureIndex=e}},{key:"selectedFeatureWidget",get:function(){var e=this._feature,t=this.headingLevel,n=this._relatedRecordsFlowItems,i=this.viewModel.selectedFeatureViewModel,r={title:!1};return i?(e?(e.viewModel=i,e.visibleElements=r):this._feature=new Ii({flowItems:n,headingLevel:t+1,viewModel:i,visibleElements:r}),this._feature):null}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"updateLocationEnabled",get:function(){return this.viewModel.updateLocationEnabled},set:function(e){this.viewModel.updateLocationEnabled=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"visible",get:function(){return this.viewModel.visible},set:function(e){this.viewModel.visible=e}},{key:"blur",value:function(){var e;this.viewModel.active?null===(e=this._rootFlowItemNode)||void 0===e||e.blur():h.Z.getLogger(this).warn("Features can only be blurred when currently active.")}},{key:"clear",value:function(){return this.viewModel.clear()}},{key:"close",value:function(){this.viewModel.visible=!1}},{key:"fetchFeatures",value:function(e,t){return this.viewModel.fetchFeatures(e,t)}},{key:"focus",value:function(){this.viewModel.active?this._setFocusOn():h.Z.getLogger(this).warn("Features can only be focused when currently active.")}},{key:"next",value:function(){return this.viewModel.next()}},{key:"open",value:function(e){var t,n=this;this.removeHandles(Ir);var i={collapsed:null!==(t=null===e||void 0===e?void 0:e.collapsed)&&void 0!==t&&t};this.set(i),this.viewModel.open(e),this.addHandles((0,v.gx)((function(){return!n.viewModel.waitingForResult}),(function(){return n._addSelectedFeatureIndexHandle()}),{once:!0}))}},{key:"previous",value:function(){return this.viewModel.previous()}},{key:"triggerAction",value:function(e){return this.viewModel.triggerAction(e)}},{key:"render",value:function(){return(0,Ue.u)("div",{bind:this,class:this.classes(Oi.base,qe.z.widget,qe.z.panel),onkeydown:this._onMainKeydown},this._renderHeader(),this._renderContentContainer())}},{key:"_renderFeatureNavigation",value:function(){return[this._renderPagination(),this._renderFeatureMenuButton()]}},{key:"_renderHeader",value:function(){return!this.featureMenuOpen&&this.featureNavigationTop&&this._featureNavigationVisible?(0,Ue.u)("div",{class:Oi.header,key:"header-actions"},this._renderFeatureNavigation()):null}},{key:"_renderFooter",value:function(){return this.featureMenuOpen||this.featureNavigationTop||!this._featureNavigationVisible?null:(0,Ue.u)("div",{class:Oi.footer,key:"footer-actions",slot:"footer"},this._renderFeatureNavigation())}},{key:"_renderFeatureMenuButton",value:function(){var e=this.messages,t=this.viewModel,n=t.featureCount,i=t.selectedFeatureIndex,r=t.pendingPromisesCount;return(0,Ue.u)("calcite-action",{appearance:"solid",bind:this,icon:"list",key:"feature-menu-button",label:e.selectFeature,loading:r>0,onclick:this._openFeatureMenu,scale:"s",text:(0,Cn.n)(e.pageText,{index:(0,T.uf)(i+1),total:(0,T.uf)(n)}),textEnabled:!0,title:e.selectFeature})}},{key:"_renderPagination",value:function(){var e=this.messagesCommon.pagination,t=e.previous,n=e.next;return(0,Ue.u)("calcite-action-bar",{class:Oi.paginationActionBar,expandDisabled:!0,key:"pagination-action-bar",layout:"horizontal",overflowActionsDisabled:!0,scale:"s"},(0,Ue.u)("calcite-action-group",{scale:"s"},(0,Ue.u)("calcite-action",{appearance:"solid",class:Oi.paginationPrevious,icon:"chevron-left",iconFlipRtl:!0,label:t,onclick:this._previousFeature,scale:"s",text:t,title:t}),(0,Ue.u)("calcite-action",{appearance:"solid",icon:"chevron-right",iconFlipRtl:!0,label:n,onclick:this._nextFeature,scale:"s",text:n,title:n})))}},{key:"_renderFeatureMenuItem",value:function(e){var t=this.viewModel,n=e===t.selectedFeatureViewModel,i=t.featureViewModels.indexOf(e);return(0,Ue.u)("calcite-list-item",{bind:this,"data-feature-index":i,key:"feature-menu-item-".concat(e.uid),onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onmouseleave:this._removeActiveFeature,onmouseover:this._setActiveFeature,selected:n,onCalciteListItemSelect:this._selectFeature},(0,Ue.u)("span",{innerHTML:e.title||this.messagesCommon.untitled,slot:"content"}))}},{key:"_groupResultsByLayer",value:function(){var e=this.viewModel.featureViewModels,t=new Map;return e.forEach((function(e){var n,i,r=null===e||void 0===e?void 0:e.graphic;if(r){var a=null!==(n=r.sourceLayer)&&void 0!==n?n:r.layer,o=null!==(i=t.get(a))&&void 0!==i?i:[];t.set(a,[].concat((0,_.Z)(o),[e]))}})),t}},{key:"_renderFeatureMenu",value:function(){var e=this,t=this.viewModel.featureViewModels,n=this._groupResultsByLayer();return t.length?(0,Ue.u)("calcite-list",{selectionAppearance:"icon",selectionMode:"single"},Array.from(n.keys()).map((function(t){var i,r;return(0,Ue.u)("calcite-list-item-group",{heading:null!==(i=null===t||void 0===t?void 0:t.title)&&void 0!==i?i:e.messagesCommon.untitled,key:(null===t||void 0===t?void 0:t.uid)||"untitled"},null===(r=n.get(t))||void 0===r?void 0:r.map((function(t){return e._renderFeatureMenuItem(t)})))}))):null}},{key:"_renderHeaderAction",value:function(e,t){return e.visible?(0,Ue.u)("calcite-action",{active:"toggle"===e.type&&e.value,appearance:"solid",bind:this,"data-action-uid":e.uid,disabled:e.disabled,icon:e.icon||"",indicator:e.indicator,key:"header-action-".concat(t),loading:e.active,onclick:this._triggerHeaderAction,scale:"m",slot:"header-actions-end",text:e.title||"",title:e.title||""}):null}},{key:"_renderHeaderActions",value:function(){var e=this;return this.headerActions.map((function(t,n){return e._renderHeaderAction(t,n)})).toArray()}},{key:"_renderContentFeature",value:function(){var e,t=this.headingLevel,n=this.visibleElements,i=this._isCollapsed,r=this._collapseEnabled,a=this.featureNavigationTop,l=this.viewModel,s=l.title,u=l.active,c=n.heading&&s?s:"";return(0,Ue.u)("calcite-flow-item",{afterCreate:this._storeRootFlowItemNode,afterUpdate:this._focusRootFlowItemNode,bind:this,class:this.classes((e={},(0,o.Z)(e,Oi.contentFeature,!0),(0,o.Z)(e,Oi.flowItemCollapsed,i),e)),closable:n.closeButton,closed:!u,collapsed:i,collapseDirection:a?"down":"up",collapsible:r,headingLevel:t,key:"root-flow-item",onCalciteFlowItemClose:this.close,onCalciteFlowItemToggle:this._handleCollapseToggle},c?(0,Ue.u)(rt,{class:this.classes(Oi.featuresHeading,qe.z.heading),innerHTML:c,key:"header-content",level:this.headingLevel,slot:"header-content"}):null,this._renderHeaderActions(),this._renderActionBar(),i?null:(0,Ue.u)("div",{class:this.classes(Oi.container,Oi.contentContainer)},this._renderContent()),this._renderFooter())}},{key:"_renderFeatureMenuContainer",value:function(){var e=this.viewModel,t=this.featureMenuOpen,n=this.messages,i=this.messagesCommon,r=e.active,a=e.featureViewModels,o=e.pendingPromisesCount;return t?(0,Ue.u)("calcite-flow-item",{afterCreate:this._storeFeatureMenuFlowItemNode,afterUpdate:this._focusFeatureMenuFlowItemNode,bind:this,closable:!1,closed:!r,description:(0,Cn.n)(n.total,{total:a.length}),heading:n.selectFeature,key:"feature-menu",loading:e.waitingForContents,onCalciteFlowItemBack:this._handleFeatureMenuBack},o>0?(0,Ue.u)("calcite-loader",{class:Oi.loader,inline:!0,key:"feature-menu-loader",label:i.loading,scale:"m",slot:"header-actions-end"}):null,(0,Ue.u)("div",{class:Oi.container},this._renderFeatureMenu()),(0,Ue.u)("div",{afterCreate:this._featureMenuIntersectionObserverCreated,bind:this,class:Oi.featureMenuObserver}),(0,Ue.u)("calcite-button",{appearance:"transparent",onclick:this._handleFeatureMenuBack,slot:"footer-actions",width:"full"},i.back)):null}},{key:"_renderContentContainer",value:function(){return(0,Ue.u)("calcite-flow",{key:"content-container"},this._renderContentFeature(),this._renderFeatureMenuContainer(),this._relatedRecordsWidget.render())}},{key:"_getIconStyles",value:function(e){return{"background-image":e?"url(".concat(e,")"):""}}},{key:"_getActionImage",value:function(e){var t=this.selectedFeature,n=null===t||void 0===t?void 0:t.attributes,i=e.image;return i&&n?(0,Cn.n)(i,n):null!==i&&void 0!==i?i:""}},{key:"_getFallbackIcon",value:function(e){var t,n=e.className;if(e.icon)return null;var i=this._getActionImage(e),r=(t={},(0,o.Z)(t,Oi.icon,!!n),(0,o.Z)(t,Oi.actionImage,!!i),t);return n&&(r[n]=!0),i||n?(0,Ue.u)("span",{"aria-hidden":"true",class:this.classes(Oi.icon,r),key:"icon",styles:i?this._getIconStyles(i):{}}):null}},{key:"_renderActionBar",value:function(){var e;return!this._isCollapsed&&this.visibleElements.actionBar&&null!==(e=this.viewModel.allActions)&&void 0!==e&&e.length?(0,Ue.u)("calcite-action-bar",{expandDisabled:!0,expanded:!this._hideActionText,key:"header-action-bar",scale:"s",slot:"action-bar"},(0,Ue.u)("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderActions())):null}},{key:"_renderActions",value:function(){return this.viewModel.allActions.toArray().map(this._renderAction)}},{key:"_renderContent",value:function(){var e,t=null===(e=this.viewModel)||void 0===e?void 0:e.content;return t?"string"==typeof t?(0,Ue.u)("div",{class:wi.i.contentNode,innerHTML:t,key:t}):this.renderNodeContent(t):null}},{key:"_setFocusOn",value:function(){this._focusOn=this.featureMenuOpen?"menu-flow-item":"root-flow-item",this.renderNow()}},{key:"_handleCollapseToggle",value:function(){this.collapsed=!this.collapsed}},{key:"_openRelatedFeature",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.viewModel.updateGeometry();case 2:if(n=t.graphic,null!=(i=null===n||void 0===n?void 0:n.geometry)&&null!=n){e.next=5;break}return e.abrupt("return");case 5:return this._destroyRelatedRecordsFlowItemWidgets(),e.next=8,this.viewModel.zoomTo({target:i});case 8:a=gr(i),this.open({features:[n],location:null!=a?a:void 0});case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_focusRootFlowItemNode",value:function(){this._focusFlowItemNodeThrottled("root-flow-item")}},{key:"_focusFeatureMenuFlowItemNode",value:function(){this._focusFlowItemNodeThrottled("menu-flow-item")}},{key:"_storeRootFlowItemNode",value:function(e){this._rootFlowItemNode=e,this._focusFlowItemNodeThrottled("root-flow-item")}},{key:"_storeFeatureMenuFlowItemNode",value:function(e){this._featureMenuViewportNode=e,this._focusFlowItemNodeThrottled("menu-flow-item")}},{key:"_setActiveFeature",value:function(e){var t,n=this.viewModel,i=e.currentTarget["data-feature-index"];n.activeFeature=(null===(t=n.features)||void 0===t?void 0:t[i])||null}},{key:"_removeActiveFeature",value:function(){this.viewModel.activeFeature=null}},{key:"_selectFeature",value:function(e){var t=e.currentTarget["data-feature-index"];isNaN(t)||(this.viewModel.selectedFeatureIndex=t),this._handleFeatureMenuBack()}},{key:"_unobserveFeatureMenuObserver",value:function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)}},{key:"_featureMenuIntersectionObserverCreated",value:function(e){this._unobserveFeatureMenuObserver(),this._featureMenuIntersectionObserver.observe(e),this._featureMenuIntersectionObserverNode=e}},{key:"_getActionIcon",value:function(e){return e.icon?e.icon:e.image||e.className?void 0:"question"}},{key:"_getActionTitle",value:function(e){var t,n=this.messages,i=this.selectedFeature,r=this.messagesCommon,a=e.id,o=null===i||void 0===i?void 0:i.attributes,l=null!==(t=e.title)&&void 0!==t?t:"",s="zoom-to-feature"===a?(0,Cn.n)(l,{messages:n}):"remove-selected-feature"===a?(0,Cn.n)(l,{messages:r}):"zoom-to-clustered-features"===a||"browse-clustered-features"===a?(0,Cn.n)(l,{messages:n}):e.title;return s&&o?(0,Cn.n)(s,o):null!==s&&void 0!==s?s:""}},{key:"_onMainKeydown",value:function(e){var t=(0,x.kK)(e);"ArrowLeft"===t&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.previous()),"ArrowRight"===t&&(e.stopPropagation(),this._handleFeatureMenuBack(),this.next())}},{key:"_featureMenuViewportScrollTop",value:function(){this._featureMenuViewportNode&&this._featureMenuViewportNode.scrollContentTo({top:0})}},{key:"_setContentFromFeatureWidget",value:function(){var e=this.selectedFeatureWidget;e&&(this.viewModel.content=e)}},{key:"_setTitleFromFeatureWidget",value:function(){var e=this.selectedFeatureWidget,t=this.messagesCommon,n=null===e||void 0===e?void 0:e.viewModel;e&&(this.viewModel.title="error"===(null===n||void 0===n?void 0:n.state)?null===t||void 0===t?void 0:t.errorMessage:(null===n||void 0===n?void 0:n.title)||"")}},{key:"_addSelectedFeatureIndexHandle",value:function(){var e=this,t=(0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.selectedFeatureIndex}),(function(t,n){return e._selectedFeatureIndexUpdated(t,n)}));this.addHandles(t,Ir)}},{key:"_selectedFeatureIndexUpdated",value:function(e,t){this.viewModel.featureCount&&e!==t&&-1!==e&&(this._destroyRelatedRecordsFlowItemWidgets(),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))}},{key:"_triggerHeaderAction",value:function(e){var t=e.currentTarget;if(!t.disabled){var n=t.dataset.actionUid,i=this.headerActions.find((function(e){return e.uid===n}));i&&!i.disabled&&("toggle"===(null===i||void 0===i?void 0:i.type)&&(i.value=!i.value),this.emit("trigger-header-action",{action:i}))}}},{key:"_triggerAction",value:function(e){var t=e.currentTarget;if(!t.disabled){var n=t.dataset.actionUid,i=this.viewModel.allActions,r=i.findIndex((function(e){return e.uid===n})),a=i.at(r);a&&"toggle"===a.type&&(a.value=!a.value),this.viewModel.triggerAction(r)}}},{key:"_createSpinner",value:function(e){e&&(this._spinner=new Si({view:e}),e.ui.add(this._spinner,{key:Fr,position:"manual",internal:!0}))}},{key:"_wireUpView",value:function(e){var t;this._destroySpinner(),e&&(null===(t=this.visibleElements)||void 0===t?void 0:t.spinner)&&this._createSpinner(e)}},{key:"_hideSpinner",value:function(){var e=this._spinner;e&&(e.location=null,e.hide())}},{key:"_viewReadyChange",value:function(e,t){var n;e?this._wireUpView(null===(n=this.viewModel)||void 0===n?void 0:n.view):t&&this.viewModel.clear()}},{key:"_viewChange",value:function(e,t){e&&t&&this.viewModel.clear()}},{key:"_destroySelectedFeatureWidget",value:function(){var e=this._feature;e&&(e.viewModel=null,!e.destroyed&&e.destroy()),this._feature=null}},{key:"_destroyRelatedRecordsFlowItemWidgets",value:function(){this._relatedRecordsFlowItems.removeAll().forEach((function(e){"showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e.viewModel=null,e.destroy()}))}},{key:"_toggleScreenLocationEnabled",value:function(){var e=this.viewModel;e&&(e.screenLocationEnabled=e.active)}},{key:"_displaySpinner",value:function(){var e=this._spinner;if(e){var t=this.viewModel,n=t.location;t.waitingForResult&&n?e.show({location:n}):e.hide()}}},{key:"_destroySpinner",value:function(){var e,t=this._spinner,n=this.view;t&&(null!==n&&void 0!==n&&null!==(e=n.ui)&&void 0!==e&&e.remove(t,Fr),t.destroy(),this._spinner=null)}},{key:"_spinnerEnabledChange",value:function(e){var t;this._destroySpinner(),e&&this._createSpinner(null===(t=this.viewModel)||void 0===t?void 0:t.view)}}]),l}(ki(I.Z));(0,p._)([(0,m.Cb)()],Zr.prototype,"_focusOn",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"_relatedRecordsFlowItems",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"_hideActionText",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"_featureNavigationVisible",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"_isCollapsed",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"_collapseEnabled",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"collapsed",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"content",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"icon",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"featureMenuOpen",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"featureNavigationTop",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"features",null),(0,p._)([(0,m.Cb)({type:Ki})],Zr.prototype,"headerActions",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"headingLevel",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"location",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"label",null),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Features/t9n/Features")],Zr.prototype,"messages",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/t9n/common")],Zr.prototype,"messagesCommon",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"promises",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"responsiveActionsEnabled",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],Zr.prototype,"selectedFeature",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"selectedFeatureIndex",null),(0,p._)([(0,m.Cb)({readOnly:!0})],Zr.prototype,"selectedFeatureWidget",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"title",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"updateLocationEnabled",null),(0,p._)([(0,m.Cb)()],Zr.prototype,"view",null),(0,p._)([(0,m.Cb)({type:kr}),Mr(["triggerAction","trigger-action"])],Zr.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)({type:Cr,nonNullable:!0})],Zr.prototype,"visibleElements",void 0),(0,p._)([(0,m.Cb)()],Zr.prototype,"visible",null);var Ar=Zr=(0,p._)([(0,g.j)("esri.widgets.Features")],Zr),Lr="esri-popup",Er="".concat(Lr,"--is-docked"),Pr={base:Lr,main:"".concat(Lr,"__main-container"),shadow:"".concat(Lr,"--shadow"),isDocked:Er,isDockedTopLeft:"".concat(Er,"-top-left"),isDockedTopCenter:"".concat(Er,"-top-center"),isDockedTopRight:"".concat(Er,"-top-right"),isDockedBottomLeft:"".concat(Er,"-bottom-left"),isDockedBottomCenter:"".concat(Er,"-bottom-center"),isDockedBottomRight:"".concat(Er,"-bottom-right"),alignTopCenter:"".concat(Lr,"--aligned-top-center"),alignBottomCenter:"".concat(Lr,"--aligned-bottom-center"),alignTopLeft:"".concat(Lr,"--aligned-top-left"),alignBottomLeft:"".concat(Lr,"--aligned-bottom-left"),alignTopRight:"".concat(Lr,"--aligned-top-right"),alignBottomRight:"".concat(Lr,"--aligned-bottom-right"),pointer:"".concat(Lr,"__pointer"),pointerDirection:"".concat(Lr,"__pointer-direction")},Tr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e){return(0,s.Z)(this,n),t.call(this,e)}return(0,u.Z)(n)}(kr),Sr=Tr=(0,p._)([(0,g.j)("esri.widgets.Popup.PopupViewModel")],Tr),Rr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).closeButton=!0,e.featureNavigation=!0,e}return(0,u.Z)(n)}(O.Z);(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],Rr.prototype,"closeButton",void 0),(0,p._)([(0,m.Cb)({type:Boolean,nonNullable:!0})],Rr.prototype,"featureNavigation",void 0);var Or=Rr=(0,p._)([(0,g.j)("esri.widgets.Features.PopupVisibleElements")],Rr),Nr={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},zr=function(e){(0,c.Z)(n,e);var t=(0,d.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e,i))._dockAction=new b.Z({id:"popup-dock-action"}),r._featuresWidget=new Ar({responsiveActionsEnabled:!0}),r._containerNode=null,r._mainContainerNode=null,r._pointerOffsetInPx=16,r.alignment="auto",r.collapsed=!1,r.collapseEnabled=!0,r.dockEnabled=!1,r.headingLevel=2,r.maxInlineActions=3,r.messages=null,r.spinnerEnabled=!0,r.viewModel=new Sr,r.visibleElements=new Or,r}return(0,u.Z)(n,[{key:"initialize",value:function(){var e=this;this.addHandles([(0,v.YP)((function(){var t;return[null===(t=e.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.widthBreakpoint,e.dockEnabled]}),(function(){return e._handleDockIcon()}),{initial:!0}),(0,v.YP)((function(){var t,n;return[e.dockEnabled,null===(t=e.messages)||void 0===t?void 0:t.undock,null===(n=e.messages)||void 0===n?void 0:n.dock]}),(function(){return e._handleDockEnabled()}),{initial:!0}),(0,v.YP)((function(){return e.dockOptions}),(function(t){var n=e._dockAction,i=e._featuresWidget.headerActions;i.remove(n),t.buttonEnabled&&i.add(n)}),{initial:!0}),(0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.screenLocation}),(function(){return e._positionContainer()})),(0,v.YP)((function(){var t;return[null===(t=e.viewModel)||void 0===t?void 0:t.active,e.dockEnabled]}),(function(){return e._toggleScreenLocationEnabled()})),(0,v.YP)((function(){var t,n,i,r,a;return[null===(t=e.viewModel)||void 0===t?void 0:t.screenLocation,null===(n=e.viewModel)||void 0===n||null===(n=n.view)||void 0===n?void 0:n.padding,null===(i=e.viewModel)||void 0===i||null===(i=i.view)||void 0===i?void 0:i.size,null===(r=e.viewModel)||void 0===r?void 0:r.active,null===(a=e.viewModel)||void 0===a?void 0:a.location,e.alignment]}),(function(){return e.reposition()})),(0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.size}),(function(t,n){return e._updateDockEnabledForViewSize(t,n)})),(0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t?void 0:t.view}),(function(t,n){return e._viewChange(t,n)})),(0,v.YP)((function(){var t;return null===(t=e.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.ready}),(function(t,n){return e._viewReadyChange(null!==t&&void 0!==t&&t,null!==n&&void 0!==n&&n)})),(0,v.YP)((function(){return e.viewModel}),(function(){return e._featuresWidget.viewModel=e.viewModel}),{initial:!0}),(0,v.YP)((function(){return e._featureNavigationTop}),(function(t){return e._featuresWidget.featureNavigationTop=t}),{initial:!0}),(0,v.YP)((function(){return e.headingLevel}),(function(t){return e._featuresWidget.headingLevel=t}),{initial:!0}),(0,v.YP)((function(){return e.collapseEnabled}),(function(t){return e._featuresWidget.visibleElements.collapseButton=t}),{initial:!0}),(0,v.YP)((function(){return e.collapsed}),(function(t){return e._featuresWidget.collapsed=t}),{initial:!0}),(0,v.YP)((function(){return e.visibleElements.closeButton}),(function(t){return e._featuresWidget.visibleElements.closeButton=!!t}),{initial:!0}),(0,v.YP)((function(){return e.spinnerEnabled}),(function(t){return e._featuresWidget.visibleElements.spinner=t}),{initial:!0}),(0,v.YP)((function(){return e.visibleElements.featureNavigation}),(function(t){return e._featuresWidget.visibleElements.featureNavigation=!!t}),{initial:!0}),(0,v.on)((function(){return e._featuresWidget}),"trigger-header-action",(function(t){t.action===e._dockAction&&(e.dockEnabled=!e.dockEnabled)}))])}},{key:"destroy",value:function(){var e;this._dockAction.destroy(),null===(e=this._featuresWidget)||void 0===e||e.destroy()}},{key:"_featureNavigationTop",get:function(){var e=this.currentAlignment,t=this.currentDockPosition;return"bottom-left"===e||"bottom-center"===e||"bottom-right"===e||"top-left"===t||"top-center"===t||"top-right"===t}},{key:"actions",get:function(){return this.viewModel.actions},set:function(e){this.viewModel.actions=e}},{key:"autoCloseEnabled",get:function(){return this.viewModel.autoCloseEnabled},set:function(e){this.viewModel.autoCloseEnabled=e}},{key:"autoOpenEnabled",get:function(){return(0,f.Mr)(h.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled},set:function(e){(0,f.Mr)(h.Z.getLogger(this),"autoOpenEnabled",{replacement:"MapView/SceneView.popupEnabled",version:"4.27"}),this.viewModel.autoOpenEnabled=e}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(e){this.viewModel.defaultPopupTemplateEnabled=e}},{key:"content",get:function(){return this.viewModel.content},set:function(e){this.viewModel.content=e}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||Nr},set:function(e){var t,n=(0,l.Z)({},Nr),i=null===(t=this.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.breakpoints,r={};i&&(r.width=i.xsmall,r.height=i.xsmall);var a=(0,l.Z)((0,l.Z)({},n),e),o=(0,l.Z)((0,l.Z)({},n.breakpoint),r),s=a.breakpoint;"object"==typeof s?a.breakpoint=(0,l.Z)((0,l.Z)({},o),s):s&&(a.breakpoint=o),this._set("dockOptions",a),this._setCurrentDockPosition(),this.reposition()}},{key:"featureCount",get:function(){return this.viewModel.featureCount}},{key:"featureMenuOpen",get:function(){return this.viewModel.featureMenuOpen},set:function(e){this.viewModel.featureMenuOpen=e}},{key:"features",get:function(){return this.viewModel.features},set:function(e){this.viewModel.features=e}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(e){this.viewModel.goToOverride=e}},{key:"highlightEnabled",get:function(){return this.viewModel.highlightEnabled},set:function(e){this.viewModel.highlightEnabled=e}},{key:"location",get:function(){return this.viewModel.location},set:function(e){this.viewModel.location=e}},{key:"label",get:function(){var e,t;return null!==(e=null===(t=this.messages)||void 0===t?void 0:t.widgetLabel)&&void 0!==e?e:""},set:function(e){this._overrideIfSome("label",e)}},{key:"promises",get:function(){return this.viewModel.promises},set:function(e){this.viewModel.promises=e}},{key:"selectedFeature",get:function(){return this.viewModel.selectedFeature}},{key:"selectedFeatureIndex",get:function(){return this.viewModel.selectedFeatureIndex},set:function(e){this.viewModel.selectedFeatureIndex=e}},{key:"selectedFeatureWidget",get:function(){return this._featuresWidget.selectedFeatureWidget}},{key:"title",get:function(){return this.viewModel.title},set:function(e){this.viewModel.title=e}},{key:"updateLocationEnabled",get:function(){return this.viewModel.updateLocationEnabled},set:function(e){this.viewModel.updateLocationEnabled=e}},{key:"view",get:function(){return this.viewModel.view},set:function(e){this.viewModel.view=e}},{key:"visible",get:function(){return this.viewModel.visible},set:function(e){this.viewModel.visible=e}},{key:"blur",value:function(){this.viewModel.active||h.Z.getLogger(this).warn("Popup can only be blurred when currently active."),this._featuresWidget.blur()}},{key:"clear",value:function(){return this.viewModel.clear()}},{key:"close",value:function(){this.visible=!1}},{key:"fetchFeatures",value:function(e,t){return this.viewModel.fetchFeatures(e,t)}},{key:"focus",value:function(){this.viewModel.active||h.Z.getLogger(this).warn("Popup can only be focused when currently active."),this.renderNow(),this._featuresWidget.focus()}},{key:"next",value:function(){return this.viewModel.next()}},{key:"open",value:function(e){var t=!!e&&!!e.featureMenuOpen,n={collapsed:!!e&&!!e.collapsed,featureMenuOpen:t};this.set(n),this.viewModel.open(e),this._shouldFocus(e)}},{key:"previous",value:function(){return this.viewModel.previous()}},{key:"reposition",value:function(){this.renderNow(),this._positionContainer(),this._setCurrentAlignment()}},{key:"triggerAction",value:function(e){return this.viewModel.triggerAction(e)}},{key:"render",value:function(){var e,t,n,i=this.dockEnabled,r=this.currentAlignment,a=this.currentDockPosition,l=this.viewModel.active,s=l&&i,u=l&&!i,c=null===(e=this.selectedFeature)||void 0===e||null===(e=e.layer)||void 0===e?void 0:e.title,d=null===(t=this.selectedFeature)||void 0===t||null===(t=t.layer)||void 0===t?void 0:t.id,p=(n={},(0,o.Z)(n,Pr.alignTopCenter,"top-center"===r),(0,o.Z)(n,Pr.alignBottomCenter,"bottom-center"===r),(0,o.Z)(n,Pr.alignTopLeft,"top-left"===r),(0,o.Z)(n,Pr.alignBottomLeft,"bottom-left"===r),(0,o.Z)(n,Pr.alignTopRight,"top-right"===r),(0,o.Z)(n,Pr.alignBottomRight,"bottom-right"===r),(0,o.Z)(n,Pr.isDocked,s),(0,o.Z)(n,Pr.shadow,u),(0,o.Z)(n,Pr.isDockedTopLeft,"top-left"===a),(0,o.Z)(n,Pr.isDockedTopCenter,"top-center"===a),(0,o.Z)(n,Pr.isDockedTopRight,"top-right"===a),(0,o.Z)(n,Pr.isDockedBottomLeft,"bottom-left"===a),(0,o.Z)(n,Pr.isDockedBottomCenter,"bottom-center"===a),(0,o.Z)(n,Pr.isDockedBottomRight,"bottom-right"===a),n);return(0,Ue.u)("div",{afterCreate:this._positionContainer,afterUpdate:this._positionContainer,bind:this,class:this.classes(Pr.base,p),"data-layer-id":d,"data-layer-title":c,role:"presentation"},l?[this._renderMainContainer(),this._renderPointer()]:null)}},{key:"_renderPointer",value:function(){return this.dockEnabled?null:(0,Ue.u)("div",{class:Pr.pointer,key:"popup-pointer",role:"presentation"},(0,Ue.u)("div",{class:this.classes(Pr.pointerDirection,Pr.shadow)}))}},{key:"_renderMainContainer",value:function(){var e=this.dockEnabled,t=(0,o.Z)({},Pr.shadow,e);return(0,Ue.u)("div",{afterCreate:this._setMainContainerNode,afterUpdate:this._setMainContainerNode,bind:this,class:this.classes(Pr.main,qe.z.widget,t)},this._featuresWidget.render())}},{key:"_shouldFocus",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=null===t||void 0===t?void 0:t.shouldFocus,!e.t0){e.next=5;break}return e.next=4,(0,v.N1)((function(){var e;return!0===(null===(e=n.viewModel)||void 0===e?void 0:e.active)}));case 4:this.focus();case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isOutsideView",value:function(e){var t=e.popupHeight,n=e.popupWidth,i=e.screenLocation,r=e.side,a=e.view;if(isNaN(n)||isNaN(t)||!a||!i)return!1;var o=a.padding;return"right"===r&&i.x+n/2>a.width-o.right||"left"===r&&i.x-n/2<o.left||"top"===r&&i.y-t<o.top||"bottom"===r&&i.y+t>a.height-o.bottom}},{key:"_calculateAutoAlignment",value:function(e){if("auto"!==e)return e;var t=this._pointerOffsetInPx,n=this._containerNode,i=this._mainContainerNode,r=this.viewModel,a=r.screenLocation,o=r.view;if(null==a||!o||!n)return"top-center";function l(e){return parseInt(e.replaceAll(/[^-\d\.]/g,""),10)}var s=i?window.getComputedStyle(i,null):null,u=s?l(s.getPropertyValue("max-height")):0,c=s?l(s.getPropertyValue("height")):0,d=n.getBoundingClientRect(),p=d.height,f=d.width+t,h=Math.max(p,u,c)+t,v=this._isOutsideView({popupHeight:h,popupWidth:f,screenLocation:a,side:"right",view:o}),m=this._isOutsideView({popupHeight:h,popupWidth:f,screenLocation:a,side:"left",view:o}),y=this._isOutsideView({popupHeight:h,popupWidth:f,screenLocation:a,side:"top",view:o}),g=this._isOutsideView({popupHeight:h,popupWidth:f,screenLocation:a,side:"bottom",view:o});return m?y?"bottom-right":"top-right":v?y?"bottom-left":"top-left":y?g?"top-center":"bottom-center":"top-center"}},{key:"_callCurrentAlignment",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getCurrentAlignment",value:function(){var e=this.alignment;return this.dockEnabled||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(e)))}},{key:"_setCurrentAlignment",value:function(){this._set("currentAlignment",this._getCurrentAlignment())}},{key:"_setCurrentDockPosition",value:function(){this._set("currentDockPosition",this._getCurrentDockPosition())}},{key:"_calculatePositionResult",value:function(e){var t=["left","right"];return(0,He.dZ)(this.container)&&t.reverse(),null===e||void 0===e?void 0:e.replace(/leading/gi,t[0]).replaceAll(/trailing/gi,t[1])}},{key:"_callDockPosition",value:function(e){return"function"==typeof e?e.call(this):e}},{key:"_getDockPosition",value:function(){var e;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null===(e=this.dockOptions)||void 0===e?void 0:e.position)))}},{key:"_getCurrentDockPosition",value:function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null}},{key:"_calculateAutoDockPosition",value:function(e){var t;if("auto"!==e)return e;var n=null===(t=this.viewModel)||void 0===t?void 0:t.view,i=(0,He.dZ)(this.container)?"top-left":"top-right";if(!n)return i;var r=n.padding||{left:0,right:0,top:0,bottom:0},a=n.width-r.left-r.right,o=n.breakpoints;return o&&a<=o.xsmall?"bottom-center":i}},{key:"_getDockIcon",value:function(){var e=this._getDockPosition();if(this.dockEnabled)return"minimize";switch(e){case"top-left":case"bottom-left":return"dock-left";case"top-center":return"maximize";case"bottom-center":return"dock-bottom";default:return"dock-right"}}},{key:"_handleDockIcon",value:function(){this._dockAction.icon=this._getDockIcon()}},{key:"_handleDockEnabled",value:function(){var e,t;this._dockAction.title=this.dockEnabled?null===(e=this.messages)||void 0===e?void 0:e.undock:null===(t=this.messages)||void 0===t?void 0:t.dock}},{key:"_setMainContainerNode",value:function(e){this._mainContainerNode=e}},{key:"_positionContainer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._containerNode;if(e&&(this._containerNode=e),this._containerNode){var t=this.viewModel.screenLocation,n=this._containerNode.getBoundingClientRect().width,i=this._calculatePositionStyle(t,n);i&&Object.assign(this._containerNode.style,i)}}},{key:"_calculateFullWidth",value:function(e){var t=this.currentAlignment,n=this._pointerOffsetInPx;return"top-left"===t||"bottom-left"===t||"top-right"===t||"bottom-right"===t?e+n:e}},{key:"_calculateAlignmentPosition",value:function(e,t,n,i){var r=this.currentAlignment,a=this._pointerOffsetInPx;if(n){var o=n.padding,l=i/2,s=n.height-t,u=n.width-e;return"bottom-center"===r?{top:t+a-o.top,left:e-l-o.left}:"top-left"===r?{bottom:s+a-o.bottom,right:u+a-o.right}:"bottom-left"===r?{top:t+a-o.top,right:u+a-o.right}:"top-right"===r?{bottom:s+a-o.bottom,left:e+a-o.left}:"bottom-right"===r?{top:t+a-o.top,left:e+a-o.left}:"top-center"===r?{bottom:s+a-o.bottom,left:e-l-o.left}:void 0}}},{key:"_calculatePositionStyle",value:function(e,t){var n=this.dockEnabled,i=this.view;if(i){if(n)return{left:"",top:"",right:"",bottom:""};if(null!=e&&t){var r=this._calculateFullWidth(t),a=this._calculateAlignmentPosition(e.x,e.y,i,r);return a?{top:void 0!==a.top?"".concat(a.top,"px"):"auto",left:void 0!==a.left?"".concat(a.left,"px"):"auto",bottom:void 0!==a.bottom?"".concat(a.bottom,"px"):"auto",right:void 0!==a.right?"".concat(a.right,"px"):"auto"}:void 0}}}},{key:"_viewChange",value:function(e,t){e&&t&&(this.close(),this.clear())}},{key:"_viewReadyChange",value:function(e,t){e?this._wireUpView():t&&(this.close(),this.clear())}},{key:"_wireUpView",value:function(){this._setDockEnabledForViewSize(this.dockOptions)}},{key:"_dockingThresholdCrossed",value:function(e,t,n){var r=(0,i.Z)(e,2),a=r[0],o=r[1],l=(0,i.Z)(t,2),s=l[0],u=l[1],c=null!==n&&void 0!==n?n:{},d=c.width,p=void 0===d?0:d,f=c.height,h=void 0===f?0:f;return a<=p&&s>p||a>p&&s<=p||o<=h&&u>h||o>h&&u<=h}},{key:"_updateDockEnabledForViewSize",value:function(e,t){var n;if(e&&t){var i=(null===(n=this.viewModel)||void 0===n||null===(n=n.view)||void 0===n?void 0:n.padding)||{left:0,right:0,top:0,bottom:0},r=i.left+i.right,a=i.top+i.bottom,o=[],l=[];o[0]=e[0]-r,o[1]=e[1]-a,l[0]=t[0]-r,l[1]=t[1]-a;var s=this.dockOptions,u=s.breakpoint;this._dockingThresholdCrossed(o,l,u)&&this._setDockEnabledForViewSize(s),this._setCurrentDockPosition()}}},{key:"_toggleScreenLocationEnabled",value:function(){var e=this.dockEnabled,t=this.viewModel;if(t){var n=t.active&&!e;t.screenLocationEnabled=n}}},{key:"_shouldDockAtCurrentViewSize",value:function(e){var t,n,i,r=e.breakpoint,a=null===(t=this.viewModel)||void 0===t||null===(t=t.view)||void 0===t?void 0:t.ui;if(!a)return!1;var o=a.width,l=a.height;if(isNaN(o)||isNaN(l))return!1;if(!r)return!1;var s=r.hasOwnProperty("width")&&o<=(null!==(n=r.width)&&void 0!==n?n:0),u=r.hasOwnProperty("height")&&l<=(null!==(i=r.height)&&void 0!==i?i:0);return s||u}},{key:"_setDockEnabledForViewSize",value:function(e){e.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(e))}}]),n}(I.Z);(0,p._)([(0,m.Cb)({readOnly:!0})],zr.prototype,"_featureNavigationTop",null),(0,p._)([(0,m.Cb)()],zr.prototype,"actions",null),(0,p._)([(0,m.Cb)()],zr.prototype,"alignment",void 0),(0,p._)([(0,m.Cb)()],zr.prototype,"autoCloseEnabled",null),(0,p._)([(0,m.Cb)()],zr.prototype,"autoOpenEnabled",null),(0,p._)([(0,m.Cb)()],zr.prototype,"defaultPopupTemplateEnabled",null),(0,p._)([(0,m.Cb)()],zr.prototype,"content",null),(0,p._)([(0,m.Cb)()],zr.prototype,"collapsed",void 0),(0,p._)([(0,m.Cb)()],zr.prototype,"collapseEnabled",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],zr.prototype,"currentAlignment",null),(0,p._)([(0,m.Cb)({readOnly:!0})],zr.prototype,"currentDockPosition",null),(0,p._)([(0,m.Cb)()],zr.prototype,"dockOptions",null),(0,p._)([(0,m.Cb)()],zr.prototype,"dockEnabled",void 0),(0,p._)([(0,m.Cb)({readOnly:!0})],zr.prototype,"featureCount",null),(0,p._)([(0,m.Cb)()],zr.prototype,"featureMenuOpen",null),(0,p._)([(0,m.Cb)()],zr.prototype,"features",null),(0,p._)([(0,m.Cb)()],zr.prototype,"goToOverride",null),(0,p._)([(0,m.Cb)()],zr.prototype,"headingLevel",void 0),(0,p._)([(0,m.Cb)()],zr.prototype,"highlightEnabled",null),(0,p._)([(0,m.Cb)()],zr.prototype,"location",null),(0,p._)([(0,m.Cb)()],zr.prototype,"label",null),(0,p._)([(0,m.Cb)()],zr.prototype,"maxInlineActions",void 0),(0,p._)([(0,m.Cb)(),(0,Ye.H)("esri/widgets/Popup/t9n/Popup")],zr.prototype,"messages",void 0),(0,p._)([(0,m.Cb)()],zr.prototype,"promises",null),(0,p._)([(0,m.Cb)({readOnly:!0})],zr.prototype,"selectedFeature",null),(0,p._)([(0,m.Cb)()],zr.prototype,"selectedFeatureIndex",null),(0,p._)([(0,m.Cb)({readOnly:!0})],zr.prototype,"selectedFeatureWidget",null),(0,p._)([(0,m.Cb)()],zr.prototype,"spinnerEnabled",void 0),(0,p._)([(0,m.Cb)()],zr.prototype,"title",null),(0,p._)([(0,m.Cb)()],zr.prototype,"updateLocationEnabled",null),(0,p._)([(0,m.Cb)()],zr.prototype,"view",null),(0,p._)([(0,m.Cb)({type:Sr}),Mr(["triggerAction","trigger-action"])],zr.prototype,"viewModel",void 0),(0,p._)([(0,m.Cb)()],zr.prototype,"visible",null),(0,p._)([(0,m.Cb)({type:Or,nonNullable:!0})],zr.prototype,"visibleElements",void 0);var Vr=zr=(0,p._)([(0,g.j)("esri.widgets.Popup")],zr)},53963:function(e,t,n){n.d(t,{Qd:function(){return i},o:function(){return r}});n(78088),n(67005),n(80975);function i(e){return e&&"function"==typeof e.render}function r(e){return e&&"function"==typeof e.postMixInProperties&&"function"==typeof e.buildRendering&&"function"==typeof e.postCreate&&"function"==typeof e.startup}}}]);
//# sourceMappingURL=4971.f9e9fd8a.chunk.js.map